
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SetupEnvironment &#8212; TCR paper notebook</title>
    
  <link href="_static/css/theme.css" rel="stylesheet">
  <link href="_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/sphinx-book-theme.d59cb220de22ca1c485ebbdc042f0030.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">TCR paper notebook</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="intro.html">
   Welcome to the huARdb TCR analysis notebook
  </a>
 </li>
</ul>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="huARdb_TCR_paper_notebook.html">
   Import Basic Packages and Definitions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="huARdb_TCR_DeepInsight_notebook.html">
   TCR-DeepInsight Vignette
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="_sources/GEXCD8.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
                onclick="printPdf(this)" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/WanluLiuLab/TCR-DeepInsight"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/WanluLiuLab/TCR-DeepInsight/issues/new?title=Issue%20on%20page%20%2FGEXCD8.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/WanluLiuLab/TCR-DeepInsight/master?urlpath=tree/docs/GEXCD8.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show noprint">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   SetupEnvironment
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#loaddata">
   LoadData
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#clonotypetableprocessing">
   ClonotypeTableProcessing
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#clonotypedefinition">
     ClonotypeDefinition
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#sharingclonotype">
     SharingClonotype
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#part1gex-tcrfeatures">
   Part1GEX/TCRfeatures
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#functions">
     Functions
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#statsfunctions">
       StatsFunctions
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#plotsfunctions">
       PlotsFunctions
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#mainfigure1">
     MainFigure1
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#supfigures">
     SupFigures
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#suptables">
       SupTables
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#supfigure1">
       SupFigure1
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#supfigure2">
       SupFigure2
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#supfigure3">
       SupFigure3
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#part2twotypetexincancer">
   Part2TwoTypeTexInCancer
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id1">
     Functions
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id2">
       StatsFunctions
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id3">
       PlotsFunctions
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#mainfigure2">
     MainFigure2
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#clonotypesharing">
       ClonotypeSharing
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id4">
     SupFigures
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#diseaserelavance">
       DiseaseRelavance
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#cxcl13analysis">
       CXCL13Analysis
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#part3expansionininflam-irae">
   Part3ExpansionInInflam&amp;irAE
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#cellnumrelated">
     CellNumRelated
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id5">
       Functions
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#circulating">
       Circulating
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#tissue">
       Tissue
      </a>
      <ul class="nav section-nav flex-column">
       <li class="toc-h4 nav-item toc-entry">
        <a class="reference internal nav-link" href="#gzmktexvsitgb2trm">
         GZMKTexvsITGB2Trm
        </a>
       </li>
      </ul>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#clonotyperelated">
     ClonotypeRelated
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id6">
       Functions
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id7">
       Circulating
      </a>
      <ul class="nav section-nav flex-column">
       <li class="toc-h4 nav-item toc-entry">
        <a class="reference internal nav-link" href="#iltckrelatedanalysis">
         ILTCKrelatedAnalysis
        </a>
        <ul class="nav section-nav flex-column">
         <li class="toc-h5 nav-item toc-entry">
          <a class="reference internal nav-link" href="#expansionanalysis">
           ExpansionAnalysis
          </a>
         </li>
        </ul>
       </li>
      </ul>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id8">
       Tissue
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#supcolitisvsarthritis">
     SupColitisVsArthritis
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#part4sharingininflam-irae">
   Part4SharingInInflam&amp;irAE
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#dataprocessing">
     DataProcessing
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#sharedclonotypes">
     SharedClonotypes
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#cxcl13expression">
     CXCL13expression
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#velo">
     Velo
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#inflammation">
       Inflammation
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#irae">
       irAE
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#stumor">
       Stumor
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#transfervae">
   TransferVAE
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#mainfigures">
     MainFigures
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id9">
     SupFigures
    </a>
   </li>
  </ul>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>SetupEnvironment</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   SetupEnvironment
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#loaddata">
   LoadData
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#clonotypetableprocessing">
   ClonotypeTableProcessing
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#clonotypedefinition">
     ClonotypeDefinition
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#sharingclonotype">
     SharingClonotype
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#part1gex-tcrfeatures">
   Part1GEX/TCRfeatures
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#functions">
     Functions
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#statsfunctions">
       StatsFunctions
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#plotsfunctions">
       PlotsFunctions
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#mainfigure1">
     MainFigure1
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#supfigures">
     SupFigures
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#suptables">
       SupTables
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#supfigure1">
       SupFigure1
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#supfigure2">
       SupFigure2
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#supfigure3">
       SupFigure3
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#part2twotypetexincancer">
   Part2TwoTypeTexInCancer
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id1">
     Functions
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id2">
       StatsFunctions
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id3">
       PlotsFunctions
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#mainfigure2">
     MainFigure2
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#clonotypesharing">
       ClonotypeSharing
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id4">
     SupFigures
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#diseaserelavance">
       DiseaseRelavance
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#cxcl13analysis">
       CXCL13Analysis
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#part3expansionininflam-irae">
   Part3ExpansionInInflam&amp;irAE
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#cellnumrelated">
     CellNumRelated
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id5">
       Functions
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#circulating">
       Circulating
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#tissue">
       Tissue
      </a>
      <ul class="nav section-nav flex-column">
       <li class="toc-h4 nav-item toc-entry">
        <a class="reference internal nav-link" href="#gzmktexvsitgb2trm">
         GZMKTexvsITGB2Trm
        </a>
       </li>
      </ul>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#clonotyperelated">
     ClonotypeRelated
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id6">
       Functions
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id7">
       Circulating
      </a>
      <ul class="nav section-nav flex-column">
       <li class="toc-h4 nav-item toc-entry">
        <a class="reference internal nav-link" href="#iltckrelatedanalysis">
         ILTCKrelatedAnalysis
        </a>
        <ul class="nav section-nav flex-column">
         <li class="toc-h5 nav-item toc-entry">
          <a class="reference internal nav-link" href="#expansionanalysis">
           ExpansionAnalysis
          </a>
         </li>
        </ul>
       </li>
      </ul>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id8">
       Tissue
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#supcolitisvsarthritis">
     SupColitisVsArthritis
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#part4sharingininflam-irae">
   Part4SharingInInflam&amp;irAE
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#dataprocessing">
     DataProcessing
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#sharedclonotypes">
     SharedClonotypes
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#cxcl13expression">
     CXCL13expression
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#velo">
     Velo
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#inflammation">
       Inflammation
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#irae">
       irAE
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#stumor">
       Stumor
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#transfervae">
   TransferVAE
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#mainfigures">
     MainFigures
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id9">
     SupFigures
    </a>
   </li>
  </ul>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="setupenvironment">
<h1>SetupEnvironment<a class="headerlink" href="#setupenvironment" title="Permalink to this headline">Â¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="o">/</span><span class="n">Volumes</span><span class="o">/</span><span class="n">rsch</span><span class="o">/</span><span class="n">GEXnotebook</span><span class="o">/</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/Volumes/rsch/GEXnotebook
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pwd</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;/Volumes/rsch/GEXnotebook&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">xlwt</span>
<span class="kn">import</span> <span class="nn">gseapy</span>
<span class="kn">import</span> <span class="nn">scanpy</span> <span class="k">as</span> <span class="nn">sc</span>
<span class="kn">import</span> <span class="nn">scirpy</span> <span class="k">as</span> <span class="nn">ir</span>
<span class="kn">import</span> <span class="nn">scvelo</span> <span class="k">as</span> <span class="nn">scv</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">networkx</span> <span class="k">as</span> <span class="nn">nx</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">Counter</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">stats</span>
<span class="kn">from</span> <span class="nn">scipy.integrate</span> <span class="kn">import</span> <span class="n">odeint</span>
<span class="kn">from</span> <span class="nn">matplotlib_venn</span> <span class="kn">import</span> <span class="n">venn2</span>
<span class="kn">from</span> <span class="nn">scanpy.plotting._anndata</span> <span class="kn">import</span> <span class="n">_prepare_dataframe</span>

<span class="n">setPltLinewidth</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">rcParamsDefault</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.dpi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">150</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;savefig.dpi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">150</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">15</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;axes.linewidth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.family&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Arial&quot;</span>

<span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;pdf.fonttype&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">42</span>
<span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;ps.fonttype&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">42</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># color_palette</span>
<span class="n">subtype_color</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;Tn&#39;</span><span class="p">:</span><span class="s1">&#39;#CEBF8F&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Tcm&#39;</span><span class="p">:</span><span class="s1">&#39;#ffbb78&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Early Tcm/Tem&#39;</span><span class="p">:</span><span class="s1">&#39;#ff7f0e&#39;</span><span class="p">,</span>
    <span class="s1">&#39;GZMK+ Tem&#39;</span><span class="p">:</span><span class="s1">&#39;#d62728&#39;</span><span class="p">,</span>
    <span class="s1">&#39;CREM+ Tm&#39;</span><span class="p">:</span><span class="s1">&#39;#aa40fc&#39;</span><span class="p">,</span>
    <span class="s1">&#39;KLRG1+ Temra&#39;</span><span class="p">:</span><span class="s1">&#39;#8c564b&#39;</span><span class="p">,</span>
    <span class="s1">&#39;KLRG1- Temra&#39;</span><span class="p">:</span><span class="s1">&#39;#e377c2&#39;</span><span class="p">,</span>
    <span class="s1">&#39;IFITM3+KLRG1+ Temra&#39;</span><span class="p">:</span><span class="s1">&#39;#b5bd61&#39;</span><span class="p">,</span>
    <span class="s1">&#39;MAIT&#39;</span><span class="p">:</span><span class="s1">&#39;#17becf&#39;</span><span class="p">,</span>
    <span class="s1">&#39;ILTCK&#39;</span><span class="p">:</span><span class="s1">&#39;#aec7e8&#39;</span><span class="p">,</span>
    <span class="s1">&#39;ITGAE+ Trm&#39;</span><span class="p">:</span><span class="s1">&#39;#279e68&#39;</span><span class="p">,</span>
    <span class="s1">&#39;ITGB2+ Trm&#39;</span><span class="p">:</span><span class="s1">&#39;#98df8a&#39;</span><span class="p">,</span>
    <span class="s1">&#39;SELL+ progenitor Tex&#39;</span><span class="p">:</span><span class="s1">&#39;#ff9896&#39;</span><span class="p">,</span>
    <span class="s1">&#39;GZMK+ Tex&#39;</span><span class="p">:</span><span class="s1">&#39;#c5b0d5&#39;</span><span class="p">,</span>
    <span class="s1">&#39;CXCR6+ Tex&#39;</span><span class="p">:</span><span class="s1">&#39;#c49c94&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Cycling T&#39;</span><span class="p">:</span><span class="s1">&#39;#f7b6d2&#39;</span>
<span class="p">}</span>

<span class="n">main_type_color</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;Tn&#39;</span><span class="p">:</span><span class="s1">&#39;#CEBF8F&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Tcm/Tem&#39;</span><span class="p">:</span><span class="s1">&#39;#DC977F&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Temra&#39;</span><span class="p">:</span><span class="s1">&#39;#EC6C72&#39;</span><span class="p">,</span>
    <span class="s1">&#39;MAIT&#39;</span><span class="p">:</span><span class="s1">&#39;#CE7FA4&#39;</span><span class="p">,</span>
    <span class="s1">&#39;ILTCK&#39;</span><span class="p">:</span><span class="s1">&#39;#684391&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Trm&#39;</span><span class="p">:</span><span class="s1">&#39;#599647&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Tex&#39;</span><span class="p">:</span><span class="s1">&#39;#8494B5&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Cycling&#39;</span><span class="p">:</span><span class="s1">&#39;#AC522B&#39;</span>
<span class="p">}</span>

<span class="n">disease_type_color</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;Healthy&#39;</span><span class="p">:</span><span class="s2">&quot;#E84C36&quot;</span><span class="p">,</span>
    <span class="s1">&#39;COVID-19&#39;</span><span class="p">:</span><span class="s2">&quot;#4CBDD7&quot;</span><span class="p">,</span>
    <span class="s1">&#39;Inflammation&#39;</span><span class="p">:</span><span class="s2">&quot;#1DA088&quot;</span><span class="p">,</span>
    <span class="s1">&#39;Inflammation-irAE&#39;</span><span class="p">:</span><span class="s2">&quot;#3C5589&quot;</span><span class="p">,</span>
    <span class="s1">&#39;Solid tumor&#39;</span><span class="p">:</span><span class="s2">&quot;#F49C7F&quot;</span><span class="p">,</span>
    <span class="s1">&#39;AML&#39;</span><span class="p">:</span><span class="s2">&quot;#8492B5&quot;</span><span class="p">,</span>
    <span class="s1">&#39;T-LGLL&#39;</span><span class="p">:</span><span class="s2">&quot;#91D1C2&quot;</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">meta_tissue_type_color</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;Circulating&quot;</span><span class="p">:</span><span class="s1">&#39;#ff7f0e&#39;</span><span class="p">,</span>
    <span class="s2">&quot;Tissue&quot;</span><span class="p">:</span><span class="s1">&#39;#1f77b4&#39;</span><span class="p">,</span>
    <span class="s2">&quot;TIL&quot;</span><span class="p">:</span><span class="s1">&#39;#279e68&#39;</span><span class="p">,</span>
    <span class="s2">&quot;PBMC/BALF&quot;</span><span class="p">:</span><span class="s1">&#39;#aa40fc&#39;</span>
<span class="p">}</span>

<span class="n">tissue_type_color</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;PBMC&#39;</span><span class="p">:</span><span class="s1">&#39;#ffbb78&#39;</span><span class="p">,</span>
    <span class="s1">&#39;T_LGLL_PBMC&#39;</span><span class="p">:</span><span class="s1">&#39;#17becf&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Normal_BM&#39;</span><span class="p">:</span><span class="s1">&#39;#b5bd61&#39;</span><span class="p">,</span>
    <span class="s1">&#39;AML_BM&#39;</span><span class="p">:</span><span class="s1">&#39;#e377c2&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Normal_Tissue&#39;</span><span class="p">:</span><span class="s1">&#39;#aec7e8&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Inflamed_Tissue&#39;</span><span class="p">:</span><span class="s1">&#39;#8c564b&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Infected_Tissue&#39;</span><span class="p">:</span><span class="s1">&#39;#ff9896&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Tumor_infiltrating_lymphocyte&#39;</span><span class="p">:</span><span class="s1">&#39;#98df8a&#39;</span><span class="p">,</span>
    <span class="s1">&#39;PBMC/BALF&#39;</span><span class="p">:</span><span class="s1">&#39;#c5b0d5&#39;</span>
<span class="p">}</span>

<span class="n">condition_color</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;condition&quot;</span><span class="p">:</span><span class="s1">&#39;#9cdb97&#39;</span><span class="p">,</span>
    <span class="s2">&quot;control&quot;</span><span class="p">:</span><span class="s1">&#39;#ff8787&#39;</span>
<span class="p">}</span>

<span class="n">tissue_type_color_detail</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;#ffbb78&#39;</span><span class="p">,</span>
    <span class="s1">&#39;#17becf&#39;</span><span class="p">,</span>
    <span class="s1">&#39;#b5bd61&#39;</span><span class="p">,</span>
    <span class="s1">&#39;#e377c2&#39;</span><span class="p">,</span>
    <span class="s1">&#39;#aec7e8&#39;</span><span class="p">,</span>
    <span class="s1">&#39;#8c564b&#39;</span><span class="p">,</span>
    <span class="s1">&#39;#ff9896&#39;</span><span class="p">,</span>
    <span class="s1">&#39;#98df8a&#39;</span><span class="p">,</span>
    <span class="s1">&#39;#c5b0d5&#39;</span><span class="p">,</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># lists</span>
<span class="n">cell_types</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;T cell&#39;</span><span class="p">,</span>
    <span class="s1">&#39;CD45RA- Memory T cell&#39;</span><span class="p">,</span>
    <span class="s1">&#39;CD45RA-CD25+CD127- Memory Treg&#39;</span><span class="p">,</span>
    <span class="s1">&#39;CD154+CD69+ stimulated T cell&#39;</span>
<span class="p">]</span>

<span class="n">leidens</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;0&#39;</span><span class="p">,</span>
    <span class="s1">&#39;1&#39;</span><span class="p">,</span>
    <span class="s1">&#39;2&#39;</span><span class="p">,</span>
    <span class="s1">&#39;3&#39;</span><span class="p">,</span>
    <span class="s1">&#39;4&#39;</span><span class="p">,</span>
    <span class="s1">&#39;5&#39;</span><span class="p">,</span>
    <span class="s1">&#39;6&#39;</span><span class="p">,</span>
    <span class="s1">&#39;7&#39;</span><span class="p">,</span>
    <span class="s1">&#39;8&#39;</span><span class="p">,</span>
    <span class="s1">&#39;9&#39;</span><span class="p">,</span>
    <span class="s1">&#39;10&#39;</span><span class="p">,</span>
    <span class="s1">&#39;11&#39;</span><span class="p">,</span>
    <span class="s1">&#39;12&#39;</span><span class="p">,</span>
    <span class="s1">&#39;14&#39;</span><span class="p">,</span>
    <span class="s1">&#39;15&#39;</span><span class="p">,</span>
    <span class="s1">&#39;16&#39;</span>
<span class="p">]</span>

<span class="n">disease_types</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;Healthy&#39;</span><span class="p">,</span>
    <span class="s1">&#39;COVID-19&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Inflammation&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Inflammation-irAE&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Solid tumor&#39;</span><span class="p">,</span> 
    <span class="s1">&#39;AML&#39;</span><span class="p">,</span>
    <span class="s1">&#39;T-LGLL&#39;</span>
<span class="p">]</span>

<span class="n">treatment_types</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;Treatment-naive&#39;</span><span class="p">,</span>
    <span class="s1">&#39;anti-PD1&#39;</span><span class="p">,</span>
    <span class="s1">&#39;anti-PD1_anti-CTLA4&#39;</span><span class="p">,</span>
    <span class="s1">&#39;anti-CD52&#39;</span>
<span class="p">]</span>

<span class="n">response_types</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;Non-cancer&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Treatment-naive&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Unknown Efficacy&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Resistant&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Partial Response&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Complete Response&#39;</span>
<span class="p">]</span>

<span class="n">cell_subtypes</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;Tn&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Tcm&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Early Tcm/Tem&#39;</span><span class="p">,</span>
    <span class="s1">&#39;GZMK+ Tem&#39;</span><span class="p">,</span>
    <span class="s1">&#39;CREM+ Tm&#39;</span><span class="p">,</span>
    <span class="s1">&#39;KLRG1+ Temra&#39;</span><span class="p">,</span>
    <span class="s1">&#39;KLRG1- Temra&#39;</span><span class="p">,</span>
    <span class="s1">&#39;IFITM3+KLRG1+ Temra&#39;</span><span class="p">,</span>
    <span class="s1">&#39;MAIT&#39;</span><span class="p">,</span>
    <span class="s1">&#39;ILTCK&#39;</span><span class="p">,</span>
    <span class="s1">&#39;ITGAE+ Trm&#39;</span><span class="p">,</span>
    <span class="s1">&#39;ITGB2+ Trm&#39;</span><span class="p">,</span>
    <span class="s1">&#39;SELL+ progenitor Tex&#39;</span><span class="p">,</span>
    <span class="s1">&#39;GZMK+ Tex&#39;</span><span class="p">,</span>
    <span class="s1">&#39;CXCR6+ Tex&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Cycling T&#39;</span>
<span class="p">]</span>

<span class="n">cell_subtype_aggrs</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;Tn&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Tcm/Tem&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Temra&#39;</span><span class="p">,</span>
    <span class="s1">&#39;MAIT&#39;</span><span class="p">,</span>
    <span class="s1">&#39;ILTCK&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Trm&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Tex&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Cycling&#39;</span>
<span class="p">]</span>

<span class="n">meta_tissue_types</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;PBMC&#39;</span><span class="p">,</span>
    <span class="s1">&#39;T_LGLL_PBMC&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Normal_BM&#39;</span><span class="p">,</span>
    <span class="s1">&#39;AML_BM&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Normal_Tissue&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Inflamed_Tissue&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Infected_Tissue&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Tumor_infiltrating_lymphocyte&#39;</span><span class="p">,</span>
    <span class="s1">&#39;PBMC/BALF&#39;</span>
<span class="p">]</span>

<span class="n">meta_tissue_type_aggrs</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;Circulating&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Tissue&quot;</span><span class="p">,</span>
    <span class="s2">&quot;TIL&quot;</span><span class="p">,</span>
    <span class="s2">&quot;PBMC/BALF&quot;</span>
<span class="p">]</span>

<span class="n">expansion_levels</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;No expansion&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Expansion2-5&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Expansion6-50&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Expansion51-100&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Expansion&gt;100&#39;</span>
<span class="p">]</span>

<span class="n">COVID_states</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;Asymptomatic Patient (AS)&#39;</span><span class="p">,</span> 
    <span class="s1">&#39;Mild&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Severe&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Recovered&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Unknown&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Non-COVID-19&#39;</span>
<span class="p">]</span>

<span class="n">circ_tissue</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;Boland_2020&#39;</span><span class="p">,</span> <span class="c1"># UC</span>
    <span class="s1">&#39;Borcherding_2021&#39;</span><span class="p">,</span> <span class="c1"># ccRCC</span>
    <span class="s1">&#39;Kim_2022&#39;</span><span class="p">,</span> <span class="c1"># irAE-Arthritis</span>
    <span class="s1">&#39;Krishna_2021&#39;</span><span class="p">,</span> <span class="c1"># ccRCC</span>
    <span class="s1">&#39;Liu_2021&#39;</span><span class="p">,</span> <span class="c1"># NPC</span>
    <span class="s1">&#39;Simone_2021&#39;</span> <span class="c1"># AS</span>
<span class="p">]</span>

<span class="n">circ_tissue_id</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;AS01&#39;</span><span class="p">,</span>
    <span class="s1">&#39;AS02&#39;</span><span class="p">,</span>
    <span class="s1">&#39;C16&#39;</span><span class="p">,</span>
    <span class="s1">&#39;C17&#39;</span><span class="p">,</span>
    <span class="s1">&#39;C18&#39;</span><span class="p">,</span>
    <span class="s1">&#39;C19&#39;</span><span class="p">,</span>
    <span class="s1">&#39;C21&#39;</span><span class="p">,</span>
    <span class="s1">&#39;C30&#39;</span><span class="p">,</span>
    <span class="s1">&#39;C33&#39;</span><span class="p">,</span>
    <span class="s1">&#39;GU0700&#39;</span><span class="p">,</span>
    <span class="s1">&#39;GU0715&#39;</span><span class="p">,</span>
    <span class="s1">&#39;GU0744&#39;</span><span class="p">,</span>
    <span class="s1">&#39;NPC_SC_1802&#39;</span><span class="p">,</span>
    <span class="s1">&#39;NPC_SC_1805&#39;</span><span class="p">,</span>
    <span class="s1">&#39;NPC_SC_1806&#39;</span><span class="p">,</span>
    <span class="s1">&#39;NPC_SC_1807&#39;</span><span class="p">,</span>
    <span class="s1">&#39;NPC_SC_1808&#39;</span><span class="p">,</span>
    <span class="s1">&#39;NPC_SC_1810&#39;</span><span class="p">,</span>
    <span class="s1">&#39;NPC_SC_1811&#39;</span><span class="p">,</span>
    <span class="s1">&#39;NPC_SC_1813&#39;</span><span class="p">,</span>
    <span class="s1">&#39;NPC_SC_1815&#39;</span><span class="p">,</span>
    <span class="s1">&#39;NPC_SC_1816&#39;</span><span class="p">,</span>
    <span class="s1">&#39;IpiNivo_Complete&#39;</span><span class="p">,</span>
    <span class="s1">&#39;IpiNivo_Mixed&#39;</span><span class="p">,</span>
    <span class="s1">&#39;IpiNivo_Resistant&#39;</span><span class="p">,</span>
    <span class="s1">&#39;NivoExposed&#39;</span><span class="p">,</span>
    <span class="s1">&#39;U34&#39;</span><span class="p">,</span>
    <span class="s1">&#39;U35&#39;</span><span class="p">,</span>
    <span class="s1">&#39;U4&#39;</span><span class="p">,</span>
    <span class="s1">&#39;U41&#39;</span><span class="p">,</span>
    <span class="s1">&#39;U44&#39;</span><span class="p">,</span>
    <span class="s1">&#39;U45&#39;</span><span class="p">,</span>
    <span class="s1">&#39;U5&#39;</span><span class="p">,</span>
    <span class="s1">&#39;irAE_40&#39;</span><span class="p">,</span>
    <span class="s1">&#39;irAE_45&#39;</span><span class="p">,</span>
    <span class="s1">&#39;irAE_56&#39;</span><span class="p">,</span>
    <span class="s1">&#39;irAE_62&#39;</span><span class="p">,</span>
    <span class="s1">&#39;irAE_63&#39;</span><span class="p">,</span>
    <span class="s1">&#39;irAE_65&#39;</span><span class="p">,</span>
    <span class="s1">&#39;irAE_7&#39;</span><span class="p">,</span>
    <span class="s1">&#39;irAE_76&#39;</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="tex2jax_ignore mathjax_ignore section" id="loaddata">
<h1>LoadData<a class="headerlink" href="#loaddata" title="Permalink to this headline">Â¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load adata</span>
<span class="c1"># adata_nogex = sc.read_h5ad(&quot;/Volumes/rsch/20221005_cd8_subset/20221005_cd8_nogex.h5ad&quot;)</span>
<span class="n">adata_nogex</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">read_h5ad</span><span class="p">(</span><span class="s2">&quot;/Volumes/rsch/20230327_new_hotspot_adata.h5ad&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">adata_test</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">read_h5ad</span><span class="p">(</span><span class="s2">&quot;./source/adata_nogex.h5ad&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">adata_nogex</span> <span class="o">=</span> <span class="n">adata_test</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load obs file</span>
<span class="n">obs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;/Volumes/qwet/wlz_tmp/20221107_obs.csv&quot;</span><span class="p">,</span><span class="n">low_memory</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">obs</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">obs</span><span class="p">[</span><span class="s2">&quot;Unnamed: 0&quot;</span><span class="p">]</span>
<span class="k">del</span> <span class="n">obs</span><span class="p">[</span><span class="s1">&#39;Unnamed: 0&#39;</span><span class="p">]</span>
<span class="n">obs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;sample_name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;SF&#39;</span><span class="p">),</span> <span class="s2">&quot;meta_tissue_type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Inflamed_Tissue&quot;</span>
<span class="n">obs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;sample_name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;ST&#39;</span><span class="p">),</span> <span class="s2">&quot;meta_tissue_type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Inflamed_Tissue&quot;</span>
<span class="n">obs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;sample_name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;SF&#39;</span><span class="p">),</span> <span class="s2">&quot;meta_tissue_type_aggr&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Tissue&quot;</span>
<span class="n">obs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;sample_name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;ST&#39;</span><span class="p">),</span> <span class="s2">&quot;meta_tissue_type_aggr&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Tissue&quot;</span>
<span class="n">obs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;sample_name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;CPInc&#39;</span><span class="p">),</span> <span class="s1">&#39;disease&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;CPInc&#39;</span>
<span class="n">obs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;sample_name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;CPInc&#39;</span><span class="p">),</span> <span class="s1">&#39;disease_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Healthy&#39;</span>
<span class="n">obs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;sample_name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;Blood&#39;</span><span class="p">),</span> <span class="s1">&#39;meta_tissue_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;PBMC&#39;</span>
<span class="n">obs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;sample_name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;Blood&#39;</span><span class="p">),</span> <span class="s1">&#39;meta_tissue_type_aggr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Circulating&#39;</span>
<span class="n">obs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;sample_name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;Marrow&#39;</span><span class="p">),</span> <span class="s1">&#39;meta_tissue_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Normal_BM&#39;</span>
<span class="n">obs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;sample_name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;Marrow&#39;</span><span class="p">),</span> <span class="s1">&#39;meta_tissue_type_aggr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Circulating&#39;</span>
<span class="n">obs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;sample_name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;IpiNivo_Mixed&#39;</span><span class="p">),</span> <span class="s2">&quot;response_type_rmpre&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Partial Response&quot;</span>
<span class="n">obs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;sample_name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Synovial_fluid_7&#39;</span><span class="p">,</span> <span class="s1">&#39;individual_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;irAE_7&#39;</span>
<span class="n">obs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;sample_name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Synovial_fluid_76&#39;</span><span class="p">,</span> <span class="s1">&#39;individual_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;irAE_76&#39;</span>
<span class="n">obs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;sample_name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;_ST&#39;</span><span class="p">),</span> <span class="s1">&#39;cell_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;T cell&#39;</span>

<span class="n">obs</span><span class="p">[</span><span class="s1">&#39;leiden&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">obs</span><span class="p">[</span><span class="s1">&#39;leiden&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;str&quot;</span><span class="p">)</span>
<span class="n">obs</span><span class="p">[</span><span class="s1">&#39;leiden&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">obs</span><span class="p">[</span><span class="s1">&#39;leiden&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;category&quot;</span><span class="p">)</span>
<span class="n">obs</span><span class="p">[</span><span class="s1">&#39;expansion_level&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">obs</span><span class="p">[</span><span class="s1">&#39;expansion_level&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;category&quot;</span><span class="p">)</span>
<span class="n">obs</span><span class="p">[</span><span class="s1">&#39;cell_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">obs</span><span class="p">[</span><span class="s1">&#39;cell_type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;category&quot;</span><span class="p">)</span>
<span class="n">obs</span><span class="p">[</span><span class="s1">&#39;cell_subtype&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">obs</span><span class="p">[</span><span class="s1">&#39;cell_subtype&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;category&quot;</span><span class="p">)</span>
<span class="n">obs</span><span class="p">[</span><span class="s1">&#39;cell_subtype_aggr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">obs</span><span class="p">[</span><span class="s1">&#39;cell_subtype_aggr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;category&quot;</span><span class="p">)</span>
<span class="n">obs</span><span class="p">[</span><span class="s1">&#39;meta_tissue_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">obs</span><span class="p">[</span><span class="s1">&#39;meta_tissue_type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;category&quot;</span><span class="p">)</span>
<span class="n">obs</span><span class="p">[</span><span class="s1">&#39;meta_tissue_type_aggr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">obs</span><span class="p">[</span><span class="s1">&#39;meta_tissue_type_aggr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;category&quot;</span><span class="p">)</span>
<span class="n">obs</span><span class="p">[</span><span class="s1">&#39;disease_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">obs</span><span class="p">[</span><span class="s1">&#39;disease_type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;category&quot;</span><span class="p">)</span>
<span class="n">obs</span><span class="p">[</span><span class="s1">&#39;COVID_state&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">obs</span><span class="p">[</span><span class="s1">&#39;COVID_state&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;category&quot;</span><span class="p">)</span>
<span class="n">obs</span><span class="p">[</span><span class="s1">&#39;response_type_rmpre&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">obs</span><span class="p">[</span><span class="s1">&#39;response_type_rmpre&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;category&quot;</span><span class="p">)</span>
<span class="n">obs</span><span class="p">[</span><span class="s1">&#39;treatment_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">obs</span><span class="p">[</span><span class="s1">&#39;treatment_type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;category&quot;</span><span class="p">)</span>

<span class="n">obs</span><span class="p">[</span><span class="s1">&#39;leiden&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">obs</span><span class="p">[</span><span class="s1">&#39;leiden&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">reorder_categories</span><span class="p">(</span><span class="n">leidens</span><span class="p">,</span> <span class="n">ordered</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">obs</span><span class="p">[</span><span class="s1">&#39;expansion_level&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">obs</span><span class="p">[</span><span class="s1">&#39;expansion_level&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">reorder_categories</span><span class="p">(</span><span class="n">expansion_levels</span><span class="p">,</span> <span class="n">ordered</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">obs</span><span class="p">[</span><span class="s1">&#39;cell_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">obs</span><span class="p">[</span><span class="s1">&#39;cell_type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">reorder_categories</span><span class="p">(</span><span class="n">cell_types</span><span class="p">,</span> <span class="n">ordered</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">obs</span><span class="p">[</span><span class="s1">&#39;cell_subtype&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">obs</span><span class="p">[</span><span class="s1">&#39;cell_subtype&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">reorder_categories</span><span class="p">(</span><span class="n">cell_subtypes</span><span class="p">,</span> <span class="n">ordered</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">obs</span><span class="p">[</span><span class="s1">&#39;cell_subtype_aggr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">obs</span><span class="p">[</span><span class="s1">&#39;cell_subtype_aggr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">reorder_categories</span><span class="p">(</span><span class="n">cell_subtype_aggrs</span><span class="p">,</span> <span class="n">ordered</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">obs</span><span class="p">[</span><span class="s1">&#39;meta_tissue_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">obs</span><span class="p">[</span><span class="s1">&#39;meta_tissue_type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">reorder_categories</span><span class="p">(</span><span class="n">meta_tissue_types</span><span class="p">,</span> <span class="n">ordered</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">obs</span><span class="p">[</span><span class="s1">&#39;meta_tissue_type_aggr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">obs</span><span class="p">[</span><span class="s1">&#39;meta_tissue_type_aggr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">reorder_categories</span><span class="p">(</span><span class="n">meta_tissue_type_aggrs</span><span class="p">,</span> <span class="n">ordered</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">obs</span><span class="p">[</span><span class="s1">&#39;disease_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">obs</span><span class="p">[</span><span class="s1">&#39;disease_type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">reorder_categories</span><span class="p">(</span><span class="n">disease_types</span><span class="p">,</span> <span class="n">ordered</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">obs</span><span class="p">[</span><span class="s1">&#39;COVID_state&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">obs</span><span class="p">[</span><span class="s1">&#39;COVID_state&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">reorder_categories</span><span class="p">(</span><span class="n">COVID_states</span><span class="p">,</span> <span class="n">ordered</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">obs</span><span class="p">[</span><span class="s1">&#39;response_type_rmpre&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">obs</span><span class="p">[</span><span class="s1">&#39;response_type_rmpre&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">reorder_categories</span><span class="p">(</span><span class="n">response_types</span><span class="p">,</span> <span class="n">ordered</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">adata_nogex</span><span class="o">.</span><span class="n">obs</span> <span class="o">=</span> <span class="n">obs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">adata_nogex</span><span class="o">.</span><span class="n">write_h5ad</span><span class="p">(</span><span class="s1">&#39;./source/adata_nogex.h5ad&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="tex2jax_ignore mathjax_ignore section" id="clonotypetableprocessing">
<h1>ClonotypeTableProcessing<a class="headerlink" href="#clonotypetableprocessing" title="Permalink to this headline">Â¶</a></h1>
<div class="section" id="clonotypedefinition">
<h2>ClonotypeDefinition<a class="headerlink" href="#clonotypedefinition" title="Permalink to this headline">Â¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">TRAB_DEFINITION_ORIG</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;IR_VJ_1_junction_aa&#39;,
 &#39;IR_VDJ_1_junction_aa&#39;,
 &#39;IR_VJ_1_v_call&#39;,
 &#39;IR_VJ_1_j_call&#39;,
 &#39;IR_VDJ_1_v_call&#39;,
 &#39;IR_VDJ_1_j_call&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">adata_nogex</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;tcr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s1">&#39;-&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">x</span><span class="p">),</span>
      <span class="n">adata_nogex</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="n">TRAB_DEFINITION_ORIG</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;individual_id&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
<span class="p">))</span>
<span class="n">adata_nogex</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;tcr&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Unnamed: 0
AAACCTGAGAAACCAT-Krishna_2021-IpiNivo_Mixed_Center    CAASRNNNDMRF-CASSSLGNEQFF-TRAV13-1-TRAJ43-TRBV...
AAACCTGAGAAACCTA-Gao_2020-UPN17_pre                   CAVEGDHSGSARQLTF-CSVEDWTDNEQFF-TRAV36DV7-TRAJ2...
AAACCTGAGAAACCTA-Liu_2021-NPC_SC_1813_PBMC            CAVSRASGGYNKLIF-CASSLAGQTSRSYNEQFF-TRAV8-4-TRA...
AAACCTGAGAAACGAG-Azizi_2018-BC09_TUMOR2               CAFTAGGGNKLTF-CASSPSWGLNAGELFF-TRAV24-TRAJ10-T...
AAACCTGAGAAACGAG-Ramaswamy_2021-PBMC_P5_1_Moderate    CAASADSNSGYALNF-CASALNEKLFF-TRAV29DV5-TRAJ41-T...
                                                                            ...                        
TTTGGTTTCATCTGCC-Simone_2021-AS02_SF                  CLPVSGWEGGGNKLTF-CASSLDSPEQYF-TRAV26-1-TRAJ10-...
TTTGTCAAGCGTAATA-Simone_2021-AS02_SF                  CAMKGNAGNNRKLIW-CASSWTGVISGNTIYF-TRAV14DV4-TRA...
TTTGTCAAGCTGTCTA-Simone_2021-AS02_SF                  CAERDGYSTLTF-CSARARSYNEQFF-TRAV5-TRAJ11-TRBV20...
TTTGTCACATCACGTA-Simone_2021-AS02_SF                  CVVRKPQDYNNARLMF-CASSLGGSYNEQFF-TRAV8-2-TRAJ31...
TTTGTCAGTTGCGTTA-Simone_2021-AS02_SF                  CAMRESNTGRRALTF-CASSSDRDRGREQYF-TRAV14DV4-TRAJ...
Name: tcr, Length: 515029, dtype: object
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cloneid</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">adata_nogex</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;tcr&#39;</span><span class="p">]),</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">adata_nogex</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;tcr&#39;</span><span class="p">]))))))</span>
<span class="n">adata_nogex</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;cc_aa_identity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">cloneid</span><span class="o">.</span><span class="n">get</span><span class="p">,</span> <span class="n">adata_nogex</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;tcr&#39;</span><span class="p">]))</span>
<span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">adata_nogex</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;tcr&#39;</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>238120
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">clone_df_generate</span><span class="p">(</span><span class="n">adata</span><span class="p">):</span>
    <span class="n">clonotype_composition</span> <span class="o">=</span> <span class="n">pandas_aggregation_to_wide</span> <span class="p">(</span> <span class="n">adata</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;cc_aa_identity&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span>
        <span class="s2">&quot;cell_subtype&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="n">Counter</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
    <span class="p">})</span> <span class="p">)</span>
    <span class="n">clone_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">clonotype_composition</span><span class="p">[</span><span class="s1">&#39;cell_subtype&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()),</span> 
                                 <span class="n">index</span><span class="o">=</span><span class="n">clonotype_composition</span><span class="p">[</span><span class="s1">&#39;cc_aa_identity&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    
    <span class="n">cell_subtypes</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;Tn&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Tcm&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Early Tcm/Tem&#39;</span><span class="p">,</span>
        <span class="s1">&#39;GZMK+ Tem&#39;</span><span class="p">,</span>
        <span class="s1">&#39;CREM+ Tm&#39;</span><span class="p">,</span>
        <span class="s1">&#39;KLRG1+ Temra&#39;</span><span class="p">,</span>
        <span class="s1">&#39;KLRG1- Temra&#39;</span><span class="p">,</span>
        <span class="s1">&#39;IFITM3+KLRG1+ Temra&#39;</span><span class="p">,</span>
        <span class="s1">&#39;MAIT&#39;</span><span class="p">,</span>
        <span class="s1">&#39;ILTCK&#39;</span><span class="p">,</span>
        <span class="s1">&#39;ITGAE+ Trm&#39;</span><span class="p">,</span>
        <span class="s1">&#39;ITGB2+ Trm&#39;</span><span class="p">,</span>
        <span class="s1">&#39;SELL+ progenitor Tex&#39;</span><span class="p">,</span>
        <span class="s1">&#39;GZMK+ Tex&#39;</span><span class="p">,</span>
        <span class="s1">&#39;CXCR6+ Tex&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Cycling T&#39;</span>
    <span class="p">]</span>
    <span class="n">clone_df</span> <span class="o">=</span> <span class="n">clone_df</span><span class="p">[</span><span class="n">cell_subtypes</span><span class="p">]</span>
    <span class="n">clone_df</span><span class="p">[</span><span class="s1">&#39;total&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">clone_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">0</span><span class="p">:</span><span class="mi">16</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">clone_df</span><span class="p">[</span><span class="s1">&#39;total_Tcmem&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">clone_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">1</span><span class="p">:</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">clone_df</span><span class="p">[</span><span class="s1">&#39;total_Temra&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">clone_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">5</span><span class="p">:</span><span class="mi">8</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">clone_df</span><span class="p">[</span><span class="s1">&#39;total_Trm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">clone_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">10</span><span class="p">:</span><span class="mi">12</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">clone_df</span><span class="p">[</span><span class="s1">&#39;total_Tex&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">clone_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">13</span><span class="p">:</span><span class="mi">15</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="c1"># add cell source</span>
    <span class="n">meta_tissue_type_composition</span> <span class="o">=</span> <span class="n">pandas_aggregation_to_wide</span> <span class="p">(</span> <span class="n">adata</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;cc_aa_identity&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span>
        <span class="s2">&quot;meta_tissue_type_aggr&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="n">Counter</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
    <span class="p">})</span> <span class="p">)</span>
    <span class="n">clone_df</span> <span class="o">=</span> <span class="n">clone_df</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span>
        <span class="n">meta_tissue_type_composition</span><span class="p">[</span><span class="s1">&#39;meta_tissue_type_aggr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
    <span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="n">meta_tissue_type_composition</span><span class="p">[</span><span class="s1">&#39;cc_aa_identity&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
    
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;individual_id&#39;</span><span class="p">,</span> <span class="s1">&#39;study_name&#39;</span><span class="p">,</span> <span class="s1">&#39;sample_name&#39;</span><span class="p">,</span> <span class="s1">&#39;disease&#39;</span><span class="p">,</span> <span class="s1">&#39;disease_type&#39;</span><span class="p">]:</span>
        <span class="n">cloneid_to_obs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">adata</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;cc_aa_identity&#39;</span><span class="p">],</span> <span class="n">adata</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
        <span class="n">clone_df</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">cloneid_to_obs</span><span class="o">.</span><span class="n">get</span><span class="p">,</span> <span class="n">clone_df</span><span class="o">.</span><span class="n">index</span><span class="p">))</span>
    <span class="c1"># define expansion</span>
    <span class="n">clone_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">clone_df</span><span class="p">[</span><span class="s1">&#39;total&#39;</span><span class="p">]</span><span class="o">&gt;=</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;expansion&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;Expanded&#39;</span>
    <span class="n">clone_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">clone_df</span><span class="p">[</span><span class="s1">&#39;total&#39;</span><span class="p">]</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;expansion&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;NoExpanded&#39;</span>
    
    <span class="c1"># define dominant clonotype</span>
    <span class="c1"># define ambiguous clonotype with equal maximum value</span>
    <span class="n">_clone</span> <span class="o">=</span> <span class="n">clone_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">0</span><span class="p">:</span><span class="mi">15</span><span class="p">]</span>
    <span class="n">clone_df</span><span class="p">[</span><span class="s1">&#39;dominant&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_clone</span><span class="o">.</span><span class="n">idxmax</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">clone_df</span><span class="p">[</span><span class="s1">&#39;dominant_num&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_clone</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">clone_df</span><span class="p">[</span><span class="s1">&#39;non_dominant_num&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">clone_df</span><span class="p">[</span><span class="s1">&#39;total&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">clone_df</span><span class="p">[</span><span class="s1">&#39;dominant_num&#39;</span><span class="p">]</span>
    
    <span class="n">amb_id</span> <span class="o">=</span> <span class="n">_clone</span><span class="o">.</span><span class="n">eq</span><span class="p">(</span><span class="n">_clone</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">clone_df</span><span class="p">[</span><span class="s1">&#39;dominant&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">clone_df</span><span class="p">[</span><span class="s1">&#39;dominant&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mask</span><span class="p">(</span><span class="n">amb_id</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;Equality&#39;</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">clone_df</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">clone_subtype</span> <span class="o">=</span> <span class="n">clone_df_generate</span><span class="p">(</span><span class="n">adata_nogex</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Counter</span><span class="p">(</span><span class="n">clone_subtype</span><span class="o">.</span><span class="n">dominant</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Counter({&#39;Tn&#39;: 73081,
         &#39;ITGB2+ Trm&#39;: 4907,
         &#39;CXCR6+ Tex&#39;: 7143,
         &#39;GZMK+ Tex&#39;: 13446,
         &#39;Early Tcm/Tem&#39;: 13775,
         &#39;GZMK+ Tem&#39;: 16537,
         &#39;Tcm&#39;: 31615,
         &#39;ITGAE+ Trm&#39;: 22547,
         &#39;KLRG1+ Temra&#39;: 10445,
         &#39;MAIT&#39;: 8408,
         &#39;SELL+ progenitor Tex&#39;: 5477,
         &#39;Equality&#39;: 12048,
         &#39;CREM+ Tm&#39;: 11935,
         &#39;ILTCK&#39;: 3724,
         &#39;KLRG1- Temra&#39;: 2785,
         &#39;IFITM3+KLRG1+ Temra&#39;: 247})
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">clonesize_to_obs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">clone_subtype</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">clone_subtype</span><span class="p">[</span><span class="s1">&#39;total&#39;</span><span class="p">]))</span>
<span class="n">adata_nogex</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;cc_aa_identity_size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">clonesize_to_obs</span><span class="o">.</span><span class="n">get</span><span class="p">,</span> <span class="n">adata_nogex</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;cc_aa_identity&#39;</span><span class="p">]))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">adata_nogex</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">adata_nogex</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;cc_aa_identity_size&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;expansion_level&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;No expansion&#39;</span>
<span class="n">adata_nogex</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">adata_nogex</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;cc_aa_identity_size&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">6</span><span class="p">)),</span> 
                    <span class="s1">&#39;expansion_level&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;Expansion2-5&#39;</span>
<span class="n">adata_nogex</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">adata_nogex</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;cc_aa_identity_size&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">51</span><span class="p">)),</span> 
                    <span class="s1">&#39;expansion_level&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;Expansion6-50&#39;</span>
<span class="n">adata_nogex</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">adata_nogex</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;cc_aa_identity_size&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">51</span><span class="p">,</span><span class="mi">101</span><span class="p">)),</span> 
                    <span class="s1">&#39;expansion_level&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;Expansion51-100&#39;</span>
<span class="n">adata_nogex</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">adata_nogex</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;cc_aa_identity_size&#39;</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">100</span><span class="p">,</span> 
                    <span class="s1">&#39;expansion_level&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;Expansion&gt;100&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">adata_nogex</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">adata_nogex</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;cc_aa_identity_size&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;expansion_size&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;1&#39;</span>
<span class="n">adata_nogex</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">adata_nogex</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;cc_aa_identity_size&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;expansion_size&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;2&#39;</span>
<span class="n">adata_nogex</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">adata_nogex</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;cc_aa_identity_size&#39;</span><span class="p">]</span><span class="o">&gt;=</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;expansion_size&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;Larger3&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">adata_noLGLL</span> <span class="o">=</span> <span class="n">adata_nogex</span><span class="p">[</span><span class="n">adata_nogex</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;disease&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;Large granular lymphocyte leukemia&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">adata_noLGLL</span> <span class="o">=</span> <span class="n">adata_test</span><span class="p">[</span><span class="n">adata_test</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;disease&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;Large granular lymphocyte leukemia&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Subset adata</span>
<span class="c1"># LGLL subset</span>
<span class="n">adata_LGLL</span> <span class="o">=</span> <span class="n">adata_nogex</span><span class="p">[</span><span class="n">adata_nogex</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;disease&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Large granular lymphocyte leukemia&quot;</span><span class="p">]</span>
<span class="c1"># non-LGLL subset</span>
<span class="n">adata_noLGLL</span> <span class="o">=</span> <span class="n">adata_nogex</span><span class="p">[</span><span class="n">adata_nogex</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;disease&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;Large granular lymphocyte leukemia&quot;</span><span class="p">]</span>
<span class="n">adata_circ_tissue</span> <span class="o">=</span> <span class="n">adata_nogex</span><span class="p">[</span><span class="n">adata_nogex</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;individual_id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">circ_tissue_id</span><span class="p">)]</span>
<span class="c1"># condition_types_subset</span>
<span class="n">adata_healthy</span> <span class="o">=</span> <span class="n">adata_noLGLL</span><span class="p">[</span><span class="n">adata_noLGLL</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;disease_type&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Healthy&#39;</span><span class="p">]</span>
<span class="n">adata_covid</span> <span class="o">=</span> <span class="n">adata_noLGLL</span><span class="p">[</span><span class="n">adata_noLGLL</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;disease_type&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;COVID-19&#39;</span><span class="p">]</span>
<span class="n">adata_inflam_irae</span> <span class="o">=</span> <span class="n">adata_noLGLL</span><span class="p">[</span><span class="n">adata_noLGLL</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;disease_type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;Inflammation&#39;</span><span class="p">)]</span>
<span class="n">adata_inflammation</span> <span class="o">=</span> <span class="n">adata_noLGLL</span><span class="p">[</span><span class="n">adata_noLGLL</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;disease_type&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Inflammation&#39;</span><span class="p">]</span>
<span class="n">adata_inflammation_irAE</span> <span class="o">=</span> <span class="n">adata_noLGLL</span><span class="p">[</span><span class="n">adata_noLGLL</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;disease_type&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Inflammation-irAE&#39;</span><span class="p">]</span>
<span class="n">adata_stumor</span> <span class="o">=</span> <span class="n">adata_noLGLL</span><span class="p">[</span><span class="n">adata_noLGLL</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;disease_type&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Solid tumor&#39;</span><span class="p">]</span>
<span class="n">adata_AML</span> <span class="o">=</span> <span class="n">adata_noLGLL</span><span class="p">[</span><span class="n">adata_noLGLL</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;disease_type&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;AML&#39;</span><span class="p">]</span>
<span class="c1"># tissue_types_subset</span>
<span class="n">kid_studies</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Wang_2021&#39;</span><span class="p">,</span> <span class="s1">&#39;Ramaswamy_2021&#39;</span><span class="p">]</span>
<span class="n">adata_nokid</span> <span class="o">=</span> <span class="n">adata_nogex</span><span class="p">[</span><span class="o">~</span><span class="n">adata_nogex</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;study_name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">kid_studies</span><span class="p">)]</span>
<span class="n">adata_circ</span> <span class="o">=</span> <span class="n">adata_nogex</span><span class="p">[</span><span class="n">adata_nogex</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;meta_tissue_type_aggr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;Circulating&#39;</span><span class="p">)]</span>
<span class="n">adata_circ_nokid</span> <span class="o">=</span> <span class="n">adata_circ</span><span class="p">[</span><span class="o">~</span><span class="n">adata_circ</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;study_name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">kid_studies</span><span class="p">)]</span>
<span class="n">adata_tissue</span> <span class="o">=</span> <span class="n">adata_nogex</span><span class="p">[</span><span class="n">adata_nogex</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;meta_tissue_type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;Tissue&#39;</span><span class="p">)]</span>
<span class="n">adata_tissue_TIL</span> <span class="o">=</span> <span class="n">adata_nogex</span><span class="p">[(</span><span class="n">adata_nogex</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;meta_tissue_type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;Tissue&#39;</span><span class="p">))</span> <span class="o">|</span> 
                               <span class="p">(</span><span class="n">adata_nogex</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;meta_tissue_type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Tumor_infiltrating_lymphocyte&#39;</span><span class="p">)]</span>
<span class="n">adata_tissue_TIL_nokid</span> <span class="o">=</span> <span class="n">adata_tissue_TIL</span><span class="p">[</span><span class="o">~</span><span class="n">adata_tissue_TIL</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;study_name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">kid_studies</span><span class="p">)]</span>

<span class="c1"># condition_tissue_subset</span>
<span class="n">adata_healthy_tissue</span> <span class="o">=</span> <span class="n">adata_healthy</span><span class="p">[</span><span class="n">adata_healthy</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;meta_tissue_type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;Tissue&#39;</span><span class="p">)]</span>
<span class="n">adata_covid_tissue</span> <span class="o">=</span> <span class="n">adata_covid</span><span class="p">[</span><span class="n">adata_covid</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;meta_tissue_type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;Tissue&#39;</span><span class="p">)]</span>
<span class="n">adata_inflam_tissue</span> <span class="o">=</span> <span class="n">adata_inflammation</span><span class="p">[</span><span class="n">adata_inflammation</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;meta_tissue_type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;Tissue&#39;</span><span class="p">)]</span>
<span class="n">adata_irae_tissue</span> <span class="o">=</span> <span class="n">adata_inflammation_irAE</span><span class="p">[</span><span class="n">adata_inflammation_irAE</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;meta_tissue_type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;Tissue&#39;</span><span class="p">)]</span>
<span class="n">adata_healthy_circ</span> <span class="o">=</span> <span class="n">adata_healthy</span><span class="p">[</span><span class="n">adata_healthy</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;meta_tissue_type_aggr&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Circulating&#39;</span><span class="p">]</span>
<span class="n">adata_covid_circ</span> <span class="o">=</span> <span class="n">adata_covid</span><span class="p">[</span><span class="n">adata_covid</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;meta_tissue_type_aggr&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Circulating&#39;</span><span class="p">]</span>
<span class="n">adata_inflam_circ</span> <span class="o">=</span> <span class="n">adata_inflammation</span><span class="p">[</span><span class="n">adata_inflammation</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;meta_tissue_type_aggr&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Circulating&#39;</span><span class="p">]</span>
<span class="n">adata_irae_circ</span> <span class="o">=</span> <span class="n">adata_inflammation_irAE</span><span class="p">[</span><span class="n">adata_inflammation_irAE</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;meta_tissue_type_aggr&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Circulating&#39;</span><span class="p">]</span>
<span class="n">adata_TIL</span> <span class="o">=</span> <span class="n">adata_stumor</span><span class="p">[</span><span class="n">adata_stumor</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;meta_tissue_type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Tumor_infiltrating_lymphocyte&#39;</span><span class="p">]</span>
<span class="n">adata_stumor_circ</span> <span class="o">=</span> <span class="n">adata_stumor</span><span class="p">[</span><span class="n">adata_stumor</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;meta_tissue_type_aggr&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Circulating&#39;</span><span class="p">]</span>
<span class="c1"># disease_subset</span>
<span class="n">adata_colon_healthy</span> <span class="o">=</span> <span class="n">adata_healthy_tissue</span><span class="p">[</span><span class="n">adata_healthy_tissue</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;study_name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s2">&quot;Boland&quot;</span><span class="p">)</span> <span class="o">|</span>
                                        <span class="n">adata_healthy_tissue</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;study_name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s2">&quot;Corridoni&quot;</span><span class="p">)</span> <span class="o">|</span>
                                        <span class="n">adata_healthy_tissue</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;study_name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s2">&quot;Luoma&quot;</span><span class="p">)]</span>

<span class="n">adata_UC</span> <span class="o">=</span> <span class="n">adata_noLGLL</span><span class="p">[</span><span class="n">adata_noLGLL</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;disease&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;Ulcerative&#39;</span><span class="p">)]</span>
<span class="n">adata_UC_tissue</span> <span class="o">=</span> <span class="n">adata_UC</span><span class="p">[</span><span class="n">adata_UC</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;meta_tissue_type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;Tissue&#39;</span><span class="p">)]</span>
<span class="n">adata_UC_circ</span> <span class="o">=</span> <span class="n">adata_UC</span><span class="p">[</span><span class="n">adata_UC</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;meta_tissue_type_aggr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;Circ&#39;</span><span class="p">)]</span>

<span class="n">adata_irae_arth</span> <span class="o">=</span> <span class="n">adata_noLGLL</span><span class="p">[</span><span class="n">adata_noLGLL</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;study_name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;Kim_2022&#39;</span><span class="p">)]</span>
<span class="n">adata_irae_arth_circ</span> <span class="o">=</span> <span class="n">adata_irae_arth</span><span class="p">[</span><span class="n">adata_irae_arth</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;meta_tissue_type_aggr&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Circulating&#39;</span><span class="p">]</span>
<span class="n">adata_irae_arth_tissue</span> <span class="o">=</span> <span class="n">adata_irae_arth</span><span class="p">[</span><span class="n">adata_irae_arth</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;meta_tissue_type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;Tissue&#39;</span><span class="p">)]</span>

<span class="n">adata_irae_colitis</span> <span class="o">=</span> <span class="n">adata_noLGLL</span><span class="p">[</span><span class="n">adata_noLGLL</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;disease&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s2">&quot;CPI-colitis&quot;</span><span class="p">)]</span>
<span class="c1"># cell_subtype subset</span>
<span class="n">adata_ex</span> <span class="o">=</span> <span class="n">adata_nogex</span><span class="p">[(</span><span class="n">adata_nogex</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;cell_subtype&#39;</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;GZMK+ Tex&quot;</span><span class="p">)</span> <span class="o">|</span>
                       <span class="p">(</span><span class="n">adata_nogex</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;cell_subtype&#39;</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;CXCR6+ Tex&quot;</span><span class="p">)]</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="sharingclonotype">
<h2>SharingClonotype<a class="headerlink" href="#sharingclonotype" title="Permalink to this headline">Â¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">sharing_info</span><span class="p">(</span><span class="n">clone_info</span><span class="p">):</span>
    <span class="n">clone_info_expanded</span> <span class="o">=</span> <span class="n">clone_info</span><span class="p">[(</span><span class="n">clone_info</span><span class="p">[</span><span class="s1">&#39;total&#39;</span><span class="p">]</span><span class="o">&gt;=</span><span class="mi">3</span><span class="p">)]</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">cell_subtypes</span><span class="p">:</span>
        <span class="c1"># larger than 20% of cells</span>
        <span class="n">clone_info_expanded</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">clone_info_expanded</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">&gt;=</span><span class="mf">0.2</span><span class="o">*</span><span class="n">clone_info_expanded</span><span class="p">[</span><span class="s1">&#39;total&#39;</span><span class="p">],</span> <span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">i</span>
        <span class="n">clone_info_expanded</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">clone_info_expanded</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">!=</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span>
        
    <span class="n">clone_info_expanded</span><span class="p">[</span><span class="s1">&#39;sharing_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">clone_info_expanded</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">cell_subtypes</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
        <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s1">&#39;=&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">)</span>
    <span class="n">clone_info_expanded</span><span class="p">[</span><span class="s1">&#39;sharing_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">clone_info_expanded</span><span class="p">[</span><span class="s1">&#39;sharing_type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mask</span><span class="p">(</span>
        <span class="o">~</span><span class="n">clone_info_expanded</span><span class="p">[</span><span class="s1">&#39;sharing_type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">),</span> <span class="s1">&#39;NoSharing&#39;</span><span class="p">)</span>
    <span class="n">clone_info</span><span class="p">[</span><span class="s1">&#39;sharing_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">clone_info_expanded</span><span class="p">[</span><span class="s1">&#39;sharing_type&#39;</span><span class="p">]</span> <span class="c1"># transfer</span>
        
    <span class="k">return</span> <span class="n">clone_info</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">dominant_sharing_info</span><span class="p">(</span><span class="n">clone_info</span><span class="p">):</span>
    <span class="n">clone_info_expanded</span> <span class="o">=</span> <span class="n">clone_info</span><span class="p">[(</span><span class="n">clone_info</span><span class="p">[</span><span class="s1">&#39;total&#39;</span><span class="p">]</span><span class="o">&gt;=</span><span class="mi">3</span><span class="p">)]</span>
    <span class="n">clone_info_expanded_number</span> <span class="o">=</span> <span class="n">clone_info_expanded</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">0</span><span class="p">:</span><span class="mi">16</span><span class="p">]</span> 

    <span class="n">clone_info_expanded_number</span><span class="p">[</span><span class="s1">&#39;Cycling T&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># exclude cycling</span>
<span class="c1">#     for i in cell_subtypes[:-1]:</span>
<span class="c1">#         # clone_info_expanded_number.loc[clone_info_expanded_number[i]&lt;3, i]=0</span>
<span class="c1">#         clone_info_expanded_number.loc[</span>
<span class="c1">#             clone_info_expanded_number[i]&lt;0.2*clone_info_expanded[&#39;total&#39;], i]=0</span>
        
    <span class="n">clone_info_expanded</span><span class="p">[</span><span class="s1">&#39;first&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">clone_info_expanded_number</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span>
        <span class="n">clone_info_expanded_number</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="mi">1</span><span class="p">)[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
    <span class="n">clone_info_expanded</span><span class="p">[</span><span class="s1">&#39;second&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">clone_info_expanded_number</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span>
        <span class="n">clone_info_expanded_number</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="mi">1</span><span class="p">)[:,</span> <span class="o">-</span><span class="mi">2</span><span class="p">]]</span>
    
    <span class="c1"># require the second not equal to the third</span>
    <span class="n">zero_id</span> <span class="o">=</span> <span class="n">clone_info_expanded_number</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
        <span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">row</span><span class="o">.</span><span class="n">nlargest</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>
    <span class="n">clone_info_expanded</span><span class="p">[</span><span class="s1">&#39;first&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">clone_info_expanded</span><span class="p">[</span><span class="s1">&#39;first&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mask</span><span class="p">(</span><span class="n">zero_id</span><span class="p">,</span> <span class="s1">&#39;NoSharing&#39;</span><span class="p">)</span>
    <span class="n">clone_info_expanded</span><span class="p">[</span><span class="s1">&#39;second&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">clone_info_expanded</span><span class="p">[</span><span class="s1">&#39;second&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mask</span><span class="p">(</span><span class="n">zero_id</span><span class="p">,</span> <span class="s1">&#39;NoSharing&#39;</span><span class="p">)</span>
    
    <span class="n">clone_info_expanded_number</span> <span class="o">=</span> <span class="n">clone_info_expanded_number</span><span class="p">[</span><span class="n">zero_id</span><span class="o">==</span><span class="kc">False</span><span class="p">]</span>
    <span class="n">qualified_id</span> <span class="o">=</span> <span class="n">clone_info_expanded_number</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
        <span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">row</span><span class="o">.</span><span class="n">nlargest</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="n">clone_info_expanded_number</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
        <span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">row</span><span class="o">.</span><span class="n">nlargest</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">qualified_id</span> <span class="o">=</span> <span class="n">qualified_id</span><span class="p">[</span><span class="n">qualified_id</span><span class="o">==</span><span class="kc">True</span><span class="p">]</span>
    
    <span class="n">clone_info_expanded</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">clone_info_expanded</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">qualified_id</span><span class="o">.</span><span class="n">index</span><span class="p">),</span> <span class="s1">&#39;first&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Equality&#39;</span>
    <span class="n">clone_info_expanded</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">clone_info_expanded</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">qualified_id</span><span class="o">.</span><span class="n">index</span><span class="p">),</span> <span class="s1">&#39;second&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Equality&#39;</span>
    
    <span class="n">clone_info</span><span class="p">[</span><span class="s1">&#39;first&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">clone_info_expanded</span><span class="p">[</span><span class="s1">&#39;first&#39;</span><span class="p">]</span>
    <span class="n">clone_info</span><span class="p">[</span><span class="s1">&#39;second&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">clone_info_expanded</span><span class="p">[</span><span class="s1">&#39;second&#39;</span><span class="p">]</span>
    
    <span class="k">return</span> <span class="n">clone_info</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">clone_subtype</span> <span class="o">=</span> <span class="n">sharing_info</span><span class="p">(</span><span class="n">clone_subtype</span><span class="p">)</span>
<span class="n">clone_subtype</span> <span class="o">=</span> <span class="n">dominant_sharing_info</span><span class="p">(</span><span class="n">clone_subtype</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="tex2jax_ignore mathjax_ignore section" id="part1gex-tcrfeatures">
<h1>Part1GEX/TCRfeatures<a class="headerlink" href="#part1gex-tcrfeatures" title="Permalink to this headline">Â¶</a></h1>
<div class="section" id="functions">
<h2>Functions<a class="headerlink" href="#functions" title="Permalink to this headline">Â¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># color palette</span>
<span class="kn">from</span> <span class="nn">colour</span> <span class="kn">import</span> <span class="n">Color</span>
<span class="kn">from</span> <span class="nn">matplotlib.colors</span> <span class="kn">import</span> <span class="n">LinearSegmentedColormap</span>
<span class="k">def</span> <span class="nf">make_colormap</span><span class="p">(</span> <span class="n">colors</span><span class="p">,</span> <span class="n">show_palette</span> <span class="o">=</span> <span class="kc">False</span> <span class="p">):</span> 
    <span class="n">color_ramp</span> <span class="o">=</span> <span class="n">LinearSegmentedColormap</span><span class="o">.</span><span class="n">from_list</span><span class="p">(</span> <span class="s1">&#39;my_list&#39;</span><span class="p">,</span> <span class="p">[</span> <span class="n">Color</span><span class="p">(</span> <span class="n">c1</span> <span class="p">)</span><span class="o">.</span><span class="n">rgb</span> <span class="k">for</span> <span class="n">c1</span> <span class="ow">in</span> <span class="n">colors</span> <span class="p">]</span> <span class="p">)</span>
    <span class="k">if</span> <span class="n">show_palette</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span> <span class="n">colors</span> <span class="p">)</span> <span class="p">,</span> <span class="mf">0.1</span><span class="p">))</span> <span class="p">]</span> <span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span> <span class="n">color_ramp</span> <span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">([])</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">([])</span>
    <span class="k">return</span> <span class="n">color_ramp</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="statsfunctions">
<h3>StatsFunctions<a class="headerlink" href="#statsfunctions" title="Permalink to this headline">Â¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># D50 stats</span>
<span class="k">def</span> <span class="nf">clone_D50</span><span class="p">(</span><span class="n">adata</span><span class="p">,</span> <span class="n">xaxis</span><span class="p">,</span> <span class="n">xaxis_label</span><span class="p">):</span>
    <span class="c1"># stats</span>
    <span class="n">ir</span><span class="o">.</span><span class="n">tl</span><span class="o">.</span><span class="n">alpha_diversity</span><span class="p">(</span><span class="n">adata</span><span class="p">,</span> <span class="n">groupby</span><span class="o">=</span><span class="s1">&#39;individual_id&#39;</span><span class="p">,</span> <span class="n">target_col</span><span class="o">=</span><span class="s1">&#39;cc_aa_identity&#39;</span><span class="p">,</span> 
                          <span class="n">metric</span><span class="o">=</span><span class="s1">&#39;D50&#39;</span><span class="p">,</span> <span class="n">key_added</span><span class="o">=</span><span class="s1">&#39;D50_sample&#39;</span><span class="p">)</span>
    
    <span class="n">qualified_id</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="ow">in</span> <span class="n">Counter</span><span class="p">(</span><span class="n">adata</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">individual_id</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">y</span><span class="o">&gt;</span><span class="mi">100</span><span class="p">]</span>
    <span class="n">adata</span> <span class="o">=</span> <span class="n">adata</span><span class="p">[</span><span class="n">adata</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;individual_id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">qualified_id</span><span class="p">)]</span>
    
    <span class="n">D50_group</span> <span class="o">=</span> <span class="n">adata</span><span class="o">.</span><span class="n">obs</span><span class="p">[[</span><span class="s1">&#39;individual_id&#39;</span><span class="p">,</span> <span class="s1">&#39;D50_sample&#39;</span><span class="p">,</span> <span class="n">xaxis_label</span><span class="p">]]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="s1">&#39;individual_id&#39;</span><span class="p">)</span>
    <span class="n">D50_group</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">D50_group</span><span class="p">[</span><span class="s1">&#39;individual_id&#39;</span><span class="p">]</span>
    
    <span class="n">D50_group</span><span class="p">[</span><span class="n">xaxis_label</span><span class="p">]</span> <span class="o">=</span> <span class="n">D50_group</span><span class="p">[</span><span class="n">xaxis_label</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;category&#39;</span><span class="p">)</span>
    <span class="n">D50_group</span><span class="p">[</span><span class="s1">&#39;D50_sample&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">D50_group</span><span class="p">[</span><span class="s1">&#39;D50_sample&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float&#39;</span><span class="p">)</span>
    <span class="n">D50_group</span> <span class="o">=</span> <span class="n">D50_group</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:]</span>

    <span class="k">return</span> <span class="n">D50_group</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Gini index calculation</span>
<span class="k">def</span> <span class="nf">gini</span><span class="p">(</span><span class="n">wealths</span><span class="p">):</span>
    <span class="n">cum_wealths</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">wealths</span><span class="p">,</span> <span class="mi">0</span><span class="p">)))</span>
    <span class="n">sum_wealths</span> <span class="o">=</span> <span class="n">cum_wealths</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">xarray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">cum_wealths</span><span class="p">)))</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cum_wealths</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">upper</span> <span class="o">=</span> <span class="n">xarray</span> <span class="c1"># 45 angle line</span>
    <span class="n">yarray</span> <span class="o">=</span> <span class="n">cum_wealths</span> <span class="o">/</span> <span class="n">sum_wealths</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xarray</span><span class="p">,</span> <span class="n">yarray</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xarray</span><span class="p">,</span> <span class="n">upper</span><span class="p">)</span>
    <span class="n">B</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">trapz</span><span class="p">(</span><span class="n">yarray</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">xarray</span><span class="p">)</span> <span class="c1"># calculate AUC</span>
    <span class="n">A</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">-</span> <span class="n">B</span> 
    <span class="n">G</span> <span class="o">=</span> <span class="n">A</span> <span class="o">/</span> <span class="p">(</span><span class="n">A</span> <span class="o">+</span> <span class="n">B</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">G</span>
<span class="k">def</span> <span class="nf">clone_gini</span><span class="p">(</span><span class="n">adata</span><span class="p">,</span> <span class="n">xaxis</span><span class="p">,</span> <span class="n">xaxis_label</span><span class="p">):</span>
    <span class="n">qualified_id</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="ow">in</span> <span class="n">Counter</span><span class="p">(</span><span class="n">adata</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">individual_id</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">y</span><span class="o">&gt;</span><span class="mi">100</span><span class="p">]</span>
    <span class="n">adata</span> <span class="o">=</span> <span class="n">adata</span><span class="p">[</span><span class="n">adata</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;individual_id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">qualified_id</span><span class="p">)]</span>
    
    <span class="n">clone_gini_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([])</span>
    <span class="n">sample_num</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">xaxis</span><span class="p">:</span>
        <span class="n">clone_group</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">adata_subgroup</span> <span class="o">=</span> <span class="n">adata</span><span class="p">[</span><span class="n">adata</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="n">xaxis_label</span><span class="p">]</span><span class="o">==</span><span class="n">i</span><span class="p">]</span>
        <span class="n">sample_subgroup</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">adata_subgroup</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;individual_id&#39;</span><span class="p">])</span>
        <span class="n">sample_num</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sample_subgroup</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">sample_subgroup</span><span class="p">:</span>
            <span class="n">subgroup_sample</span> <span class="o">=</span> <span class="n">adata_subgroup</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="n">adata_subgroup</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;individual_id&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">j</span><span class="p">]</span>
            <span class="n">clone_sample</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">Counter</span><span class="p">(</span><span class="n">subgroup_sample</span><span class="o">.</span><span class="n">cc_aa_identity</span><span class="p">))</span>
            <span class="n">G</span> <span class="o">=</span> <span class="n">gini</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">clone_sample</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
            <span class="n">clone_group</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>
        <span class="n">clone_gini_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">clone_gini_df</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">clone_group</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">sample_subgroup</span><span class="p">)],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        
    <span class="n">conditions</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">sample_num</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span> <span class="k">for</span> <span class="n">idx</span><span class="p">,</span><span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">xaxis</span><span class="p">)]</span>
    <span class="n">clone_gini_df</span><span class="p">[</span><span class="n">xaxis_label</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">y</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">conditions</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">x</span> <span class="p">]</span>
    <span class="n">clone_gini_df</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">clone_gini_df</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">clone_gini_df</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># circ_tissue cbind df</span>
<span class="k">def</span> <span class="nf">cbind_df</span><span class="p">(</span><span class="n">adata_circ</span><span class="p">,</span> <span class="n">adata_tissue</span><span class="p">,</span> <span class="n">xaxis</span><span class="p">,</span> <span class="n">xaxis_label</span><span class="p">,</span> <span class="n">index_type</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">index_type</span> <span class="o">==</span> <span class="s1">&#39;D50&#39;</span><span class="p">:</span>
        <span class="n">df1</span> <span class="o">=</span> <span class="n">clone_D50</span><span class="p">(</span><span class="n">adata_circ</span><span class="p">,</span> <span class="n">xaxis</span><span class="o">=</span><span class="n">xaxis</span><span class="p">,</span> <span class="n">xaxis_label</span><span class="o">=</span><span class="n">xaxis_label</span><span class="p">)</span>
        <span class="n">df2</span> <span class="o">=</span> <span class="n">clone_D50</span><span class="p">(</span><span class="n">adata_tissue</span><span class="p">,</span> <span class="n">xaxis</span><span class="o">=</span><span class="n">xaxis</span><span class="p">,</span> <span class="n">xaxis_label</span><span class="o">=</span><span class="n">xaxis_label</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">df1</span> <span class="o">=</span> <span class="n">clone_gini</span><span class="p">(</span><span class="n">adata_circ</span><span class="p">,</span> <span class="n">xaxis</span><span class="o">=</span><span class="n">xaxis</span><span class="p">,</span> <span class="n">xaxis_label</span><span class="o">=</span><span class="n">xaxis_label</span><span class="p">)</span>
        <span class="n">df2</span> <span class="o">=</span> <span class="n">clone_gini</span><span class="p">(</span><span class="n">adata_tissue</span><span class="p">,</span> <span class="n">xaxis</span><span class="o">=</span><span class="n">xaxis</span><span class="p">,</span> <span class="n">xaxis_label</span><span class="o">=</span><span class="n">xaxis_label</span><span class="p">)</span>
        
    <span class="n">df1</span><span class="p">[</span><span class="s1">&#39;origin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Circulating&#39;</span>
    <span class="n">df2</span><span class="p">[</span><span class="s1">&#39;origin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Tissue&#39;</span>
    
    <span class="n">multi_box</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df1</span><span class="p">,</span> <span class="n">df2</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">multi_box</span> <span class="o">=</span> <span class="n">multi_box</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="n">multi_box</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="n">multi_box</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="s2">&quot;variable&quot;</span><span class="p">})</span>
    
    <span class="n">multi_box</span><span class="p">[</span><span class="s2">&quot;variable&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">multi_box</span><span class="p">[</span><span class="s2">&quot;variable&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;category&#39;</span><span class="p">)</span>
    <span class="n">multi_box</span><span class="p">[</span><span class="s2">&quot;variable&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">multi_box</span><span class="p">[</span><span class="s2">&quot;variable&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">reorder_categories</span><span class="p">(</span><span class="n">xaxis</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">multi_box</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="plotsfunctions">
<h3>PlotsFunctions<a class="headerlink" href="#plotsfunctions" title="Permalink to this headline">Â¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># general bar function</span>
<span class="k">def</span> <span class="nf">general_bar</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">target_col</span><span class="p">,</span> <span class="n">ylim0</span><span class="p">,</span> <span class="n">ylim1</span><span class="p">,</span> <span class="n">file_name</span><span class="p">):</span>
    
    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="n">target_col</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    
    <span class="n">width</span> <span class="o">=</span> <span class="mf">0.5</span>
    <span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
    
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">target_col</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ylim0</span><span class="p">,</span> <span class="n">ylim1</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)),</span> 
            <span class="p">[</span><span class="n">x</span><span class="o">-</span><span class="n">ylim0</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="n">target_col</span><span class="p">]],</span> <span class="n">bottom</span><span class="o">=</span><span class="n">ylim0</span><span class="p">,</span>
            <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;colors&#39;</span><span class="p">])</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># stacked_bar function</span>
<span class="k">def</span> <span class="nf">stacked_bar</span><span class="p">(</span><span class="n">adata</span><span class="p">,</span> <span class="n">percentage</span><span class="p">,</span> <span class="n">xitems</span><span class="p">,</span> <span class="n">xitem_str</span><span class="p">,</span> 
                <span class="n">yitems</span><span class="p">,</span> <span class="n">yitem_str</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">yitem_color</span><span class="p">,</span> 
                <span class="n">file_name</span><span class="p">:</span><span class="nb">str</span><span class="p">):</span>
    <span class="c1"># stats</span>
    <span class="n">stats</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">yitems</span><span class="p">:</span>
        <span class="n">cell_num</span> <span class="o">=</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">adata</span><span class="o">.</span><span class="n">obs</span><span class="p">[(</span><span class="n">adata</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="n">yitem_str</span><span class="p">]</span><span class="o">==</span><span class="n">j</span><span class="p">)</span> <span class="o">&amp;</span> 
                                  <span class="p">(</span><span class="n">adata</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="n">xitem_str</span><span class="p">]</span><span class="o">==</span><span class="n">i</span><span class="p">)])</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">xitems</span><span class="p">]</span>
        <span class="n">stats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cell_num</span><span class="p">)</span>
    <span class="n">stats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">stats</span><span class="p">)</span>

    <span class="c1"># plots</span>
    <span class="n">x</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">xitems</span><span class="p">))</span>
    <span class="n">width</span> <span class="o">=</span> <span class="mf">0.35</span>
    
    <span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
    <span class="n">bottom_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">xitems</span><span class="p">))</span>

    <span class="n">sums</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">stats</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span><span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">stats</span><span class="p">):</span>
        
        <span class="k">if</span> <span class="n">percentage</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">i</span> <span class="o">/</span> <span class="n">sums</span> <span class="c1"># bar height (percentage)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">y</span><span class="o">=</span><span class="n">i</span>
            
        <span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="n">bottom_y</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
               <span class="n">label</span><span class="o">=</span><span class="n">yitems</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">yitem_color</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="n">idx</span><span class="p">])</span>
        <span class="c1"># bottom position</span>
        <span class="n">bottom_y</span> <span class="o">=</span> <span class="n">y</span> <span class="o">+</span> <span class="n">bottom_y</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">xitems</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.3</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;center right&#39;</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">autofmt_xdate</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># pie_plot function</span>
<span class="k">def</span> <span class="nf">pie_plot</span><span class="p">(</span><span class="n">adata</span><span class="p">,</span> <span class="n">items</span><span class="p">,</span> <span class="n">item_str</span><span class="p">,</span> <span class="n">item_color</span><span class="p">,</span> <span class="n">file_name</span><span class="p">):</span>
    <span class="c1"># SupFigure1BR </span>
    <span class="c1"># stats</span>
    <span class="n">requested_percent</span> <span class="o">=</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">adata</span><span class="o">.</span><span class="n">obs</span><span class="p">[(</span><span class="n">adata</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="n">item_str</span><span class="p">]</span><span class="o">==</span><span class="n">i</span><span class="p">)])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">items</span><span class="p">]</span>
    <span class="n">requested_percent</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">requested_percent</span><span class="p">)</span>

    <span class="c1"># plots</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">pie</span><span class="p">(</span><span class="n">requested_percent</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> 
           <span class="n">colors</span><span class="o">=</span><span class="n">item_color</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> 
           <span class="n">autopct</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%1.0f%%</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">pctdistance</span><span class="o">=</span><span class="mf">1.2</span><span class="p">,</span>
           <span class="n">wedgeprops</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">))</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">items</span><span class="p">,</span>
              <span class="n">title</span><span class="o">=</span><span class="n">item_str</span><span class="p">,</span>
              <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;center left&quot;</span><span class="p">,</span>
              <span class="n">fontsize</span><span class="o">=</span><span class="s2">&quot;small&quot;</span><span class="p">,</span>
              <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># multi boxplot</span>
<span class="k">def</span> <span class="nf">multi_boxplot</span><span class="p">(</span><span class="n">multi_box</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span>
                 <span class="n">xaxis</span><span class="o">=</span><span class="s1">&#39;variable&#39;</span><span class="p">,</span> <span class="n">yaxis</span><span class="o">=</span><span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="n">hueaxis</span><span class="o">=</span><span class="s1">&#39;origin&#39;</span><span class="p">):</span>
    
    <span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
    
    <span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">xaxis</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">yaxis</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="n">hueaxis</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">multi_box</span><span class="p">,</span> 
                <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">boxprops</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;zorder&quot;</span><span class="p">:</span><span class="mi">2</span><span class="p">},</span>
                <span class="n">showfliers</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
    <span class="c1"># Extract x and y coordinates of the dots</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">stripplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">xaxis</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">yaxis</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="n">hueaxis</span><span class="p">,</span>
                  <span class="n">dodge</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">multi_box</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
            
    <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.3</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;center right&#39;</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">autofmt_xdate</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
    
    <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="mainfigure1">
<h2>MainFigure1<a class="headerlink" href="#mainfigure1" title="Permalink to this headline">Â¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Cell subtype UMAP, Figure1B</span>
<span class="n">sc</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">umap</span><span class="p">(</span><span class="n">adata_nogex</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;leiden&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/GEXCD8_43_0.png" src="_images/GEXCD8_43_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Cell subtype UMAP, Figure1B</span>
<span class="n">sc</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">umap</span><span class="p">(</span><span class="n">adata_nogex</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;predictions&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/GEXCD8_44_0.png" src="_images/GEXCD8_44_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Cell subtype UMAP, Figure1B</span>
<span class="n">sc</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">umap</span><span class="p">(</span><span class="n">adata_nogex</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;cell_subtype&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="n">subtype_color</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/GEXCD8_45_0.png" src="_images/GEXCD8_45_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Cell subtype marker, Figure1C</span>
<span class="n">sc</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">dotplot</span><span class="p">(</span><span class="n">adata_nogex</span><span class="p">,</span> <span class="n">var_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;S1PR1&quot;</span><span class="p">,</span> <span class="s2">&quot;SELL&quot;</span><span class="p">,</span> <span class="s2">&quot;IL7R&quot;</span><span class="p">,</span> <span class="s2">&quot;KLRG1&quot;</span><span class="p">,</span> <span class="s2">&quot;GZMK&quot;</span><span class="p">,</span> <span class="s2">&quot;CREM&quot;</span><span class="p">,</span>
                                      <span class="s2">&quot;CX3CR1&quot;</span><span class="p">,</span> <span class="s2">&quot;IFITM3&quot;</span><span class="p">,</span>
                                      <span class="s2">&quot;KLRB1&quot;</span><span class="p">,</span> <span class="s2">&quot;ZBTB16&quot;</span><span class="p">,</span> <span class="s2">&quot;FCER1G&quot;</span><span class="p">,</span> <span class="s2">&quot;TYROBP&quot;</span><span class="p">,</span>
                                      <span class="s2">&quot;ITGAE&quot;</span><span class="p">,</span> <span class="s2">&quot;ITGA1&quot;</span><span class="p">,</span> <span class="s2">&quot;ITGB2&quot;</span><span class="p">,</span> 
                                      <span class="s2">&quot;TCF7&quot;</span><span class="p">,</span> <span class="s2">&quot;PDCD1&quot;</span><span class="p">,</span> <span class="s2">&quot;HAVCR2&quot;</span><span class="p">,</span> <span class="s2">&quot;TIGIT&quot;</span><span class="p">,</span> <span class="s2">&quot;CXCR6&quot;</span><span class="p">,</span>
                                      <span class="s2">&quot;MKI67&quot;</span><span class="p">,</span> <span class="s2">&quot;CDC20&quot;</span><span class="p">],</span> 
              <span class="n">groupby</span><span class="o">=</span><span class="s1">&#39;cell_subtype&#39;</span><span class="p">,</span> <span class="n">dot_max</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> 
              <span class="n">standard_scale</span><span class="o">=</span><span class="s1">&#39;var&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/GEXCD8_46_0.png" src="_images/GEXCD8_46_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># D50 cc_aa_identtiy, Figure1D</span>
<span class="n">ir</span><span class="o">.</span><span class="n">tl</span><span class="o">.</span><span class="n">alpha_diversity</span><span class="p">(</span><span class="n">adata_nogex</span><span class="p">,</span> <span class="n">groupby</span><span class="o">=</span><span class="s2">&quot;cell_subtype&quot;</span><span class="p">,</span> <span class="n">target_col</span><span class="o">=</span><span class="s1">&#39;cc_aa_identity&#39;</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="s1">&#39;D50&#39;</span><span class="p">)</span>
<span class="n">adata_nogex</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s2">&quot;D50_cc_aa_identity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">adata_nogex</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s2">&quot;D50_cc_aa_identity&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">sc</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">umap</span><span class="p">(</span><span class="n">adata_nogex</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;D50_cc_aa_identity&quot;</span><span class="p">,</span> 
           <span class="n">cmap</span><span class="o">=</span><span class="n">make_colormap</span><span class="p">([</span><span class="s1">&#39;#EAE0DE&#39;</span><span class="p">,</span><span class="s1">&#39;#895180&#39;</span><span class="p">,</span><span class="s1">&#39;#472B51&#39;</span><span class="p">]),</span> 
           <span class="n">vmax</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;./figures/d50umap.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/GEXCD8_47_0.png" src="_images/GEXCD8_47_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">adata_nogex</span><span class="o">.</span><span class="n">obs</span><span class="p">[[</span><span class="s1">&#39;cell_subtype&#39;</span><span class="p">,</span><span class="s1">&#39;D50_cc_aa_identity&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>cell_subtype</th>
      <th>D50_cc_aa_identity</th>
    </tr>
    <tr>
      <th>Unnamed: 0</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>AAACCTGAGAAACCAT-Krishna_2021-IpiNivo_Mixed_Center</th>
      <td>GZMK+ Tex</td>
      <td>3.368897</td>
    </tr>
    <tr>
      <th>AAACCTGAGAAACCTA-Gao_2020-UPN17_pre</th>
      <td>ILTCK</td>
      <td>45.134765</td>
    </tr>
    <tr>
      <th>AAACCTGAGAAACCTA-Liu_2021-NPC_SC_1813_PBMC</th>
      <td>Tn</td>
      <td>49.655809</td>
    </tr>
    <tr>
      <th>AAACCTGAGAAACGAG-Azizi_2018-BC09_TUMOR2</th>
      <td>GZMK+ Tem</td>
      <td>9.091773</td>
    </tr>
    <tr>
      <th>AAACCTGAGAACAACT-Neal_2018-ccRCC_2_ft_rep2</th>
      <td>ITGB2+ Trm</td>
      <td>17.223127</td>
    </tr>
    <tr>
      <th>AAACCTGAGAACTCGG-Gao_2020-UPN15_pre</th>
      <td>IFITM3+KLRG1+ Temra</td>
      <td>0.185357</td>
    </tr>
    <tr>
      <th>AAACCTGAGAAGATTC-Boland_2020-U35_PBMC</th>
      <td>KLRG1+ Temra</td>
      <td>2.048972</td>
    </tr>
    <tr>
      <th>AAACCTGAGAAGGCCT-Gao_2020-UPN4_post</th>
      <td>KLRG1- Temra</td>
      <td>0.021617</td>
    </tr>
    <tr>
      <th>AAACCTGAGAAGGTTT-Luoma_2020-CPInc_NC4</th>
      <td>ITGAE+ Trm</td>
      <td>12.935167</td>
    </tr>
    <tr>
      <th>AAACCTGAGAATCTCC-Gao_2020-UPN4_pre</th>
      <td>Early Tcm/Tem</td>
      <td>35.206707</td>
    </tr>
    <tr>
      <th>AAACCTGAGACAAGCC-Yost_2019-su010_post_SCC_CD39_Tcell</th>
      <td>CXCR6+ Tex</td>
      <td>3.404387</td>
    </tr>
    <tr>
      <th>AAACCTGAGACTAGGC-Gao_2020-HD5</th>
      <td>MAIT</td>
      <td>30.163790</td>
    </tr>
    <tr>
      <th>AAACCTGAGAGGTTGC-Yost_2019-su004_pre</th>
      <td>CREM+ Tm</td>
      <td>12.369467</td>
    </tr>
    <tr>
      <th>AAACCTGAGAGTAATC-Boland_2020-U4_PBMC</th>
      <td>Tcm</td>
      <td>42.404547</td>
    </tr>
    <tr>
      <th>AAACCTGAGATATGCA-Yost_2019-su014_pre_Tcell</th>
      <td>Cycling T</td>
      <td>9.843732</td>
    </tr>
    <tr>
      <th>AAACCTGAGCGTTTAC-Liu_2021-NPC_SC_1811_Tumor</th>
      <td>SELL+ progenitor Tex</td>
      <td>44.530524</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># D50 cc_aa_identity, Figure1E</span>
<span class="n">kid_studies</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Wang_2021&#39;</span><span class="p">,</span> <span class="s1">&#39;Ramaswamy_2021&#39;</span><span class="p">]</span>
<span class="n">adata_circ</span> <span class="o">=</span> <span class="n">adata_nogex</span><span class="p">[</span><span class="n">adata_nogex</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;meta_tissue_type_aggr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;Circulating&#39;</span><span class="p">)]</span>
<span class="n">adata_circ_nokid</span> <span class="o">=</span> <span class="n">adata_circ</span><span class="p">[</span><span class="o">~</span><span class="n">adata_circ</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;study_name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">kid_studies</span><span class="p">)]</span>
<span class="n">adata_tissue_TIL</span> <span class="o">=</span> <span class="n">adata_nogex</span><span class="p">[(</span><span class="n">adata_nogex</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;meta_tissue_type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;Tissue&#39;</span><span class="p">))</span> <span class="o">|</span> 
                               <span class="p">(</span><span class="n">adata_nogex</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;meta_tissue_type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Tumor_infiltrating_lymphocyte&#39;</span><span class="p">)]</span>
<span class="n">adata_tissue_TIL_nokid</span> <span class="o">=</span> <span class="n">adata_tissue_TIL</span><span class="p">[</span><span class="o">~</span><span class="n">adata_tissue_TIL</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;study_name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">kid_studies</span><span class="p">)]</span>

<span class="n">adata_circ_nokid</span> <span class="o">=</span> <span class="n">adata_circ_nokid</span><span class="p">[</span><span class="n">adata_circ_nokid</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;cell_type&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;T cell&#39;</span><span class="p">]</span>
<span class="n">adata_tissue_TIL_nokid</span> <span class="o">=</span> <span class="n">adata_tissue_TIL_nokid</span><span class="p">[</span><span class="n">adata_tissue_TIL_nokid</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;cell_type&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;T cell&#39;</span><span class="p">]</span>

<span class="n">d50_disease</span> <span class="o">=</span> <span class="n">cbind_df</span><span class="p">(</span><span class="n">adata_circ_nokid</span><span class="p">,</span> <span class="n">adata_tissue_TIL_nokid</span><span class="p">,</span>
                       <span class="n">xaxis</span><span class="o">=</span><span class="n">disease_types</span><span class="p">,</span> <span class="n">xaxis_label</span><span class="o">=</span><span class="s1">&#39;disease_type&#39;</span><span class="p">,</span> <span class="n">index_type</span><span class="o">=</span><span class="s1">&#39;D50&#39;</span><span class="p">)</span>
<span class="n">multi_boxplot</span><span class="p">(</span><span class="n">d50_disease</span><span class="p">,</span> <span class="n">xaxis</span><span class="o">=</span><span class="s1">&#39;origin&#39;</span><span class="p">,</span> <span class="n">yaxis</span><span class="o">=</span><span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="n">hueaxis</span><span class="o">=</span><span class="s1">&#39;variable&#39;</span><span class="p">,</span> 
              <span class="n">file_name</span><span class="o">=</span><span class="s1">&#39;d50_disease.pdf&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/GEXCD8_49_0.png" src="_images/GEXCD8_49_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Counter</span><span class="p">(</span><span class="n">d50_disease</span><span class="p">[</span><span class="n">d50_disease</span><span class="p">[</span><span class="s1">&#39;origin&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Circulating&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">variable</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Counter({&#39;T-LGLL&#39;: 12,
         &#39;Solid tumor&#39;: 17,
         &#39;Inflammation&#39;: 7,
         &#39;Healthy&#39;: 30,
         &#39;COVID-19&#39;: 58,
         &#39;AML&#39;: 8,
         &#39;Inflammation-irAE&#39;: 8})
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Counter</span><span class="p">(</span><span class="n">d50_disease</span><span class="p">[</span><span class="n">d50_disease</span><span class="p">[</span><span class="s1">&#39;origin&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Tissue&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">variable</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Counter({&#39;Solid tumor&#39;: 44,
         &#39;Healthy&#39;: 33,
         &#39;Inflammation&#39;: 18,
         &#39;Inflammation-irAE&#39;: 16,
         &#39;COVID-19&#39;: 6})
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">d50_disease_circulating</span> <span class="o">=</span> <span class="n">d50_disease</span><span class="p">[</span><span class="n">d50_disease</span><span class="p">[</span><span class="s1">&#39;origin&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Circulating&#39;</span><span class="p">]</span>
<span class="n">d50_disease_tissue</span> <span class="o">=</span> <span class="n">d50_disease</span><span class="p">[</span><span class="n">d50_disease</span><span class="p">[</span><span class="s1">&#39;origin&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Tissue&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stats</span><span class="o">.</span><span class="n">mannwhitneyu</span><span class="p">(</span><span class="n">d50_disease_tissue</span><span class="p">[</span><span class="n">d50_disease_tissue</span><span class="p">[</span><span class="s1">&#39;variable&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Healthy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                   <span class="n">d50_disease_tissue</span><span class="p">[</span><span class="n">d50_disease_tissue</span><span class="p">[</span><span class="s1">&#39;variable&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Solid tumor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>MannwhitneyuResult(statistic=1096.5, pvalue=0.00013975964729537183)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Figure1F, stats of circos plot</span>
<span class="n">clone_cross</span> <span class="o">=</span> <span class="n">clone_subtype</span><span class="p">[(</span><span class="n">clone_subtype</span><span class="p">[</span><span class="s2">&quot;study_name&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">circ_tissue</span><span class="p">))]</span>
<span class="n">general_share</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">Counter</span><span class="p">(</span><span class="n">clone_cross</span><span class="p">[</span><span class="s1">&#39;sharing_type&#39;</span><span class="p">]))</span>
<span class="n">general_share_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">general_share</span><span class="p">,</span> <span class="n">orient</span><span class="o">=</span><span class="s1">&#39;index&#39;</span><span class="p">)</span>
<span class="n">general_share_df</span> <span class="o">=</span> <span class="n">general_share_df</span><span class="p">[</span><span class="n">general_share_df</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&gt;=</span><span class="mi">5</span><span class="p">]</span>
<span class="n">general_share_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;./figures/stats/Figure1F.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="supfigures">
<h2>SupFigures<a class="headerlink" href="#supfigures" title="Permalink to this headline">Â¶</a></h2>
<div class="section" id="suptables">
<h3>SupTables<a class="headerlink" href="#suptables" title="Permalink to this headline">Â¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># stats</span>
<span class="n">sc</span><span class="o">.</span><span class="n">tl</span><span class="o">.</span><span class="n">rank_genes_groups</span><span class="p">(</span><span class="n">adata_nogex</span><span class="p">,</span> <span class="n">groupby</span><span class="o">=</span><span class="s1">&#39;cell_subtype&#39;</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;t-test&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">subtype_sheet_names</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;Tn&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Tcm&#39;</span><span class="p">,</span>
    <span class="s1">&#39;EarlyTcmTem&#39;</span><span class="p">,</span>
    <span class="s1">&#39;GZMK+Tem&#39;</span><span class="p">,</span>
    <span class="s1">&#39;CREM+Tm&#39;</span><span class="p">,</span>
    <span class="s1">&#39;KLRG1+Temra&#39;</span><span class="p">,</span>
    <span class="s1">&#39;KLRG1-Temra&#39;</span><span class="p">,</span>
    <span class="s1">&#39;IFITM3+Temra&#39;</span><span class="p">,</span>
    <span class="s1">&#39;MAIT&#39;</span><span class="p">,</span>
    <span class="s1">&#39;ILTCK&#39;</span><span class="p">,</span>
    <span class="s1">&#39;ITGAE+Trm&#39;</span><span class="p">,</span>
    <span class="s1">&#39;ITGB2+Trm&#39;</span><span class="p">,</span>
    <span class="s1">&#39;SELL+Tpex&#39;</span><span class="p">,</span>
    <span class="s1">&#39;GZMK+Tex&#39;</span><span class="p">,</span>
    <span class="s1">&#39;CXCR6+Tex&#39;</span><span class="p">,</span>
    <span class="s1">&#39;CyclingT&#39;</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">pd</span><span class="o">.</span><span class="n">ExcelWriter</span><span class="p">(</span><span class="s1">&#39;./tables/marker_genes.xls&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">marker_excel</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">cell_subtypes</span><span class="p">,</span><span class="n">subtype_sheet_names</span><span class="p">):</span>
        <span class="n">subtype_marker</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">get</span><span class="o">.</span><span class="n">rank_genes_groups_df</span><span class="p">(</span><span class="n">adata_nogex</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="n">i</span><span class="p">)</span>
        <span class="n">subtype_marker</span> <span class="o">=</span> <span class="n">subtype_marker</span><span class="p">[</span><span class="o">~</span><span class="n">subtype_marker</span><span class="p">[</span><span class="s1">&#39;names&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;RP&#39;</span><span class="p">)</span> <span class="o">&amp;</span>
                                        <span class="o">~</span><span class="n">subtype_marker</span><span class="p">[</span><span class="s1">&#39;names&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;MT-&#39;</span><span class="p">)]</span>
        <span class="n">subtype_marker</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">marker_excel</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="n">j</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">TFlist</span><span class="o">=</span><span class="p">[</span>
    <span class="s2">&quot;AC008770.3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;AC023509.3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;AC092835.1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;AC138696.1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ADNP&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ADNP2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;AEBP1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;AEBP2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;AHCTF1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;AHDC1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;AHR&quot;</span><span class="p">,</span>
    <span class="s2">&quot;AHRR&quot;</span><span class="p">,</span>
    <span class="s2">&quot;AIRE&quot;</span><span class="p">,</span>
    <span class="s2">&quot;AKAP8&quot;</span><span class="p">,</span>
    <span class="s2">&quot;AKAP8L&quot;</span><span class="p">,</span>
    <span class="s2">&quot;AKNA&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ALX1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ALX3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ALX4&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ANHX&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ANKZF1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;AR&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ARGFX&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ARHGAP35&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ARID2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ARID3A&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ARID3B&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ARID3C&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ARID5A&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ARID5B&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ARNT&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ARNT2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ARNTL&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ARNTL2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ARX&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ASCL1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ASCL2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ASCL3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ASCL4&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ASCL5&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ASH1L&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ATF1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ATF2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ATF3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ATF4&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ATF5&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ATF6&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ATF6B&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ATF7&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ATMIN&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ATOH1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ATOH7&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ATOH8&quot;</span><span class="p">,</span>
    <span class="s2">&quot;BACH1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;BACH2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;BARHL1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;BARHL2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;BARX1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;BARX2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;BATF&quot;</span><span class="p">,</span>
    <span class="s2">&quot;BATF2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;BATF3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;BAZ2A&quot;</span><span class="p">,</span>
    <span class="s2">&quot;BAZ2B&quot;</span><span class="p">,</span>
    <span class="s2">&quot;BBX&quot;</span><span class="p">,</span>
    <span class="s2">&quot;BCL11A&quot;</span><span class="p">,</span>
    <span class="s2">&quot;BCL11B&quot;</span><span class="p">,</span>
    <span class="s2">&quot;BCL6&quot;</span><span class="p">,</span>
    <span class="s2">&quot;BCL6B&quot;</span><span class="p">,</span>
    <span class="s2">&quot;BHLHA15&quot;</span><span class="p">,</span>
    <span class="s2">&quot;BHLHA9&quot;</span><span class="p">,</span>
    <span class="s2">&quot;BHLHE22&quot;</span><span class="p">,</span>
    <span class="s2">&quot;BHLHE23&quot;</span><span class="p">,</span>
    <span class="s2">&quot;BHLHE40&quot;</span><span class="p">,</span>
    <span class="s2">&quot;BHLHE41&quot;</span><span class="p">,</span>
    <span class="s2">&quot;BNC1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;BNC2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;BORCS8-MEF2B&quot;</span><span class="p">,</span>
    <span class="s2">&quot;BPTF&quot;</span><span class="p">,</span>
    <span class="s2">&quot;BRF2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;BSX&quot;</span><span class="p">,</span>
    <span class="s2">&quot;C11orf95&quot;</span><span class="p">,</span>
    <span class="s2">&quot;CAMTA1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;CAMTA2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;CARF&quot;</span><span class="p">,</span>
    <span class="s2">&quot;CASZ1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;CBX2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;CC2D1A&quot;</span><span class="p">,</span>
    <span class="s2">&quot;CCDC169-SOHLH2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;CCDC17&quot;</span><span class="p">,</span>
    <span class="s2">&quot;CDC5L&quot;</span><span class="p">,</span>
    <span class="s2">&quot;CDX1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;CDX2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;CDX4&quot;</span><span class="p">,</span>
    <span class="s2">&quot;CEBPA&quot;</span><span class="p">,</span>
    <span class="s2">&quot;CEBPB&quot;</span><span class="p">,</span>
    <span class="s2">&quot;CEBPD&quot;</span><span class="p">,</span>
    <span class="s2">&quot;CEBPE&quot;</span><span class="p">,</span>
    <span class="s2">&quot;CEBPG&quot;</span><span class="p">,</span>
    <span class="s2">&quot;CEBPZ&quot;</span><span class="p">,</span>
    <span class="s2">&quot;CENPA&quot;</span><span class="p">,</span>
    <span class="s2">&quot;CENPB&quot;</span><span class="p">,</span>
    <span class="s2">&quot;CENPBD1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;CENPS&quot;</span><span class="p">,</span>
    <span class="s2">&quot;CENPT&quot;</span><span class="p">,</span>
    <span class="s2">&quot;CENPX&quot;</span><span class="p">,</span>
    <span class="s2">&quot;CGGBP1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;CHAMP1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;CHCHD3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;CIC&quot;</span><span class="p">,</span>
    <span class="s2">&quot;CLOCK&quot;</span><span class="p">,</span>
    <span class="s2">&quot;CPEB1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;CPXCR1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;CREB1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;CREB3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;CREB3L1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;CREB3L2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;CREB3L3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;CREB3L4&quot;</span><span class="p">,</span>
    <span class="s2">&quot;CREB5&quot;</span><span class="p">,</span>
    <span class="s2">&quot;CREBL2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;CREBZF&quot;</span><span class="p">,</span>
    <span class="s2">&quot;CREM&quot;</span><span class="p">,</span>
    <span class="s2">&quot;CRX&quot;</span><span class="p">,</span>
    <span class="s2">&quot;CSRNP1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;CSRNP2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;CSRNP3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;CTCF&quot;</span><span class="p">,</span>
    <span class="s2">&quot;CTCFL&quot;</span><span class="p">,</span>
    <span class="s2">&quot;CUX1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;CUX2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;CXXC1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;CXXC4&quot;</span><span class="p">,</span>
    <span class="s2">&quot;CXXC5&quot;</span><span class="p">,</span>
    <span class="s2">&quot;DACH1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;DACH2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;DBP&quot;</span><span class="p">,</span>
    <span class="s2">&quot;DBX1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;DBX2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;DDIT3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;DEAF1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;DLX1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;DLX2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;DLX3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;DLX4&quot;</span><span class="p">,</span>
    <span class="s2">&quot;DLX5&quot;</span><span class="p">,</span>
    <span class="s2">&quot;DLX6&quot;</span><span class="p">,</span>
    <span class="s2">&quot;DMBX1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;DMRT1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;DMRT2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;DMRT3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;DMRTA1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;DMRTA2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;DMRTB1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;DMRTC2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;DMTF1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;DNMT1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;DNTTIP1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;DOT1L&quot;</span><span class="p">,</span>
    <span class="s2">&quot;DPF1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;DPF3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;DPRX&quot;</span><span class="p">,</span>
    <span class="s2">&quot;DR1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;DRAP1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;DRGX&quot;</span><span class="p">,</span>
    <span class="s2">&quot;DUX1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;DUX3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;DUX4&quot;</span><span class="p">,</span>
    <span class="s2">&quot;DUXA&quot;</span><span class="p">,</span>
    <span class="s2">&quot;DZIP1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;E2F1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;E2F2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;E2F3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;E2F4&quot;</span><span class="p">,</span>
    <span class="s2">&quot;E2F5&quot;</span><span class="p">,</span>
    <span class="s2">&quot;E2F6&quot;</span><span class="p">,</span>
    <span class="s2">&quot;E2F7&quot;</span><span class="p">,</span>
    <span class="s2">&quot;E2F8&quot;</span><span class="p">,</span>
    <span class="s2">&quot;E4F1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;EBF1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;EBF2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;EBF3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;EBF4&quot;</span><span class="p">,</span>
    <span class="s2">&quot;EEA1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;EGR1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;EGR2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;EGR3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;EGR4&quot;</span><span class="p">,</span>
    <span class="s2">&quot;EHF&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ELF1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ELF2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ELF3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ELF4&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ELF5&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ELK1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ELK3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ELK4&quot;</span><span class="p">,</span>
    <span class="s2">&quot;EMX1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;EMX2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;EN1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;EN2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;EOMES&quot;</span><span class="p">,</span>
    <span class="s2">&quot;EPAS1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ERF&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ERG&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ESR1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ESR2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ESRRA&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ESRRB&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ESRRG&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ESX1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ETS1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ETS2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ETV1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ETV2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ETV3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ETV3L&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ETV4&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ETV5&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ETV6&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ETV7&quot;</span><span class="p">,</span>
    <span class="s2">&quot;EVX1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;EVX2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;FAM170A&quot;</span><span class="p">,</span>
    <span class="s2">&quot;FAM200B&quot;</span><span class="p">,</span>
    <span class="s2">&quot;FBXL19&quot;</span><span class="p">,</span>
    <span class="s2">&quot;FERD3L&quot;</span><span class="p">,</span>
    <span class="s2">&quot;FEV&quot;</span><span class="p">,</span>
    <span class="s2">&quot;FEZF1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;FEZF2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;FIGLA&quot;</span><span class="p">,</span>
    <span class="s2">&quot;FIZ1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;FLI1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;FLYWCH1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;FOS&quot;</span><span class="p">,</span>
    <span class="s2">&quot;FOSB&quot;</span><span class="p">,</span>
    <span class="s2">&quot;FOSL1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;FOSL2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;FOXA1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;FOXA2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;FOXA3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;FOXB1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;FOXB2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;FOXC1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;FOXC2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;FOXD1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;FOXD2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;FOXD3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;FOXD4&quot;</span><span class="p">,</span>
    <span class="s2">&quot;FOXD4L1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;FOXD4L3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;FOXD4L4&quot;</span><span class="p">,</span>
    <span class="s2">&quot;FOXD4L5&quot;</span><span class="p">,</span>
    <span class="s2">&quot;FOXD4L6&quot;</span><span class="p">,</span>
    <span class="s2">&quot;FOXE1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;FOXE3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;FOXF1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;FOXF2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;FOXG1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;FOXH1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;FOXI1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;FOXI2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;FOXI3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;FOXJ1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;FOXJ2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;FOXJ3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;FOXK1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;FOXK2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;FOXL1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;FOXL2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;FOXM1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;FOXN1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;FOXN2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;FOXN3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;FOXN4&quot;</span><span class="p">,</span>
    <span class="s2">&quot;FOXO1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;FOXO3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;FOXO4&quot;</span><span class="p">,</span>
    <span class="s2">&quot;FOXO6&quot;</span><span class="p">,</span>
    <span class="s2">&quot;FOXP1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;FOXP2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;FOXP3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;FOXP4&quot;</span><span class="p">,</span>
    <span class="s2">&quot;FOXQ1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;FOXR1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;FOXR2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;FOXS1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;GABPA&quot;</span><span class="p">,</span>
    <span class="s2">&quot;GATA1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;GATA2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;GATA3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;GATA4&quot;</span><span class="p">,</span>
    <span class="s2">&quot;GATA5&quot;</span><span class="p">,</span>
    <span class="s2">&quot;GATA6&quot;</span><span class="p">,</span>
    <span class="s2">&quot;GATAD2A&quot;</span><span class="p">,</span>
    <span class="s2">&quot;GATAD2B&quot;</span><span class="p">,</span>
    <span class="s2">&quot;GBX1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;GBX2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;GCM1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;GCM2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;GFI1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;GFI1B&quot;</span><span class="p">,</span>
    <span class="s2">&quot;GLI1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;GLI2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;GLI3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;GLI4&quot;</span><span class="p">,</span>
    <span class="s2">&quot;GLIS1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;GLIS2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;GLIS3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;GLMP&quot;</span><span class="p">,</span>
    <span class="s2">&quot;GLYR1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;GMEB1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;GMEB2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;GPBP1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;GPBP1L1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;GRHL1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;GRHL2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;GRHL3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;GSC&quot;</span><span class="p">,</span>
    <span class="s2">&quot;GSC2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;GSX1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;GSX2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;GTF2B&quot;</span><span class="p">,</span>
    <span class="s2">&quot;GTF2I&quot;</span><span class="p">,</span>
    <span class="s2">&quot;GTF2IRD1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;GTF2IRD2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;GTF2IRD2B&quot;</span><span class="p">,</span>
    <span class="s2">&quot;GTF3A&quot;</span><span class="p">,</span>
    <span class="s2">&quot;GZF1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;HAND1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;HAND2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;HBP1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;HDX&quot;</span><span class="p">,</span>
    <span class="s2">&quot;HELT&quot;</span><span class="p">,</span>
    <span class="s2">&quot;HES1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;HES2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;HES3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;HES4&quot;</span><span class="p">,</span>
    <span class="s2">&quot;HES5&quot;</span><span class="p">,</span>
    <span class="s2">&quot;HES6&quot;</span><span class="p">,</span>
    <span class="s2">&quot;HES7&quot;</span><span class="p">,</span>
    <span class="s2">&quot;HESX1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;HEY1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;HEY2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;HEYL&quot;</span><span class="p">,</span>
    <span class="s2">&quot;HHEX&quot;</span><span class="p">,</span>
    <span class="s2">&quot;HIC1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;HIC2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;HIF1A&quot;</span><span class="p">,</span>
    <span class="s2">&quot;HIF3A&quot;</span><span class="p">,</span>
    <span class="s2">&quot;HINFP&quot;</span><span class="p">,</span>
    <span class="s2">&quot;HIVEP1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;HIVEP2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;HIVEP3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;HKR1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;HLF&quot;</span><span class="p">,</span>
    <span class="s2">&quot;HLX&quot;</span><span class="p">,</span>
    <span class="s2">&quot;HMBOX1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;HMG20A&quot;</span><span class="p">,</span>
    <span class="s2">&quot;HMG20B&quot;</span><span class="p">,</span>
    <span class="s2">&quot;HMGA1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;HMGA2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;HMGN3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;HMX1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;HMX2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;HMX3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;HNF1A&quot;</span><span class="p">,</span>
    <span class="s2">&quot;HNF1B&quot;</span><span class="p">,</span>
    <span class="s2">&quot;HNF4A&quot;</span><span class="p">,</span>
    <span class="s2">&quot;HNF4G&quot;</span><span class="p">,</span>
    <span class="s2">&quot;HOMEZ&quot;</span><span class="p">,</span>
    <span class="s2">&quot;HOXA1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;HOXA10&quot;</span><span class="p">,</span>
    <span class="s2">&quot;HOXA11&quot;</span><span class="p">,</span>
    <span class="s2">&quot;HOXA13&quot;</span><span class="p">,</span>
    <span class="s2">&quot;HOXA2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;HOXA3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;HOXA4&quot;</span><span class="p">,</span>
    <span class="s2">&quot;HOXA5&quot;</span><span class="p">,</span>
    <span class="s2">&quot;HOXA6&quot;</span><span class="p">,</span>
    <span class="s2">&quot;HOXA7&quot;</span><span class="p">,</span>
    <span class="s2">&quot;HOXA9&quot;</span><span class="p">,</span>
    <span class="s2">&quot;HOXB1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;HOXB13&quot;</span><span class="p">,</span>
    <span class="s2">&quot;HOXB2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;HOXB3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;HOXB4&quot;</span><span class="p">,</span>
    <span class="s2">&quot;HOXB5&quot;</span><span class="p">,</span>
    <span class="s2">&quot;HOXB6&quot;</span><span class="p">,</span>
    <span class="s2">&quot;HOXB7&quot;</span><span class="p">,</span>
    <span class="s2">&quot;HOXB8&quot;</span><span class="p">,</span>
    <span class="s2">&quot;HOXB9&quot;</span><span class="p">,</span>
    <span class="s2">&quot;HOXC10&quot;</span><span class="p">,</span>
    <span class="s2">&quot;HOXC11&quot;</span><span class="p">,</span>
    <span class="s2">&quot;HOXC12&quot;</span><span class="p">,</span>
    <span class="s2">&quot;HOXC13&quot;</span><span class="p">,</span>
    <span class="s2">&quot;HOXC4&quot;</span><span class="p">,</span>
    <span class="s2">&quot;HOXC5&quot;</span><span class="p">,</span>
    <span class="s2">&quot;HOXC6&quot;</span><span class="p">,</span>
    <span class="s2">&quot;HOXC8&quot;</span><span class="p">,</span>
    <span class="s2">&quot;HOXC9&quot;</span><span class="p">,</span>
    <span class="s2">&quot;HOXD1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;HOXD10&quot;</span><span class="p">,</span>
    <span class="s2">&quot;HOXD11&quot;</span><span class="p">,</span>
    <span class="s2">&quot;HOXD12&quot;</span><span class="p">,</span>
    <span class="s2">&quot;HOXD13&quot;</span><span class="p">,</span>
    <span class="s2">&quot;HOXD3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;HOXD4&quot;</span><span class="p">,</span>
    <span class="s2">&quot;HOXD8&quot;</span><span class="p">,</span>
    <span class="s2">&quot;HOXD9&quot;</span><span class="p">,</span>
    <span class="s2">&quot;HSF1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;HSF2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;HSF4&quot;</span><span class="p">,</span>
    <span class="s2">&quot;HSF5&quot;</span><span class="p">,</span>
    <span class="s2">&quot;HSFX1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;HSFX2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;HSFY1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;HSFY2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;IKZF1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;IKZF2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;IKZF3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;IKZF4&quot;</span><span class="p">,</span>
    <span class="s2">&quot;IKZF5&quot;</span><span class="p">,</span>
    <span class="s2">&quot;INSM1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;INSM2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;IRF1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;IRF2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;IRF3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;IRF4&quot;</span><span class="p">,</span>
    <span class="s2">&quot;IRF5&quot;</span><span class="p">,</span>
    <span class="s2">&quot;IRF6&quot;</span><span class="p">,</span>
    <span class="s2">&quot;IRF7&quot;</span><span class="p">,</span>
    <span class="s2">&quot;IRF8&quot;</span><span class="p">,</span>
    <span class="s2">&quot;IRF9&quot;</span><span class="p">,</span>
    <span class="s2">&quot;IRX1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;IRX2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;IRX3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;IRX4&quot;</span><span class="p">,</span>
    <span class="s2">&quot;IRX5&quot;</span><span class="p">,</span>
    <span class="s2">&quot;IRX6&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ISL1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ISL2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ISX&quot;</span><span class="p">,</span>
    <span class="s2">&quot;JAZF1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;JDP2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;JRK&quot;</span><span class="p">,</span>
    <span class="s2">&quot;JRKL&quot;</span><span class="p">,</span>
    <span class="s2">&quot;JUN&quot;</span><span class="p">,</span>
    <span class="s2">&quot;JUNB&quot;</span><span class="p">,</span>
    <span class="s2">&quot;JUND&quot;</span><span class="p">,</span>
    <span class="s2">&quot;KAT7&quot;</span><span class="p">,</span>
    <span class="s2">&quot;KCMF1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;KCNIP3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;KDM2A&quot;</span><span class="p">,</span>
    <span class="s2">&quot;KDM2B&quot;</span><span class="p">,</span>
    <span class="s2">&quot;KDM5B&quot;</span><span class="p">,</span>
    <span class="s2">&quot;KIN&quot;</span><span class="p">,</span>
    <span class="s2">&quot;KLF1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;KLF10&quot;</span><span class="p">,</span>
    <span class="s2">&quot;KLF11&quot;</span><span class="p">,</span>
    <span class="s2">&quot;KLF12&quot;</span><span class="p">,</span>
    <span class="s2">&quot;KLF13&quot;</span><span class="p">,</span>
    <span class="s2">&quot;KLF14&quot;</span><span class="p">,</span>
    <span class="s2">&quot;KLF15&quot;</span><span class="p">,</span>
    <span class="s2">&quot;KLF16&quot;</span><span class="p">,</span>
    <span class="s2">&quot;KLF17&quot;</span><span class="p">,</span>
    <span class="s2">&quot;KLF2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;KLF3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;KLF4&quot;</span><span class="p">,</span>
    <span class="s2">&quot;KLF5&quot;</span><span class="p">,</span>
    <span class="s2">&quot;KLF6&quot;</span><span class="p">,</span>
    <span class="s2">&quot;KLF7&quot;</span><span class="p">,</span>
    <span class="s2">&quot;KLF8&quot;</span><span class="p">,</span>
    <span class="s2">&quot;KLF9&quot;</span><span class="p">,</span>
    <span class="s2">&quot;KMT2A&quot;</span><span class="p">,</span>
    <span class="s2">&quot;KMT2B&quot;</span><span class="p">,</span>
    <span class="s2">&quot;L3MBTL1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;L3MBTL3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;L3MBTL4&quot;</span><span class="p">,</span>
    <span class="s2">&quot;LBX1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;LBX2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;LCOR&quot;</span><span class="p">,</span>
    <span class="s2">&quot;LCORL&quot;</span><span class="p">,</span>
    <span class="s2">&quot;LEF1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;LEUTX&quot;</span><span class="p">,</span>
    <span class="s2">&quot;LHX1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;LHX2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;LHX3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;LHX4&quot;</span><span class="p">,</span>
    <span class="s2">&quot;LHX5&quot;</span><span class="p">,</span>
    <span class="s2">&quot;LHX6&quot;</span><span class="p">,</span>
    <span class="s2">&quot;LHX8&quot;</span><span class="p">,</span>
    <span class="s2">&quot;LHX9&quot;</span><span class="p">,</span>
    <span class="s2">&quot;LIN28A&quot;</span><span class="p">,</span>
    <span class="s2">&quot;LIN28B&quot;</span><span class="p">,</span>
    <span class="s2">&quot;LIN54&quot;</span><span class="p">,</span>
    <span class="s2">&quot;LMX1A&quot;</span><span class="p">,</span>
    <span class="s2">&quot;LMX1B&quot;</span><span class="p">,</span>
    <span class="s2">&quot;LTF&quot;</span><span class="p">,</span>
    <span class="s2">&quot;LYL1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;MAF&quot;</span><span class="p">,</span>
    <span class="s2">&quot;MAFA&quot;</span><span class="p">,</span>
    <span class="s2">&quot;MAFB&quot;</span><span class="p">,</span>
    <span class="s2">&quot;MAFF&quot;</span><span class="p">,</span>
    <span class="s2">&quot;MAFG&quot;</span><span class="p">,</span>
    <span class="s2">&quot;MAFK&quot;</span><span class="p">,</span>
    <span class="s2">&quot;MAX&quot;</span><span class="p">,</span>
    <span class="s2">&quot;MAZ&quot;</span><span class="p">,</span>
    <span class="s2">&quot;MBD1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;MBD2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;MBD3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;MBD4&quot;</span><span class="p">,</span>
    <span class="s2">&quot;MBD6&quot;</span><span class="p">,</span>
    <span class="s2">&quot;MBNL2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;MECOM&quot;</span><span class="p">,</span>
    <span class="s2">&quot;MECP2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;MEF2A&quot;</span><span class="p">,</span>
    <span class="s2">&quot;MEF2B&quot;</span><span class="p">,</span>
    <span class="s2">&quot;MEF2C&quot;</span><span class="p">,</span>
    <span class="s2">&quot;MEF2D&quot;</span><span class="p">,</span>
    <span class="s2">&quot;MEIS1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;MEIS2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;MEIS3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;MEOX1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;MEOX2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;MESP1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;MESP2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;MGA&quot;</span><span class="p">,</span>
    <span class="s2">&quot;MITF&quot;</span><span class="p">,</span>
    <span class="s2">&quot;MIXL1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;MKX&quot;</span><span class="p">,</span>
    <span class="s2">&quot;MLX&quot;</span><span class="p">,</span>
    <span class="s2">&quot;MLXIP&quot;</span><span class="p">,</span>
    <span class="s2">&quot;MLXIPL&quot;</span><span class="p">,</span>
    <span class="s2">&quot;MNT&quot;</span><span class="p">,</span>
    <span class="s2">&quot;MNX1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;MSANTD1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;MSANTD3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;MSANTD4&quot;</span><span class="p">,</span>
    <span class="s2">&quot;MSC&quot;</span><span class="p">,</span>
    <span class="s2">&quot;MSGN1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;MSX1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;MSX2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;MTERF1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;MTERF2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;MTERF3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;MTERF4&quot;</span><span class="p">,</span>
    <span class="s2">&quot;MTF1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;MTF2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;MXD1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;MXD3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;MXD4&quot;</span><span class="p">,</span>
    <span class="s2">&quot;MXI1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;MYB&quot;</span><span class="p">,</span>
    <span class="s2">&quot;MYBL1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;MYBL2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;MYC&quot;</span><span class="p">,</span>
    <span class="s2">&quot;MYCL&quot;</span><span class="p">,</span>
    <span class="s2">&quot;MYCN&quot;</span><span class="p">,</span>
    <span class="s2">&quot;MYF5&quot;</span><span class="p">,</span>
    <span class="s2">&quot;MYF6&quot;</span><span class="p">,</span>
    <span class="s2">&quot;MYNN&quot;</span><span class="p">,</span>
    <span class="s2">&quot;MYOD1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;MYOG&quot;</span><span class="p">,</span>
    <span class="s2">&quot;MYPOP&quot;</span><span class="p">,</span>
    <span class="s2">&quot;MYRF&quot;</span><span class="p">,</span>
    <span class="s2">&quot;MYRFL&quot;</span><span class="p">,</span>
    <span class="s2">&quot;MYSM1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;MYT1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;MYT1L&quot;</span><span class="p">,</span>
    <span class="s2">&quot;MZF1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NACC2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NAIF1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NANOG&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NANOGNB&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NANOGP8&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NCOA1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NCOA2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NCOA3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NEUROD1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NEUROD2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NEUROD4&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NEUROD6&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NEUROG1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NEUROG2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NEUROG3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NFAT5&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NFATC1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NFATC2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NFATC3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NFATC4&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NFE2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NFE2L1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NFE2L2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NFE2L3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NFE4&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NFIA&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NFIB&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NFIC&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NFIL3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NFIX&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NFKB1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NFKB2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NFX1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NFXL1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NFYA&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NFYB&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NFYC&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NHLH1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NHLH2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NKRF&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NKX1-1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NKX1-2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NKX2-1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NKX2-2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NKX2-3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NKX2-4&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NKX2-5&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NKX2-6&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NKX2-8&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NKX3-1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NKX3-2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NKX6-1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NKX6-2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NKX6-3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NME2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NOBOX&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NOTO&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NPAS1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NPAS2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NPAS3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NPAS4&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NR0B1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NR1D1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NR1D2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NR1H2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NR1H3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NR1H4&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NR1I2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NR1I3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NR2C1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NR2C2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NR2E1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NR2E3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NR2F1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NR2F2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NR2F6&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NR3C1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NR3C2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NR4A1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NR4A2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NR4A3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NR5A1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NR5A2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NR6A1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NRF1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NRL&quot;</span><span class="p">,</span>
    <span class="s2">&quot;OLIG1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;OLIG2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;OLIG3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ONECUT1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ONECUT2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ONECUT3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;OSR1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;OSR2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;OTP&quot;</span><span class="p">,</span>
    <span class="s2">&quot;OTX1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;OTX2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;OVOL1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;OVOL2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;OVOL3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;PA2G4&quot;</span><span class="p">,</span>
    <span class="s2">&quot;PATZ1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;PAX1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;PAX2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;PAX3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;PAX4&quot;</span><span class="p">,</span>
    <span class="s2">&quot;PAX5&quot;</span><span class="p">,</span>
    <span class="s2">&quot;PAX6&quot;</span><span class="p">,</span>
    <span class="s2">&quot;PAX7&quot;</span><span class="p">,</span>
    <span class="s2">&quot;PAX8&quot;</span><span class="p">,</span>
    <span class="s2">&quot;PAX9&quot;</span><span class="p">,</span>
    <span class="s2">&quot;PBX1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;PBX2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;PBX3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;PBX4&quot;</span><span class="p">,</span>
    <span class="s2">&quot;PCGF2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;PCGF6&quot;</span><span class="p">,</span>
    <span class="s2">&quot;PDX1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;PEG3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;PGR&quot;</span><span class="p">,</span>
    <span class="s2">&quot;PHF1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;PHF19 &quot;</span><span class="p">,</span>
    <span class="s2">&quot;PHF20&quot;</span><span class="p">,</span>
    <span class="s2">&quot;PHF21A&quot;</span><span class="p">,</span>
    <span class="s2">&quot;PHOX2A&quot;</span><span class="p">,</span>
    <span class="s2">&quot;PHOX2B&quot;</span><span class="p">,</span>
    <span class="s2">&quot;PIN1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;PITX1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;PITX2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;PITX3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;PKNOX1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;PKNOX2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;PLAG1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;PLAGL1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;PLAGL2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;PLSCR1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;POGK&quot;</span><span class="p">,</span>
    <span class="s2">&quot;POU1F1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;POU2AF1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;POU2F1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;POU2F2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;POU2F3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;POU3F1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;POU3F2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;POU3F3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;POU3F4&quot;</span><span class="p">,</span>
    <span class="s2">&quot;POU4F1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;POU4F2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;POU4F3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;POU5F1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;POU5F1B&quot;</span><span class="p">,</span>
    <span class="s2">&quot;POU5F2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;POU6F1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;POU6F2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;PPARA&quot;</span><span class="p">,</span>
    <span class="s2">&quot;PPARD&quot;</span><span class="p">,</span>
    <span class="s2">&quot;PPARG&quot;</span><span class="p">,</span>
    <span class="s2">&quot;PRDM1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;PRDM10&quot;</span><span class="p">,</span>
    <span class="s2">&quot;PRDM12&quot;</span><span class="p">,</span>
    <span class="s2">&quot;PRDM13&quot;</span><span class="p">,</span>
    <span class="s2">&quot;PRDM14&quot;</span><span class="p">,</span>
    <span class="s2">&quot;PRDM15&quot;</span><span class="p">,</span>
    <span class="s2">&quot;PRDM16&quot;</span><span class="p">,</span>
    <span class="s2">&quot;PRDM2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;PRDM4&quot;</span><span class="p">,</span>
    <span class="s2">&quot;PRDM5&quot;</span><span class="p">,</span>
    <span class="s2">&quot;PRDM6&quot;</span><span class="p">,</span>
    <span class="s2">&quot;PRDM8&quot;</span><span class="p">,</span>
    <span class="s2">&quot;PRDM9&quot;</span><span class="p">,</span>
    <span class="s2">&quot;PREB&quot;</span><span class="p">,</span>
    <span class="s2">&quot;PRMT3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;PROP1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;PROX1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;PROX2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;PRR12&quot;</span><span class="p">,</span>
    <span class="s2">&quot;PRRX1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;PRRX2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;PTF1A&quot;</span><span class="p">,</span>
    <span class="s2">&quot;PURA&quot;</span><span class="p">,</span>
    <span class="s2">&quot;PURB&quot;</span><span class="p">,</span>
    <span class="s2">&quot;PURG&quot;</span><span class="p">,</span>
    <span class="s2">&quot;RAG1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;RARA&quot;</span><span class="p">,</span>
    <span class="s2">&quot;RARB&quot;</span><span class="p">,</span>
    <span class="s2">&quot;RARG&quot;</span><span class="p">,</span>
    <span class="s2">&quot;RAX&quot;</span><span class="p">,</span>
    <span class="s2">&quot;RAX2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;RBAK&quot;</span><span class="p">,</span>
    <span class="s2">&quot;RBCK1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;RBPJ&quot;</span><span class="p">,</span>
    <span class="s2">&quot;RBPJL&quot;</span><span class="p">,</span>
    <span class="s2">&quot;RBSN&quot;</span><span class="p">,</span>
    <span class="s2">&quot;REL&quot;</span><span class="p">,</span>
    <span class="s2">&quot;RELA&quot;</span><span class="p">,</span>
    <span class="s2">&quot;RELB&quot;</span><span class="p">,</span>
    <span class="s2">&quot;REPIN1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;REST&quot;</span><span class="p">,</span>
    <span class="s2">&quot;REXO4&quot;</span><span class="p">,</span>
    <span class="s2">&quot;RFX1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;RFX2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;RFX3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;RFX4&quot;</span><span class="p">,</span>
    <span class="s2">&quot;RFX5&quot;</span><span class="p">,</span>
    <span class="s2">&quot;RFX6&quot;</span><span class="p">,</span>
    <span class="s2">&quot;RFX7&quot;</span><span class="p">,</span>
    <span class="s2">&quot;RFX8&quot;</span><span class="p">,</span>
    <span class="s2">&quot;RHOXF1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;RHOXF2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;RHOXF2B&quot;</span><span class="p">,</span>
    <span class="s2">&quot;RLF&quot;</span><span class="p">,</span>
    <span class="s2">&quot;RORA&quot;</span><span class="p">,</span>
    <span class="s2">&quot;RORB&quot;</span><span class="p">,</span>
    <span class="s2">&quot;RORC&quot;</span><span class="p">,</span>
    <span class="s2">&quot;RREB1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;RUNX1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;RUNX2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;RUNX3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;RXRA&quot;</span><span class="p">,</span>
    <span class="s2">&quot;RXRB&quot;</span><span class="p">,</span>
    <span class="s2">&quot;RXRG&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SAFB&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SAFB2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SALL1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SALL2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SALL3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SALL4&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SATB1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SATB2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SCMH1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SCML4&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SCRT1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SCRT2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SCX&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SEBOX&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SETBP1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SETDB1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SETDB2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SGSM2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SHOX&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SHOX2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SIM1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SIM2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SIX1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SIX2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SIX3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SIX4&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SIX5&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SIX6&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SKI&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SKIL&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SKOR1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SKOR2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SLC2A4RG&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SMAD1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SMAD3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SMAD4&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SMAD5&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SMAD9&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SMYD3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SNAI1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SNAI2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SNAI3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SNAPC2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SNAPC4&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SNAPC5&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SOHLH1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SOHLH2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SON&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SOX1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SOX10&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SOX11&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SOX12&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SOX13&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SOX14&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SOX15&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SOX17&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SOX18&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SOX2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SOX21&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SOX3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SOX30&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SOX4&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SOX5&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SOX6&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SOX7&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SOX8&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SOX9&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SP1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SP100&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SP110&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SP140&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SP140L&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SP2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SP3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SP4&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SP5&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SP6&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SP7&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SP8&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SP9&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SPDEF&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SPEN&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SPI1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SPIB&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SPIC&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SPZ1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SRCAP&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SREBF1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SREBF2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SRF&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SRY&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ST18&quot;</span><span class="p">,</span>
    <span class="s2">&quot;STAT1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;STAT2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;STAT3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;STAT4&quot;</span><span class="p">,</span>
    <span class="s2">&quot;STAT5A&quot;</span><span class="p">,</span>
    <span class="s2">&quot;STAT5B&quot;</span><span class="p">,</span>
    <span class="s2">&quot;STAT6&quot;</span><span class="p">,</span>
    <span class="s2">&quot;T&quot;</span><span class="p">,</span>
    <span class="s2">&quot;TAL1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;TAL2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;TBP&quot;</span><span class="p">,</span>
    <span class="s2">&quot;TBPL1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;TBPL2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;TBR1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;TBX1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;TBX10&quot;</span><span class="p">,</span>
    <span class="s2">&quot;TBX15&quot;</span><span class="p">,</span>
    <span class="s2">&quot;TBX18&quot;</span><span class="p">,</span>
    <span class="s2">&quot;TBX19&quot;</span><span class="p">,</span>
    <span class="s2">&quot;TBX2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;TBX20&quot;</span><span class="p">,</span>
    <span class="s2">&quot;TBX21&quot;</span><span class="p">,</span>
    <span class="s2">&quot;TBX22&quot;</span><span class="p">,</span>
    <span class="s2">&quot;TBX3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;TBX4&quot;</span><span class="p">,</span>
    <span class="s2">&quot;TBX5&quot;</span><span class="p">,</span>
    <span class="s2">&quot;TBX6&quot;</span><span class="p">,</span>
    <span class="s2">&quot;TCF12&quot;</span><span class="p">,</span>
    <span class="s2">&quot;TCF15&quot;</span><span class="p">,</span>
    <span class="s2">&quot;TCF20&quot;</span><span class="p">,</span>
    <span class="s2">&quot;TCF21&quot;</span><span class="p">,</span>
    <span class="s2">&quot;TCF23&quot;</span><span class="p">,</span>
    <span class="s2">&quot;TCF24&quot;</span><span class="p">,</span>
    <span class="s2">&quot;TCF3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;TCF4&quot;</span><span class="p">,</span>
    <span class="s2">&quot;TCF7&quot;</span><span class="p">,</span>
    <span class="s2">&quot;TCF7L1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;TCF7L2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;TCFL5&quot;</span><span class="p">,</span>
    <span class="s2">&quot;TEAD1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;TEAD2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;TEAD3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;TEAD4&quot;</span><span class="p">,</span>
    <span class="s2">&quot;TEF&quot;</span><span class="p">,</span>
    <span class="s2">&quot;TERB1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;TERF1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;TERF2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;TET1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;TET2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;TET3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;TFAP2A&quot;</span><span class="p">,</span>
    <span class="s2">&quot;TFAP2B&quot;</span><span class="p">,</span>
    <span class="s2">&quot;TFAP2C&quot;</span><span class="p">,</span>
    <span class="s2">&quot;TFAP2D&quot;</span><span class="p">,</span>
    <span class="s2">&quot;TFAP2E&quot;</span><span class="p">,</span>
    <span class="s2">&quot;TFAP4&quot;</span><span class="p">,</span>
    <span class="s2">&quot;TFCP2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;TFCP2L1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;TFDP1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;TFDP2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;TFDP3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;TFE3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;TFEB&quot;</span><span class="p">,</span>
    <span class="s2">&quot;TFEC&quot;</span><span class="p">,</span>
    <span class="s2">&quot;TGIF1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;TGIF2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;TGIF2LX&quot;</span><span class="p">,</span>
    <span class="s2">&quot;TGIF2LY&quot;</span><span class="p">,</span>
    <span class="s2">&quot;THAP1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;THAP10&quot;</span><span class="p">,</span>
    <span class="s2">&quot;THAP11&quot;</span><span class="p">,</span>
    <span class="s2">&quot;THAP12&quot;</span><span class="p">,</span>
    <span class="s2">&quot;THAP2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;THAP3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;THAP4&quot;</span><span class="p">,</span>
    <span class="s2">&quot;THAP5&quot;</span><span class="p">,</span>
    <span class="s2">&quot;THAP6&quot;</span><span class="p">,</span>
    <span class="s2">&quot;THAP7&quot;</span><span class="p">,</span>
    <span class="s2">&quot;THAP8&quot;</span><span class="p">,</span>
    <span class="s2">&quot;THAP9&quot;</span><span class="p">,</span>
    <span class="s2">&quot;THRA&quot;</span><span class="p">,</span>
    <span class="s2">&quot;THRB&quot;</span><span class="p">,</span>
    <span class="s2">&quot;THYN1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;TIGD1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;TIGD2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;TIGD3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;TIGD4&quot;</span><span class="p">,</span>
    <span class="s2">&quot;TIGD5&quot;</span><span class="p">,</span>
    <span class="s2">&quot;TIGD6&quot;</span><span class="p">,</span>
    <span class="s2">&quot;TIGD7&quot;</span><span class="p">,</span>
    <span class="s2">&quot;TLX1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;TLX2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;TLX3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;TMF1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;TOPORS&quot;</span><span class="p">,</span>
    <span class="s2">&quot;TP53&quot;</span><span class="p">,</span>
    <span class="s2">&quot;TP63&quot;</span><span class="p">,</span>
    <span class="s2">&quot;TP73&quot;</span><span class="p">,</span>
    <span class="s2">&quot;TPRX1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;TRAFD1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;TRERF1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;TRPS1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;TSC22D1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;TSHZ1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;TSHZ2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;TSHZ3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;TTF1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;TWIST1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;TWIST2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;UBP1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;UNCX&quot;</span><span class="p">,</span>
    <span class="s2">&quot;USF1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;USF2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;USF3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;VAX1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;VAX2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;VDR&quot;</span><span class="p">,</span>
    <span class="s2">&quot;VENTX&quot;</span><span class="p">,</span>
    <span class="s2">&quot;VEZF1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;VSX1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;VSX2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;WIZ&quot;</span><span class="p">,</span>
    <span class="s2">&quot;WT1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;XBP1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;XPA&quot;</span><span class="p">,</span>
    <span class="s2">&quot;YBX1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;YBX2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;YBX3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;YY1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;YY2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZBED1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZBED2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZBED3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZBED4&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZBED5&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZBED6&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZBED9&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZBTB1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZBTB10&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZBTB11&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZBTB12&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZBTB14&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZBTB16&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZBTB17&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZBTB18&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZBTB2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZBTB20&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZBTB21&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZBTB22&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZBTB24&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZBTB25&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZBTB26&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZBTB3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZBTB32&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZBTB33&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZBTB34&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZBTB37&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZBTB38&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZBTB39&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZBTB4&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZBTB40&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZBTB41&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZBTB42&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZBTB43&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZBTB44&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZBTB45&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZBTB46&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZBTB47&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZBTB48&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZBTB49&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZBTB5&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZBTB6&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZBTB7A&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZBTB7B&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZBTB7C&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZBTB8A&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZBTB8B&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZBTB9&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZC3H8&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZEB1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZEB2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZFAT&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZFHX2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZFHX3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZFHX4&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZFP1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZFP14&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZFP2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZFP28&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZFP3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZFP30&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZFP37&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZFP41&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZFP42&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZFP57&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZFP62&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZFP64&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZFP69&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZFP69B&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZFP82&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZFP90&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZFP91&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZFP92&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZFPM1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZFPM2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZFX&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZFY&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZGLP1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZGPAT&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZHX1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZHX2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZHX3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZIC1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZIC2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZIC3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZIC4&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZIC5&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZIK1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZIM2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZIM3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZKSCAN1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZKSCAN2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZKSCAN3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZKSCAN4&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZKSCAN5&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZKSCAN7&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZKSCAN8&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZMAT1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZMAT4&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF10&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF100&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF101&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF107&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF112&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF114&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF117&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF12&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF121&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF124&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF131&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF132&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF133&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF134&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF135&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF136&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF138&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF14&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF140&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF141&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF142&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF143&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF146&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF148&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF154&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF155&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF157&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF16&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF160&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF165&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF169&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF17&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF174&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF175&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF177&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF18&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF180&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF181&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF182&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF184&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF189&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF19&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF195&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF197&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF20&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF200&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF202&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF205&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF207&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF208&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF211&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF212&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF213&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF214&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF215&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF217&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF219&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF22&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF221&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF222&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF223&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF224&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF225&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF226&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF227&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF229&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF23&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF230&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF232&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF233&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF234&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF235&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF236&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF239&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF24&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF248&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF25&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF250&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF251&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF253&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF254&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF256&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF257&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF26&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF260&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF263&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF264&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF266&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF267&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF268&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF273&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF274&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF275&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF276&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF277&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF28&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF280A&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF280B&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF280C&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF280D&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF281&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF282&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF283&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF284&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF285&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF286A&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF286B&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF287&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF292&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF296&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF30&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF300&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF302&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF304&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF311&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF316&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF317&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF318&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF319&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF32&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF320&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF322&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF324&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF324B&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF326&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF329&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF331&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF333&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF334&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF335&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF337&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF33A&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF33B&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF34&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF341&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF343&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF345&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF346&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF347&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF35&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF350&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF354A&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF354B&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF354C&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF358&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF362&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF365&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF366&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF367&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF37A&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF382&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF383&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF384&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF385A&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF385B&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF385C&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF385D&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF391&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF394&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF395&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF396&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF397&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF398&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF404&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF407&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF408&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF41&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF410&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF414&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF415&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF416&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF417&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF418&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF419&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF420&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF423&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF425&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF426&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF428&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF429&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF43&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF430&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF431&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF432&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF433&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF436&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF438&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF439&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF44&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF440&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF441&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF442&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF443&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF444&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF445&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF446&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF449&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF45&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF451&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF454&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF460&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF461&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF462&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF467&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF468&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF469&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF470&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF471&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF473&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF474&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF479&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF48&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF480&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF483&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF484&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF485&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF486&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF487&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF488&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF490&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF491&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF492&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF493&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF496&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF497&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF500&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF501&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF502&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF503&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF506&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF507&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF510&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF511&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF512&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF512B&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF513&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF514&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF516&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF517&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF518A&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF518B&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF519&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF521&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF524&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF525&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF526&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF527&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF528&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF529&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF530&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF532&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF534&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF536&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF540&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF541&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF543&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF544&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF546&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF547&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF548&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF549&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF550&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF551&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF552&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF554&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF555&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF556&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF557&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF558&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF559&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF560&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF561&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF562&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF563&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF564&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF565&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF566&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF567&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF568&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF569&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF57&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF570&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF571&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF572&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF573&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF574&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF575&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF576&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF577&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF578&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF579&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF580&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF581&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF582&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF583&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF584&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF585A&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF585B&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF586&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF587&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF587B&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF589&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF592&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF594&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF595&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF596&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF597&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF598&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF599&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF600&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF605&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF606&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF607&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF608&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF609&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF610&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF611&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF613&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF614&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF615&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF616&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF618&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF619&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF620&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF621&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF623&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF624&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF625&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF626&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF627&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF628&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF629&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF630&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF639&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF641&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF644&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF645&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF646&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF648&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF649&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF652&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF653&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF654&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF655&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF658&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF66&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF660&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF662&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF664&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF665&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF667&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF668&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF669&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF670&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF671&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF672&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF674&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF675&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF676&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF677&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF678&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF679&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF680&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF681&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF682&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF683&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF684&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF687&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF688&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF689&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF69&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF691&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF692&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF695&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF696&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF697&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF699&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF7&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF70&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF700&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF701&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF703&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF704&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF705A&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF705B&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF705D&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF705E&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF705G&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF706&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF707&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF708&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF709&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF71&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF710&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF711&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF713&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF714&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF716&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF717&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF718&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF721&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF724&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF726&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF727&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF728&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF729&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF730&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF732&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF735&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF736&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF737&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF74&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF740&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF746&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF747&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF749&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF750&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF75A&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF75D&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF76&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF761&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF763&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF764&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF765&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF766&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF768&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF77&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF770&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF771&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF772&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF773&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF774&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF775&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF776&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF777&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF778&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF780A&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF780B&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF781&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF782&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF783&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF784&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF785&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF786&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF787&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF788&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF789&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF79&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF790&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF791&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF792&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF793&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF799&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF8&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF80&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF800&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF804A&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF804B&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF805&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF808&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF81&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF813&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF814&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF816&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF821&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF823&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF827&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF829&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF83&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF830&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF831&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF835&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF836&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF837&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF84&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF841&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF843&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF844&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF845&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF846&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF85&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF850&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF852&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF853&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF860&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF865&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF878&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF879&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF880&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF883&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF888&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF891&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF90&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF91&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF92&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF93&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF98&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZNF99&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZSCAN1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZSCAN10&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZSCAN12&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZSCAN16&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZSCAN18&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZSCAN2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZSCAN20&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZSCAN21&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZSCAN22&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZSCAN23&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZSCAN25&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZSCAN26&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZSCAN29&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZSCAN30&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZSCAN31&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZSCAN32&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZSCAN4&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZSCAN5A&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZSCAN5B&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZSCAN5C&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZSCAN9&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZUFSP&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZXDA&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZXDB&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZXDC&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZZZ3&quot;</span><span class="p">,</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">pd</span><span class="o">.</span><span class="n">ExcelWriter</span><span class="p">(</span><span class="s1">&#39;./tables/marker_TF.xls&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">marker_excel</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">cell_subtypes</span><span class="p">,</span><span class="n">subtype_sheet_names</span><span class="p">):</span>
        <span class="n">subtype_marker</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">get</span><span class="o">.</span><span class="n">rank_genes_groups_df</span><span class="p">(</span><span class="n">adata_nogex</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="n">i</span><span class="p">)</span>
        <span class="n">subtype_marker</span> <span class="o">=</span> <span class="n">subtype_marker</span><span class="p">[</span><span class="n">subtype_marker</span><span class="p">[</span><span class="s1">&#39;names&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">TFlist</span><span class="p">)]</span>
        <span class="n">subtype_marker</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">marker_excel</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="n">j</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sample_info</span> <span class="o">=</span> <span class="n">adata_nogex</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="s1">&#39;sample_name&#39;</span><span class="p">)</span>
<span class="n">sample_info</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">sample_info</span><span class="p">[</span><span class="s1">&#39;sample_name&#39;</span><span class="p">]</span>
<span class="n">sample_info</span><span class="p">[</span><span class="s1">&#39;cell_num&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="n">adata_nogex</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;sample_name&#39;</span><span class="p">])</span>
<span class="n">sample_info</span> <span class="o">=</span> <span class="n">sample_info</span><span class="p">[[</span><span class="s1">&#39;study_name&#39;</span><span class="p">,</span><span class="s1">&#39;individual_id&#39;</span><span class="p">,</span> 
                           <span class="s1">&#39;tissue_type&#39;</span><span class="p">,</span> <span class="s1">&#39;meta_tissue_type&#39;</span><span class="p">,</span><span class="s1">&#39;meta_tissue_type_aggr&#39;</span><span class="p">,</span>
                           <span class="s1">&#39;cell_type&#39;</span><span class="p">,</span><span class="s1">&#39;main_origin&#39;</span><span class="p">,</span>
                           <span class="s1">&#39;disease&#39;</span><span class="p">,</span> <span class="s1">&#39;disease_type&#39;</span><span class="p">,</span> 
                           <span class="s1">&#39;treatment&#39;</span><span class="p">,</span> <span class="s1">&#39;treatment_type&#39;</span><span class="p">,</span> <span class="s1">&#39;response_type&#39;</span><span class="p">,</span><span class="s1">&#39;cell_num&#39;</span><span class="p">]]</span>
<span class="n">sample_info</span> <span class="o">=</span> <span class="n">sample_info</span><span class="o">.</span><span class="n">sort_values</span><span class="p">([</span><span class="s1">&#39;study_name&#39;</span><span class="p">,</span> <span class="s1">&#39;sample_name&#39;</span><span class="p">,</span> <span class="s1">&#39;meta_tissue_type_aggr&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sample_info</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="s1">&#39;./tables/sample_info.xls&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="supfigure1">
<h3>SupFigure1<a class="headerlink" href="#supfigure1" title="Permalink to this headline">Â¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Supfigure1A</span>
<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
<span class="n">sc</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">umap</span><span class="p">(</span><span class="n">adata_nogex</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;study_name&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;./figures/study_name.png&quot;</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/GEXCD8_65_0.png" src="_images/GEXCD8_65_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Supfigure1B</span>
<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
<span class="n">sc</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">umap</span><span class="p">(</span><span class="n">adata_nogex</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;meta_tissue_type&quot;</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="n">tissue_type_color</span><span class="p">,</span>
           <span class="n">size</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;./figures/meta_tissue_type.png&quot;</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/GEXCD8_66_0.png" src="_images/GEXCD8_66_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Supfigure1B, pie chart</span>
<span class="n">tissue_subpercent</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">meta_tissue_type_aggrs</span><span class="p">:</span>
    <span class="n">cell_num</span> <span class="o">=</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">adata_nogex</span><span class="o">.</span><span class="n">obs</span><span class="p">[(</span><span class="n">adata_nogex</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;meta_tissue_type_aggr&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">j</span><span class="p">)</span> <span class="o">&amp;</span> 
                                    <span class="p">(</span><span class="n">adata_nogex</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;meta_tissue_type&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">i</span><span class="p">)])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">meta_tissue_types</span><span class="p">]</span>
    <span class="n">tissue_subpercent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cell_num</span><span class="p">)</span>
<span class="n">tissue_subpercent</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tissue_subpercent</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
<span class="n">color_map</span> <span class="o">=</span> <span class="n">meta_tissue_type_color</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
<span class="n">inner_color_map</span> <span class="o">=</span> <span class="n">tissue_type_color</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>

<span class="n">ax</span><span class="o">.</span><span class="n">pie</span><span class="p">(</span><span class="n">tissue_subpercent</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="n">radius</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="n">color_map</span><span class="p">,</span> 
       <span class="n">autopct</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%1.0f%%</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">pctdistance</span><span class="o">=</span><span class="mf">1.2</span><span class="p">,</span>
       <span class="n">wedgeprops</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mf">0.3</span><span class="p">))</span>

<span class="n">ax</span><span class="o">.</span><span class="n">pie</span><span class="p">(</span><span class="n">tissue_subpercent</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">radius</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="n">inner_color_map</span><span class="p">,</span>
       <span class="n">wedgeprops</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">))</span>

<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">meta_tissue_type_color</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="o">+</span><span class="nb">list</span><span class="p">(</span><span class="n">tissue_type_color</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span>
          <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Meta Tissue Types&quot;</span><span class="p">,</span>
          <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;center left&quot;</span><span class="p">,</span>
          <span class="n">fontsize</span><span class="o">=</span><span class="s2">&quot;small&quot;</span><span class="p">,</span>
          <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;./figures/tissue_subpercent.pdf&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/GEXCD8_67_0.png" src="_images/GEXCD8_67_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Supfigure1C</span>
<span class="n">main_tissue_types</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;Circulating&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Tissue&quot;</span><span class="p">,</span>
    <span class="s2">&quot;TIL&quot;</span>   
<span class="p">]</span>
<span class="n">tissue_subtype_hm</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([])</span>
<span class="n">tissue_subtype_hm</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">cell_subtypes</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">main_tissue_types</span><span class="p">:</span>
    <span class="n">condition_subtypes</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">Counter</span><span class="p">(</span><span class="n">adata_nogex</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span>
        <span class="n">adata_nogex</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;meta_tissue_type_aggr&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">i</span>
    <span class="p">]</span><span class="o">.</span><span class="n">cell_subtype</span><span class="p">))</span>
    <span class="n">tissue_subtype_hm</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">tissue_subtype_hm</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">condition_subtypes</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">tissue_subtype_hm</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">tissue_subtype_hm</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tissue_subtype_hm</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
    <span class="n">tissue_subtype_hm</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span> <span class="n">x</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="n">tissue_subtype_hm</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">tissue_subtype_hm</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">]</span>

<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">tissue_subtype_hm</span><span class="p">,</span> <span class="n">square</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;YlGnBu&quot;</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mf">0.35</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">(),</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/GEXCD8_68_0.png" src="_images/GEXCD8_68_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Supfigure1C</span>
<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
<span class="n">sc</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">umap</span><span class="p">(</span><span class="n">adata_nogex</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;disease_type&quot;</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="n">disease_type_color</span><span class="p">,</span>
           <span class="n">size</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;./figures/disease_type.png&quot;</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/GEXCD8_69_0.png" src="_images/GEXCD8_69_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Supfigure1D</span>
<span class="n">pie_plot</span><span class="p">(</span><span class="n">adata_nogex</span><span class="p">,</span> 
         <span class="n">items</span><span class="o">=</span><span class="n">disease_types</span><span class="p">,</span> <span class="n">item_str</span><span class="o">=</span><span class="s2">&quot;disease_type&quot;</span><span class="p">,</span> <span class="n">item_color</span><span class="o">=</span><span class="n">disease_type_color</span><span class="p">,</span> 
         <span class="n">file_name</span><span class="o">=</span><span class="s2">&quot;./figures/condition_percent.pdf&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/GEXCD8_70_0.png" src="_images/GEXCD8_70_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Supfigure1E,PBMC</span>
<span class="n">disease_types_mod</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;Healthy&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Inflammation&#39;</span><span class="p">,</span>
    <span class="s1">&#39;COVID-19&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Inflammation-irAE&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Solid tumor&#39;</span><span class="p">,</span>
    <span class="s1">&#39;AML&#39;</span><span class="p">,</span>
    <span class="s1">&#39;T-LGLL&#39;</span>
<span class="p">]</span>
<span class="n">stacked_bar</span><span class="p">(</span><span class="n">adata</span><span class="o">=</span><span class="n">adata_circ</span><span class="p">,</span> <span class="n">percentage</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">xitems</span><span class="o">=</span><span class="n">disease_types_mod</span><span class="p">,</span> <span class="n">xitem_str</span><span class="o">=</span><span class="s2">&quot;disease_type&quot;</span><span class="p">,</span> 
            <span class="n">yitems</span><span class="o">=</span><span class="n">cell_subtype_aggrs</span><span class="p">,</span> <span class="n">yitem_str</span><span class="o">=</span><span class="s2">&quot;cell_subtype_aggr&quot;</span><span class="p">,</span> <span class="n">yitem_color</span><span class="o">=</span><span class="n">subtype_color</span><span class="p">,</span> 
            <span class="n">file_name</span><span class="o">=</span><span class="s2">&quot;./figures/disease2subtypes_circ.pdf&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/GEXCD8_71_0.png" src="_images/GEXCD8_71_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Supfigure1E,Tissue</span>
<span class="n">adata_tissue_TIL</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">loc</span><span class="p">[((</span><span class="n">adata_tissue_TIL</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;disease_type&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Solid tumor&#39;</span><span class="p">)</span> <span class="o">&amp;</span> 
                         <span class="p">(</span><span class="n">adata_tissue_TIL</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;meta_tissue_type&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Normal_Tissue&#39;</span><span class="p">)</span>
                         <span class="p">),</span> <span class="s1">&#39;cell_subtype_aggr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># exclude the jaxta-tissue of tumor</span>
<span class="n">stacked_bar</span><span class="p">(</span><span class="n">adata</span><span class="o">=</span><span class="n">adata_tissue_TIL</span><span class="p">,</span> <span class="n">percentage</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">xitems</span><span class="o">=</span><span class="n">disease_types_mod</span><span class="p">,</span> <span class="n">xitem_str</span><span class="o">=</span><span class="s2">&quot;disease_type&quot;</span><span class="p">,</span> 
            <span class="n">yitems</span><span class="o">=</span><span class="n">cell_subtype_aggrs</span><span class="p">,</span> <span class="n">yitem_str</span><span class="o">=</span><span class="s2">&quot;cell_subtype_aggr&quot;</span><span class="p">,</span> <span class="n">yitem_color</span><span class="o">=</span><span class="n">subtype_color</span><span class="p">,</span> 
            <span class="n">file_name</span><span class="o">=</span><span class="s2">&quot;./figures/disease2subtypes_tissue.pdf&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/GEXCD8_72_0.png" src="_images/GEXCD8_72_0.png" />
</div>
</div>
</div>
<div class="section" id="supfigure2">
<h3>SupFigure2<a class="headerlink" href="#supfigure2" title="Permalink to this headline">Â¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Supfigure2A</span>
<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
<span class="n">sc</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">umap</span><span class="p">(</span><span class="n">adata_nogex</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;main_origin&quot;</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;#219ebc&#39;</span><span class="p">,</span><span class="s1">&#39;#832C20&#39;</span><span class="p">],</span>
           <span class="n">size</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;./figures/main_origin.png&quot;</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/GEXCD8_74_0.png" src="_images/GEXCD8_74_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Supfigure2B</span>
<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
<span class="n">sc</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">umap</span><span class="p">(</span><span class="n">adata_nogex</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;CX3CR1&quot;</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;Reds&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;./figures/temra_cx3cr1.png&quot;</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/GEXCD8_75_0.png" src="_images/GEXCD8_75_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Supfigure2C</span>
<span class="n">adata_emra</span> <span class="o">=</span> <span class="n">adata_nogex</span><span class="p">[</span><span class="n">adata_nogex</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;cell_subtype&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s2">&quot;Temra&quot;</span><span class="p">)]</span>
<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">sc</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">dotplot</span><span class="p">(</span><span class="n">adata_emra</span><span class="p">,</span> <span class="n">var_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;CX3CR1&quot;</span><span class="p">,</span> <span class="s2">&quot;KLRG1&quot;</span><span class="p">,</span> <span class="s2">&quot;IFITM3&quot;</span><span class="p">,</span> <span class="s2">&quot;IL7R&quot;</span><span class="p">],</span> <span class="n">groupby</span><span class="o">=</span><span class="s2">&quot;cell_subtype&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;./figures/temra_markers_dotplot.pdf&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/GEXCD8_76_0.png" src="_images/GEXCD8_76_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Supfigure2C</span>
<span class="n">sc</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">violin</span><span class="p">(</span><span class="n">adata_emra</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;CX3CR1&quot;</span><span class="p">,</span><span class="s2">&quot;KLRG1&quot;</span><span class="p">,</span> <span class="s2">&quot;IFITM3&quot;</span><span class="p">],</span> <span class="n">stripplot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
             <span class="n">groupby</span><span class="o">=</span><span class="s2">&quot;cell_subtype&quot;</span><span class="p">,)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;./figures/FigureS2KLRG1.pdf&quot;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/GEXCD8_77_0.png" src="_images/GEXCD8_77_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Supfigure2D</span>
<span class="n">sc</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">umap</span><span class="p">(</span><span class="n">adata_nogex</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;TYROBP&quot;</span><span class="p">,</span> <span class="s2">&quot;FCER1G&quot;</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;Reds&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;./figures/iltck_markers.png&quot;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Figure size 960x720 with 0 Axes&gt;
</pre></div>
</div>
<img alt="_images/GEXCD8_78_1.png" src="_images/GEXCD8_78_1.png" />
</div>
</div>
</div>
<div class="section" id="supfigure3">
<h3>SupFigure3<a class="headerlink" href="#supfigure3" title="Permalink to this headline">Â¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># SupFigureS4A</span>
<span class="n">ir</span><span class="o">.</span><span class="n">tl</span><span class="o">.</span><span class="n">alpha_diversity</span><span class="p">(</span><span class="n">adata_nogex</span><span class="p">,</span> <span class="n">groupby</span><span class="o">=</span><span class="s1">&#39;cell_subtype&#39;</span><span class="p">,</span> <span class="n">target_col</span><span class="o">=</span><span class="s1">&#39;cc_aa_identity&#39;</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="s1">&#39;D50&#39;</span><span class="p">)</span>
<span class="n">adata_nogex</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s2">&quot;D50_cc_aa_identity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">adata_nogex</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s2">&quot;D50_cc_aa_identity&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>

<span class="n">D50_subtypes</span> <span class="o">=</span> <span class="n">adata_nogex</span><span class="o">.</span><span class="n">obs</span><span class="p">[[</span><span class="s1">&#39;cell_subtype&#39;</span><span class="p">,</span><span class="s1">&#39;D50_cc_aa_identity&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="s1">&#39;cell_subtype&#39;</span><span class="p">)</span>
<span class="n">D50_subtypes</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">D50_subtypes</span><span class="p">[</span><span class="s1">&#39;cell_subtype&#39;</span><span class="p">]</span>
<span class="n">D50_subtypes</span> <span class="o">=</span> <span class="n">D50_subtypes</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">cell_subtypes</span><span class="p">)</span>
<span class="n">D50_subtypes</span><span class="p">[</span><span class="s1">&#39;colors&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">subtype_color</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>

<span class="n">general_bar</span><span class="p">(</span><span class="n">D50_subtypes</span><span class="p">,</span> <span class="n">target_col</span><span class="o">=</span><span class="s1">&#39;D50_cc_aa_identity&#39;</span><span class="p">,</span> <span class="n">ylim0</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ylim1</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> 
            <span class="n">file_name</span><span class="o">=</span><span class="s1">&#39;figures/d50_subtype.pdf&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Figure size 960x720 with 0 Axes&gt;
</pre></div>
</div>
<img alt="_images/GEXCD8_80_1.png" src="_images/GEXCD8_80_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># SupFigureS4B</span>
<span class="n">clone_group</span><span class="o">=</span><span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">cell_subtypes</span><span class="p">:</span>
    <span class="n">subgroup_sample</span> <span class="o">=</span> <span class="n">adata_nogex</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="n">adata_nogex</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;cell_subtype&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">i</span><span class="p">]</span>
    <span class="n">clone_sample</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">Counter</span><span class="p">(</span><span class="n">subgroup_sample</span><span class="o">.</span><span class="n">cc_aa_identity</span><span class="p">))</span>
    <span class="n">G</span> <span class="o">=</span> <span class="n">gini</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">clone_sample</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
    <span class="n">clone_group</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>
<span class="n">clone_gini_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">clone_group</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">cell_subtypes</span><span class="p">)</span>
<span class="n">clone_gini_df</span><span class="p">[</span><span class="s1">&#39;colors&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">subtype_color</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
<span class="n">general_bar</span><span class="p">(</span><span class="n">clone_gini_df</span><span class="p">,</span> <span class="n">target_col</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ylim0</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ylim1</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> 
            <span class="n">file_name</span><span class="o">=</span><span class="s1">&#39;figures/gini_subtype.pdf&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/GEXCD8_81_0.png" src="_images/GEXCD8_81_0.png" />
<img alt="_images/GEXCD8_81_1.png" src="_images/GEXCD8_81_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># SupFigureS4C</span>
<span class="n">gini_disease</span> <span class="o">=</span> <span class="n">cbind_df</span><span class="p">(</span><span class="n">adata_circ_nokid</span><span class="p">,</span> <span class="n">adata_tissue_TIL_nokid</span><span class="p">,</span> 
                        <span class="n">xaxis</span><span class="o">=</span><span class="n">disease_types</span><span class="p">,</span> <span class="n">xaxis_label</span><span class="o">=</span><span class="s1">&#39;disease_type&#39;</span><span class="p">,</span> <span class="n">index_type</span><span class="o">=</span><span class="s1">&#39;gini&#39;</span><span class="p">)</span>
<span class="n">multi_boxplot</span><span class="p">(</span><span class="n">gini_disease</span><span class="p">,</span> <span class="n">xaxis</span><span class="o">=</span><span class="s1">&#39;origin&#39;</span><span class="p">,</span> <span class="n">hueaxis</span><span class="o">=</span><span class="s1">&#39;variable&#39;</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="s1">&#39;figures/gini_disease.pdf&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/GEXCD8_82_0.png" src="_images/GEXCD8_82_0.png" />
<img alt="_images/GEXCD8_82_1.png" src="_images/GEXCD8_82_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gini_disease_tissue</span> <span class="o">=</span> <span class="n">gini_disease</span><span class="p">[</span><span class="n">gini_disease</span><span class="p">[</span><span class="s1">&#39;origin&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Tissue&#39;</span><span class="p">]</span>
<span class="n">gini_disease_circulating</span> <span class="o">=</span> <span class="n">gini_disease</span><span class="p">[</span><span class="n">gini_disease</span><span class="p">[</span><span class="s1">&#39;origin&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Circulating&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stats</span><span class="o">.</span><span class="n">mannwhitneyu</span><span class="p">(</span><span class="n">gini_disease_tissue</span><span class="p">[</span><span class="n">gini_disease_tissue</span><span class="p">[</span><span class="s1">&#39;variable&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Healthy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                   <span class="n">gini_disease_tissue</span><span class="p">[</span><span class="n">gini_disease_tissue</span><span class="p">[</span><span class="s1">&#39;variable&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Solid tumor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>MannwhitneyuResult(statistic=339.0, pvalue=6.937773255678891e-05)
</pre></div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="tex2jax_ignore mathjax_ignore section" id="part2twotypetexincancer">
<h1>Part2TwoTypeTexInCancer<a class="headerlink" href="#part2twotypetexincancer" title="Permalink to this headline">Â¶</a></h1>
<div class="section" id="id1">
<h2>Functions<a class="headerlink" href="#id1" title="Permalink to this headline">Â¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># blacklist genes which may be affected by dissociation</span>
<span class="n">blacklist</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;ACTG1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;BTG1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;CXCL1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;DNAJB4&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ERRFI1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;H3F3B&quot;</span><span class="p">,</span>
    <span class="s2">&quot;HSPB1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;IRF1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;KLF6&quot;</span><span class="p">,</span>
    <span class="s2">&quot;MIR22HG&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NFKBIA&quot;</span><span class="p">,</span>
    <span class="s2">&quot;PCF11&quot;</span><span class="p">,</span>
    <span class="s2">&quot;PXDC1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SDC4&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SRF&quot;</span><span class="p">,</span>
    <span class="s2">&quot;TPM3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;USP2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;GADD45G&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ANKRD1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;BTG2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;CYR61&quot;</span><span class="p">,</span>
    <span class="s2">&quot;DUSP1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;FAM132B&quot;</span><span class="p">,</span>
    <span class="s2">&quot;HIPK3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;HSPH1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;IRF8&quot;</span><span class="p">,</span>
    <span class="s2">&quot;KLF9&quot;</span><span class="p">,</span>
    <span class="s2">&quot;MT1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NFKBIZ&quot;</span><span class="p">,</span>
    <span class="s2">&quot;PDE4B&quot;</span><span class="p">,</span>
    <span class="s2">&quot;RAP1B&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SERPINE1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SRSF5&quot;</span><span class="p">,</span>
    <span class="s2">&quot;TPPP3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;WAC&quot;</span><span class="p">,</span>
    <span class="s2">&quot;HSPE1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ARID5A&quot;</span><span class="p">,</span>
    <span class="s2">&quot;CCNL1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;DCN&quot;</span><span class="p">,</span>
    <span class="s2">&quot;DUSP8&quot;</span><span class="p">,</span>
    <span class="s2">&quot;FOS&quot;</span><span class="p">,</span>
    <span class="s2">&quot;HSP90AA1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ID3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ITPKC&quot;</span><span class="p">,</span>
    <span class="s2">&quot;LITAF&quot;</span><span class="p">,</span>
    <span class="s2">&quot;MT2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NOP58&quot;</span><span class="p">,</span>
    <span class="s2">&quot;PER1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;RASSF1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SKIL&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SRSF7&quot;</span><span class="p">,</span>
    <span class="s2">&quot;TRA2A&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZC3H12A&quot;</span><span class="p">,</span>
    <span class="s2">&quot;IER5&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ATF3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;CCRN4L&quot;</span><span class="p">,</span>
    <span class="s2">&quot;DDX3X&quot;</span><span class="p">,</span>
    <span class="s2">&quot;EGR1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;FOSB&quot;</span><span class="p">,</span>
    <span class="s2">&quot;HSP90AB1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;IDI1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;JUN&quot;</span><span class="p">,</span>
    <span class="s2">&quot;LMNA&quot;</span><span class="p">,</span>
    <span class="s2">&quot;MYADM&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NPPC&quot;</span><span class="p">,</span>
    <span class="s2">&quot;PHLDA1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;RHOB&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SLC10A6&quot;</span><span class="p">,</span>
    <span class="s2">&quot;STAT3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;TRA2B&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZFAND5&quot;</span><span class="p">,</span>
    <span class="s2">&quot;KCNE4&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ATF4&quot;</span><span class="p">,</span>
    <span class="s2">&quot;CEBPB&quot;</span><span class="p">,</span>
    <span class="s2">&quot;DDX5&quot;</span><span class="p">,</span>
    <span class="s2">&quot;EGR2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;FOSL2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;HSPA1A&quot;</span><span class="p">,</span>
    <span class="s2">&quot;IER2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;JUNB&quot;</span><span class="p">,</span>
    <span class="s2">&quot;MAFF&quot;</span><span class="p">,</span>
    <span class="s2">&quot;MYC&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NR4A1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;PNP&quot;</span><span class="p">,</span>
    <span class="s2">&quot;RHOH&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SLC38A2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;TAGLN2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;TRIB1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZFP36&quot;</span><span class="p">,</span>
    <span class="s2">&quot;BAG3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;CEBPD&quot;</span><span class="p">,</span>
    <span class="s2">&quot;DES&quot;</span><span class="p">,</span>
    <span class="s2">&quot;EIF1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;GADD45A&quot;</span><span class="p">,</span>
    <span class="s2">&quot;HSPA1B&quot;</span><span class="p">,</span>
    <span class="s2">&quot;IER3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;JUND&quot;</span><span class="p">,</span>
    <span class="s2">&quot;MAFK&quot;</span><span class="p">,</span>
    <span class="s2">&quot;MYD88&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ODC1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;PNRC1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;RIPK1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SLC41A1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;TIPARP&quot;</span><span class="p">,</span>
    <span class="s2">&quot;TUBB4B&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZFP36L1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;BHLHE40&quot;</span><span class="p">,</span>
    <span class="s2">&quot;CEBPG&quot;</span><span class="p">,</span>
    <span class="s2">&quot;DNAJA1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;EIF5&quot;</span><span class="p">,</span>
    <span class="s2">&quot;GCC1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;HSPA5&quot;</span><span class="p">,</span>
    <span class="s2">&quot;IFRD1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;KLF2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;MCL1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NCKAP5L&quot;</span><span class="p">,</span>
    <span class="s2">&quot;OSGIN1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;PPP1CC&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SAT1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SOCS3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;TNFAIP3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;TUBB6&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZFP36L2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;BRD2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;CSRNP1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;DNAJB1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ERF&quot;</span><span class="p">,</span>
    <span class="s2">&quot;GEM&quot;</span><span class="p">,</span>
    <span class="s2">&quot;HSPA8&quot;</span><span class="p">,</span>
    <span class="s2">&quot;IL6&quot;</span><span class="p">,</span>
    <span class="s2">&quot;KLF4&quot;</span><span class="p">,</span>
    <span class="s2">&quot;MIDN&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NCOA7&quot;</span><span class="p">,</span>
    <span class="s2">&quot;OXNAD1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;PPP1R15A&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SBNO2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SQSTM1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;TNFAIP6&quot;</span><span class="p">,</span>
    <span class="s2">&quot;UBC&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ZYX&quot;</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id2">
<h3>StatsFunctions<a class="headerlink" href="#id2" title="Permalink to this headline">Â¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">DEG_analysis</span><span class="p">(</span><span class="n">adata</span><span class="p">,</span> <span class="n">groupby</span><span class="p">,</span> <span class="n">query_subtype</span><span class="p">,</span> <span class="n">reference_subtype</span><span class="p">):</span>
    <span class="c1"># stats</span>
    <span class="n">sc</span><span class="o">.</span><span class="n">tl</span><span class="o">.</span><span class="n">rank_genes_groups</span><span class="p">(</span><span class="n">adata</span><span class="p">,</span> <span class="n">groupby</span><span class="o">=</span><span class="n">groupby</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;t-test&quot;</span><span class="p">,</span> <span class="n">key_added</span><span class="o">=</span><span class="s1">&#39;rank_genes_test&#39;</span><span class="p">,</span>
                            <span class="n">groups</span><span class="o">=</span><span class="p">[</span><span class="n">query_subtype</span><span class="p">],</span> <span class="n">reference</span><span class="o">=</span><span class="n">reference_subtype</span><span class="p">)</span>
    <span class="n">diff_exp_genes</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span>
        <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">adata</span><span class="o">.</span><span class="n">uns</span><span class="p">[</span><span class="s2">&quot;rank_genes_test&quot;</span><span class="p">][</span><span class="s2">&quot;names&quot;</span><span class="p">]))),</span>
        <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">adata</span><span class="o">.</span><span class="n">uns</span><span class="p">[</span><span class="s2">&quot;rank_genes_test&quot;</span><span class="p">][</span><span class="s1">&#39;logfoldchanges&#39;</span><span class="p">]))),</span>
        <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">adata</span><span class="o">.</span><span class="n">uns</span><span class="p">[</span><span class="s2">&quot;rank_genes_test&quot;</span><span class="p">][</span><span class="s1">&#39;pvals_adj&#39;</span><span class="p">])))</span>
    <span class="p">]),</span>
            <span class="n">columns</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
    <span class="p">)</span>
    
    <span class="n">diff_exp_genes_up</span> <span class="o">=</span> <span class="n">diff_exp_genes</span><span class="p">[(</span><span class="o">~</span><span class="n">diff_exp_genes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">blacklist</span><span class="p">))</span> <span class="o">&amp;</span>
                                        <span class="p">(</span><span class="n">diff_exp_genes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span>
                                        <span class="p">(</span><span class="n">diff_exp_genes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float&#39;</span><span class="p">)</span><span class="o">&lt;=</span><span class="mf">0.01</span><span class="p">)]</span>
    <span class="n">diff_exp_genes_dw</span> <span class="o">=</span> <span class="n">diff_exp_genes</span><span class="p">[(</span><span class="o">~</span><span class="n">diff_exp_genes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">blacklist</span><span class="p">))</span> <span class="o">&amp;</span>
                                        <span class="p">(</span><span class="n">diff_exp_genes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float&#39;</span><span class="p">)</span><span class="o">&lt;=-</span><span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span>
                                        <span class="p">(</span><span class="n">diff_exp_genes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float&#39;</span><span class="p">)</span><span class="o">&lt;=</span><span class="mf">0.01</span><span class="p">)]</span>
    
    <span class="n">enr_res_up</span> <span class="o">=</span> <span class="n">gseapy</span><span class="o">.</span><span class="n">enrichr</span><span class="p">(</span><span class="n">gene_list</span><span class="o">=</span><span class="n">diff_exp_genes_up</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                <span class="n">organism</span><span class="o">=</span><span class="s1">&#39;Human&#39;</span><span class="p">,</span>
                                <span class="n">gene_sets</span><span class="o">=</span><span class="s1">&#39;GO_Biological_Process_2021&#39;</span><span class="p">)</span>
    <span class="n">enr_res_dw</span> <span class="o">=</span> <span class="n">gseapy</span><span class="o">.</span><span class="n">enrichr</span><span class="p">(</span><span class="n">gene_list</span><span class="o">=</span><span class="n">diff_exp_genes_dw</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                <span class="n">organism</span><span class="o">=</span><span class="s1">&#39;Human&#39;</span><span class="p">,</span>
                                <span class="n">gene_sets</span><span class="o">=</span><span class="s1">&#39;GO_Biological_Process_2021&#39;</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">diff_exp_genes</span><span class="p">,</span><span class="n">diff_exp_genes_up</span><span class="p">,</span><span class="n">diff_exp_genes_dw</span><span class="p">,</span><span class="n">enr_res_up</span><span class="p">,</span><span class="n">enr_res_dw</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">condition_cell_ratio</span><span class="p">(</span><span class="n">adata0</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">cell_type1</span><span class="p">,</span> <span class="n">cell_type2</span><span class="p">):</span>
    <span class="n">adata0</span> <span class="o">=</span> <span class="n">adata0</span><span class="p">[</span><span class="n">adata0</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;meta_tissue_type_aggr&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">source</span><span class="p">]</span>
    <span class="n">a1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">Counter</span><span class="p">(</span><span class="n">adata0</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="n">adata0</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s2">&quot;cell_subtype&quot;</span><span class="p">]</span><span class="o">==</span><span class="n">cell_type1</span><span class="p">]</span><span class="o">.</span><span class="n">sample_name</span><span class="p">))</span>
    <span class="n">b1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">Counter</span><span class="p">(</span><span class="n">adata0</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">sample_name</span><span class="p">))</span>
    <span class="n">x1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;ratio&quot;</span><span class="p">:</span><span class="n">a1</span><span class="o">/</span><span class="n">b1</span><span class="p">})</span>
    <span class="n">x1</span> <span class="o">=</span> <span class="n">x1</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="n">a2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">Counter</span><span class="p">(</span><span class="n">adata0</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="n">adata0</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s2">&quot;cell_subtype&quot;</span><span class="p">]</span><span class="o">==</span><span class="n">cell_type2</span><span class="p">]</span><span class="o">.</span><span class="n">sample_name</span><span class="p">))</span>
    <span class="n">b2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">Counter</span><span class="p">(</span><span class="n">adata0</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">sample_name</span><span class="p">))</span>
    <span class="n">x2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;ratio&quot;</span><span class="p">:</span><span class="n">a2</span><span class="o">/</span><span class="n">b2</span><span class="p">})</span>
    <span class="n">x2</span> <span class="o">=</span> <span class="n">x2</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">x3</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">x1</span><span class="p">,</span><span class="n">x2</span><span class="p">])</span>

    <span class="n">x3</span><span class="p">[</span><span class="s1">&#39;subtype&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
        <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">cell_type1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">x1</span><span class="p">)))</span> <span class="o">+</span> 
        <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">cell_type2</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">x2</span><span class="p">)))</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">x3</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">tissue_pie_data</span><span class="p">(</span><span class="n">adata_use</span><span class="o">=</span><span class="n">adata_nogex</span><span class="p">,</span> 
                    <span class="n">groupby</span><span class="o">=</span><span class="s1">&#39;disease_type&#39;</span><span class="p">,</span> <span class="n">groupby_type</span><span class="o">=</span><span class="s1">&#39;Healthy&#39;</span><span class="p">,</span> 
                    <span class="n">ratioby</span><span class="o">=</span><span class="s1">&#39;cell_subtype&#39;</span><span class="p">,</span> 
                    <span class="n">ratioby_type</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;ITGAE+ Trm&#39;</span><span class="p">,</span> <span class="s1">&#39;ITGB2+ Trm&#39;</span><span class="p">,</span> <span class="s1">&#39;GZMK+ Tex&#39;</span><span class="p">,</span> <span class="s1">&#39;CXCR6+ Tex&#39;</span><span class="p">],</span>
                    <span class="n">expanded</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>

    <span class="n">adata</span> <span class="o">=</span> <span class="n">adata_use</span><span class="p">[</span><span class="n">adata_use</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="n">groupby</span><span class="p">]</span><span class="o">==</span><span class="n">groupby_type</span><span class="p">]</span>
    
    <span class="k">if</span> <span class="n">expanded</span> <span class="o">==</span> <span class="s1">&#39;large&#39;</span><span class="p">:</span>
        <span class="n">adata_use</span> <span class="o">=</span> <span class="n">adata</span><span class="p">[</span>
            <span class="p">(</span><span class="n">adata</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;expansion_level&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;100&#39;</span><span class="p">))</span> <span class="o">|</span>
            <span class="p">(</span><span class="n">adata</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;expansion_level&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;50&#39;</span><span class="p">))</span>
        <span class="p">]</span>
    <span class="k">elif</span> <span class="n">expanded</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">adata_use</span> <span class="o">=</span> <span class="n">adata</span><span class="p">[</span>
            <span class="n">adata</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;cc_aa_identity_size&#39;</span><span class="p">]</span><span class="o">&gt;=</span><span class="mi">3</span>
        <span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">adata_use</span> <span class="o">=</span> <span class="n">adata</span>
        
    <span class="n">pie_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ratioby_type</span><span class="p">:</span>
        <span class="n">TNum</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">Counter</span><span class="p">(</span><span class="n">adata_use</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="n">ratioby</span><span class="p">]))</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">pie_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">TNum</span><span class="p">)</span>
        
    <span class="n">OtherNum</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">adata_use</span><span class="o">.</span><span class="n">obs</span><span class="p">)</span><span class="o">-</span><span class="nb">sum</span><span class="p">(</span><span class="n">pie_list</span><span class="p">)</span>
    <span class="n">pie_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">OtherNum</span><span class="p">)</span>
    
    <span class="n">ratio</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">adata_use</span><span class="o">.</span><span class="n">obs</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">adata</span><span class="o">.</span><span class="n">obs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">pie_list</span><span class="p">,</span> <span class="n">ratio</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="id3">
<h3>PlotsFunctions<a class="headerlink" href="#id3" title="Permalink to this headline">Â¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">volcanoPlot</span><span class="p">(</span><span class="n">diff_exp_genes</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="nb">str</span><span class="p">):</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
    <span class="n">diff_exp_genes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">diff_exp_genes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float&#39;</span><span class="p">)</span>
    <span class="n">result</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">diff_exp_genes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">diff_exp_genes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">diff_exp_genes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float&#39;</span><span class="p">)</span>
    <span class="n">result</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">diff_exp_genes</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>
    <span class="n">result</span><span class="o">.</span><span class="n">replace</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">],</span> <span class="mi">320</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>


    <span class="c1">#set threshold </span>
    <span class="n">x_threshold</span><span class="o">=</span><span class="mi">1</span>
    <span class="n">y_threshold</span><span class="o">=</span><span class="mi">2</span>

    <span class="c1">#groupby up, normal, down</span>
    <span class="n">result</span><span class="p">[</span><span class="s1">&#39;group&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span>
    <span class="n">result</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">result</span><span class="o">.</span><span class="n">x</span> <span class="o">&gt;</span> <span class="n">x_threshold</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">y</span> <span class="o">&gt;</span> <span class="n">y_threshold</span><span class="p">),</span><span class="s1">&#39;group&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;tab:red&#39;</span> <span class="c1">#x=-+x_thresholdç´æ¥æªæ­</span>
    <span class="n">result</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">result</span><span class="o">.</span><span class="n">x</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">x_threshold</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">y</span> <span class="o">&gt;</span> <span class="n">y_threshold</span><span class="p">),</span><span class="s1">&#39;group&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;tab:blue&#39;</span> <span class="c1">#x=-+x_thresholdç´æ¥æªæ­</span>
    <span class="n">result</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">result</span><span class="o">.</span><span class="n">y</span> <span class="o">&lt;</span> <span class="n">y_threshold</span><span class="p">,</span><span class="s1">&#39;group&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;dimgrey&#39;</span> <span class="c1">#éå¼ä»¥ä¸ç¹ä¸ºç°è²</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>

    <span class="c1"># xtick limit</span>
    <span class="n">xmin</span><span class="o">=-</span><span class="mi">8</span>
    <span class="n">xmax</span><span class="o">=</span><span class="mi">8</span>
    <span class="n">ymin</span><span class="o">=-</span><span class="mi">20</span>
    <span class="n">ymax</span><span class="o">=</span><span class="mi">340</span>

    <span class="c1"># scatter</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">7</span><span class="p">))</span> <span class="c1">#ç¡®å®figæ¯ä¾ï¼h/wï¼</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlim</span><span class="o">=</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">),</span> <span class="n">ylim</span><span class="o">=</span><span class="p">(</span><span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">),</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">],</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">],</span> <span class="n">s</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;group&#39;</span><span class="p">])</span>
    <span class="c1"># ax.set_ylabel(&#39;-Log10(Q value)&#39;,fontweight=&#39;bold&#39;)</span>
    <span class="c1"># ax.set_xlabel(&#39;Log2 (fold change)&#39;,fontweight=&#39;bold&#39;)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span> <span class="c1">#å»æå³è¾¹æ¡</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span> <span class="c1">#å»æä¸è¾¹æ¡</span>

    <span class="c1"># horizontal and vertical line</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="o">-</span><span class="n">x_threshold</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;dimgrey&#39;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="c1">#ç»ç«ç´çº¿</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="n">x_threshold</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;dimgrey&#39;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="c1">#ç»ç«ç´çº¿</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">hlines</span><span class="p">(</span><span class="n">y_threshold</span><span class="p">,</span> <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;dimgrey&#39;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="c1">#ç»ç«æ°´å¹³çº¿</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span><span class="n">xmax</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span><span class="c1">#è®¾ç½®xè½´å»åº¦èµ·ç¹åæ­¥é¿</span>
    <span class="c1"># ax.set_xticklabels(labels=ax.get_xticklabels(),rotation=45)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">ymin</span><span class="p">,</span><span class="n">ymax</span><span class="p">,</span><span class="mi">40</span><span class="p">))</span> <span class="c1">#è®¾ç½®yè½´å»åº¦èµ·ç¹åæ­¥é¿</span>
    
    <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># stats of clonotype sharing</span>
<span class="k">def</span> <span class="nf">circos_edges</span><span class="p">(</span><span class="n">clone_df</span><span class="p">,</span> <span class="n">subtypes</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">specific_subtype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                 <span class="n">first_index</span><span class="o">=</span><span class="s1">&#39;first&#39;</span><span class="p">,</span> <span class="n">second_index</span><span class="o">=</span><span class="s1">&#39;second&#39;</span><span class="p">):</span>

    <span class="n">edges</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([],</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;source&#39;</span><span class="p">,</span> <span class="s1">&#39;target&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">specific_subtype</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">subtypes</span><span class="p">:</span>
            <span class="n">clonei_qualified</span> <span class="o">=</span> <span class="n">clone_df</span><span class="p">[</span><span class="n">clone_df</span><span class="p">[</span><span class="n">first_index</span><span class="p">]</span><span class="o">==</span><span class="n">specific_subtype</span><span class="p">]</span>
            <span class="n">clonej_qualified</span> <span class="o">=</span> <span class="n">clonei_qualified</span><span class="p">[</span><span class="n">clonei_qualified</span><span class="p">[</span><span class="n">second_index</span><span class="p">]</span><span class="o">==</span><span class="n">i</span><span class="p">]</span>
            <span class="n">rows</span> <span class="o">=</span> <span class="p">[</span><span class="n">specific_subtype</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">clonej_qualified</span><span class="p">)]</span>
            <span class="n">edges</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">edges</span><span class="o">.</span><span class="n">index</span><span class="p">)]</span> <span class="o">=</span> <span class="n">rows</span>
    <span class="k">else</span><span class="p">:</span>        
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">subtypes</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">idx</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">subtypes</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">subtypes</span><span class="p">[</span><span class="n">idx</span><span class="o">+</span><span class="mi">1</span><span class="p">:]:</span>
                    <span class="n">clonei_qualified</span> <span class="o">=</span> <span class="n">clone_df</span><span class="p">[(</span><span class="n">clone_df</span><span class="p">[</span><span class="n">first_index</span><span class="p">]</span><span class="o">==</span><span class="n">i</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">clone_df</span><span class="p">[</span><span class="n">second_index</span><span class="p">]</span><span class="o">==</span><span class="n">i</span><span class="p">)]</span>
                    <span class="n">clonej_qualified</span> <span class="o">=</span> <span class="n">clonei_qualified</span><span class="p">[(</span><span class="n">clonei_qualified</span><span class="p">[</span><span class="n">first_index</span><span class="p">]</span><span class="o">==</span><span class="n">j</span><span class="p">)</span> <span class="o">|</span> 
                                                        <span class="p">(</span><span class="n">clonei_qualified</span><span class="p">[</span><span class="n">second_index</span><span class="p">]</span><span class="o">==</span><span class="n">j</span><span class="p">)]</span>
                    <span class="n">rows</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">clonej_qualified</span><span class="p">)]</span>
                    <span class="n">edges</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">edges</span><span class="o">.</span><span class="n">index</span><span class="p">)]</span> <span class="o">=</span> <span class="n">rows</span>
            <span class="k">else</span><span class="p">:</span> <span class="k">pass</span>
            
    <span class="n">edges</span> <span class="o">=</span> <span class="n">edges</span><span class="p">[</span><span class="n">edges</span><span class="o">.</span><span class="n">ne</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)]</span>
    <span class="n">edges</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">edges</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Figure2D, stats of circos plot</span>
<span class="k">def</span> <span class="nf">sanke_plot</span><span class="p">(</span><span class="n">circos_df</span><span class="p">,</span> <span class="n">column1</span><span class="p">,</span> <span class="n">column2</span><span class="p">,</span> <span class="n">file_name</span><span class="p">):</span>
    <span class="n">circos_df</span><span class="p">[</span><span class="s1">&#39;sg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">circos_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">circos_df</span><span class="p">[</span><span class="s1">&#39;source&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">column1</span><span class="p">,</span><span class="s1">&#39;sg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">circos_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">circos_df</span><span class="p">[</span><span class="s1">&#39;source&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">column2</span><span class="p">,</span><span class="s1">&#39;sg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">circos_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">circos_df</span><span class="p">[</span><span class="s1">&#39;sg&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">(),</span><span class="s1">&#39;sg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="n">circos_df</span><span class="p">[</span><span class="s1">&#39;tg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">circos_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">circos_df</span><span class="p">[</span><span class="s1">&#39;target&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">column1</span><span class="p">,</span><span class="s1">&#39;tg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">circos_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">circos_df</span><span class="p">[</span><span class="s1">&#39;target&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">column2</span><span class="p">,</span><span class="s1">&#39;tg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">circos_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">circos_df</span><span class="p">[</span><span class="s1">&#39;tg&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">(),</span><span class="s1">&#39;tg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    
    <span class="n">circos_df</span> <span class="o">=</span> <span class="n">circos_df</span><span class="p">[(</span><span class="n">circos_df</span><span class="p">[</span><span class="s1">&#39;sg&#39;</span><span class="p">]</span><span class="o">!=</span><span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">circos_df</span><span class="p">[</span><span class="s1">&#39;tg&#39;</span><span class="p">]</span><span class="o">!=</span><span class="mi">1</span><span class="p">)]</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">inter_value</span> <span class="o">=</span> <span class="n">circos_df</span><span class="p">[(</span><span class="n">circos_df</span><span class="p">[</span><span class="s1">&#39;sg&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">circos_df</span><span class="p">[</span><span class="s1">&#39;tg&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">2</span><span class="p">)]</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">inter_value</span> <span class="o">=</span> <span class="mi">0</span>
        
    <span class="n">circos_df</span> <span class="o">=</span> <span class="n">circos_df</span><span class="p">[(</span><span class="n">circos_df</span><span class="p">[</span><span class="s1">&#39;sg&#39;</span><span class="p">]</span><span class="o">!=</span><span class="mi">0</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">circos_df</span><span class="p">[</span><span class="s1">&#39;tg&#39;</span><span class="p">]</span><span class="o">!=</span><span class="mi">2</span><span class="p">)]</span>
    
    <span class="n">col1_num</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">circos_df</span><span class="p">[(</span><span class="n">circos_df</span><span class="p">[</span><span class="s1">&#39;source&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">column1</span><span class="p">)</span> <span class="o">|</span> 
                             <span class="p">(</span><span class="n">circos_df</span><span class="p">[</span><span class="s1">&#39;target&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">column1</span><span class="p">)]</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
    <span class="n">col2_num</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">circos_df</span><span class="p">[(</span><span class="n">circos_df</span><span class="p">[</span><span class="s1">&#39;source&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">column2</span><span class="p">)</span> <span class="o">|</span> 
                             <span class="p">(</span><span class="n">circos_df</span><span class="p">[</span><span class="s1">&#39;target&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">column2</span><span class="p">)]</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
    <span class="n">circos_df</span><span class="p">[</span><span class="s1">&#39;value_raw&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">circos_df</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span>
    <span class="n">circos_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">circos_df</span><span class="p">[</span><span class="s1">&#39;sg&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">circos_df</span><span class="p">[</span><span class="s1">&#39;tg&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">),</span> 
                      <span class="s1">&#39;value&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">circos_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">circos_df</span><span class="p">[</span><span class="s1">&#39;sg&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">circos_df</span><span class="p">[</span><span class="s1">&#39;tg&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">),</span> 
                                                   <span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">col1_num</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span>
    <span class="n">circos_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">circos_df</span><span class="p">[</span><span class="s1">&#39;sg&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">2</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">circos_df</span><span class="p">[</span><span class="s1">&#39;tg&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">2</span><span class="p">),</span> 
                      <span class="s1">&#39;value&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">circos_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">circos_df</span><span class="p">[</span><span class="s1">&#39;sg&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">2</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">circos_df</span><span class="p">[</span><span class="s1">&#39;tg&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">2</span><span class="p">),</span> 
                                                   <span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">col2_num</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span>
    <span class="n">circos_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>
    
    <span class="n">venn_df</span> <span class="o">=</span> <span class="p">[</span><span class="n">col1_num</span><span class="p">,</span> <span class="n">col2_num</span><span class="p">,</span> <span class="n">inter_value</span><span class="p">]</span>
    
    <span class="k">return</span> <span class="n">circos_df</span><span class="p">,</span><span class="n">venn_df</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="mainfigure2">
<h2>MainFigure2<a class="headerlink" href="#mainfigure2" title="Permalink to this headline">Â¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Figure2A Stats and Plots</span>
<span class="n">adata_nogex</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;Tex_umap&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">adata_nogex</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
    <span class="p">(</span>
        <span class="p">((</span><span class="n">adata_nogex</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;cell_subtype&#39;</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;GZMK+ Tex&quot;</span><span class="p">)</span> <span class="o">|</span>
        <span class="p">(</span><span class="n">adata_nogex</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;cell_subtype&#39;</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;CXCR6+ Tex&quot;</span><span class="p">))</span>
    <span class="p">),</span> <span class="s1">&#39;Tex_umap&#39;</span>
<span class="p">]</span> <span class="o">=</span> <span class="n">adata_nogex</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">disease_type</span>
<span class="n">adata_nogex</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;Tex_umap&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">adata_nogex</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;Tex_umap&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;category&#39;</span><span class="p">)</span>
<span class="n">adata_nogex</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;Tex_umap&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">adata_nogex</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;Tex_umap&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">reorder_categories</span><span class="p">(</span><span class="n">disease_types</span><span class="p">)</span>
<span class="c1"># Figure2A</span>
<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
<span class="n">sc</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">umap</span><span class="p">(</span><span class="n">adata_nogex</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;Tex_umap&#39;</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="n">disease_type_color</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> 
           <span class="n">na_color</span><span class="o">=</span><span class="s1">&#39;#f3f3f3&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;./figures/gzmk_cxcr6.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/GEXCD8_97_0.png" src="_images/GEXCD8_97_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gzmk_pie</span> <span class="o">=</span> <span class="n">tissue_pie_data</span><span class="p">(</span><span class="n">adata_use</span><span class="o">=</span><span class="n">adata_nogex</span><span class="p">,</span> 
    <span class="n">groupby</span><span class="o">=</span><span class="s1">&#39;cell_subtype&#39;</span><span class="p">,</span> <span class="n">groupby_type</span><span class="o">=</span><span class="s1">&#39;GZMK+ Tex&#39;</span><span class="p">,</span>
    <span class="n">ratioby</span><span class="o">=</span><span class="s1">&#39;disease_type&#39;</span><span class="p">,</span> <span class="n">ratioby_type</span><span class="o">=</span><span class="n">disease_types</span><span class="p">,</span>
    <span class="n">expanded</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">cxcr6_pie</span> <span class="o">=</span> <span class="n">tissue_pie_data</span><span class="p">(</span><span class="n">adata_use</span><span class="o">=</span><span class="n">adata_nogex</span><span class="p">,</span> 
    <span class="n">groupby</span><span class="o">=</span><span class="s1">&#39;cell_subtype&#39;</span><span class="p">,</span> <span class="n">groupby_type</span><span class="o">=</span><span class="s1">&#39;CXCR6+ Tex&#39;</span><span class="p">,</span>
    <span class="n">ratioby</span><span class="o">=</span><span class="s1">&#39;disease_type&#39;</span><span class="p">,</span> <span class="n">ratioby_type</span><span class="o">=</span><span class="n">disease_types</span><span class="p">,</span>
    <span class="n">expanded</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">pie</span><span class="p">(</span><span class="n">gzmk_pie</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">radius</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="n">disease_type_color</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="c1">#cxcr6_pie</span>
       <span class="n">autopct</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%1.0f%%</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">pctdistance</span><span class="o">=</span><span class="mf">1.2</span><span class="p">,</span>
       <span class="n">wedgeprops</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">))</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">pie</span><span class="p">(</span><span class="n">cxcr6_pie</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">radius</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="n">disease_type_color</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="c1">#cxcr6_pie</span>
       <span class="n">autopct</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%1.0f%%</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">pctdistance</span><span class="o">=</span><span class="mf">1.2</span><span class="p">,</span>
       <span class="n">wedgeprops</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">))</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;./figures/gzmk_cxcr6_pie.pdf&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/GEXCD8_99_0.png" src="_images/GEXCD8_99_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">deg_tex</span><span class="p">,</span><span class="n">deg_tex_up</span><span class="p">,</span><span class="n">deg_tex_dw</span><span class="p">,</span><span class="n">enr_tex_up</span><span class="p">,</span><span class="n">enr_tex_dw</span> <span class="o">=</span> <span class="n">DEG_analysis</span><span class="p">(</span><span class="n">adata_nogex</span><span class="p">,</span> <span class="n">groupby</span><span class="o">=</span><span class="s1">&#39;cell_subtype&#39;</span><span class="p">,</span>
                                                                   <span class="n">query_subtype</span><span class="o">=</span><span class="s1">&#39;GZMK+ Tex&#39;</span><span class="p">,</span> 
                                                                   <span class="n">reference_subtype</span><span class="o">=</span><span class="s1">&#39;CXCR6+ Tex&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">deg_tex_dw_sort</span> <span class="o">=</span> <span class="n">deg_tex_dw</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">deg_tex_dw_sort</span><span class="p">[</span><span class="n">deg_tex_dw_sort</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;0.0&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>19929</th>
      <td>TMIGD2</td>
      <td>-3.0812368</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>19880</th>
      <td>LRRN3</td>
      <td>-2.4329364</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>19953</th>
      <td>KLRB1</td>
      <td>-2.301062</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>19945</th>
      <td>LAYN</td>
      <td>-2.2833066</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>19947</th>
      <td>TNFRSF18</td>
      <td>-2.2156186</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>19915</th>
      <td>FURIN</td>
      <td>-2.178659</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>19955</th>
      <td>CAPG</td>
      <td>-2.0833144</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>19884</th>
      <td>PDE4A</td>
      <td>-2.0249436</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>19936</th>
      <td>KLRC1</td>
      <td>-2.0186136</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>19925</th>
      <td>ANKRD28</td>
      <td>-1.9002602</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>19904</th>
      <td>SPRY1</td>
      <td>-1.8976516</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>19951</th>
      <td>GNLY</td>
      <td>-1.8283246</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>19885</th>
      <td>GPR25</td>
      <td>-1.8267225</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>19897</th>
      <td>CDCA7</td>
      <td>-1.8116485</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>19889</th>
      <td>SOX4</td>
      <td>-1.8061968</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>19934</th>
      <td>ZNF683</td>
      <td>-1.7251606</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>19942</th>
      <td>IL7R</td>
      <td>-1.6535127</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>19901</th>
      <td>TNFRSF25</td>
      <td>-1.5645537</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>19937</th>
      <td>GALNT2</td>
      <td>-1.5599933</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>19948</th>
      <td>LDLRAD4</td>
      <td>-1.552857</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>19926</th>
      <td>AHI1</td>
      <td>-1.5084904</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>19893</th>
      <td>DAPK2</td>
      <td>-1.4727451</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>19952</th>
      <td>JAML</td>
      <td>-1.4465675</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>19944</th>
      <td>RORA</td>
      <td>-1.4410411</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>19908</th>
      <td>PFKFB3</td>
      <td>-1.3731062</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>19935</th>
      <td>ENTPD1</td>
      <td>-1.2749933</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>19939</th>
      <td>CAMK4</td>
      <td>-1.1725919</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>19920</th>
      <td>ZEB2</td>
      <td>-1.1601509</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>19924</th>
      <td>SLC7A5</td>
      <td>-1.1351619</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>19956</th>
      <td>CD7</td>
      <td>-1.1118013</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>19914</th>
      <td>TMEM123</td>
      <td>-1.0985686</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>19916</th>
      <td>HOPX</td>
      <td>-1.095994</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>19896</th>
      <td>PRNP</td>
      <td>-1.0759578</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>19932</th>
      <td>CREM</td>
      <td>-1.055154</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>19909</th>
      <td>KLRD1</td>
      <td>-1.0299249</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>19912</th>
      <td>GABARAPL1</td>
      <td>-1.0171854</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>19938</th>
      <td>ITGAE</td>
      <td>-1.0030208</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Figure2B</span>
<span class="n">volcanoPlot</span><span class="p">(</span><span class="n">deg_tex</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="s1">&#39;./figures/gzmk_cxcr6_volcano.pdf&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>          x      y    group
0  3.909193  320.0  tab:red
1  1.678365  320.0  tab:red
2  1.846151  320.0  tab:red
3  1.276832  320.0  tab:red
4  1.115275  320.0  tab:red
</pre></div>
</div>
<img alt="_images/GEXCD8_102_1.png" src="_images/GEXCD8_102_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Figure2C</span>
<span class="c1"># trim (go:...)</span>
<span class="c1"># fig,ax=plt.subplots(figsize=(10,8))</span>
<span class="n">enr_tex_up</span><span class="o">.</span><span class="n">res2d</span><span class="o">.</span><span class="n">Term</span> <span class="o">=</span> <span class="n">enr_tex_up</span><span class="o">.</span><span class="n">res2d</span><span class="o">.</span><span class="n">Term</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; \(GO&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="c1"># dotplot</span>
<span class="n">gseapy</span><span class="o">.</span><span class="n">dotplot</span><span class="p">(</span><span class="n">enr_tex_up</span><span class="o">.</span><span class="n">res2d</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">12</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Up&quot;</span><span class="p">,</span> 
               <span class="n">top_term</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> 
               <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Reds&#39;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;./figures/gzmk_cxcr6_go_up.pdf&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/GEXCD8_103_0.png" src="_images/GEXCD8_103_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Figure2C</span>
<span class="c1"># trim (go:...)</span>
<span class="n">enr_tex_dw</span><span class="o">.</span><span class="n">res2d</span><span class="o">.</span><span class="n">Term</span> <span class="o">=</span> <span class="n">enr_tex_dw</span><span class="o">.</span><span class="n">res2d</span><span class="o">.</span><span class="n">Term</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; \(GO&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="c1"># dotplot</span>
<span class="n">gseapy</span><span class="o">.</span><span class="n">dotplot</span><span class="p">(</span><span class="n">enr_tex_dw</span><span class="o">.</span><span class="n">res2d</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">12</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">top_term</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
               <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Down&quot;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;./gzmk_cxcr6_go_dw.pdf&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/GEXCD8_104_0.png" src="_images/GEXCD8_104_0.png" />
</div>
</div>
<div class="section" id="clonotypesharing">
<h3>ClonotypeSharing<a class="headerlink" href="#clonotypesharing" title="Permalink to this headline">Â¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">clone_subtype</span><span class="p">[</span><span class="s1">&#39;non_dominant_no_cycling_num&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">clone_subtype</span><span class="p">[</span><span class="s1">&#39;non_dominant_num&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">clone_subtype</span><span class="p">[</span><span class="s1">&#39;Cycling T&#39;</span><span class="p">]</span>
<span class="n">clone_subtype</span><span class="p">[</span>
    <span class="s1">&#39;sharing_ratio&#39;</span>
<span class="p">]</span> <span class="o">=</span> <span class="n">clone_subtype</span><span class="p">[</span><span class="s1">&#39;non_dominant_no_cycling_num&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">clone_subtype</span><span class="p">[</span><span class="s1">&#39;total&#39;</span><span class="p">]</span>
<span class="n">clone_stumor</span> <span class="o">=</span> <span class="n">clone_subtype</span><span class="p">[</span><span class="n">clone_subtype</span><span class="p">[</span><span class="s1">&#39;disease_type&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Solid tumor&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cell_subtypes_mod</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;GZMK+ Tex&#39;</span><span class="p">,</span>
    <span class="s1">&#39;CXCR6+ Tex&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Tn&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Tcm&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Early Tcm/Tem&#39;</span><span class="p">,</span>
    <span class="s1">&#39;GZMK+ Tem&#39;</span><span class="p">,</span>
    <span class="s1">&#39;CREM+ Tm&#39;</span><span class="p">,</span>
    <span class="s1">&#39;KLRG1+ Temra&#39;</span><span class="p">,</span>
    <span class="s1">&#39;KLRG1- Temra&#39;</span><span class="p">,</span>
    <span class="s1">&#39;IFITM3+KLRG1+ Temra&#39;</span><span class="p">,</span>
    <span class="s1">&#39;MAIT&#39;</span><span class="p">,</span>
    <span class="s1">&#39;ILTCK&#39;</span><span class="p">,</span>
    <span class="s1">&#39;ITGAE+ Trm&#39;</span><span class="p">,</span>
    <span class="s1">&#39;ITGB2+ Trm&#39;</span><span class="p">,</span>
    <span class="s1">&#39;SELL+ progenitor Tex&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Cycling T&#39;</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stumor_circos</span> <span class="o">=</span> <span class="n">circos_edges</span><span class="p">(</span><span class="n">clone_stumor</span><span class="p">,</span>
                             <span class="n">subtypes</span><span class="o">=</span><span class="n">cell_subtypes_mod</span><span class="p">,</span>
                             <span class="n">file_name</span><span class="o">=</span><span class="s1">&#39;figures/stumor_clonotype.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stumor_sanke</span><span class="p">,</span> <span class="n">stumor_sanke_venn</span> <span class="o">=</span> <span class="n">sanke_plot</span><span class="p">(</span>
    <span class="n">stumor_circos</span><span class="p">,</span> 
    <span class="n">column1</span><span class="o">=</span><span class="s1">&#39;GZMK+ Tex&#39;</span><span class="p">,</span> 
    <span class="n">column2</span><span class="o">=</span><span class="s1">&#39;CXCR6+ Tex&#39;</span><span class="p">,</span> 
    <span class="n">file_name</span><span class="o">=</span><span class="s1">&#39;figures/stumor_sanke.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">venn2</span><span class="p">(</span><span class="n">subsets</span><span class="o">=</span><span class="n">stumor_sanke_venn</span><span class="p">,</span>
      <span class="n">set_labels</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GZMK+ Tex&#39;</span><span class="p">,</span> <span class="s1">&#39;CXCR6+ Tex&#39;</span><span class="p">],</span>
      <span class="n">set_colors</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;#082799&#39;</span><span class="p">,</span> <span class="s1">&#39;#d67e09&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;figures/stumor_venn.pdf&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/GEXCD8_110_0.png" src="_images/GEXCD8_110_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">clone_gzmk</span> <span class="o">=</span> <span class="n">clone_stumor</span><span class="p">[(</span><span class="n">clone_stumor</span><span class="p">[</span><span class="s1">&#39;first&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;GZMK+ Tex&#39;</span><span class="p">)</span><span class="o">|</span><span class="p">(</span><span class="n">clone_stumor</span><span class="p">[</span><span class="s1">&#39;second&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;GZMK+ Tex&#39;</span><span class="p">)]</span>
<span class="n">clone_gzmk_only</span> <span class="o">=</span> <span class="n">clone_gzmk</span><span class="p">[(</span><span class="n">clone_gzmk</span><span class="p">[</span><span class="s1">&#39;first&#39;</span><span class="p">]</span><span class="o">!=</span><span class="s1">&#39;CXCR6+ Tex&#39;</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">clone_gzmk</span><span class="p">[</span><span class="s1">&#39;second&#39;</span><span class="p">]</span><span class="o">!=</span><span class="s1">&#39;CXCR6+ Tex&#39;</span><span class="p">)]</span>
<span class="n">clone_cxcr6</span> <span class="o">=</span> <span class="n">clone_stumor</span><span class="p">[(</span><span class="n">clone_stumor</span><span class="p">[</span><span class="s1">&#39;first&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;CXCR6+ Tex&#39;</span><span class="p">)</span><span class="o">|</span><span class="p">(</span><span class="n">clone_stumor</span><span class="p">[</span><span class="s1">&#39;second&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;CXCR6+ Tex&#39;</span><span class="p">)]</span>
<span class="n">clone_cxcr6_only</span> <span class="o">=</span> <span class="n">clone_cxcr6</span><span class="p">[(</span><span class="n">clone_cxcr6</span><span class="p">[</span><span class="s1">&#39;first&#39;</span><span class="p">]</span><span class="o">!=</span><span class="s1">&#39;GZMK+ Tex&#39;</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">clone_cxcr6</span><span class="p">[</span><span class="s1">&#39;second&#39;</span><span class="p">]</span><span class="o">!=</span><span class="s1">&#39;GZMK+ Tex&#39;</span><span class="p">)]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">clone_gzmk_only_sorted</span> <span class="o">=</span> <span class="n">clone_gzmk_only</span><span class="p">[(</span><span class="n">clone_gzmk_only</span><span class="p">[</span><span class="s1">&#39;total&#39;</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">50</span><span class="p">)]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span>
    <span class="n">by</span><span class="o">=</span><span class="s1">&#39;sharing_ratio&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)[[</span><span class="s1">&#39;disease&#39;</span><span class="p">,</span><span class="s1">&#39;total&#39;</span><span class="p">,</span><span class="s1">&#39;sharing_ratio&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">clone_cxcr6_only_sorted</span> <span class="o">=</span> <span class="n">clone_cxcr6_only</span><span class="p">[</span><span class="n">clone_cxcr6_only</span><span class="p">[</span><span class="s1">&#39;total&#39;</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">50</span><span class="p">]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span>
    <span class="n">by</span><span class="o">=</span><span class="s1">&#39;sharing_ratio&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)[[</span><span class="s1">&#39;disease&#39;</span><span class="p">,</span><span class="s1">&#39;total&#39;</span><span class="p">,</span><span class="s1">&#39;sharing_ratio&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">clone_Tex_only</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">clone_gzmk_only_sorted</span><span class="p">,</span><span class="n">clone_cxcr6_only_sorted</span><span class="p">])</span>

<span class="n">disease_subtypes_color_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">disease_subtypes</span><span class="p">,</span> <span class="n">sns</span><span class="o">.</span><span class="n">color_palette</span><span class="p">(</span><span class="s2">&quot;Set3&quot;</span><span class="p">)[:</span><span class="mi">7</span><span class="p">]))</span>
<span class="n">disease_subtypes_color</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">disease_subtypes_color_dict</span><span class="o">.</span><span class="n">get</span><span class="p">,</span> <span class="n">clone_Tex_only</span><span class="p">[</span><span class="s1">&#39;disease&#39;</span><span class="p">]))</span>

<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">clone_Tex_only</span><span class="p">)),</span> <span class="n">height</span><span class="o">=</span><span class="n">clone_Tex_only</span><span class="p">[</span><span class="s1">&#39;sharing_ratio&#39;</span><span class="p">],</span> 
       <span class="n">color</span><span class="o">=</span><span class="n">disease_subtypes_color</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;./figures/clone_Tex_only_score.pdf&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/GEXCD8_114_0.png" src="_images/GEXCD8_114_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">disease_subtypes_color_dict</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;Melanoma&#39;</span><span class="p">:</span>
    <span class="s1">&#39;Squamous cell carcinoma tumor&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Basal cell carinoma tumor&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Esophagus squamous cell carcinoma&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Nasopharyngeal carcinoma&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Breast cancer&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Clear cell renal cell carcinoma&#39;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;Melanoma&#39;,
 &#39;Squamous cell carcinoma tumor&#39;,
 &#39;Basal cell carinoma tumor&#39;,
 &#39;Esophagus squamous cell carcinoma&#39;,
 &#39;Nasopharyngeal carcinoma&#39;,
 &#39;Breast cancer&#39;,
 &#39;Clear cell renal cell carcinoma&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">clone_Tex_only</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">clone_gzmk_only_sorted</span><span class="p">,</span><span class="n">clone_cxcr6_only_sorted</span><span class="p">])</span>
<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">clone_Tex_only</span><span class="p">)),</span> <span class="n">height</span><span class="o">=</span><span class="n">clone_Tex_only</span><span class="p">[</span><span class="s1">&#39;sharing_ratio&#39;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">clone_Tex_only</span><span class="p">[</span><span class="s1">&#39;disease&#39;</span><span class="p">])</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;./figures/clone_Tex_only_score.pdf&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ValueError</span><span class="g g-Whitespace">                                </span>Traceback (most recent call last)
<span class="n">Input</span> <span class="n">In</span> <span class="p">[</span><span class="mi">330</span><span class="p">],</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="n">clone_Tex_only</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">clone_gzmk_only_sorted</span><span class="p">,</span><span class="n">clone_cxcr6_only_sorted</span><span class="p">])</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
<span class="ne">----&gt; </span><span class="mi">3</span> <span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">clone_Tex_only</span><span class="p">)),</span> <span class="n">height</span><span class="o">=</span><span class="n">clone_Tex_only</span><span class="p">[</span><span class="s1">&#39;sharing_ratio&#39;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">clone_Tex_only</span><span class="p">[</span><span class="s1">&#39;disease&#39;</span><span class="p">])</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;./figures/clone_Tex_only_score.pdf&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="nn">File /usr/local/lib/python3.9/site-packages/matplotlib/__init__.py:1412,</span> in <span class="ni">_preprocess_data.&lt;locals&gt;.inner</span><span class="nt">(ax, data, *args, **kwargs)</span>
<span class="g g-Whitespace">   </span><span class="mi">1409</span> <span class="nd">@functools</span><span class="o">.</span><span class="n">wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1410</span> <span class="k">def</span> <span class="nf">inner</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="g g-Whitespace">   </span><span class="mi">1411</span>     <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<span class="ne">-&gt; </span><span class="mi">1412</span>         <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="o">*</span><span class="nb">map</span><span class="p">(</span><span class="n">sanitize_sequence</span><span class="p">,</span> <span class="n">args</span><span class="p">),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1414</span>     <span class="n">bound</span> <span class="o">=</span> <span class="n">new_sig</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1415</span>     <span class="n">auto_label</span> <span class="o">=</span> <span class="p">(</span><span class="n">bound</span><span class="o">.</span><span class="n">arguments</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">label_namer</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1416</span>                   <span class="ow">or</span> <span class="n">bound</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">label_namer</span><span class="p">))</span>

<span class="nn">File /usr/local/lib/python3.9/site-packages/matplotlib/axes/_axes.py:2356,</span> in <span class="ni">Axes.bar</span><span class="nt">(self, x, height, width, bottom, align, **kwargs)</span>
<span class="g g-Whitespace">   </span><span class="mi">2354</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="n">itertools</span><span class="o">.</span><span class="n">cycle</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">linewidth</span><span class="p">))</span>
<span class="g g-Whitespace">   </span><span class="mi">2355</span> <span class="n">hatch</span> <span class="o">=</span> <span class="n">itertools</span><span class="o">.</span><span class="n">cycle</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">hatch</span><span class="p">))</span>
<span class="ne">-&gt; </span><span class="mi">2356</span> <span class="n">color</span> <span class="o">=</span> <span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">cycle</span><span class="p">(</span><span class="n">mcolors</span><span class="o">.</span><span class="n">to_rgba_array</span><span class="p">(</span><span class="n">color</span><span class="p">)),</span>
<span class="g g-Whitespace">   </span><span class="mi">2357</span>                         <span class="c1"># Fallback if color == &quot;none&quot;.</span>
<span class="g g-Whitespace">   </span><span class="mi">2358</span>                         <span class="n">itertools</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="s1">&#39;none&#39;</span><span class="p">))</span>
<span class="g g-Whitespace">   </span><span class="mi">2359</span> <span class="k">if</span> <span class="n">edgecolor</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">2360</span>     <span class="n">edgecolor</span> <span class="o">=</span> <span class="n">itertools</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>

<span class="nn">File /usr/local/lib/python3.9/site-packages/matplotlib/colors.py:377,</span> in <span class="ni">to_rgba_array</span><span class="nt">(c, alpha)</span>
<span class="g g-Whitespace">    </span><span class="mi">375</span>         <span class="n">rgba</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">to_rgba</span><span class="p">(</span><span class="n">cc</span><span class="p">)</span> <span class="k">for</span> <span class="n">cc</span> <span class="ow">in</span> <span class="n">c</span><span class="p">])</span>
<span class="g g-Whitespace">    </span><span class="mi">376</span> <span class="k">else</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">377</span>     <span class="n">rgba</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">to_rgba</span><span class="p">(</span><span class="n">cc</span><span class="p">)</span> <span class="k">for</span> <span class="n">cc</span> <span class="ow">in</span> <span class="n">c</span><span class="p">])</span>
<span class="g g-Whitespace">    </span><span class="mi">379</span> <span class="k">if</span> <span class="n">alpha</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">380</span>     <span class="n">rgba</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">alpha</span>

<span class="nn">File /usr/local/lib/python3.9/site-packages/matplotlib/colors.py:377,</span> in <span class="ni">&lt;listcomp&gt;</span><span class="nt">(.0)</span>
<span class="g g-Whitespace">    </span><span class="mi">375</span>         <span class="n">rgba</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">to_rgba</span><span class="p">(</span><span class="n">cc</span><span class="p">)</span> <span class="k">for</span> <span class="n">cc</span> <span class="ow">in</span> <span class="n">c</span><span class="p">])</span>
<span class="g g-Whitespace">    </span><span class="mi">376</span> <span class="k">else</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">377</span>     <span class="n">rgba</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">to_rgba</span><span class="p">(</span><span class="n">cc</span><span class="p">)</span> <span class="k">for</span> <span class="n">cc</span> <span class="ow">in</span> <span class="n">c</span><span class="p">])</span>
<span class="g g-Whitespace">    </span><span class="mi">379</span> <span class="k">if</span> <span class="n">alpha</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">380</span>     <span class="n">rgba</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">alpha</span>

<span class="nn">File /usr/local/lib/python3.9/site-packages/matplotlib/colors.py:187,</span> in <span class="ni">to_rgba</span><span class="nt">(c, alpha)</span>
<span class="g g-Whitespace">    </span><span class="mi">185</span>     <span class="n">rgba</span> <span class="o">=</span> <span class="kc">None</span>
<span class="g g-Whitespace">    </span><span class="mi">186</span> <span class="k">if</span> <span class="n">rgba</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># Suppress exception chaining of cache lookup failure.</span>
<span class="ne">--&gt; </span><span class="mi">187</span>     <span class="n">rgba</span> <span class="o">=</span> <span class="n">_to_rgba_no_colorcycle</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">alpha</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">188</span>     <span class="k">try</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">189</span>         <span class="n">_colors_full_map</span><span class="o">.</span><span class="n">cache</span><span class="p">[</span><span class="n">c</span><span class="p">,</span> <span class="n">alpha</span><span class="p">]</span> <span class="o">=</span> <span class="n">rgba</span>

<span class="nn">File /usr/local/lib/python3.9/site-packages/matplotlib/colors.py:262,</span> in <span class="ni">_to_rgba_no_colorcycle</span><span class="nt">(c, alpha)</span>
<span class="g g-Whitespace">    </span><span class="mi">258</span>             <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">259</span>                 <span class="sa">f</span><span class="s2">&quot;Invalid string grayscale value </span><span class="si">{</span><span class="n">orig_c</span><span class="si">!r}</span><span class="s2">. &quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">260</span>                 <span class="sa">f</span><span class="s2">&quot;Value must be within 0-1 range&quot;</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">261</span>         <span class="k">return</span> <span class="n">c</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">alpha</span> <span class="k">if</span> <span class="n">alpha</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mf">1.</span>
<span class="ne">--&gt; </span><span class="mi">262</span>     <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid RGBA argument: </span><span class="si">{</span><span class="n">orig_c</span><span class="si">!r}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">263</span> <span class="c1"># turn 2-D array into 1-D array</span>
<span class="g g-Whitespace">    </span><span class="mi">264</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>

<span class="ne">ValueError</span>: Invalid RGBA argument: &#39;Breast cancer&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Figure2E Stats and Plots</span>
<span class="c1"># For GZMK+ Tex: 71972/BC, 137481/NPC, 51186/ccRCC</span>
<span class="c1"># For CXCR6+ Tex: 101021/BCC, 25018/ESCC, 40534/NPC</span>
<span class="n">file_name</span> <span class="o">=</span> <span class="s1">&#39;clone_gzmk_top1&#39;</span>
<span class="n">clone_id</span> <span class="o">=</span> <span class="mi">71972</span>

<span class="n">adata_nogex</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;clone_umap&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">adata_nogex</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
    <span class="p">(</span>
        <span class="n">adata_nogex</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;cc_aa_identity&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">clone_id</span>
    <span class="p">),</span> <span class="s1">&#39;clone_umap&#39;</span>
<span class="p">]</span> <span class="o">=</span> <span class="n">adata_nogex</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">cell_subtype</span>

<span class="c1"># Figure2E</span>

<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
<span class="n">sc</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">umap</span><span class="p">(</span><span class="n">adata_nogex</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;clone_umap&#39;</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="n">subtype_color</span><span class="p">,</span> 
           <span class="n">size</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">na_color</span><span class="o">=</span><span class="s1">&#39;#f3f3f3&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;./figures/&#39;</span><span class="o">+</span><span class="n">file_name</span><span class="o">+</span><span class="s1">&#39;.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span>

<span class="n">subtype_used</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">adata_nogex</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="o">~</span><span class="n">adata_nogex</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;clone_umap&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">()][</span><span class="s1">&#39;clone_umap&#39;</span><span class="p">])</span>
<span class="n">subtype_used</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">setdiff1d</span><span class="p">(</span><span class="n">subtype_used</span><span class="p">,</span> <span class="s1">&#39;Cycling T&#39;</span><span class="p">)</span>
<span class="n">clone_pie</span> <span class="o">=</span> <span class="n">tissue_pie_data</span><span class="p">(</span><span class="n">adata_use</span><span class="o">=</span><span class="n">adata_nogex</span><span class="p">,</span>
                            <span class="n">groupby</span><span class="o">=</span><span class="s1">&#39;has_ir&#39;</span><span class="p">,</span> <span class="n">groupby_type</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                            <span class="n">ratioby</span><span class="o">=</span><span class="s1">&#39;clone_umap&#39;</span><span class="p">,</span>
                            <span class="n">ratioby_type</span><span class="o">=</span><span class="n">subtype_used</span><span class="p">,</span>
                            <span class="n">expanded</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">clone_pie_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">subtype_used</span><span class="p">,</span> <span class="n">clone_pie</span><span class="p">[</span><span class="mi">0</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
<span class="n">clone_pie_tuple</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">clone_pie_dict</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">item</span><span class="p">:</span> <span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">clone_pie_keys</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">clone_pie_tuple</span><span class="p">]</span>
<span class="n">clone_pie_values</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">clone_pie_tuple</span><span class="p">]</span>

<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">pie</span><span class="p">(</span><span class="n">clone_pie_values</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
       <span class="n">colors</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">subtype_color</span><span class="o">.</span><span class="n">get</span><span class="p">,</span> <span class="n">clone_pie_keys</span><span class="p">)),</span> 
       <span class="n">autopct</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%1.0f%%</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">pctdistance</span><span class="o">=</span><span class="mf">1.2</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;./figures/&#39;</span><span class="o">+</span><span class="n">file_name</span><span class="o">+</span><span class="s1">&#39;.pie.pdf&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/GEXCD8_117_0.png" src="_images/GEXCD8_117_0.png" />
<img alt="_images/GEXCD8_117_1.png" src="_images/GEXCD8_117_1.png" />
</div>
</div>
</div>
</div>
<div class="section" id="id4">
<h2>SupFigures<a class="headerlink" href="#id4" title="Permalink to this headline">Â¶</a></h2>
<div class="section" id="diseaserelavance">
<h3>DiseaseRelavance<a class="headerlink" href="#diseaserelavance" title="Permalink to this headline">Â¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">disease_subtypes</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;Melanoma&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Squamous cell carcinoma tumor&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Basal cell carinoma tumor&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Esophagus squamous cell carcinoma&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Nasopharyngeal carcinoma&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Breast cancer&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Clear cell renal cell carcinoma&#39;</span><span class="p">,</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">adata_ex</span> <span class="o">=</span> <span class="n">adata_nogex</span><span class="p">[(</span><span class="n">adata_nogex</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;cell_subtype&#39;</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;GZMK+ Tex&quot;</span><span class="p">)</span> <span class="o">|</span>
                       <span class="p">(</span><span class="n">adata_nogex</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;cell_subtype&#39;</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;CXCR6+ Tex&quot;</span><span class="p">)]</span>
<span class="n">stacked_bar</span><span class="p">(</span><span class="n">adata_ex</span><span class="p">,</span> <span class="n">xitems</span><span class="o">=</span><span class="n">disease_subtypes</span><span class="p">,</span> <span class="n">xitem_str</span><span class="o">=</span><span class="s1">&#39;disease&#39;</span><span class="p">,</span>
           <span class="n">yitems</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GZMK+ Tex&#39;</span><span class="p">,</span> <span class="s1">&#39;CXCR6+ Tex&#39;</span><span class="p">],</span> <span class="n">yitem_str</span><span class="o">=</span><span class="s1">&#39;cell_subtype&#39;</span><span class="p">,</span> 
           <span class="n">yitem_color</span><span class="o">=</span><span class="n">subtype_color</span><span class="p">,</span>
           <span class="n">percentage</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="s1">&#39;./figures/disease_Tex.pdf&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/GEXCD8_121_0.png" src="_images/GEXCD8_121_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">adata_stumor</span> <span class="o">=</span> <span class="n">adata_nogex</span><span class="p">[</span><span class="n">adata_nogex</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;disease_type&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Solid tumor&#39;</span><span class="p">]</span>
<span class="n">adata_TIL</span> <span class="o">=</span> <span class="n">adata_stumor</span><span class="p">[</span><span class="n">adata_stumor</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;meta_tissue_type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Tumor_infiltrating_lymphocyte&#39;</span><span class="p">]</span>

<span class="n">ratio_list</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">disease_subtypes</span><span class="p">:</span>
    <span class="n">adata_disease</span> <span class="o">=</span> <span class="n">adata_TIL</span><span class="p">[</span><span class="n">adata_TIL</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;disease&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">i</span><span class="p">]</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">condition_cell_ratio</span><span class="p">(</span><span class="n">adata_disease</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="s1">&#39;TIL&#39;</span><span class="p">,</span> 
                              <span class="n">cell_type1</span><span class="o">=</span><span class="s1">&#39;GZMK+ Tex&#39;</span><span class="p">,</span> <span class="n">cell_type2</span><span class="o">=</span><span class="s1">&#39;CXCR6+ Tex&#39;</span><span class="p">)</span>
    <span class="n">ratio_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="n">ratio_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">ratio_list</span><span class="p">)</span>

<span class="n">condition_list</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">disease_subtypes</span><span class="p">,</span> <span class="n">ratio_list</span><span class="p">):</span>
    <span class="n">disease_name</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">j</span><span class="p">)))</span>
    <span class="n">condition_list</span> <span class="o">=</span> <span class="n">condition_list</span> <span class="o">+</span> <span class="n">disease_name</span>
<span class="n">ratio_df</span><span class="p">[</span><span class="s1">&#39;condition&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">condition_list</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ratio_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;figures/disease_relavance_ratio.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">multi_boxplot</span><span class="p">(</span><span class="n">ratio_df</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="s1">&#39;./figures/disease_relavance&#39;</span><span class="p">,</span> 
              <span class="n">xaxis</span><span class="o">=</span><span class="s1">&#39;condition&#39;</span><span class="p">,</span> <span class="n">yaxis</span><span class="o">=</span><span class="s1">&#39;ratio&#39;</span><span class="p">,</span> <span class="n">hueaxis</span><span class="o">=</span><span class="s1">&#39;subtype&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/GEXCD8_124_0.png" src="_images/GEXCD8_124_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stats</span><span class="o">.</span><span class="n">wilcoxon</span><span class="p">(</span><span class="n">ratio_df</span><span class="p">[(</span><span class="n">ratio_df</span><span class="p">[</span><span class="s1">&#39;condition&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">disease_subtypes</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span> <span class="o">&amp;</span>
                        <span class="p">(</span><span class="n">ratio_df</span><span class="p">[</span><span class="s1">&#39;subtype&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;GZMK+ Tex&#39;</span><span class="p">)]</span><span class="o">.</span><span class="n">ratio</span><span class="p">,</span>
               <span class="n">ratio_df</span><span class="p">[(</span><span class="n">ratio_df</span><span class="p">[</span><span class="s1">&#39;condition&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">disease_subtypes</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span> <span class="o">&amp;</span>
                        <span class="p">(</span><span class="n">ratio_df</span><span class="p">[</span><span class="s1">&#39;subtype&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;CXCR6+ Tex&#39;</span><span class="p">)]</span><span class="o">.</span><span class="n">ratio</span><span class="p">,)</span> <span class="c1">#paired sample test</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>WilcoxonResult(statistic=5.0, pvalue=0.01953125)
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="cxcl13analysis">
<h3>CXCL13Analysis<a class="headerlink" href="#cxcl13analysis" title="Permalink to this headline">Â¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sc</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">umap</span><span class="p">(</span><span class="n">adata_nogex</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;CXCL13&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Reds&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/GEXCD8_127_0.png" src="_images/GEXCD8_127_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sc</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">violin</span><span class="p">(</span><span class="n">adata_ex</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="s1">&#39;CXCL13&#39;</span><span class="p">,</span> <span class="n">stripplot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
             <span class="n">groupby</span><span class="o">=</span><span class="s1">&#39;disease_type&#39;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/GEXCD8_128_0.png" src="_images/GEXCD8_128_0.png" />
</div>
</div>
</div>
</div>
</div>
<div class="tex2jax_ignore mathjax_ignore section" id="part3expansionininflam-irae">
<h1>Part3ExpansionInInflam&amp;irAE<a class="headerlink" href="#part3expansionininflam-irae" title="Permalink to this headline">Â¶</a></h1>
<div class="section" id="cellnumrelated">
<h2>CellNumRelated<a class="headerlink" href="#cellnumrelated" title="Permalink to this headline">Â¶</a></h2>
<div class="section" id="id5">
<h3>Functions<a class="headerlink" href="#id5" title="Permalink to this headline">Â¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">circ_color</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;Tcm&#39;</span><span class="p">:</span><span class="s1">&#39;#ffbb78&#39;</span><span class="p">,</span>
    <span class="s1">&#39;GZMK+ Tem&#39;</span><span class="p">:</span><span class="s1">&#39;#d62728&#39;</span><span class="p">,</span>
    <span class="s1">&#39;KLRG1+ Temra&#39;</span><span class="p">:</span><span class="s1">&#39;#8c564b&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Other Subtype&#39;</span><span class="p">:</span><span class="s1">&#39;#f2f2f2&#39;</span><span class="p">,</span>
<span class="p">}</span>
<span class="n">tissue_color</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;ITGAE+ Trm&#39;</span><span class="p">:</span><span class="s1">&#39;#279e68&#39;</span><span class="p">,</span>
    <span class="s1">&#39;ITGB2+ Trm&#39;</span><span class="p">:</span><span class="s1">&#39;#98df8a&#39;</span><span class="p">,</span>
    <span class="s1">&#39;GZMK+ Tex&#39;</span><span class="p">:</span><span class="s1">&#39;#c5b0d5&#39;</span><span class="p">,</span>
    <span class="s1">&#39;CXCR6+ Tex&#39;</span><span class="p">:</span><span class="s1">&#39;#c49c94&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Other Subtype&#39;</span><span class="p">:</span><span class="s1">&#39;#f2f2f2&#39;</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Only select healthy sample in the involved study</span>
<span class="n">healthy_study_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Boland_2020&#39;</span><span class="p">,</span> <span class="s1">&#39;Corridoni_2020&#39;</span><span class="p">,</span> <span class="s1">&#39;Luoma_2020&#39;</span><span class="p">]</span>
<span class="n">adata_nokid</span> <span class="o">=</span> <span class="n">adata_nogex</span><span class="p">[</span><span class="o">~</span><span class="n">adata_nogex</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;study_name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">kid_studies</span><span class="p">)]</span>
<span class="n">adata_hiit</span> <span class="o">=</span> <span class="n">adata_nokid</span><span class="p">[</span>
    <span class="p">(</span>
        <span class="p">(</span><span class="n">adata_nokid</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;cell_type&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;T cell&#39;</span><span class="p">)</span>
    <span class="p">)</span> <span class="o">&amp;</span>
    <span class="p">((</span>
        <span class="p">(</span><span class="n">adata_nokid</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;disease_type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s2">&quot;Healthy&quot;</span><span class="p">))</span>
        <span class="c1"># (adata_nogex.obs[&#39;study_name&#39;].isin(healthy_study_list))</span>
    <span class="p">)</span> <span class="o">|</span>
    <span class="p">(</span>
        <span class="n">adata_nokid</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;disease_type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s2">&quot;Inflammation&quot;</span><span class="p">)</span>

    <span class="p">)</span> <span class="o">|</span>
    <span class="p">(</span>
        <span class="n">adata_nokid</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;disease_type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s2">&quot;Inflammation-irAE&quot;</span><span class="p">)</span>
    <span class="p">)</span> <span class="o">|</span>
    <span class="p">(</span>
        <span class="p">(</span><span class="n">adata_nokid</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;disease_type&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Solid tumor&#39;</span><span class="p">)</span> <span class="o">&amp;</span>
        <span class="p">(</span><span class="n">adata_nokid</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;meta_tissue_type_aggr&#39;</span><span class="p">]</span><span class="o">!=</span><span class="s1">&#39;Tissue&#39;</span><span class="p">)</span> <span class="o">&amp;</span>
        <span class="p">(</span><span class="n">adata_nokid</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;response_type_rmpre&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s2">&quot;Treatment-naive&quot;</span><span class="p">))</span>
    <span class="p">))</span>
<span class="p">]</span> <span class="c1"># data for comparison</span>

<span class="c1"># filter cell number too low</span>
<span class="n">hiit_id</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="ow">in</span> <span class="n">Counter</span><span class="p">(</span><span class="n">adata_hiit</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">individual_id</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">y</span><span class="o">&gt;</span><span class="mi">100</span><span class="p">]</span>
<span class="n">adata_hiit</span> <span class="o">=</span> <span class="n">adata_hiit</span><span class="p">[</span><span class="n">adata_hiit</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;individual_id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">hiit_id</span><span class="p">)]</span>

<span class="c1"># Healthy sample</span>
<span class="n">adata_hiit</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;disease&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">adata_hiit</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;disease&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;str&#39;</span><span class="p">)</span>
<span class="n">adata_hiit</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">adata_hiit</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;disease_type&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Healthy&#39;</span><span class="p">,</span> <span class="s1">&#39;disease&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Healthy&#39;</span>

<span class="c1"># Cancer sample rename</span>
<span class="n">cancer_list</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;Basal cell carinoma tumor&#39;</span><span class="p">,</span><span class="s1">&#39;Breast cancer&#39;</span><span class="p">,</span> 
    <span class="s1">&#39;Clear cell renal cell carcinoma&#39;</span><span class="p">,</span> <span class="s1">&#39;Esophagus squamous cell carcinoma&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Melanoma&#39;</span><span class="p">,</span> <span class="s1">&#39;Nasopharyngeal carcinoma&#39;</span><span class="p">,</span><span class="s1">&#39;Squamous cell carcinoma tumor&#39;</span><span class="p">,</span>
<span class="p">]</span>
<span class="n">adata_hiit</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">adata_hiit</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;disease&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">cancer_list</span><span class="p">),</span> <span class="s1">&#39;disease&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;TN_tumor&#39;</span>

<span class="n">adata_hiit</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;disease&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">adata_hiit</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;disease&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;category&#39;</span><span class="p">)</span>
<span class="n">adata_hiit</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;disease_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">adata_hiit</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;disease_type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;category&#39;</span><span class="p">)</span>

<span class="c1"># Subset adata, filter sample with too few cells</span>
<span class="n">adata_hiit_circ</span> <span class="o">=</span> <span class="n">adata_hiit</span><span class="p">[</span>
    <span class="n">adata_hiit</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;meta_tissue_type_aggr&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Circulating&#39;</span>
<span class="p">]</span>
<span class="n">hiit_circ_id</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="ow">in</span> <span class="n">Counter</span><span class="p">(</span><span class="n">adata_hiit_circ</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">individual_id</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">y</span><span class="o">&gt;</span><span class="mi">100</span><span class="p">]</span>
<span class="n">adata_hiit_circ</span> <span class="o">=</span> <span class="n">adata_hiit_circ</span><span class="p">[</span><span class="n">adata_hiit_circ</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;individual_id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">hiit_circ_id</span><span class="p">)]</span>

<span class="n">adata_hiit_tissue_pre</span> <span class="o">=</span> <span class="n">adata_hiit</span><span class="p">[</span>
    <span class="p">(</span><span class="n">adata_hiit</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;meta_tissue_type_aggr&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Tissue&#39;</span><span class="p">)</span> <span class="o">|</span>
    <span class="p">(</span><span class="n">adata_hiit</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;meta_tissue_type_aggr&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;TIL&#39;</span><span class="p">)</span>
<span class="p">]</span>

<span class="n">hiit_tissue_id</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="ow">in</span> <span class="n">Counter</span><span class="p">(</span><span class="n">adata_hiit_tissue_pre</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">individual_id</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">y</span><span class="o">&gt;</span><span class="mi">100</span><span class="p">]</span>
<span class="n">adata_hiit_tissue_pre</span> <span class="o">=</span> <span class="n">adata_hiit_tissue_pre</span><span class="p">[</span><span class="n">adata_hiit_tissue_pre</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;individual_id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">hiit_tissue_id</span><span class="p">)]</span>

<span class="c1"># subset colon/arthritis tissue</span>
<span class="n">adata_hiit_tissue_arth</span> <span class="o">=</span> <span class="n">adata_hiit_tissue_pre</span><span class="p">[</span>
    <span class="p">(</span><span class="n">adata_hiit_tissue_pre</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;study_name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;Boland&#39;</span><span class="p">))</span> <span class="o">|</span>
    <span class="p">(</span><span class="n">adata_hiit_tissue_pre</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;study_name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;Corridoni&#39;</span><span class="p">))</span> <span class="o">|</span>
    <span class="p">(</span><span class="n">adata_hiit_tissue_pre</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;study_name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;Luoma&#39;</span><span class="p">))</span> <span class="o">|</span>
    <span class="p">(</span><span class="n">adata_hiit_tissue_pre</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;disease&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Ulcerative colitis&#39;</span><span class="p">)</span> <span class="o">|</span>
    <span class="p">(</span><span class="n">adata_hiit_tissue_pre</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;disease&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;CPI-colitis&#39;</span><span class="p">)</span> <span class="o">|</span>
    <span class="p">(</span><span class="n">adata_hiit_tissue_pre</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;disease&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Arthritis&#39;</span><span class="p">)</span> <span class="o">|</span>
    <span class="p">(</span><span class="n">adata_hiit_tissue_pre</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;disease_type&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Solid tumor&#39;</span><span class="p">)</span>
<span class="p">]</span>
<span class="n">adata_hiit_tissue</span> <span class="o">=</span> <span class="n">adata_hiit_tissue_arth</span><span class="p">[</span><span class="n">adata_hiit_tissue_arth</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;disease&#39;</span><span class="p">]</span><span class="o">!=</span><span class="s1">&#39;Arthritis&#39;</span><span class="p">]</span>

<span class="c1"># Subset by condition</span>
<span class="c1"># healthy</span>
<span class="n">adata_hiit_healthy_circ</span> <span class="o">=</span> <span class="n">adata_hiit_circ</span><span class="p">[</span>
    <span class="n">adata_hiit_circ</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;disease_type&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Healthy&#39;</span>
<span class="p">]</span>
<span class="n">adata_hiit_healthy_tissue</span> <span class="o">=</span> <span class="n">adata_hiit_tissue</span><span class="p">[</span>
    <span class="n">adata_hiit_tissue</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;disease_type&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Healthy&#39;</span>
<span class="p">]</span>

<span class="c1"># inflammation</span>
<span class="n">adata_hiit_inflam_circ</span> <span class="o">=</span> <span class="n">adata_hiit_circ</span><span class="p">[</span>
    <span class="n">adata_hiit_circ</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;disease_type&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Inflammation&#39;</span>
<span class="p">]</span>
<span class="n">adata_hiit_inflam_tissue</span> <span class="o">=</span> <span class="n">adata_hiit_tissue</span><span class="p">[</span>
    <span class="n">adata_hiit_tissue</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;disease_type&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Inflammation&#39;</span>
<span class="p">]</span>

<span class="c1"># irae_colitis</span>
<span class="n">adata_hiit_irae_circ</span> <span class="o">=</span> <span class="n">adata_hiit_circ</span><span class="p">[</span>
    <span class="n">adata_hiit_circ</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;disease_type&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Inflammation-irAE&#39;</span>
<span class="p">]</span>
<span class="n">adata_hiit_irae_tissue</span> <span class="o">=</span> <span class="n">adata_hiit_tissue</span><span class="p">[</span>
    <span class="n">adata_hiit_tissue</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;disease_type&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Inflammation-irAE&#39;</span>
<span class="p">]</span>

<span class="c1"># solid tumor</span>
<span class="n">adata_hiit_stumor_circ</span> <span class="o">=</span> <span class="n">adata_hiit_circ</span><span class="p">[</span>
    <span class="n">adata_hiit_circ</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;disease_type&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Solid tumor&#39;</span>
<span class="p">]</span>
<span class="n">adata_hiit_stumor_til</span> <span class="o">=</span> <span class="n">adata_hiit_tissue</span><span class="p">[</span>
    <span class="n">adata_hiit_tissue</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;disease_type&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Solid tumor&#39;</span>
<span class="p">]</span>

<span class="c1"># ID of subset adata</span>
<span class="c1"># hiit_id = np.unique(adata_hiit.obs[&#39;individual_id&#39;])</span>
<span class="c1"># hiit_healthy_circ_id = np.unique(adata_hiit_healthy_circ.obs[&#39;individual_id&#39;])</span>
<span class="c1"># hiit_healthy_tissue_id = np.unique(adata_hiit_healthy_tissue.obs[&#39;individual_id&#39;])</span>
<span class="c1"># hiit_inflam_circ_id = np.unique(adata_hiit_inflam_circ.obs[&#39;individual_id&#39;])</span>
<span class="c1"># hiit_inflam_tissue_id = np.unique(adata_hiit_inflam_tissue.obs[&#39;individual_id&#39;])</span>
<span class="c1"># hiit_irae_circ_id = np.unique(adata_hiit_irae_circ.obs[&#39;individual_id&#39;])</span>
<span class="c1"># hiit_irae_tissue_id = np.unique(adata_hiit_irae_tissue.obs[&#39;individual_id&#39;])</span>
<span class="c1"># hiit_stumor_circ_id = np.unique(adata_hiit_stumor_circ.obs[&#39;individual_id&#39;])</span>
<span class="c1"># hiit_stumor_til_id = np.unique(adata_hiit_stumor_til.obs[&#39;individual_id&#39;])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">cell_ratio</span><span class="p">(</span><span class="n">adata</span><span class="o">=</span><span class="n">adata_nogex</span><span class="p">,</span>
               <span class="n">groupby</span><span class="o">=</span><span class="s1">&#39;disease_type&#39;</span><span class="p">,</span>
               <span class="n">groups</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Healthy&#39;</span><span class="p">,</span> <span class="s1">&#39;Inflammation&#39;</span><span class="p">,</span> 
                       <span class="s1">&#39;Inflammation-irAE&#39;</span><span class="p">,</span> <span class="s1">&#39;Solid tumor&#39;</span><span class="p">],</span>
               <span class="n">subtypeby</span><span class="o">=</span><span class="s1">&#39;cell_subtype&#39;</span><span class="p">,</span>
               <span class="n">subtypes</span><span class="o">=</span><span class="n">cell_subtypes</span><span class="p">,</span>
               <span class="n">expanded</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">total</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([])</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">groups</span><span class="p">:</span>
        <span class="n">adata_grouped</span> <span class="o">=</span> <span class="n">adata</span><span class="p">[</span><span class="n">adata</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="n">groupby</span><span class="p">]</span><span class="o">==</span><span class="n">i</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">expanded</span> <span class="o">==</span> <span class="s1">&#39;large&#39;</span><span class="p">:</span>
            <span class="n">adata_grouped_test</span> <span class="o">=</span> <span class="n">adata_grouped</span><span class="p">[</span>
                <span class="p">(</span><span class="n">adata_grouped</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;expansion_level&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;100&#39;</span><span class="p">))</span> <span class="o">|</span>
                <span class="p">(</span><span class="n">adata_grouped</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;expansion_level&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;50&#39;</span><span class="p">))</span>
            <span class="p">]</span> 
        <span class="k">elif</span> <span class="n">expanded</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">adata_grouped_test</span> <span class="o">=</span> <span class="n">adata_grouped</span><span class="p">[</span>
                <span class="p">(</span><span class="n">adata_grouped</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;cc_aa_identity_size&#39;</span><span class="p">]</span><span class="o">&gt;=</span><span class="mi">3</span><span class="p">)</span>
            <span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">adata_grouped_test</span> <span class="o">=</span> <span class="n">adata_grouped</span>
    
        <span class="n">df0</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([])</span>
        <span class="k">if</span> <span class="n">total</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">Counter</span><span class="p">(</span><span class="n">adata_grouped_test</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">individual_id</span><span class="p">))</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">Counter</span><span class="p">(</span><span class="n">adata_grouped</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">individual_id</span><span class="p">))</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

            <span class="n">x</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;ratio&quot;</span><span class="p">:</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">]})</span>
            <span class="n">x</span><span class="p">[</span><span class="s1">&#39;subtypes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Total&#39;</span>
            <span class="n">df0</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df0</span><span class="p">,</span> <span class="n">x</span><span class="p">])</span>     
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">subtypes</span><span class="p">:</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">Counter</span><span class="p">(</span><span class="n">adata_grouped_test</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span>
                <span class="n">adata_grouped_test</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="n">subtypeby</span><span class="p">]</span><span class="o">==</span><span class="n">j</span>
            <span class="p">]</span><span class="o">.</span><span class="n">individual_id</span><span class="p">))</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">Counter</span><span class="p">(</span><span class="n">adata_grouped</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">individual_id</span><span class="p">))</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

            <span class="n">x</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;ratio&quot;</span><span class="p">:</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">]})</span>
            <span class="n">x</span><span class="p">[</span><span class="s1">&#39;subtypes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span>
            <span class="n">df0</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df0</span><span class="p">,</span> <span class="n">x</span><span class="p">])</span>
            
        <span class="n">df0</span><span class="p">[</span><span class="s1">&#39;disease_types&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">df0</span><span class="p">)))</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df</span><span class="p">,</span> <span class="n">df0</span><span class="p">])</span>
        
    <span class="k">return</span> <span class="n">df</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># multi boxplot</span>
<span class="k">def</span> <span class="nf">sep_multi_boxplot</span><span class="p">(</span><span class="n">multi_box</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span>
                      <span class="n">xaxis</span><span class="o">=</span><span class="s1">&#39;variable&#39;</span><span class="p">,</span> <span class="n">yaxis</span><span class="o">=</span><span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="n">hueaxis</span><span class="o">=</span><span class="s1">&#39;origin&#39;</span><span class="p">):</span>
    
    <span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">multi_box</span><span class="p">[</span><span class="n">xaxis</span><span class="p">])),</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>

    <span class="c1"># add padding between the subplots</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span> 

    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span><span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">multi_box</span><span class="p">[</span><span class="n">xaxis</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()):</span>
        <span class="n">grouped_box</span> <span class="o">=</span> <span class="n">multi_box</span><span class="p">[</span><span class="n">multi_box</span><span class="p">[</span><span class="n">xaxis</span><span class="p">]</span><span class="o">==</span><span class="n">i</span><span class="p">]</span>
        <span class="n">grouped_box</span><span class="p">[</span><span class="n">xaxis</span><span class="p">]</span> <span class="o">=</span> <span class="n">grouped_box</span><span class="p">[</span><span class="n">xaxis</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;str&#39;</span><span class="p">)</span>
        <span class="c1"># draw boxplot for age in the 1st subplot</span>
        <span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">grouped_box</span><span class="p">,</span>
                    <span class="n">x</span><span class="o">=</span><span class="n">xaxis</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">yaxis</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="n">hueaxis</span><span class="p">,</span>
                    <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">boxprops</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;zorder&quot;</span><span class="p">:</span><span class="mi">2</span><span class="p">},</span>
                    <span class="n">showfliers</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="c1"># Extract x and y coordinates of the dots</span>
        <span class="n">sns</span><span class="o">.</span><span class="n">stripplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">xaxis</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">yaxis</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="n">hueaxis</span><span class="p">,</span>
                      <span class="n">dodge</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">grouped_box</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>

        <span class="n">ax</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.3</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;center right&#39;</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">autofmt_xdate</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
    
    <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="circulating">
<h3>Circulating<a class="headerlink" href="#circulating" title="Permalink to this headline">Â¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Counter</span><span class="p">(</span><span class="n">adata_hiit_circ</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;disease_type&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Counter({&#39;Solid tumor&#39;: 24563,
         &#39;Inflammation&#39;: 13711,
         &#39;Healthy&#39;: 37376,
         &#39;Inflammation-irAE&#39;: 13288})
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">target_cells</span> <span class="o">=</span> <span class="mi">13288</span>
<span class="n">cluster_key</span> <span class="o">=</span> <span class="s1">&#39;disease_type&#39;</span>
<span class="n">adata</span> <span class="o">=</span> <span class="n">adata_hiit_circ</span>

<span class="n">adatas</span> <span class="o">=</span> <span class="p">[</span><span class="n">adata</span><span class="p">[</span><span class="n">adata</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="n">cluster_key</span><span class="p">]</span><span class="o">==</span><span class="n">clust</span><span class="p">]</span> <span class="k">for</span> <span class="n">clust</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">adata</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="n">cluster_key</span><span class="p">])]</span>

<span class="k">for</span> <span class="n">dat</span> <span class="ow">in</span> <span class="n">adatas</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">dat</span><span class="o">.</span><span class="n">n_obs</span> <span class="o">&gt;</span> <span class="n">target_cells</span><span class="p">:</span>
         <span class="n">sc</span><span class="o">.</span><span class="n">pp</span><span class="o">.</span><span class="n">subsample</span><span class="p">(</span><span class="n">dat</span><span class="p">,</span> <span class="n">n_obs</span><span class="o">=</span><span class="n">target_cells</span><span class="p">)</span>

<span class="n">adata_downsampled</span> <span class="o">=</span> <span class="n">adatas</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="o">*</span><span class="n">adatas</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
<span class="n">adata_downsampled</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="p">[</span> <span class="s1">&#39;-&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">adata_downsampled</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">index</span> <span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># MainFigure3A, stats</span>
<span class="n">adata_nogex</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;expanded_distribution&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">adata_nogex</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
    <span class="n">adata_downsampled</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span>
        <span class="p">(</span>
            <span class="p">(</span><span class="n">adata_downsampled</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;cell_subtype&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;Tem&#39;</span><span class="p">))</span> <span class="o">|</span>
            <span class="p">(</span><span class="n">adata_downsampled</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;cell_subtype&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;Tcm&#39;</span><span class="p">))</span> <span class="o">|</span>
            <span class="p">(</span><span class="n">adata_downsampled</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;cell_subtype&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;Cycling&#39;</span><span class="p">))</span>
        <span class="p">)</span> <span class="o">&amp;</span>
        <span class="p">(</span>
            <span class="p">(</span><span class="n">adata_downsampled</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;cc_aa_identity_size&#39;</span><span class="p">]</span><span class="o">&gt;=</span><span class="mi">3</span><span class="p">)</span>
        <span class="p">)</span>
    <span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;expanded_distribution&#39;</span>
<span class="p">]</span> <span class="o">=</span> <span class="n">adata_downsampled</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;disease_type&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># MainFigure3A</span>
<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
<span class="n">sc</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">umap</span><span class="p">(</span><span class="n">adata_nogex</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;expanded_distribution&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">na_color</span><span class="o">=</span><span class="s2">&quot;#f7f7f7&quot;</span><span class="p">,</span> 
           <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="n">disease_type_color</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;./figures/expanded_circ_cells.png&quot;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/GEXCD8_140_0.png" src="_images/GEXCD8_140_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># SupFigures</span>
<span class="n">circ_subtypes_aggr</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Tcm/Tem&#39;</span><span class="p">,</span> <span class="s1">&#39;KLRG1+ Temra&#39;</span><span class="p">]</span>
<span class="n">disease_types_compare</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Healthy&#39;</span><span class="p">,</span> <span class="s1">&#39;Inflammation&#39;</span><span class="p">,</span> <span class="s1">&#39;Inflammation-irAE&#39;</span><span class="p">,</span> <span class="s1">&#39;Solid tumor&#39;</span><span class="p">]</span>
<span class="n">adata_hiit_circ</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;cell_subtype_comparison&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">adata_hiit_circ</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;cell_subtype_aggr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">adata_hiit_circ</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;cell_subtype_comparison&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">adata_hiit_circ</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;cell_subtype_comparison&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;str&#39;</span><span class="p">)</span>
<span class="n">adata_hiit_circ</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
    <span class="n">adata_hiit_circ</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;cell_subtype&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;KLRG1+ Temra&#39;</span><span class="p">,</span> <span class="s1">&#39;cell_subtype_comparison&#39;</span>
<span class="p">]</span><span class="o">=</span><span class="s1">&#39;KLRG1+ Temra&#39;</span>
<span class="n">disease_circ_ratio</span> <span class="o">=</span> <span class="n">cell_ratio</span><span class="p">(</span><span class="n">adata</span><span class="o">=</span><span class="n">adata_hiit_circ</span><span class="p">,</span> 
                                <span class="n">groupby</span><span class="o">=</span><span class="s1">&#39;disease_type&#39;</span><span class="p">,</span>
                                <span class="n">groups</span><span class="o">=</span><span class="n">disease_types_compare</span><span class="p">,</span>
                                <span class="n">subtypeby</span><span class="o">=</span><span class="s1">&#39;cell_subtype_comparison&#39;</span><span class="p">,</span>
                                <span class="n">subtypes</span><span class="o">=</span><span class="n">circ_subtypes_aggr</span><span class="p">,</span> <span class="n">expanded</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">total</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Counter</span><span class="p">(</span><span class="n">disease_circ_ratio</span><span class="p">[</span><span class="n">disease_circ_ratio</span><span class="p">[</span><span class="s1">&#39;subtypes&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Tcm/Tem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">disease_types</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Counter({&#39;Healthy&#39;: 30,
         &#39;Inflammation&#39;: 7,
         &#39;Inflammation-irAE&#39;: 8,
         &#39;Solid tumor&#39;: 13})
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sep_multi_boxplot</span><span class="p">(</span><span class="n">disease_circ_ratio</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="s1">&#39;./figures/circ_ratio.pdf&#39;</span><span class="p">,</span>
                  <span class="n">xaxis</span><span class="o">=</span><span class="s1">&#39;subtypes&#39;</span><span class="p">,</span> <span class="n">yaxis</span><span class="o">=</span><span class="s1">&#39;ratio&#39;</span><span class="p">,</span> <span class="n">hueaxis</span><span class="o">=</span><span class="s1">&#39;disease_types&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/GEXCD8_143_0.png" src="_images/GEXCD8_143_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stats</span><span class="o">.</span><span class="n">mannwhitneyu</span><span class="p">(</span><span class="n">disease_circ_ratio</span><span class="p">[</span>
    <span class="p">(</span><span class="n">disease_circ_ratio</span><span class="p">[</span><span class="s1">&#39;subtypes&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;KLRG1+ Temra&#39;</span><span class="p">)</span><span class="o">&amp;</span>
    <span class="p">(</span><span class="n">disease_circ_ratio</span><span class="p">[</span><span class="s1">&#39;disease_types&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Healthy&#39;</span><span class="p">)]</span><span class="o">.</span><span class="n">ratio</span><span class="p">,</span>
                  <span class="n">disease_circ_ratio</span><span class="p">[</span>
    <span class="p">(</span><span class="n">disease_circ_ratio</span><span class="p">[</span><span class="s1">&#39;subtypes&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;KLRG1+ Temra&#39;</span><span class="p">)</span><span class="o">&amp;</span>
    <span class="p">(</span><span class="n">disease_circ_ratio</span><span class="p">[</span><span class="s1">&#39;disease_types&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Solid tumor&#39;</span><span class="p">)]</span><span class="o">.</span><span class="n">ratio</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>MannwhitneyuResult(statistic=64.0, pvalue=0.000558284541956457)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Expansion Pie Charts</span>
<span class="n">circ_healthy_expansion_pie</span> <span class="o">=</span> <span class="n">tissue_pie_data</span><span class="p">(</span><span class="n">adata_use</span><span class="o">=</span><span class="n">adata_hiit_circ</span><span class="p">,</span> 
    <span class="n">groupby</span><span class="o">=</span><span class="s1">&#39;disease_type&#39;</span><span class="p">,</span> <span class="n">groupby_type</span><span class="o">=</span><span class="s1">&#39;Healthy&#39;</span><span class="p">,</span>
    <span class="n">ratioby</span><span class="o">=</span><span class="s1">&#39;expansion_size&#39;</span><span class="p">,</span> <span class="n">ratioby_type</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;2&#39;</span><span class="p">],</span>
    <span class="n">expanded</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">circ_inflam_expansion_pie</span> <span class="o">=</span> <span class="n">tissue_pie_data</span><span class="p">(</span><span class="n">adata_use</span><span class="o">=</span><span class="n">adata_hiit_circ</span><span class="p">,</span> 
    <span class="n">groupby</span><span class="o">=</span><span class="s1">&#39;disease_type&#39;</span><span class="p">,</span> <span class="n">groupby_type</span><span class="o">=</span><span class="s1">&#39;Inflammation&#39;</span><span class="p">,</span>
    <span class="n">ratioby</span><span class="o">=</span><span class="s1">&#39;expansion_size&#39;</span><span class="p">,</span> <span class="n">ratioby_type</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;2&#39;</span><span class="p">],</span>
    <span class="n">expanded</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">circ_irae_expansion_pie</span> <span class="o">=</span> <span class="n">tissue_pie_data</span><span class="p">(</span><span class="n">adata_use</span><span class="o">=</span><span class="n">adata_hiit_circ</span><span class="p">,</span> 
    <span class="n">groupby</span><span class="o">=</span><span class="s1">&#39;disease_type&#39;</span><span class="p">,</span> <span class="n">groupby_type</span><span class="o">=</span><span class="s1">&#39;Inflammation-irAE&#39;</span><span class="p">,</span>
    <span class="n">ratioby</span><span class="o">=</span><span class="s1">&#39;expansion_size&#39;</span><span class="p">,</span> <span class="n">ratioby_type</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;2&#39;</span><span class="p">],</span>
    <span class="n">expanded</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">circ_stumor_expansion_pie</span> <span class="o">=</span> <span class="n">tissue_pie_data</span><span class="p">(</span><span class="n">adata_use</span><span class="o">=</span><span class="n">adata_hiit_circ</span><span class="p">,</span> 
    <span class="n">groupby</span><span class="o">=</span><span class="s1">&#39;disease_type&#39;</span><span class="p">,</span> <span class="n">groupby_type</span><span class="o">=</span><span class="s1">&#39;Solid tumor&#39;</span><span class="p">,</span>
    <span class="n">ratioby</span><span class="o">=</span><span class="s1">&#39;expansion_size&#39;</span><span class="p">,</span> <span class="n">ratioby_type</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;2&#39;</span><span class="p">],</span>
    <span class="n">expanded</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">expansion_size_color</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;#d4dced&#39;</span><span class="p">,</span><span class="s1">&#39;#87a8d7&#39;</span><span class="p">,</span><span class="s1">&#39;#39547d&#39;</span><span class="p">,]</span>
<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">pie</span><span class="p">(</span><span class="n">circ_healthy_expansion_pie</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">radius</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="n">expansion_size_color</span><span class="p">,</span> 
       <span class="n">autopct</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%1.0f%%</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">pctdistance</span><span class="o">=</span><span class="mf">1.2</span><span class="p">,</span> <span class="n">explode</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.1</span><span class="p">),</span> <span class="n">shadow</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">startangle</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">pie</span><span class="p">(</span><span class="n">circ_inflam_expansion_pie</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">radius</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="n">expansion_size_color</span><span class="p">,</span> 
       <span class="n">autopct</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%1.0f%%</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">pctdistance</span><span class="o">=</span><span class="mf">1.2</span><span class="p">,</span> <span class="n">explode</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.1</span><span class="p">),</span> <span class="n">shadow</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">startangle</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">pie</span><span class="p">(</span><span class="n">circ_irae_expansion_pie</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">radius</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="n">expansion_size_color</span><span class="p">,</span> 
       <span class="n">autopct</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%1.0f%%</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">pctdistance</span><span class="o">=</span><span class="mf">1.2</span><span class="p">,</span> <span class="n">explode</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.1</span><span class="p">),</span> <span class="n">shadow</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">startangle</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">pie</span><span class="p">(</span><span class="n">circ_stumor_expansion_pie</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">radius</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="n">expansion_size_color</span><span class="p">,</span> 
       <span class="n">autopct</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%1.0f%%</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">pctdistance</span><span class="o">=</span><span class="mf">1.2</span><span class="p">,</span> <span class="n">explode</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.1</span><span class="p">),</span> <span class="n">shadow</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">startangle</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;./figures/circ_expansion_pie.pdf&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/GEXCD8_145_0.png" src="_images/GEXCD8_145_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Disease-subtype Pie Charts</span>
<span class="n">circ_healthy_pie</span> <span class="o">=</span> <span class="n">tissue_pie_data</span><span class="p">(</span><span class="n">adata_use</span><span class="o">=</span><span class="n">adata_hiit_circ</span><span class="p">,</span> 
    <span class="n">groupby</span><span class="o">=</span><span class="s1">&#39;disease_type&#39;</span><span class="p">,</span> <span class="n">groupby_type</span><span class="o">=</span><span class="s1">&#39;Healthy&#39;</span><span class="p">,</span>
    <span class="n">ratioby</span><span class="o">=</span><span class="s1">&#39;cell_subtype&#39;</span><span class="p">,</span> <span class="n">ratioby_type</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Tcm&#39;</span><span class="p">,</span> <span class="s1">&#39;Early Tcm/Tem&#39;</span><span class="p">,</span> <span class="s1">&#39;GZMK+ Tem&#39;</span><span class="p">,</span> <span class="s1">&#39;KLRG1+ Temra&#39;</span><span class="p">],</span>
    <span class="n">expanded</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">circ_inflam_pie</span> <span class="o">=</span> <span class="n">tissue_pie_data</span><span class="p">(</span><span class="n">adata_use</span><span class="o">=</span><span class="n">adata_hiit_circ</span><span class="p">,</span> 
    <span class="n">groupby</span><span class="o">=</span><span class="s1">&#39;disease_type&#39;</span><span class="p">,</span> <span class="n">groupby_type</span><span class="o">=</span><span class="s1">&#39;Inflammation&#39;</span><span class="p">,</span>
    <span class="n">ratioby</span><span class="o">=</span><span class="s1">&#39;cell_subtype&#39;</span><span class="p">,</span> <span class="n">ratioby_type</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Tcm&#39;</span><span class="p">,</span> <span class="s1">&#39;Early Tcm/Tem&#39;</span><span class="p">,</span> <span class="s1">&#39;GZMK+ Tem&#39;</span><span class="p">,</span> <span class="s1">&#39;KLRG1+ Temra&#39;</span><span class="p">],</span>
    <span class="n">expanded</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">circ_irae_pie</span> <span class="o">=</span> <span class="n">tissue_pie_data</span><span class="p">(</span><span class="n">adata_use</span><span class="o">=</span><span class="n">adata_hiit_circ</span><span class="p">,</span> 
    <span class="n">groupby</span><span class="o">=</span><span class="s1">&#39;disease_type&#39;</span><span class="p">,</span> <span class="n">groupby_type</span><span class="o">=</span><span class="s1">&#39;Inflammation-irAE&#39;</span><span class="p">,</span>
    <span class="n">ratioby</span><span class="o">=</span><span class="s1">&#39;cell_subtype&#39;</span><span class="p">,</span> <span class="n">ratioby_type</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Tcm&#39;</span><span class="p">,</span> <span class="s1">&#39;Early Tcm/Tem&#39;</span><span class="p">,</span> <span class="s1">&#39;GZMK+ Tem&#39;</span><span class="p">,</span> <span class="s1">&#39;KLRG1+ Temra&#39;</span><span class="p">],</span>
    <span class="n">expanded</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">circ_stumor_pie</span> <span class="o">=</span> <span class="n">tissue_pie_data</span><span class="p">(</span><span class="n">adata_use</span><span class="o">=</span><span class="n">adata_hiit_circ</span><span class="p">,</span> 
    <span class="n">groupby</span><span class="o">=</span><span class="s1">&#39;disease_type&#39;</span><span class="p">,</span> <span class="n">groupby_type</span><span class="o">=</span><span class="s1">&#39;Solid tumor&#39;</span><span class="p">,</span>
    <span class="n">ratioby</span><span class="o">=</span><span class="s1">&#39;cell_subtype&#39;</span><span class="p">,</span> <span class="n">ratioby_type</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Tcm&#39;</span><span class="p">,</span> <span class="s1">&#39;Early Tcm/Tem&#39;</span><span class="p">,</span> <span class="s1">&#39;GZMK+ Tem&#39;</span><span class="p">,</span> <span class="s1">&#39;KLRG1+ Temra&#39;</span><span class="p">],</span>
    <span class="n">expanded</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">circ_color</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;#ffbb78&#39;</span><span class="p">,</span>
    <span class="s1">&#39;#ff7f0e&#39;</span><span class="p">,</span>
    <span class="s1">&#39;#d62728&#39;</span><span class="p">,</span>
    <span class="s1">&#39;#8c564b&#39;</span><span class="p">,</span>
    <span class="s1">&#39;#f2f2f2&#39;</span>
<span class="p">]</span>
<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">pie</span><span class="p">(</span><span class="n">circ_healthy_pie</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">radius</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="n">circ_color</span><span class="p">,</span> 
       <span class="n">autopct</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%1.0f%%</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">pctdistance</span><span class="o">=</span><span class="mf">1.2</span><span class="p">,)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">pie</span><span class="p">(</span><span class="n">circ_inflam_pie</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">radius</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="n">circ_color</span><span class="p">,</span> 
       <span class="n">autopct</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%1.0f%%</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">pctdistance</span><span class="o">=</span><span class="mf">1.2</span><span class="p">,)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">pie</span><span class="p">(</span><span class="n">circ_irae_pie</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">radius</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="n">circ_color</span><span class="p">,</span> 
       <span class="n">autopct</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%1.0f%%</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">pctdistance</span><span class="o">=</span><span class="mf">1.2</span><span class="p">,)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">pie</span><span class="p">(</span><span class="n">circ_stumor_pie</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">radius</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="n">circ_color</span><span class="p">,</span> 
       <span class="n">autopct</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%1.0f%%</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">pctdistance</span><span class="o">=</span><span class="mf">1.2</span><span class="p">,)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;./figures/circ_disease_pie.pdf&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/GEXCD8_146_0.png" src="_images/GEXCD8_146_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stats</span><span class="o">.</span><span class="n">mannwhitneyu</span><span class="p">(</span><span class="n">disease_circ_ratio</span><span class="p">[(</span><span class="n">disease_circ_ratio</span><span class="p">[</span><span class="s1">&#39;subtypes&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;KLRG1+ Temra&#39;</span><span class="p">)</span><span class="o">&amp;</span>
                                     <span class="p">(</span><span class="n">disease_circ_ratio</span><span class="p">[</span><span class="s1">&#39;disease_types&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Healthy&#39;</span><span class="p">)]</span><span class="o">.</span><span class="n">ratio</span><span class="p">,</span>
                   <span class="n">disease_circ_ratio</span><span class="p">[(</span><span class="n">disease_circ_ratio</span><span class="p">[</span><span class="s1">&#39;subtypes&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;KLRG1+ Temra&#39;</span><span class="p">)</span><span class="o">&amp;</span>
                                     <span class="p">(</span><span class="n">disease_circ_ratio</span><span class="p">[</span><span class="s1">&#39;disease_types&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Inflammation-irAE&#39;</span><span class="p">)]</span><span class="o">.</span><span class="n">ratio</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>MannwhitneyuResult(statistic=59.0, pvalue=0.030283228384646376)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stats</span><span class="o">.</span><span class="n">mannwhitneyu</span><span class="p">(</span><span class="n">disease_circ_ratio</span><span class="p">[(</span><span class="n">disease_circ_ratio</span><span class="p">[</span><span class="s1">&#39;subtypes&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Tcm/Tem&#39;</span><span class="p">)</span><span class="o">&amp;</span>
                                     <span class="p">(</span><span class="n">disease_circ_ratio</span><span class="p">[</span><span class="s1">&#39;disease_types&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Healthy&#39;</span><span class="p">)]</span><span class="o">.</span><span class="n">ratio</span><span class="p">,</span>
                   <span class="n">disease_circ_ratio</span><span class="p">[(</span><span class="n">disease_circ_ratio</span><span class="p">[</span><span class="s1">&#39;subtypes&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Tcm/Tem&#39;</span><span class="p">)</span><span class="o">&amp;</span>
                                     <span class="p">(</span><span class="n">disease_circ_ratio</span><span class="p">[</span><span class="s1">&#39;disease_types&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Inflammation-irAE&#39;</span><span class="p">)]</span><span class="o">.</span><span class="n">ratio</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>MannwhitneyuResult(statistic=81.5, pvalue=0.17361082029487696)
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="tissue">
<h3>Tissue<a class="headerlink" href="#tissue" title="Permalink to this headline">Â¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Counter</span><span class="p">(</span><span class="n">adata_hiit_tissue</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">disease_type</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Counter({&#39;Solid tumor&#39;: 65575,
         &#39;Healthy&#39;: 28292,
         &#39;Inflammation&#39;: 10399,
         &#39;Inflammation-irAE&#39;: 11990})
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">target_cells</span> <span class="o">=</span> <span class="mi">10399</span>
<span class="n">cluster_key</span> <span class="o">=</span> <span class="s1">&#39;disease_type&#39;</span>
<span class="n">adata</span> <span class="o">=</span> <span class="n">adata_hiit_tissue</span>

<span class="n">adatas</span> <span class="o">=</span> <span class="p">[</span><span class="n">adata</span><span class="p">[</span><span class="n">adata</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="n">cluster_key</span><span class="p">]</span><span class="o">==</span><span class="n">clust</span><span class="p">]</span> <span class="k">for</span> <span class="n">clust</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">adata</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="n">cluster_key</span><span class="p">])]</span>

<span class="k">for</span> <span class="n">dat</span> <span class="ow">in</span> <span class="n">adatas</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">dat</span><span class="o">.</span><span class="n">n_obs</span> <span class="o">&gt;</span> <span class="n">target_cells</span><span class="p">:</span>
         <span class="n">sc</span><span class="o">.</span><span class="n">pp</span><span class="o">.</span><span class="n">subsample</span><span class="p">(</span><span class="n">dat</span><span class="p">,</span> <span class="n">n_obs</span><span class="o">=</span><span class="n">target_cells</span><span class="p">)</span>

<span class="n">adata_downsampled</span> <span class="o">=</span> <span class="n">adatas</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="o">*</span><span class="n">adatas</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
<span class="n">adata_downsampled</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="p">[</span> <span class="s1">&#39;-&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">adata_downsampled</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">index</span> <span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">adata_nogex</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;cell_distribution&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">adata_nogex</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
    <span class="n">adata_downsampled</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span>
        <span class="p">(</span><span class="n">adata_downsampled</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;cell_subtype&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;Tm&#39;</span><span class="p">))</span> <span class="o">|</span>
        <span class="p">(</span><span class="n">adata_downsampled</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;cell_subtype&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;Trm&#39;</span><span class="p">))</span> <span class="o">|</span>
        <span class="p">(</span><span class="n">adata_downsampled</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;cell_subtype&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;Tex&#39;</span><span class="p">))</span> <span class="o">|</span>
        <span class="p">(</span><span class="n">adata_downsampled</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;cell_subtype&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;Cycling&#39;</span><span class="p">))</span>
    <span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;cell_distribution&#39;</span>
<span class="p">]</span> <span class="o">=</span> <span class="n">adata_downsampled</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;disease_type&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># SupFigures</span>
<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
<span class="n">sc</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">umap</span><span class="p">(</span><span class="n">adata_nogex</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;cell_distribution&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">na_color</span><span class="o">=</span><span class="s2">&quot;#f7f7f7&quot;</span><span class="p">,</span> 
           <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="n">disease_type_color</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;./figures/tissue_cells.png&quot;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/GEXCD8_153_0.png" src="_images/GEXCD8_153_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># MainFigure3C, stats</span>
<span class="n">adata_nogex</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;expanded_distribution&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">adata_nogex</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
    <span class="n">adata_downsampled</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span>
        <span class="p">(</span>
            <span class="p">(</span><span class="n">adata_downsampled</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;cell_subtype&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;Tm&#39;</span><span class="p">))</span> <span class="o">|</span>
            <span class="p">(</span><span class="n">adata_downsampled</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;cell_subtype&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;Trm&#39;</span><span class="p">))</span> <span class="o">|</span>
            <span class="p">(</span><span class="n">adata_downsampled</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;cell_subtype&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;Tex&#39;</span><span class="p">))</span> <span class="o">|</span>
            <span class="p">(</span><span class="n">adata_downsampled</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;cell_subtype&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;Cycling&#39;</span><span class="p">))</span>
        <span class="p">)</span> <span class="o">&amp;</span>
        <span class="p">(</span>
            <span class="p">(</span><span class="n">adata_downsampled</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;cc_aa_identity_size&#39;</span><span class="p">]</span><span class="o">&gt;=</span><span class="mi">3</span><span class="p">)</span>
        <span class="p">)</span>
    <span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;expanded_distribution&#39;</span>
<span class="p">]</span> <span class="o">=</span> <span class="n">adata_downsampled</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;disease_type&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># MainFigure3C</span>
<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
<span class="n">sc</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">umap</span><span class="p">(</span><span class="n">adata_nogex</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;expanded_distribution&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">na_color</span><span class="o">=</span><span class="s2">&quot;#f7f7f7&quot;</span><span class="p">,</span> 
           <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="n">disease_type_color</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;./figures/expanded_tissue_cells.png&quot;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/GEXCD8_155_0.png" src="_images/GEXCD8_155_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Expansion Pie Charts</span>
<span class="n">circ_healthy_expansion_pie</span> <span class="o">=</span> <span class="n">tissue_pie_data</span><span class="p">(</span><span class="n">adata_use</span><span class="o">=</span><span class="n">adata_hiit_circ</span><span class="p">,</span> 
    <span class="n">groupby</span><span class="o">=</span><span class="s1">&#39;disease_type&#39;</span><span class="p">,</span> <span class="n">groupby_type</span><span class="o">=</span><span class="s1">&#39;Healthy&#39;</span><span class="p">,</span>
    <span class="n">ratioby</span><span class="o">=</span><span class="s1">&#39;expansion_size&#39;</span><span class="p">,</span> <span class="n">ratioby_type</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;2&#39;</span><span class="p">],</span>
    <span class="n">expanded</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">circ_inflam_expansion_pie</span> <span class="o">=</span> <span class="n">tissue_pie_data</span><span class="p">(</span><span class="n">adata_use</span><span class="o">=</span><span class="n">adata_hiit_circ</span><span class="p">,</span> 
    <span class="n">groupby</span><span class="o">=</span><span class="s1">&#39;disease_type&#39;</span><span class="p">,</span> <span class="n">groupby_type</span><span class="o">=</span><span class="s1">&#39;Inflammation&#39;</span><span class="p">,</span>
    <span class="n">ratioby</span><span class="o">=</span><span class="s1">&#39;expansion_size&#39;</span><span class="p">,</span> <span class="n">ratioby_type</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;2&#39;</span><span class="p">],</span>
    <span class="n">expanded</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">circ_irae_expansion_pie</span> <span class="o">=</span> <span class="n">tissue_pie_data</span><span class="p">(</span><span class="n">adata_use</span><span class="o">=</span><span class="n">adata_hiit_circ</span><span class="p">,</span> 
    <span class="n">groupby</span><span class="o">=</span><span class="s1">&#39;disease_type&#39;</span><span class="p">,</span> <span class="n">groupby_type</span><span class="o">=</span><span class="s1">&#39;Inflammation-irAE&#39;</span><span class="p">,</span>
    <span class="n">ratioby</span><span class="o">=</span><span class="s1">&#39;expansion_size&#39;</span><span class="p">,</span> <span class="n">ratioby_type</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;2&#39;</span><span class="p">],</span>
    <span class="n">expanded</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">circ_stumor_expansion_pie</span> <span class="o">=</span> <span class="n">tissue_pie_data</span><span class="p">(</span><span class="n">adata_use</span><span class="o">=</span><span class="n">adata_hiit_circ</span><span class="p">,</span> 
    <span class="n">groupby</span><span class="o">=</span><span class="s1">&#39;disease_type&#39;</span><span class="p">,</span> <span class="n">groupby_type</span><span class="o">=</span><span class="s1">&#39;Solid tumor&#39;</span><span class="p">,</span>
    <span class="n">ratioby</span><span class="o">=</span><span class="s1">&#39;expansion_size&#39;</span><span class="p">,</span> <span class="n">ratioby_type</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;2&#39;</span><span class="p">],</span>
    <span class="n">expanded</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">expansion_size_color</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;#d4dced&#39;</span><span class="p">,</span><span class="s1">&#39;#87a8d7&#39;</span><span class="p">,</span><span class="s1">&#39;#39547d&#39;</span><span class="p">,]</span>
<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">pie</span><span class="p">(</span><span class="n">circ_healthy_expansion_pie</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">radius</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="n">expansion_size_color</span><span class="p">,</span> 
       <span class="n">autopct</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%1.0f%%</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">pctdistance</span><span class="o">=</span><span class="mf">1.2</span><span class="p">,</span> <span class="n">explode</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.1</span><span class="p">),</span> <span class="n">shadow</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">startangle</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">pie</span><span class="p">(</span><span class="n">circ_inflam_expansion_pie</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">radius</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="n">expansion_size_color</span><span class="p">,</span> 
       <span class="n">autopct</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%1.0f%%</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">pctdistance</span><span class="o">=</span><span class="mf">1.2</span><span class="p">,</span> <span class="n">explode</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.1</span><span class="p">),</span> <span class="n">shadow</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">startangle</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">pie</span><span class="p">(</span><span class="n">circ_irae_expansion_pie</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">radius</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="n">expansion_size_color</span><span class="p">,</span> 
       <span class="n">autopct</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%1.0f%%</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">pctdistance</span><span class="o">=</span><span class="mf">1.2</span><span class="p">,</span> <span class="n">explode</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.1</span><span class="p">),</span> <span class="n">shadow</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">startangle</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">pie</span><span class="p">(</span><span class="n">circ_stumor_expansion_pie</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">radius</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="n">expansion_size_color</span><span class="p">,</span> 
       <span class="n">autopct</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%1.0f%%</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">pctdistance</span><span class="o">=</span><span class="mf">1.2</span><span class="p">,</span> <span class="n">explode</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.1</span><span class="p">),</span> <span class="n">shadow</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">startangle</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;./figures/circ_expansion_pie.pdf&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">tissue_healthy_expansion_pie</span> <span class="o">=</span> <span class="n">tissue_pie_data</span><span class="p">(</span><span class="n">adata_use</span><span class="o">=</span><span class="n">adata_hiit_tissue</span><span class="p">,</span> 
    <span class="n">groupby</span><span class="o">=</span><span class="s1">&#39;disease_type&#39;</span><span class="p">,</span> <span class="n">groupby_type</span><span class="o">=</span><span class="s1">&#39;Healthy&#39;</span><span class="p">,</span>
    <span class="n">ratioby</span><span class="o">=</span><span class="s1">&#39;expansion_size&#39;</span><span class="p">,</span> <span class="n">ratioby_type</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;2&#39;</span><span class="p">],</span>
    <span class="n">expanded</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">tissue_inflam_expansion_pie</span> <span class="o">=</span> <span class="n">tissue_pie_data</span><span class="p">(</span><span class="n">adata_use</span><span class="o">=</span><span class="n">adata_hiit_tissue</span><span class="p">,</span> 
    <span class="n">groupby</span><span class="o">=</span><span class="s1">&#39;disease_type&#39;</span><span class="p">,</span> <span class="n">groupby_type</span><span class="o">=</span><span class="s1">&#39;Inflammation&#39;</span><span class="p">,</span>
    <span class="n">ratioby</span><span class="o">=</span><span class="s1">&#39;expansion_size&#39;</span><span class="p">,</span> <span class="n">ratioby_type</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;2&#39;</span><span class="p">],</span>
    <span class="n">expanded</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">tissue_irae_expansion_pie</span> <span class="o">=</span> <span class="n">tissue_pie_data</span><span class="p">(</span><span class="n">adata_use</span><span class="o">=</span><span class="n">adata_hiit_tissue</span><span class="p">,</span> 
    <span class="n">groupby</span><span class="o">=</span><span class="s1">&#39;disease_type&#39;</span><span class="p">,</span> <span class="n">groupby_type</span><span class="o">=</span><span class="s1">&#39;Inflammation-irAE&#39;</span><span class="p">,</span>
    <span class="n">ratioby</span><span class="o">=</span><span class="s1">&#39;expansion_size&#39;</span><span class="p">,</span> <span class="n">ratioby_type</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;2&#39;</span><span class="p">],</span>
    <span class="n">expanded</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">tissue_stumor_expansion_pie</span> <span class="o">=</span> <span class="n">tissue_pie_data</span><span class="p">(</span><span class="n">adata_use</span><span class="o">=</span><span class="n">adata_hiit_tissue</span><span class="p">,</span> 
    <span class="n">groupby</span><span class="o">=</span><span class="s1">&#39;disease_type&#39;</span><span class="p">,</span> <span class="n">groupby_type</span><span class="o">=</span><span class="s1">&#39;Solid tumor&#39;</span><span class="p">,</span>
    <span class="n">ratioby</span><span class="o">=</span><span class="s1">&#39;expansion_size&#39;</span><span class="p">,</span> <span class="n">ratioby_type</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;2&#39;</span><span class="p">],</span>
    <span class="n">expanded</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">expansion_size_color</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;#d4dced&#39;</span><span class="p">,</span><span class="s1">&#39;#87a8d7&#39;</span><span class="p">,</span><span class="s1">&#39;#39547d&#39;</span><span class="p">,]</span>
<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">pie</span><span class="p">(</span><span class="n">tissue_healthy_expansion_pie</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">radius</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="n">expansion_size_color</span><span class="p">,</span> 
          <span class="n">autopct</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%1.0f%%</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">pctdistance</span><span class="o">=</span><span class="mf">1.2</span><span class="p">,</span> <span class="n">explode</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.1</span><span class="p">),</span> <span class="n">shadow</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">startangle</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">pie</span><span class="p">(</span><span class="n">tissue_inflam_expansion_pie</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">radius</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="n">expansion_size_color</span><span class="p">,</span> 
          <span class="n">autopct</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%1.0f%%</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">pctdistance</span><span class="o">=</span><span class="mf">1.2</span><span class="p">,</span> <span class="n">explode</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.1</span><span class="p">),</span> <span class="n">shadow</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">startangle</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">pie</span><span class="p">(</span><span class="n">tissue_irae_expansion_pie</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">radius</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="n">expansion_size_color</span><span class="p">,</span> 
          <span class="n">autopct</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%1.0f%%</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">pctdistance</span><span class="o">=</span><span class="mf">1.2</span><span class="p">,</span> <span class="n">explode</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.1</span><span class="p">),</span> <span class="n">shadow</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">startangle</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">pie</span><span class="p">(</span><span class="n">tissue_stumor_expansion_pie</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">radius</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="n">expansion_size_color</span><span class="p">,</span> 
          <span class="n">autopct</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%1.0f%%</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">pctdistance</span><span class="o">=</span><span class="mf">1.2</span><span class="p">,</span> <span class="n">explode</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.1</span><span class="p">),</span> <span class="n">shadow</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">startangle</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;./figures/tissue_expansion_pie.pdf&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/GEXCD8_156_0.png" src="_images/GEXCD8_156_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Disease-subtype Pie Charts</span>
<span class="n">circ_healthy_expansion_pie</span> <span class="o">=</span> <span class="n">tissue_pie_data</span><span class="p">(</span><span class="n">adata_use</span><span class="o">=</span><span class="n">adata_hiit_circ</span><span class="p">,</span> 
    <span class="n">groupby</span><span class="o">=</span><span class="s1">&#39;disease_type&#39;</span><span class="p">,</span> <span class="n">groupby_type</span><span class="o">=</span><span class="s1">&#39;Healthy&#39;</span><span class="p">,</span>
    <span class="n">ratioby</span><span class="o">=</span><span class="s1">&#39;expansion_size&#39;</span><span class="p">,</span> <span class="n">ratioby_type</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;2&#39;</span><span class="p">],</span>
    <span class="n">expanded</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">circ_inflam_expansion_pie</span> <span class="o">=</span> <span class="n">tissue_pie_data</span><span class="p">(</span><span class="n">adata_use</span><span class="o">=</span><span class="n">adata_hiit_circ</span><span class="p">,</span> 
    <span class="n">groupby</span><span class="o">=</span><span class="s1">&#39;disease_type&#39;</span><span class="p">,</span> <span class="n">groupby_type</span><span class="o">=</span><span class="s1">&#39;Inflammation&#39;</span><span class="p">,</span>
    <span class="n">ratioby</span><span class="o">=</span><span class="s1">&#39;expansion_size&#39;</span><span class="p">,</span> <span class="n">ratioby_type</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;2&#39;</span><span class="p">],</span>
    <span class="n">expanded</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">circ_irae_expansion_pie</span> <span class="o">=</span> <span class="n">tissue_pie_data</span><span class="p">(</span><span class="n">adata_use</span><span class="o">=</span><span class="n">adata_hiit_circ</span><span class="p">,</span> 
    <span class="n">groupby</span><span class="o">=</span><span class="s1">&#39;disease_type&#39;</span><span class="p">,</span> <span class="n">groupby_type</span><span class="o">=</span><span class="s1">&#39;Inflammation-irAE&#39;</span><span class="p">,</span>
    <span class="n">ratioby</span><span class="o">=</span><span class="s1">&#39;expansion_size&#39;</span><span class="p">,</span> <span class="n">ratioby_type</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;2&#39;</span><span class="p">],</span>
    <span class="n">expanded</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">circ_stumor_expansion_pie</span> <span class="o">=</span> <span class="n">tissue_pie_data</span><span class="p">(</span><span class="n">adata_use</span><span class="o">=</span><span class="n">adata_hiit_circ</span><span class="p">,</span> 
    <span class="n">groupby</span><span class="o">=</span><span class="s1">&#39;disease_type&#39;</span><span class="p">,</span> <span class="n">groupby_type</span><span class="o">=</span><span class="s1">&#39;Solid tumor&#39;</span><span class="p">,</span>
    <span class="n">ratioby</span><span class="o">=</span><span class="s1">&#39;expansion_size&#39;</span><span class="p">,</span> <span class="n">ratioby_type</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;2&#39;</span><span class="p">],</span>
    <span class="n">expanded</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">expansion_size_color</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;#d4dced&#39;</span><span class="p">,</span><span class="s1">&#39;#87a8d7&#39;</span><span class="p">,</span><span class="s1">&#39;#39547d&#39;</span><span class="p">,]</span>
<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">pie</span><span class="p">(</span><span class="n">circ_healthy_expansion_pie</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">radius</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="n">expansion_size_color</span><span class="p">,</span> 
       <span class="n">autopct</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%1.0f%%</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">pctdistance</span><span class="o">=</span><span class="mf">1.2</span><span class="p">,</span> <span class="n">explode</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.1</span><span class="p">),</span> <span class="n">shadow</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">startangle</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">pie</span><span class="p">(</span><span class="n">circ_inflam_expansion_pie</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">radius</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="n">expansion_size_color</span><span class="p">,</span> 
       <span class="n">autopct</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%1.0f%%</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">pctdistance</span><span class="o">=</span><span class="mf">1.2</span><span class="p">,</span> <span class="n">explode</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.1</span><span class="p">),</span> <span class="n">shadow</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">startangle</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">pie</span><span class="p">(</span><span class="n">circ_irae_expansion_pie</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">radius</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="n">expansion_size_color</span><span class="p">,</span> 
       <span class="n">autopct</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%1.0f%%</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">pctdistance</span><span class="o">=</span><span class="mf">1.2</span><span class="p">,</span> <span class="n">explode</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.1</span><span class="p">),</span> <span class="n">shadow</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">startangle</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">pie</span><span class="p">(</span><span class="n">circ_stumor_expansion_pie</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">radius</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="n">expansion_size_color</span><span class="p">,</span> 
       <span class="n">autopct</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%1.0f%%</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">pctdistance</span><span class="o">=</span><span class="mf">1.2</span><span class="p">,</span> <span class="n">explode</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.1</span><span class="p">),</span> <span class="n">shadow</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">startangle</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;./figures/circ_expansion_pie.pdf&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">tissue_healthy_pie</span> <span class="o">=</span> <span class="n">tissue_pie_data</span><span class="p">(</span><span class="n">adata_use</span><span class="o">=</span><span class="n">adata_hiit_tissue</span><span class="p">,</span> 
    <span class="n">groupby</span><span class="o">=</span><span class="s1">&#39;disease_type&#39;</span><span class="p">,</span> <span class="n">groupby_type</span><span class="o">=</span><span class="s1">&#39;Healthy&#39;</span><span class="p">,</span>
    <span class="n">ratioby</span><span class="o">=</span><span class="s1">&#39;cell_subtype&#39;</span><span class="p">,</span> <span class="n">ratioby_type</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;ITGAE+ Trm&#39;</span><span class="p">,</span> <span class="s1">&#39;ITGB2+ Trm&#39;</span><span class="p">,</span> <span class="s1">&#39;GZMK+ Tex&#39;</span><span class="p">,</span> <span class="s1">&#39;CXCR6+ Tex&#39;</span><span class="p">,</span>
                                          <span class="s1">&#39;Cycling T&#39;</span><span class="p">],</span>
    <span class="n">expanded</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">tissue_inflam_pie</span> <span class="o">=</span> <span class="n">tissue_pie_data</span><span class="p">(</span><span class="n">adata_use</span><span class="o">=</span><span class="n">adata_hiit_tissue</span><span class="p">,</span> 
    <span class="n">groupby</span><span class="o">=</span><span class="s1">&#39;disease_type&#39;</span><span class="p">,</span> <span class="n">groupby_type</span><span class="o">=</span><span class="s1">&#39;Inflammation&#39;</span><span class="p">,</span>
    <span class="n">ratioby</span><span class="o">=</span><span class="s1">&#39;cell_subtype&#39;</span><span class="p">,</span> <span class="n">ratioby_type</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;ITGAE+ Trm&#39;</span><span class="p">,</span> <span class="s1">&#39;ITGB2+ Trm&#39;</span><span class="p">,</span> <span class="s1">&#39;GZMK+ Tex&#39;</span><span class="p">,</span> <span class="s1">&#39;CXCR6+ Tex&#39;</span><span class="p">,</span>
                                          <span class="s1">&#39;Cycling T&#39;</span><span class="p">],</span>
    <span class="n">expanded</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">tissue_irae_pie</span> <span class="o">=</span> <span class="n">tissue_pie_data</span><span class="p">(</span><span class="n">adata_use</span><span class="o">=</span><span class="n">adata_hiit_tissue</span><span class="p">,</span> 
    <span class="n">groupby</span><span class="o">=</span><span class="s1">&#39;disease_type&#39;</span><span class="p">,</span> <span class="n">groupby_type</span><span class="o">=</span><span class="s1">&#39;Inflammation-irAE&#39;</span><span class="p">,</span>
    <span class="n">ratioby</span><span class="o">=</span><span class="s1">&#39;cell_subtype&#39;</span><span class="p">,</span> <span class="n">ratioby_type</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;ITGAE+ Trm&#39;</span><span class="p">,</span> <span class="s1">&#39;ITGB2+ Trm&#39;</span><span class="p">,</span> <span class="s1">&#39;GZMK+ Tex&#39;</span><span class="p">,</span> <span class="s1">&#39;CXCR6+ Tex&#39;</span><span class="p">,</span>
                                          <span class="s1">&#39;Cycling T&#39;</span><span class="p">],</span>
    <span class="n">expanded</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">tissue_stumor_pie</span> <span class="o">=</span> <span class="n">tissue_pie_data</span><span class="p">(</span><span class="n">adata_use</span><span class="o">=</span><span class="n">adata_hiit_tissue</span><span class="p">,</span> 
    <span class="n">groupby</span><span class="o">=</span><span class="s1">&#39;disease_type&#39;</span><span class="p">,</span> <span class="n">groupby_type</span><span class="o">=</span><span class="s1">&#39;Solid tumor&#39;</span><span class="p">,</span>
    <span class="n">ratioby</span><span class="o">=</span><span class="s1">&#39;cell_subtype&#39;</span><span class="p">,</span> <span class="n">ratioby_type</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;ITGAE+ Trm&#39;</span><span class="p">,</span> <span class="s1">&#39;ITGB2+ Trm&#39;</span><span class="p">,</span> <span class="s1">&#39;GZMK+ Tex&#39;</span><span class="p">,</span> <span class="s1">&#39;CXCR6+ Tex&#39;</span><span class="p">,</span>
                                          <span class="s1">&#39;Cycling T&#39;</span><span class="p">],</span>
    <span class="n">expanded</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
<span class="n">tissue_color</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;#279e68&#39;</span><span class="p">,</span><span class="s1">&#39;#98df8a&#39;</span><span class="p">,</span><span class="s1">&#39;#c5b0d5&#39;</span><span class="p">,</span><span class="s1">&#39;#c49c94&#39;</span><span class="p">,</span><span class="s1">&#39;#f7b6d2&#39;</span><span class="p">,</span><span class="s1">&#39;#f2f2f2&#39;</span><span class="p">]</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">pie</span><span class="p">(</span><span class="n">tissue_healthy_pie</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">radius</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="n">tissue_color</span><span class="p">,</span>
          <span class="n">autopct</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%1.0f%%</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">pctdistance</span><span class="o">=</span><span class="mf">1.2</span><span class="p">,)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">pie</span><span class="p">(</span><span class="n">tissue_inflam_pie</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">radius</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="n">tissue_color</span><span class="p">,</span>
          <span class="n">autopct</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%1.0f%%</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">pctdistance</span><span class="o">=</span><span class="mf">1.2</span><span class="p">,)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">pie</span><span class="p">(</span><span class="n">tissue_irae_pie</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">radius</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="n">tissue_color</span><span class="p">,</span>
          <span class="n">autopct</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%1.0f%%</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">pctdistance</span><span class="o">=</span><span class="mf">1.2</span><span class="p">,)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">pie</span><span class="p">(</span><span class="n">tissue_stumor_pie</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">radius</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="n">tissue_color</span><span class="p">,</span>
          <span class="n">autopct</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%1.0f%%</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">pctdistance</span><span class="o">=</span><span class="mf">1.2</span><span class="p">,)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;./figures/tissue_disease_pie.pdf&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/GEXCD8_157_0.png" src="_images/GEXCD8_157_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># SupFigures</span>
<span class="n">disease_types_compare</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Healthy&#39;</span><span class="p">,</span> <span class="s1">&#39;Inflammation&#39;</span><span class="p">,</span> <span class="s1">&#39;Inflammation-irAE&#39;</span><span class="p">,</span> <span class="s1">&#39;Solid tumor&#39;</span><span class="p">]</span>
<span class="n">tissue_subtypes</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;ITGAE+ Trm&#39;</span><span class="p">,</span> <span class="s1">&#39;ITGB2+ Trm&#39;</span><span class="p">,</span> <span class="s1">&#39;GZMK+ Tex&#39;</span><span class="p">,</span> <span class="s1">&#39;CXCR6+ Tex&#39;</span><span class="p">,</span> <span class="s1">&#39;Cycling T&#39;</span><span class="p">]</span>
<span class="n">disease_tissue_ratio</span> <span class="o">=</span> <span class="n">cell_ratio</span><span class="p">(</span><span class="n">adata</span><span class="o">=</span><span class="n">adata_hiit_tissue</span><span class="p">,</span> 
                                  <span class="n">groupby</span><span class="o">=</span><span class="s1">&#39;disease_type&#39;</span><span class="p">,</span>
                                  <span class="n">groups</span><span class="o">=</span><span class="n">disease_types_compare</span><span class="p">,</span>
                                  <span class="n">subtypes</span><span class="o">=</span><span class="n">tissue_subtypes</span><span class="p">,</span> <span class="n">expanded</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">total</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Counter</span><span class="p">(</span><span class="n">disease_tissue_ratio</span><span class="p">[</span><span class="n">disease_tissue_ratio</span><span class="p">[</span><span class="s1">&#39;subtypes&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;ITGAE+ Trm&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">disease_types</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Counter({&#39;Healthy&#39;: 24,
         &#39;Inflammation&#39;: 10,
         &#39;Inflammation-irAE&#39;: 8,
         &#39;Solid tumor&#39;: 39})
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sep_multi_boxplot</span><span class="p">(</span><span class="n">disease_tissue_ratio</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="s1">&#39;./figures/expanded_tissue_ratio.pdf&#39;</span><span class="p">,</span>
                  <span class="n">xaxis</span><span class="o">=</span><span class="s1">&#39;subtypes&#39;</span><span class="p">,</span> <span class="n">yaxis</span><span class="o">=</span><span class="s1">&#39;ratio&#39;</span><span class="p">,</span> <span class="n">hueaxis</span><span class="o">=</span><span class="s1">&#39;disease_types&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/GEXCD8_160_0.png" src="_images/GEXCD8_160_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stats</span><span class="o">.</span><span class="n">mannwhitneyu</span><span class="p">(</span><span class="n">disease_tissue_ratio</span><span class="p">[</span>
    <span class="p">(</span><span class="n">disease_tissue_ratio</span><span class="p">[</span><span class="s1">&#39;subtypes&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;CXCR6+ Tex&#39;</span><span class="p">)</span><span class="o">&amp;</span>
    <span class="p">(</span><span class="n">disease_tissue_ratio</span><span class="p">[</span><span class="s1">&#39;disease_types&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Healthy&#39;</span><span class="p">)]</span><span class="o">.</span><span class="n">ratio</span><span class="p">,</span>
                  <span class="n">disease_tissue_ratio</span><span class="p">[</span>
    <span class="p">(</span><span class="n">disease_tissue_ratio</span><span class="p">[</span><span class="s1">&#39;subtypes&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;CXCR6+ Tex&#39;</span><span class="p">)</span><span class="o">&amp;</span>
    <span class="p">(</span><span class="n">disease_tissue_ratio</span><span class="p">[</span><span class="s1">&#39;disease_types&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Solid tumor&#39;</span><span class="p">)]</span><span class="o">.</span><span class="n">ratio</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>MannwhitneyuResult(statistic=136.0, pvalue=2.6656853492824358e-06)
</pre></div>
</div>
</div>
</div>
<div class="section" id="gzmktexvsitgb2trm">
<h4>GZMKTexvsITGB2Trm<a class="headerlink" href="#gzmktexvsitgb2trm" title="Permalink to this headline">Â¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">adata_irae_inflam</span> <span class="o">=</span> <span class="n">adata_hiit_tissue</span><span class="p">[</span><span class="n">adata_hiit_tissue</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;disease_type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;Inflammation&#39;</span><span class="p">)]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># list contains: deg_tex,deg_tex_up,deg_tex_dw,enr_tex_up,enr_tex_dw </span>
<span class="n">tex_trm_list</span> <span class="o">=</span> <span class="n">DEG_analysis</span><span class="p">(</span><span class="n">adata_irae_inflam</span><span class="p">,</span> <span class="n">groupby</span><span class="o">=</span><span class="s1">&#39;cell_subtype&#39;</span><span class="p">,</span>
                            <span class="n">query_subtype</span><span class="o">=</span><span class="s1">&#39;GZMK+ Tex&#39;</span><span class="p">,</span><span class="n">reference_subtype</span><span class="o">=</span><span class="s1">&#39;ITGB2+ Trm&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">volcanoPlot</span><span class="p">(</span><span class="n">tex_trm_list</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">file_name</span><span class="o">=</span><span class="s1">&#39;./figures/GZMK_ITGB_volcano.png&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>          x      y    group
0  3.026784  320.0  tab:red
1  3.208594  320.0  tab:red
2  2.476667  320.0  tab:red
3  3.839227  320.0  tab:red
4  2.914159  320.0  tab:red
</pre></div>
</div>
<img alt="_images/GEXCD8_165_1.png" src="_images/GEXCD8_165_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tex_trm_list</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">res2d</span><span class="o">.</span><span class="n">Term</span> <span class="o">=</span> <span class="n">tex_trm_list</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">res2d</span><span class="o">.</span><span class="n">Term</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; \(GO&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="c1"># dotplot</span>
<span class="n">gseapy</span><span class="o">.</span><span class="n">dotplot</span><span class="p">(</span><span class="n">tex_trm_list</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">res2d</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">top_term</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Up&quot;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Reds&#39;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;./figures/gzmk_itgb_go_up.pdf&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/GEXCD8_166_0.png" src="_images/GEXCD8_166_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tex_trm_list</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">res2d</span><span class="o">.</span><span class="n">Term</span> <span class="o">=</span> <span class="n">tex_trm_list</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">res2d</span><span class="o">.</span><span class="n">Term</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; \(GO&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="c1"># dotplot</span>
<span class="n">gseapy</span><span class="o">.</span><span class="n">dotplot</span><span class="p">(</span><span class="n">tex_trm_list</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">res2d</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">top_term</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Down&quot;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;./figures/gzmk_itgb_go_dw.pdf&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/GEXCD8_167_0.png" src="_images/GEXCD8_167_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tex_trm_list</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">res2d</span><span class="p">[</span><span class="n">tex_trm_list</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">res2d</span><span class="p">[</span><span class="s1">&#39;Adjusted P-value&#39;</span><span class="p">]</span><span class="o">&lt;</span><span class="mf">0.05</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Gene_set</th>
      <th>Term</th>
      <th>Overlap</th>
      <th>P-value</th>
      <th>Adjusted P-value</th>
      <th>Old P-value</th>
      <th>Old Adjusted P-value</th>
      <th>Odds Ratio</th>
      <th>Combined Score</th>
      <th>Genes</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>GO_Biological_Process_2021</td>
      <td>mitochondrial ATP synthesis coupled electron t...</td>
      <td>36/71</td>
      <td>1.077423e-14</td>
      <td>5.181329e-11</td>
      <td>0</td>
      <td>0</td>
      <td>7.144634</td>
      <td>229.783006</td>
      <td>COX7B;NDUFA13;NDUFB8;NDUFA11;UQCRB;NDUFA12;COX...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>GO_Biological_Process_2021</td>
      <td>aerobic electron transport chain</td>
      <td>35/70</td>
      <td>4.358576e-14</td>
      <td>1.048020e-10</td>
      <td>0</td>
      <td>0</td>
      <td>6.943404</td>
      <td>213.607192</td>
      <td>COX7B;NDUFA13;NDUFB8;NDUFA11;UQCRB;NDUFA12;COX...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>GO_Biological_Process_2021</td>
      <td>cytokine-mediated signaling pathway</td>
      <td>142/621</td>
      <td>1.009247e-12</td>
      <td>1.617823e-09</td>
      <td>0</td>
      <td>0</td>
      <td>2.095274</td>
      <td>57.875267</td>
      <td>CD86;CSF2;CSF1;TRAF3IP2;IRS1;IL23R;PITPNA;RORC...</td>
    </tr>
    <tr>
      <th>3</th>
      <td>GO_Biological_Process_2021</td>
      <td>tumor necrosis factor-mediated signaling pathway</td>
      <td>39/116</td>
      <td>4.659946e-09</td>
      <td>5.602420e-06</td>
      <td>0</td>
      <td>0</td>
      <td>3.513912</td>
      <td>67.411817</td>
      <td>PSMD10;PSMB10;TXNDC17;TNFSF13B;PYCARD;PSMD9;PS...</td>
    </tr>
    <tr>
      <th>4</th>
      <td>GO_Biological_Process_2021</td>
      <td>mitochondrial translation</td>
      <td>36/105</td>
      <td>1.001836e-08</td>
      <td>9.635658e-06</td>
      <td>0</td>
      <td>0</td>
      <td>3.617017</td>
      <td>66.621278</td>
      <td>MRPS17;GFM2;MRPS14;MRPS36;MRPS12;MRPL38;MRPL39...</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>109</th>
      <td>GO_Biological_Process_2021</td>
      <td>regulation of apoptotic process</td>
      <td>123/742</td>
      <td>1.124800e-03</td>
      <td>4.917419e-02</td>
      <td>0</td>
      <td>0</td>
      <td>1.381925</td>
      <td>9.383477</td>
      <td>MRE11;ARL6IP1;PDCD5;CCAR2;IFIT3;PYCARD;RPS6KA3...</td>
    </tr>
    <tr>
      <th>110</th>
      <td>GO_Biological_Process_2021</td>
      <td>positive regulation of T cell proliferation</td>
      <td>18/66</td>
      <td>1.154038e-03</td>
      <td>4.950214e-02</td>
      <td>0</td>
      <td>0</td>
      <td>2.584323</td>
      <td>17.481623</td>
      <td>CD86;CD70;IL23R;HMGB1;PDCD1LG2;AIF1;IL27RA;PYC...</td>
    </tr>
    <tr>
      <th>111</th>
      <td>GO_Biological_Process_2021</td>
      <td>caveolin-mediated endocytosis</td>
      <td>4/5</td>
      <td>1.173476e-03</td>
      <td>4.950214e-02</td>
      <td>0</td>
      <td>0</td>
      <td>27.488189</td>
      <td>185.484399</td>
      <td>CAV1;MAPK1;MLC1;MAPK3</td>
    </tr>
    <tr>
      <th>112</th>
      <td>GO_Biological_Process_2021</td>
      <td>CD4-positive, alpha-beta T cell activation</td>
      <td>4/5</td>
      <td>1.173476e-03</td>
      <td>4.950214e-02</td>
      <td>0</td>
      <td>0</td>
      <td>27.488189</td>
      <td>185.484399</td>
      <td>STOML2;RSAD2;TNFSF4;HMGB1</td>
    </tr>
    <tr>
      <th>113</th>
      <td>GO_Biological_Process_2021</td>
      <td>positive regulation of dendritic cell differen...</td>
      <td>4/5</td>
      <td>1.173476e-03</td>
      <td>4.950214e-02</td>
      <td>0</td>
      <td>0</td>
      <td>27.488189</td>
      <td>185.484399</td>
      <td>LGALS3;LGALS1;HMGB1;LGALS9</td>
    </tr>
  </tbody>
</table>
<p>114 rows Ã 10 columns</p>
</div></div></div>
</div>
</div>
</div>
</div>
<div class="section" id="clonotyperelated">
<h2>ClonotypeRelated<a class="headerlink" href="#clonotyperelated" title="Permalink to this headline">Â¶</a></h2>
<div class="section" id="id6">
<h3>Functions<a class="headerlink" href="#id6" title="Permalink to this headline">Â¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">expansion_ratio</span><span class="p">(</span><span class="n">df_list</span><span class="p">,</span> <span class="n">df_name_list</span><span class="p">,</span> <span class="n">subtype_list</span><span class="p">,</span> <span class="n">total</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    
    <span class="k">def</span> <span class="nf">condition_cell_ratio</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">subtypes</span><span class="p">):</span>

        <span class="n">x0</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([])</span>
        <span class="n">df_test</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;total&#39;</span><span class="p">]</span><span class="o">&gt;=</span><span class="mi">3</span><span class="p">]</span>
        
        <span class="k">if</span> <span class="n">total</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">Counter</span><span class="p">(</span><span class="n">df_test</span><span class="o">.</span><span class="n">individual_id</span><span class="p">))</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">Counter</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">individual_id</span><span class="p">))</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

            <span class="n">x</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;ratio&quot;</span><span class="p">:</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">]})</span>
            <span class="n">x</span><span class="p">[</span><span class="s1">&#39;sharing_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Total&#39;</span>
            <span class="n">x0</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">x0</span><span class="p">,</span> <span class="n">x</span><span class="p">])</span>
            
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">subtypes</span><span class="p">:</span>
            <span class="c1"># Expansion</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="nb">list</span><span class="p">):</span>
                <span class="n">a1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">Counter</span><span class="p">(</span><span class="n">df_test</span><span class="p">[</span><span class="n">df_test</span><span class="p">[</span><span class="s2">&quot;dominant&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">i</span><span class="p">)]</span><span class="o">.</span><span class="n">individual_id</span><span class="p">))</span>
                <span class="n">b1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">Counter</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">individual_id</span><span class="p">))</span>
                <span class="n">c1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">a1</span><span class="p">,</span><span class="n">b1</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">c1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">c1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

                <span class="n">x1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;ratio&quot;</span><span class="p">:</span><span class="n">c1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">c1</span><span class="p">[</span><span class="mi">1</span><span class="p">]})</span>
                <span class="n">x1</span><span class="p">[</span><span class="s1">&#39;sharing_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">len</span><span class="p">(</span><span class="n">x1</span><span class="p">)))</span>
                <span class="n">x0</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">x0</span><span class="p">,</span><span class="n">x1</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">a1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">Counter</span><span class="p">(</span><span class="n">df_test</span><span class="p">[</span><span class="n">df_test</span><span class="p">[</span><span class="s2">&quot;dominant&quot;</span><span class="p">]</span><span class="o">==</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">individual_id</span><span class="p">))</span>
                <span class="n">b1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">Counter</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">individual_id</span><span class="p">))</span>
                <span class="n">c1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">a1</span><span class="p">,</span><span class="n">b1</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">c1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">c1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

                <span class="n">x1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;ratio&quot;</span><span class="p">:</span><span class="n">c1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">c1</span><span class="p">[</span><span class="mi">1</span><span class="p">]})</span>
                <span class="n">x1</span><span class="p">[</span><span class="s1">&#39;sharing_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">x1</span><span class="p">)))</span>
                <span class="n">x0</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">x0</span><span class="p">,</span><span class="n">x1</span><span class="p">])</span>
            
        <span class="k">return</span> <span class="n">x0</span>
    
    <span class="n">expansion_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([])</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">df_list</span><span class="p">,</span> <span class="n">df_name_list</span><span class="p">):</span>
        <span class="n">expansion_condition</span> <span class="o">=</span> <span class="n">condition_cell_ratio</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">subtypes</span><span class="o">=</span><span class="n">subtype_list</span><span class="p">)</span>
        <span class="n">expansion_condition</span><span class="p">[</span><span class="s1">&#39;condition&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">expansion_condition</span><span class="p">)))</span>
        <span class="n">expansion_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">expansion_df</span><span class="p">,</span> <span class="n">expansion_condition</span><span class="p">])</span>
    
    <span class="k">return</span> <span class="n">expansion_df</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="id7">
<h3>Circulating<a class="headerlink" href="#id7" title="Permalink to this headline">Â¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">clone_hiit_circ</span> <span class="o">=</span> <span class="n">clone_df_generate</span><span class="p">(</span><span class="n">adata_hiit_circ</span><span class="p">)</span>
<span class="n">clone_hiit_circ_healthy</span> <span class="o">=</span> <span class="n">clone_hiit_circ</span><span class="p">[</span><span class="n">clone_hiit_circ</span><span class="p">[</span><span class="s1">&#39;disease_type&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Healthy&#39;</span><span class="p">]</span>
<span class="n">clone_hiit_circ_inflam</span> <span class="o">=</span> <span class="n">clone_hiit_circ</span><span class="p">[</span><span class="n">clone_hiit_circ</span><span class="p">[</span><span class="s1">&#39;disease_type&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Inflammation&#39;</span><span class="p">]</span>
<span class="n">clone_hiit_circ_irae</span> <span class="o">=</span> <span class="n">clone_hiit_circ</span><span class="p">[</span><span class="n">clone_hiit_circ</span><span class="p">[</span><span class="s1">&#39;disease_type&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Inflammation-irAE&#39;</span><span class="p">]</span>
<span class="n">clone_hiit_circ_stumor</span> <span class="o">=</span> <span class="n">clone_hiit_circ</span><span class="p">[</span><span class="n">clone_hiit_circ</span><span class="p">[</span><span class="s1">&#39;disease&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;TN_tumor&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">circ_subtypes</span><span class="o">=</span><span class="p">[[</span><span class="s1">&#39;Tcm&#39;</span><span class="p">,</span> <span class="s1">&#39;Early Tcm/Tem&#39;</span><span class="p">,</span> <span class="s1">&#39;GZMK+ Tem&#39;</span><span class="p">,</span> <span class="s1">&#39;CREM+ Tm&#39;</span><span class="p">],</span> <span class="s1">&#39;KLRG1+ Temra&#39;</span><span class="p">]</span>
<span class="n">HI_expansion_circ</span> <span class="o">=</span> <span class="n">expansion_ratio</span><span class="p">(</span><span class="n">df_list</span><span class="o">=</span><span class="p">[</span><span class="n">clone_hiit_circ_healthy</span><span class="p">,</span><span class="n">clone_hiit_circ_inflam</span><span class="p">,</span>
                                             <span class="n">clone_hiit_circ_irae</span><span class="p">,</span><span class="n">clone_hiit_circ_stumor</span><span class="p">],</span>
                                    <span class="n">df_name_list</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Healthy&#39;</span><span class="p">,</span> <span class="s1">&#39;Inflammation&#39;</span><span class="p">,</span> <span class="s1">&#39;irAE&#39;</span><span class="p">,</span> <span class="s1">&#39;TN_tumor&#39;</span><span class="p">],</span>
                                    <span class="n">subtype_list</span><span class="o">=</span><span class="n">circ_subtypes</span><span class="p">)</span>
<span class="n">HI_expansion_circ</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ratio</th>
      <th>sharing_type</th>
      <th>condition</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>HD4</th>
      <td>0.029107</td>
      <td>Total</td>
      <td>Healthy</td>
    </tr>
    <tr>
      <th>p7_HD</th>
      <td>0.028078</td>
      <td>Total</td>
      <td>Healthy</td>
    </tr>
    <tr>
      <th>C17</th>
      <td>0.042781</td>
      <td>Total</td>
      <td>Healthy</td>
    </tr>
    <tr>
      <th>HC1</th>
      <td>0.038657</td>
      <td>Total</td>
      <td>Healthy</td>
    </tr>
    <tr>
      <th>C16</th>
      <td>0.039367</td>
      <td>Total</td>
      <td>Healthy</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>NPC_SC_1811</th>
      <td>0.012413</td>
      <td>KLRG1+ Temra</td>
      <td>TN_tumor</td>
    </tr>
    <tr>
      <th>GU0744</th>
      <td>0.059406</td>
      <td>KLRG1+ Temra</td>
      <td>TN_tumor</td>
    </tr>
    <tr>
      <th>NPC_SC_1805</th>
      <td>0.024096</td>
      <td>KLRG1+ Temra</td>
      <td>TN_tumor</td>
    </tr>
    <tr>
      <th>GU0715</th>
      <td>0.065476</td>
      <td>KLRG1+ Temra</td>
      <td>TN_tumor</td>
    </tr>
    <tr>
      <th>NPC_SC_1816</th>
      <td>0.079082</td>
      <td>KLRG1+ Temra</td>
      <td>TN_tumor</td>
    </tr>
  </tbody>
</table>
<p>174 rows Ã 3 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Counter</span><span class="p">(</span><span class="n">HI_expansion_circ</span><span class="p">[</span><span class="n">HI_expansion_circ</span><span class="p">[</span><span class="s1">&#39;sharing_type&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Tcm&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">condition</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Counter({&#39;Healthy&#39;: 30, &#39;Inflammation&#39;: 7, &#39;irAE&#39;: 8, &#39;TN_tumor&#39;: 13})
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Figure3B</span>
<span class="n">sep_multi_boxplot</span><span class="p">(</span><span class="n">HI_expansion_circ</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="s1">&#39;./figures/expansion_circ.pdf&#39;</span><span class="p">,</span>
                  <span class="n">xaxis</span><span class="o">=</span><span class="s1">&#39;sharing_type&#39;</span><span class="p">,</span> <span class="n">yaxis</span><span class="o">=</span><span class="s1">&#39;ratio&#39;</span><span class="p">,</span> <span class="n">hueaxis</span><span class="o">=</span><span class="s1">&#39;condition&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/GEXCD8_176_0.png" src="_images/GEXCD8_176_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stats</span><span class="o">.</span><span class="n">mannwhitneyu</span><span class="p">(</span><span class="n">HI_expansion_circ</span><span class="p">[(</span><span class="n">HI_expansion_circ</span><span class="p">[</span><span class="s1">&#39;sharing_type&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Total&#39;</span><span class="p">)</span> <span class="o">&amp;</span>
                                    <span class="p">(</span><span class="n">HI_expansion_circ</span><span class="p">[</span><span class="s1">&#39;condition&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Healthy&#39;</span><span class="p">)]</span><span class="o">.</span><span class="n">ratio</span><span class="p">,</span>
                  <span class="n">HI_expansion_circ</span><span class="p">[(</span><span class="n">HI_expansion_circ</span><span class="p">[</span><span class="s1">&#39;sharing_type&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Total&#39;</span><span class="p">)</span> <span class="o">&amp;</span>
                                    <span class="p">(</span><span class="n">HI_expansion_circ</span><span class="p">[</span><span class="s1">&#39;condition&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;irAE&#39;</span><span class="p">)]</span><span class="o">.</span><span class="n">ratio</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>MannwhitneyuResult(statistic=70.0, pvalue=0.07604254518266304)
</pre></div>
</div>
</div>
</div>
<div class="section" id="iltckrelatedanalysis">
<h4>ILTCKrelatedAnalysis<a class="headerlink" href="#iltckrelatedanalysis" title="Permalink to this headline">Â¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># filter cell number too low</span>
<span class="n">larger_id</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="ow">in</span> <span class="n">Counter</span><span class="p">(</span><span class="n">adata_circ_nokid</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">individual_id</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">y</span><span class="o">&gt;</span><span class="mi">100</span><span class="p">]</span>
<span class="n">adata_circ_nokid_mod</span> <span class="o">=</span> <span class="n">adata_circ_nokid</span><span class="p">[</span><span class="n">adata_circ_nokid</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;individual_id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">larger_id</span><span class="p">)]</span>
<span class="n">iltck_ratio</span> <span class="o">=</span> <span class="n">cell_ratio</span><span class="p">(</span><span class="n">adata</span><span class="o">=</span><span class="n">adata_circ_nokid_mod</span><span class="p">,</span>
                         <span class="n">groupby</span><span class="o">=</span><span class="s1">&#39;disease_type&#39;</span><span class="p">,</span>
                         <span class="n">groups</span><span class="o">=</span><span class="n">disease_types</span><span class="p">,</span>
                         <span class="n">subtypeby</span><span class="o">=</span><span class="s1">&#39;cell_subtype&#39;</span><span class="p">,</span>
                         <span class="n">subtypes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;ILTCK&#39;</span><span class="p">],</span> <span class="n">expanded</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">total</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">iltck_expansion_ratio</span> <span class="o">=</span> <span class="n">cell_ratio</span><span class="p">(</span><span class="n">adata</span><span class="o">=</span><span class="n">adata_circ_nokid_mod</span><span class="p">,</span>
                                   <span class="n">groupby</span><span class="o">=</span><span class="s1">&#39;disease_type&#39;</span><span class="p">,</span>
                                   <span class="n">groups</span><span class="o">=</span><span class="n">disease_types</span><span class="p">,</span>
                                   <span class="n">subtypeby</span><span class="o">=</span><span class="s1">&#39;cell_subtype&#39;</span><span class="p">,</span>
                                   <span class="n">subtypes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;ILTCK&#39;</span><span class="p">],</span> <span class="n">expanded</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">total</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">multi_boxplot</span><span class="p">(</span><span class="n">iltck_expansion_ratio</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="s1">&#39;./figures/iltck_expansion_ratio.pdf&#39;</span><span class="p">,</span>
              <span class="n">xaxis</span><span class="o">=</span><span class="s1">&#39;disease_types&#39;</span><span class="p">,</span> <span class="n">yaxis</span><span class="o">=</span><span class="s1">&#39;ratio&#39;</span><span class="p">,</span> <span class="n">hueaxis</span><span class="o">=</span><span class="s1">&#39;subtypes&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/GEXCD8_180_0.png" src="_images/GEXCD8_180_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Counter</span><span class="p">(</span><span class="n">iltck_expansion_ratio</span><span class="p">[</span><span class="n">iltck_expansion_ratio</span><span class="p">[</span><span class="s1">&#39;subtypes&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;ILTCK&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">disease_types</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Counter({&#39;Healthy&#39;: 30,
         &#39;COVID-19&#39;: 58,
         &#39;Inflammation&#39;: 7,
         &#39;Inflammation-irAE&#39;: 8,
         &#39;Solid tumor&#39;: 17,
         &#39;AML&#39;: 8,
         &#39;T-LGLL&#39;: 12})
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stats</span><span class="o">.</span><span class="n">mannwhitneyu</span><span class="p">(</span><span class="n">iltck_ratio</span><span class="p">[(</span><span class="n">iltck_ratio</span><span class="p">[</span><span class="s1">&#39;subtypes&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;ILTCK&#39;</span><span class="p">)</span> <span class="o">&amp;</span>
                                <span class="p">(</span><span class="n">iltck_ratio</span><span class="p">[</span><span class="s1">&#39;disease_types&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Healthy&#39;</span><span class="p">)]</span><span class="o">.</span><span class="n">ratio</span><span class="p">,</span>
                  <span class="n">iltck_ratio</span><span class="p">[(</span><span class="n">iltck_ratio</span><span class="p">[</span><span class="s1">&#39;subtypes&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;ILTCK&#39;</span><span class="p">)</span> <span class="o">&amp;</span>
                                <span class="p">(</span><span class="n">iltck_ratio</span><span class="p">[</span><span class="s1">&#39;disease_types&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Inflammation&#39;</span><span class="p">)]</span><span class="o">.</span><span class="n">ratio</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>MannwhitneyuResult(statistic=31.0, pvalue=0.004366747815881364)
</pre></div>
</div>
</div>
</div>
<div class="section" id="expansionanalysis">
<h5>ExpansionAnalysis<a class="headerlink" href="#expansionanalysis" title="Permalink to this headline">Â¶</a></h5>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">adata_iltck</span> <span class="o">=</span> <span class="n">adata_nogex</span><span class="p">[</span><span class="n">adata_nogex</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;cell_subtype&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;ILTCK&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Supfigure1BL</span>
<span class="n">expansion_level_color</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;a&#39;</span><span class="p">:</span><span class="s1">&#39;#d4dced&#39;</span><span class="p">,</span>
    <span class="s1">&#39;b&#39;</span><span class="p">:</span><span class="s1">&#39;#afc4e6&#39;</span><span class="p">,</span>
    <span class="s1">&#39;c&#39;</span><span class="p">:</span><span class="s1">&#39;#87a8d7&#39;</span><span class="p">,</span>
    <span class="s1">&#39;d&#39;</span><span class="p">:</span><span class="s1">&#39;#5e88c0&#39;</span><span class="p">,</span>
    <span class="s1">&#39;e&#39;</span><span class="p">:</span><span class="s1">&#39;#39547d&#39;</span><span class="p">,</span>
<span class="p">}</span>
<span class="n">stacked_bar</span><span class="p">(</span><span class="n">adata</span><span class="o">=</span><span class="n">adata_iltck</span><span class="p">,</span> <span class="n">percentage</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">xitems</span><span class="o">=</span><span class="n">disease_types</span><span class="p">,</span> <span class="n">xitem_str</span><span class="o">=</span><span class="s2">&quot;disease_type&quot;</span><span class="p">,</span> 
            <span class="n">yitems</span><span class="o">=</span><span class="n">expansion_levels</span><span class="p">,</span> <span class="n">yitem_str</span><span class="o">=</span><span class="s2">&quot;expansion_level&quot;</span><span class="p">,</span> <span class="n">yitem_color</span><span class="o">=</span><span class="n">expansion_level_color</span><span class="p">,</span> 
            <span class="n">file_name</span><span class="o">=</span><span class="s2">&quot;./figures/iltck2disease.pdf&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/GEXCD8_185_0.png" src="_images/GEXCD8_185_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">adata_nogex</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;specific_clone&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">adata_nogex</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;specific_clone_subtype&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

<span class="n">clone_id</span> <span class="o">=</span> <span class="n">clone_irae_id</span>
<span class="n">adata_nogex</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">adata_nogex</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s2">&quot;cc_aa_identity&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">clone_id</span><span class="p">),</span> 
                    <span class="s1">&#39;specific_clone&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">adata_nogex</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;cc_aa_identity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;str&#39;</span><span class="p">)</span>
<span class="n">adata_nogex</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">adata_nogex</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s2">&quot;cc_aa_identity&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">clone_id</span><span class="p">),</span> 
                    <span class="s1">&#39;specific_clone_subtype&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">adata_nogex</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;cell_subtype&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">clone_irae_id</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">clone_hiit_circ_irae</span><span class="p">[</span><span class="n">clone_hiit_circ_irae</span><span class="p">[</span><span class="s1">&#39;ILTCK&#39;</span><span class="p">]</span><span class="o">&gt;=</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
<span class="nb">len</span><span class="p">(</span><span class="n">clone_irae_id</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>17
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
<span class="n">sc</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">umap</span><span class="p">(</span><span class="n">adata_nogex</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;specific_clone&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">na_color</span><span class="o">=</span><span class="s2">&quot;#f3f3f3&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;./figures/iltck_clone.png&quot;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/GEXCD8_188_0.png" src="_images/GEXCD8_188_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
<span class="n">sc</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">umap</span><span class="p">(</span><span class="n">adata_nogex</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;specific_clone_subtype&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> 
           <span class="n">na_color</span><span class="o">=</span><span class="s2">&quot;#f3f3f3&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="n">subtype_color</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;./figrues/iltck_clone_subtype.png&quot;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/GEXCD8_189_0.png" src="_images/GEXCD8_189_0.png" />
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">FileNotFoundError</span><span class="g g-Whitespace">                         </span>Traceback (most recent call last)
<span class="n">Input</span> <span class="n">In</span> <span class="p">[</span><span class="mi">216</span><span class="p">],</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">sc</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">umap</span><span class="p">(</span><span class="n">adata_nogex</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;specific_clone_subtype&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> 
<span class="g g-Whitespace">      </span><span class="mi">3</span>            <span class="n">na_color</span><span class="o">=</span><span class="s2">&quot;#f3f3f3&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="n">subtype_color</span><span class="p">)</span>
<span class="ne">----&gt; </span><span class="mi">4</span> <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;./figrues/iltck_clone_subtype.png&quot;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span>

<span class="nn">File /usr/local/lib/python3.9/site-packages/matplotlib/figure.py:3019,</span> in <span class="ni">Figure.savefig</span><span class="nt">(self, fname, transparent, **kwargs)</span>
<span class="g g-Whitespace">   </span><span class="mi">3015</span>     <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">3016</span>         <span class="n">stack</span><span class="o">.</span><span class="n">enter_context</span><span class="p">(</span>
<span class="g g-Whitespace">   </span><span class="mi">3017</span>             <span class="n">ax</span><span class="o">.</span><span class="n">patch</span><span class="o">.</span><span class="n">_cm_set</span><span class="p">(</span><span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">))</span>
<span class="ne">-&gt; </span><span class="mi">3019</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">print_figure</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="nn">File /usr/local/lib/python3.9/site-packages/matplotlib/backend_bases.py:2319,</span> in <span class="ni">FigureCanvasBase.print_figure</span><span class="nt">(self, filename, dpi, facecolor, edgecolor, orientation, format, bbox_inches, pad_inches, bbox_extra_artists, backend, **kwargs)</span>
<span class="g g-Whitespace">   </span><span class="mi">2315</span> <span class="k">try</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">2316</span>     <span class="c1"># _get_renderer may change the figure dpi (as vector formats</span>
<span class="g g-Whitespace">   </span><span class="mi">2317</span>     <span class="c1"># force the figure dpi to 72), so we need to set it again here.</span>
<span class="g g-Whitespace">   </span><span class="mi">2318</span>     <span class="k">with</span> <span class="n">cbook</span><span class="o">.</span><span class="n">_setattr_cm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">):</span>
<span class="ne">-&gt; </span><span class="mi">2319</span>         <span class="n">result</span> <span class="o">=</span> <span class="n">print_method</span><span class="p">(</span>
<span class="g g-Whitespace">   </span><span class="mi">2320</span>             <span class="n">filename</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">2321</span>             <span class="n">facecolor</span><span class="o">=</span><span class="n">facecolor</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">2322</span>             <span class="n">edgecolor</span><span class="o">=</span><span class="n">edgecolor</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">2323</span>             <span class="n">orientation</span><span class="o">=</span><span class="n">orientation</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">2324</span>             <span class="n">bbox_inches_restore</span><span class="o">=</span><span class="n">_bbox_inches_restore</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">2325</span>             <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">2326</span> <span class="k">finally</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">2327</span>     <span class="k">if</span> <span class="n">bbox_inches</span> <span class="ow">and</span> <span class="n">restore_bbox</span><span class="p">:</span>

<span class="nn">File /usr/local/lib/python3.9/site-packages/matplotlib/backend_bases.py:1648,</span> in <span class="ni">_check_savefig_extra_args.&lt;locals&gt;.wrapper</span><span class="nt">(*args, **kwargs)</span>
<span class="g g-Whitespace">   </span><span class="mi">1640</span>     <span class="n">_api</span><span class="o">.</span><span class="n">warn_deprecated</span><span class="p">(</span>
<span class="g g-Whitespace">   </span><span class="mi">1641</span>         <span class="s1">&#39;3.3&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">removal</span><span class="o">=</span><span class="s1">&#39;3.6&#39;</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1642</span>         <span class="n">message</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%(name)s</span><span class="s1">() got unexpected keyword argument &quot;&#39;</span>
<span class="g g-Whitespace">   </span><span class="mi">1643</span>                 <span class="o">+</span> <span class="n">arg</span> <span class="o">+</span> <span class="s1">&#39;&quot; which is no longer supported as of &#39;</span>
<span class="g g-Whitespace">   </span><span class="mi">1644</span>                 <span class="s1">&#39;</span><span class="si">%(since)s</span><span class="s1"> and will become an error &#39;</span>
<span class="g g-Whitespace">   </span><span class="mi">1645</span>                 <span class="s1">&#39;</span><span class="si">%(removal)s</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1646</span>     <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
<span class="ne">-&gt; </span><span class="mi">1648</span> <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="nn">File /usr/local/lib/python3.9/site-packages/matplotlib/_api/deprecation.py:412,</span> in <span class="ni">delete_parameter.&lt;locals&gt;.wrapper</span><span class="nt">(*inner_args, **inner_kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">402</span>     <span class="n">deprecation_addendum</span> <span class="o">=</span> <span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">403</span>         <span class="sa">f</span><span class="s2">&quot;If any parameter follows </span><span class="si">{</span><span class="n">name</span><span class="si">!r}</span><span class="s2">, they should be passed as &quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">404</span>         <span class="sa">f</span><span class="s2">&quot;keyword, not positionally.&quot;</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">405</span>     <span class="n">warn_deprecated</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">406</span>         <span class="n">since</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">407</span>         <span class="n">name</span><span class="o">=</span><span class="nb">repr</span><span class="p">(</span><span class="n">name</span><span class="p">),</span>
   <span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">410</span>                  <span class="k">else</span> <span class="n">deprecation_addendum</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">411</span>         <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">412</span> <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">inner_args</span><span class="p">,</span> <span class="o">**</span><span class="n">inner_kwargs</span><span class="p">)</span>

<span class="nn">File /usr/local/lib/python3.9/site-packages/matplotlib/backends/backend_agg.py:541,</span> in <span class="ni">FigureCanvasAgg.print_png</span><span class="nt">(self, filename_or_obj, metadata, pil_kwargs, *args)</span>
<span class="g g-Whitespace">    </span><span class="mi">494</span> <span class="sd">&quot;&quot;&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">495</span><span class="sd"> Write the figure to a PNG file.</span>
<span class="g g-Whitespace">    </span><span class="mi">496</span><span class="sd"> </span>
<span class="sd">   (...)</span>
<span class="g g-Whitespace">    </span><span class="mi">538</span><span class="sd">     *metadata*, including the default &#39;Software&#39; key.</span>
<span class="g g-Whitespace">    </span><span class="mi">539</span><span class="sd"> &quot;&quot;&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">540</span> <span class="n">FigureCanvasAgg</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">541</span> <span class="n">mpl</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">imsave</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">542</span>     <span class="n">filename_or_obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">buffer_rgba</span><span class="p">(),</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;png&quot;</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s2">&quot;upper&quot;</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">543</span>     <span class="n">dpi</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">dpi</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span><span class="p">,</span> <span class="n">pil_kwargs</span><span class="o">=</span><span class="n">pil_kwargs</span><span class="p">)</span>

<span class="nn">File /usr/local/lib/python3.9/site-packages/matplotlib/image.py:1675,</span> in <span class="ni">imsave</span><span class="nt">(fname, arr, vmin, vmax, cmap, format, origin, dpi, metadata, pil_kwargs)</span>
<span class="g g-Whitespace">   </span><span class="mi">1673</span> <span class="n">pil_kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;format&quot;</span><span class="p">,</span> <span class="nb">format</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1674</span> <span class="n">pil_kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;dpi&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">dpi</span><span class="p">,</span> <span class="n">dpi</span><span class="p">))</span>
<span class="ne">-&gt; </span><span class="mi">1675</span> <span class="n">image</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="o">**</span><span class="n">pil_kwargs</span><span class="p">)</span>

<span class="nn">File ~/Library/Python/3.9/lib/python/site-packages/PIL/Image.py:2429,</span> in <span class="ni">Image.save</span><span class="nt">(self, fp, format, **params)</span>
<span class="g g-Whitespace">   </span><span class="mi">2427</span>         <span class="n">fp</span> <span class="o">=</span> <span class="n">builtins</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;r+b&quot;</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">2428</span>     <span class="k">else</span><span class="p">:</span>
<span class="ne">-&gt; </span><span class="mi">2429</span>         <span class="n">fp</span> <span class="o">=</span> <span class="n">builtins</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;w+b&quot;</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">2431</span> <span class="k">try</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">2432</span>     <span class="n">save_handler</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>

<span class="ne">FileNotFoundError</span>: [Errno 2] No such file or directory: &#39;./figrues/iltck_clone_subtype.png&#39;
</pre></div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="id8">
<h3>Tissue<a class="headerlink" href="#id8" title="Permalink to this headline">Â¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">clone_hiit_tissue</span> <span class="o">=</span> <span class="n">clone_df_generate</span><span class="p">(</span><span class="n">adata_hiit_tissue_arth</span><span class="p">)</span>
<span class="n">clone_hiit_tissue</span> <span class="o">=</span> <span class="n">sharing_info</span><span class="p">(</span><span class="n">clone_hiit_tissue</span><span class="p">)</span>
<span class="n">clone_hiit_tissue</span> <span class="o">=</span> <span class="n">dominant_sharing_info</span><span class="p">(</span><span class="n">clone_hiit_tissue</span><span class="p">)</span>

<span class="n">clone_hiit_tissue_healthy</span> <span class="o">=</span> <span class="n">clone_hiit_tissue</span><span class="p">[</span><span class="n">clone_hiit_tissue</span><span class="p">[</span><span class="s1">&#39;disease_type&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Healthy&#39;</span><span class="p">]</span>
<span class="n">clone_hiit_tissue_inflam</span> <span class="o">=</span> <span class="n">clone_hiit_tissue</span><span class="p">[</span><span class="n">clone_hiit_tissue</span><span class="p">[</span><span class="s1">&#39;disease&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Ulcerative colitis&#39;</span><span class="p">]</span>
<span class="n">clone_hiit_tissue_irae</span> <span class="o">=</span> <span class="n">clone_hiit_tissue</span><span class="p">[</span><span class="n">clone_hiit_tissue</span><span class="p">[</span><span class="s1">&#39;disease&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;CPI-colitis&#39;</span><span class="p">]</span>
<span class="n">clone_hiit_tissue_stumor</span> <span class="o">=</span> <span class="n">clone_hiit_tissue</span><span class="p">[</span><span class="n">clone_hiit_tissue</span><span class="p">[</span><span class="s1">&#39;disease&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;TN_tumor&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tissue_subtypes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;ITGAE+ Trm&#39;</span><span class="p">,</span> <span class="s1">&#39;ITGB2+ Trm&#39;</span><span class="p">,</span> <span class="s1">&#39;GZMK+ Tex&#39;</span><span class="p">,</span> <span class="s1">&#39;CXCR6+ Tex&#39;</span><span class="p">]</span>
<span class="n">HI_expansion_tissue</span> <span class="o">=</span> <span class="n">expansion_ratio</span><span class="p">(</span><span class="n">df_list</span><span class="o">=</span><span class="p">[</span><span class="n">clone_hiit_tissue_healthy</span><span class="p">,</span><span class="n">clone_hiit_tissue_inflam</span><span class="p">,</span>
                                               <span class="n">clone_hiit_tissue_irae</span><span class="p">,</span><span class="n">clone_hiit_tissue_stumor</span><span class="p">],</span>
                                      <span class="n">df_name_list</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Healthy&#39;</span><span class="p">,</span> <span class="s1">&#39;UC&#39;</span><span class="p">,</span> <span class="s1">&#39;irAE_colitis&#39;</span><span class="p">,</span> <span class="s1">&#39;TN_tumor&#39;</span><span class="p">],</span>
                                      <span class="n">subtype_list</span><span class="o">=</span><span class="n">tissue_subtypes</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Figure3D</span>
<span class="n">sep_multi_boxplot</span><span class="p">(</span><span class="n">HI_expansion_tissue</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="s1">&#39;./figures/expansion_tissue.pdf&#39;</span><span class="p">,</span>
                  <span class="n">xaxis</span><span class="o">=</span><span class="s1">&#39;sharing_type&#39;</span><span class="p">,</span> <span class="n">yaxis</span><span class="o">=</span><span class="s1">&#39;ratio&#39;</span><span class="p">,</span> <span class="n">hueaxis</span><span class="o">=</span><span class="s1">&#39;condition&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/GEXCD8_193_0.png" src="_images/GEXCD8_193_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stats</span><span class="o">.</span><span class="n">mannwhitneyu</span><span class="p">(</span><span class="n">HI_expansion_tissue</span><span class="p">[(</span><span class="n">HI_expansion_tissue</span><span class="p">[</span><span class="s1">&#39;sharing_type&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;GZMK+ Tex&#39;</span><span class="p">)</span> <span class="o">&amp;</span>
                                       <span class="p">(</span><span class="n">HI_expansion_tissue</span><span class="p">[</span><span class="s1">&#39;condition&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Healthy&#39;</span><span class="p">)]</span><span class="o">.</span><span class="n">ratio</span><span class="p">,</span>
                   <span class="n">HI_expansion_tissue</span><span class="p">[(</span><span class="n">HI_expansion_tissue</span><span class="p">[</span><span class="s1">&#39;sharing_type&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;GZMK+ Tex&#39;</span><span class="p">)</span> <span class="o">&amp;</span>
                                       <span class="p">(</span><span class="n">HI_expansion_tissue</span><span class="p">[</span><span class="s1">&#39;condition&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;irAE_colitis&#39;</span><span class="p">)]</span><span class="o">.</span><span class="n">ratio</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>MannwhitneyuResult(statistic=4.0, pvalue=1.5745166167316915e-05)
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="supcolitisvsarthritis">
<h2>SupColitisVsArthritis<a class="headerlink" href="#supcolitisvsarthritis" title="Permalink to this headline">Â¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">adata_irae_arth</span> <span class="o">=</span> <span class="n">adata_nogex</span><span class="p">[</span><span class="n">adata_nogex</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;study_name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;Kim_2022&#39;</span><span class="p">)]</span>
<span class="n">adata_irae_arth_circ</span> <span class="o">=</span> <span class="n">adata_irae_arth</span><span class="p">[</span><span class="n">adata_irae_arth</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;meta_tissue_type_aggr&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Circulating&#39;</span><span class="p">]</span>
<span class="n">adata_irae_arth_tissue</span> <span class="o">=</span> <span class="n">adata_irae_arth</span><span class="p">[</span><span class="n">adata_irae_arth</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;meta_tissue_type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;Tissue&#39;</span><span class="p">)]</span>
<span class="n">adata_irae_colitis</span> <span class="o">=</span> <span class="n">adata_noLGLL</span><span class="p">[</span><span class="n">adata_noLGLL</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;disease&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s2">&quot;CPI-colitis&quot;</span><span class="p">)]</span>

<span class="n">target_cells</span> <span class="o">=</span> <span class="mi">9400</span>
<span class="n">cluster_key</span> <span class="o">=</span> <span class="s1">&#39;disease&#39;</span>
<span class="n">adata</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">adata_irae_colitis</span><span class="p">,</span> <span class="n">adata_irae_arth_tissue</span><span class="p">])</span> <span class="c1"># minimum #cell=9400</span>

<span class="n">adatas</span> <span class="o">=</span> <span class="p">[</span><span class="n">adata</span><span class="p">[</span><span class="n">adata</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="n">cluster_key</span><span class="p">]</span><span class="o">==</span><span class="n">clust</span><span class="p">]</span> <span class="k">for</span> <span class="n">clust</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">adata</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="n">cluster_key</span><span class="p">])]</span>

<span class="k">for</span> <span class="n">dat</span> <span class="ow">in</span> <span class="n">adatas</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">dat</span><span class="o">.</span><span class="n">n_obs</span> <span class="o">&gt;</span> <span class="n">target_cells</span><span class="p">:</span>
         <span class="n">sc</span><span class="o">.</span><span class="n">pp</span><span class="o">.</span><span class="n">subsample</span><span class="p">(</span><span class="n">dat</span><span class="p">,</span> <span class="n">n_obs</span><span class="o">=</span><span class="n">target_cells</span><span class="p">)</span>

<span class="n">adata_downsampled</span> <span class="o">=</span> <span class="n">adatas</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="o">*</span><span class="n">adatas</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
<span class="n">adata_downsampled</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="p">[</span> <span class="s1">&#39;-&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">adata_downsampled</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">index</span> <span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">adata_nogex</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;expanded_distribution&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">adata_nogex</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
    <span class="n">adata_downsampled</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span>
        <span class="n">adata_downsampled</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;cc_aa_identity&#39;</span><span class="p">]</span><span class="o">&gt;=</span><span class="mi">3</span>
    <span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;expanded_distribution&#39;</span>
<span class="p">]</span> <span class="o">=</span> <span class="n">adata_downsampled</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;disease&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">adata_nogex</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;expanded_distribution&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">adata_nogex</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
    <span class="n">adata_downsampled</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span>
        <span class="p">(</span>
            <span class="p">(</span><span class="n">adata_downsampled</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;cell_subtype&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;Trm&#39;</span><span class="p">))</span> <span class="o">|</span>
            <span class="p">(</span><span class="n">adata_downsampled</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;cell_subtype&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;Tex&#39;</span><span class="p">))</span> <span class="o">|</span>
            <span class="p">(</span><span class="n">adata_downsampled</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;cell_subtype&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;Tm&#39;</span><span class="p">))</span> <span class="o">|</span>
            <span class="p">(</span><span class="n">adata_downsampled</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;cell_subtype&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;Cycling&#39;</span><span class="p">))</span>
        <span class="p">)</span> <span class="o">&amp;</span>
        <span class="p">(</span>
            <span class="p">(</span><span class="n">adata_downsampled</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;cc_aa_identity_size&#39;</span><span class="p">]</span><span class="o">&gt;=</span><span class="mi">3</span><span class="p">)</span>
        <span class="p">)</span>
    <span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;expanded_distribution&#39;</span>
<span class="p">]</span> <span class="o">=</span> <span class="n">adata_downsampled</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;disease&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>

<span class="n">sc</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">umap</span><span class="p">(</span><span class="n">adata_nogex</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;expanded_distribution&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">na_color</span><span class="o">=</span><span class="s2">&quot;#f7f7f7&quot;</span><span class="p">,</span> 
           <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;#ff707e&#39;</span><span class="p">,</span><span class="s1">&#39;#3f5070&#39;</span><span class="p">])</span>

<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;./figures/arth_colitis.png&quot;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/GEXCD8_199_0.png" src="_images/GEXCD8_199_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">arth_tissue_expansion_pie</span> <span class="o">=</span> <span class="n">tissue_pie_data</span><span class="p">(</span><span class="n">adata_use</span><span class="o">=</span><span class="n">adata_irae_arth_tissue</span><span class="p">,</span> 
    <span class="n">groupby</span><span class="o">=</span><span class="s1">&#39;disease_type&#39;</span><span class="p">,</span> <span class="n">groupby_type</span><span class="o">=</span><span class="s1">&#39;Inflammation-irAE&#39;</span><span class="p">,</span>
    <span class="n">ratioby</span><span class="o">=</span><span class="s1">&#39;expansion_size&#39;</span><span class="p">,</span> <span class="n">ratioby_type</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;2&#39;</span><span class="p">],</span>
    <span class="n">expanded</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">arth_tissue_subtypes</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;ITGAE+ Trm&#39;</span><span class="p">,</span> <span class="s1">&#39;ITGB2+ Trm&#39;</span><span class="p">,</span> <span class="s1">&#39;GZMK+ Tex&#39;</span><span class="p">,</span> <span class="s1">&#39;CXCR6+ Tex&#39;</span><span class="p">,</span> <span class="s1">&#39;Cycling T&#39;</span><span class="p">]</span>
<span class="n">arth_ratio</span> <span class="o">=</span> <span class="n">tissue_pie_data</span><span class="p">(</span><span class="n">adata_use</span><span class="o">=</span><span class="n">adata_hiit_tissue_arth</span><span class="p">,</span> 
    <span class="n">groupby</span><span class="o">=</span><span class="s1">&#39;disease&#39;</span><span class="p">,</span> <span class="n">groupby_type</span><span class="o">=</span><span class="s1">&#39;Arthritis&#39;</span><span class="p">,</span>
    <span class="n">ratioby</span><span class="o">=</span><span class="s1">&#39;cell_subtype&#39;</span><span class="p">,</span> <span class="n">ratioby_type</span><span class="o">=</span><span class="n">arth_tissue_subtypes</span><span class="p">,</span>
    <span class="n">expanded</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">pie</span><span class="p">(</span><span class="n">arth_tissue_expansion_pie</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">radius</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="n">expansion_size_color</span><span class="p">,</span> 
       <span class="n">autopct</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%1.0f%%</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">pctdistance</span><span class="o">=</span><span class="mf">1.2</span><span class="p">,</span> <span class="n">explode</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.1</span><span class="p">),</span> <span class="n">shadow</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">startangle</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">pie</span><span class="p">(</span><span class="n">arth_ratio</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">radius</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="n">tissue_color</span><span class="p">,</span> 
       <span class="n">autopct</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%1.0f%%</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">pctdistance</span><span class="o">=</span><span class="mf">1.2</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;./figures/arth_pie.pdf&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/GEXCD8_200_0.png" src="_images/GEXCD8_200_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># SupFigures</span>
<span class="n">disease_types_compare</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Arthritis&#39;</span><span class="p">,</span> <span class="s1">&#39;CPI-colitis&#39;</span><span class="p">]</span>
<span class="n">tissue_subtypes</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;GZMK+ Tex&#39;</span><span class="p">]</span>
<span class="n">disease_tissue_ratio</span> <span class="o">=</span> <span class="n">cell_ratio</span><span class="p">(</span><span class="n">adata</span><span class="o">=</span><span class="n">adata_hiit_tissue_arth</span><span class="p">,</span> 
                                  <span class="n">groupby</span><span class="o">=</span><span class="s1">&#39;disease&#39;</span><span class="p">,</span>
                                  <span class="n">groups</span><span class="o">=</span><span class="n">disease_types_compare</span><span class="p">,</span>
                                  <span class="n">subtypes</span><span class="o">=</span><span class="n">tissue_subtypes</span><span class="p">,</span> <span class="n">expanded</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">total</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sep_multi_boxplot</span><span class="p">(</span><span class="n">disease_tissue_ratio</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="s1">&#39;./figures/arth_expanded_tissue_ratio.pdf&#39;</span><span class="p">,</span>
                  <span class="n">xaxis</span><span class="o">=</span><span class="s1">&#39;subtypes&#39;</span><span class="p">,</span> <span class="n">yaxis</span><span class="o">=</span><span class="s1">&#39;ratio&#39;</span><span class="p">,</span> <span class="n">hueaxis</span><span class="o">=</span><span class="s1">&#39;disease_types&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/GEXCD8_202_0.png" src="_images/GEXCD8_202_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">clone_hiit_tissue_arth</span> <span class="o">=</span> <span class="n">clone_hiit_tissue</span><span class="p">[</span><span class="n">clone_hiit_tissue</span><span class="p">[</span><span class="s1">&#39;disease&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Arthritis&#39;</span><span class="p">]</span>
<span class="n">arth_tissue_subtypes_clone</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;GZMK+ Tex&#39;</span><span class="p">]</span>
<span class="n">HI_expansion_irae</span> <span class="o">=</span> <span class="n">expansion_ratio</span><span class="p">(</span><span class="n">df_list</span><span class="o">=</span><span class="p">[</span><span class="n">clone_hiit_tissue_irae</span><span class="p">,</span> <span class="n">clone_hiit_tissue_arth</span><span class="p">],</span>
                            <span class="n">df_name_list</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;CPI_colitis&#39;</span><span class="p">,</span> <span class="s1">&#39;CPI_arthritis&#39;</span><span class="p">],</span>
                            <span class="n">subtype_list</span><span class="o">=</span><span class="n">arth_tissue_subtypes_clone</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sep_multi_boxplot</span><span class="p">(</span><span class="n">HI_expansion_irae</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="s1">&#39;./figures/expansion_irae.pdf&#39;</span><span class="p">,</span>
                  <span class="n">xaxis</span><span class="o">=</span><span class="s1">&#39;sharing_type&#39;</span><span class="p">,</span> <span class="n">yaxis</span><span class="o">=</span><span class="s1">&#39;ratio&#39;</span><span class="p">,</span> <span class="n">hueaxis</span><span class="o">=</span><span class="s1">&#39;condition&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/GEXCD8_204_0.png" src="_images/GEXCD8_204_0.png" />
</div>
</div>
</div>
</div>
<div class="tex2jax_ignore mathjax_ignore section" id="part4sharingininflam-irae">
<h1>Part4SharingInInflam&amp;irAE<a class="headerlink" href="#part4sharingininflam-irae" title="Permalink to this headline">Â¶</a></h1>
<div class="section" id="dataprocessing">
<h2>DataProcessing<a class="headerlink" href="#dataprocessing" title="Permalink to this headline">Â¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">clone_circ</span> <span class="o">=</span> <span class="n">clone_df_generate</span><span class="p">(</span><span class="n">adata_hiit_circ</span><span class="p">)</span>
<span class="n">clone_tissue</span> <span class="o">=</span> <span class="n">clone_df_generate</span><span class="p">(</span><span class="n">adata_hiit_tissue_pre</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">hiit_cross_id</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;C16&quot;</span><span class="p">,</span>
    <span class="s2">&quot;C17&quot;</span><span class="p">,</span>
    <span class="s2">&quot;C18&quot;</span><span class="p">,</span>
    <span class="s2">&quot;C21&quot;</span><span class="p">,</span>
    <span class="s2">&quot;C30&quot;</span><span class="p">,</span>
    <span class="s2">&quot;C33&quot;</span><span class="p">,</span>
    <span class="s2">&quot;GU0700&quot;</span><span class="p">,</span>
    <span class="s2">&quot;GU0715&quot;</span><span class="p">,</span>
    <span class="s2">&quot;GU0744&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NPC_SC_1802&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NPC_SC_1805&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NPC_SC_1806&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NPC_SC_1807&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NPC_SC_1808&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NPC_SC_1810&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NPC_SC_1811&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NPC_SC_1813&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NPC_SC_1815&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NPC_SC_1816&quot;</span><span class="p">,</span>
    <span class="s2">&quot;U34&quot;</span><span class="p">,</span>
    <span class="s2">&quot;U35&quot;</span><span class="p">,</span>
    <span class="s2">&quot;U4&quot;</span><span class="p">,</span>
    <span class="s2">&quot;U41&quot;</span><span class="p">,</span>
    <span class="s2">&quot;U44&quot;</span><span class="p">,</span>
    <span class="s2">&quot;U45&quot;</span><span class="p">,</span>
    <span class="s2">&quot;U5&quot;</span><span class="p">,</span>
    <span class="s2">&quot;irAE_40&quot;</span><span class="p">,</span>
    <span class="s2">&quot;irAE_45&quot;</span><span class="p">,</span>
    <span class="s2">&quot;irAE_56&quot;</span><span class="p">,</span>
    <span class="s2">&quot;irAE_62&quot;</span><span class="p">,</span>
    <span class="s2">&quot;irAE_63&quot;</span><span class="p">,</span>
    <span class="s2">&quot;irAE_65&quot;</span><span class="p">,</span>
    <span class="s2">&quot;irAE_7&quot;</span><span class="p">,</span>
    <span class="s2">&quot;irAE_76&quot;</span><span class="p">,</span>
<span class="p">]</span>
<span class="n">adata_hiit_cross</span> <span class="o">=</span> <span class="n">adata_hiit</span><span class="p">[</span><span class="n">adata_hiit</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;individual_id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">hiit_cross_id</span><span class="p">)]</span>
<span class="n">clone_circ_cross</span> <span class="o">=</span> <span class="n">clone_circ</span><span class="p">[(</span><span class="n">clone_circ</span><span class="p">[</span><span class="s1">&#39;individual_id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">hiit_cross_id</span><span class="p">))]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">clone_tissue_cross</span> <span class="o">=</span> <span class="n">clone_tissue</span><span class="p">[(</span><span class="n">clone_tissue</span><span class="p">[</span><span class="s1">&#39;individual_id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">hiit_cross_id</span><span class="p">))]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="n">clone_hiit_crossx</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">clone_circ_cross</span><span class="p">,</span> <span class="n">clone_tissue_cross</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;cc_aa_identity&#39;</span><span class="p">)</span>
<span class="n">clone_hiit_cross</span><span class="p">[</span><span class="s1">&#39;total&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">clone_hiit_cross</span><span class="p">[</span><span class="s1">&#39;total_x&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">clone_hiit_cross</span><span class="p">[</span><span class="s1">&#39;total_y&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">clone_merge_all_healthy</span> <span class="o">=</span> <span class="n">clone_hiit_cross</span><span class="p">[</span><span class="n">clone_hiit_cross</span><span class="p">[</span><span class="s1">&#39;disease_type_x&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Healthy&#39;</span><span class="p">]</span>
<span class="n">clone_merge_all_inflam</span> <span class="o">=</span> <span class="n">clone_hiit_cross</span><span class="p">[</span><span class="n">clone_hiit_cross</span><span class="p">[</span><span class="s1">&#39;disease_type_x&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Inflammation&#39;</span><span class="p">]</span>
<span class="n">clone_merge_all_irae</span> <span class="o">=</span> <span class="n">clone_hiit_cross</span><span class="p">[</span><span class="n">clone_hiit_cross</span><span class="p">[</span><span class="s1">&#39;disease_type_x&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Inflammation-irAE&#39;</span><span class="p">]</span>
<span class="n">clone_merge_all_stumor</span> <span class="o">=</span> <span class="n">clone_hiit_cross</span><span class="p">[</span><span class="n">clone_hiit_cross</span><span class="p">[</span><span class="s1">&#39;disease_type_x&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Solid tumor&#39;</span><span class="p">]</span>

<span class="n">clone_merge_all_inflam</span> <span class="o">=</span> <span class="n">clone_merge_all_inflam</span><span class="p">[(</span><span class="n">clone_merge_all_inflam</span><span class="p">[</span><span class="s1">&#39;Circulating&#39;</span><span class="p">]</span><span class="o">&gt;=</span><span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span>
                                                <span class="p">(</span><span class="n">clone_merge_all_inflam</span><span class="p">[</span><span class="s1">&#39;Tissue&#39;</span><span class="p">]</span><span class="o">&gt;=</span><span class="mi">1</span><span class="p">)]</span>
<span class="n">clone_merge_all_irae</span> <span class="o">=</span> <span class="n">clone_merge_all_irae</span><span class="p">[(</span><span class="n">clone_merge_all_irae</span><span class="p">[</span><span class="s1">&#39;Circulating&#39;</span><span class="p">]</span><span class="o">&gt;=</span><span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span>
                                                <span class="p">(</span><span class="n">clone_merge_all_irae</span><span class="p">[</span><span class="s1">&#39;Tissue&#39;</span><span class="p">]</span><span class="o">&gt;=</span><span class="mi">1</span><span class="p">)]</span>
<span class="n">clone_merge_all_stumor</span> <span class="o">=</span> <span class="n">clone_merge_all_stumor</span><span class="p">[(</span><span class="n">clone_merge_all_stumor</span><span class="p">[</span><span class="s1">&#39;Circulating&#39;</span><span class="p">]</span><span class="o">&gt;=</span><span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span>
                                                <span class="p">(</span><span class="n">clone_merge_all_stumor</span><span class="p">[</span><span class="s1">&#39;TIL&#39;</span><span class="p">]</span><span class="o">&gt;=</span><span class="mi">1</span><span class="p">)]</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="sharedclonotypes">
<h2>SharedClonotypes<a class="headerlink" href="#sharedclonotypes" title="Permalink to this headline">Â¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cell_subtypes_mod</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;GZMK+ Tex&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Tn&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Tcm&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Early Tcm/Tem&#39;</span><span class="p">,</span>
    <span class="s1">&#39;GZMK+ Tem&#39;</span><span class="p">,</span>
    <span class="s1">&#39;CREM+ Tm&#39;</span><span class="p">,</span>
    <span class="s1">&#39;KLRG1+ Temra&#39;</span><span class="p">,</span>
    <span class="s1">&#39;KLRG1- Temra&#39;</span><span class="p">,</span>
    <span class="s1">&#39;IFITM3+KLRG1+ Temra&#39;</span><span class="p">,</span>
    <span class="s1">&#39;MAIT&#39;</span><span class="p">,</span>
    <span class="s1">&#39;ILTCK&#39;</span><span class="p">,</span>
    <span class="s1">&#39;ITGAE+ Trm&#39;</span><span class="p">,</span>
    <span class="s1">&#39;ITGB2+ Trm&#39;</span><span class="p">,</span>
    <span class="s1">&#39;SELL+ progenitor Tex&#39;</span><span class="p">,</span>
    <span class="s1">&#39;CXCR6+ Tex&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Cycling T&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Equality&#39;</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">clone_inflam_sharing</span> <span class="o">=</span> <span class="n">circos_edges</span><span class="p">(</span><span class="n">clone_merge_all_inflam</span><span class="p">,</span>
                                    <span class="n">subtypes</span><span class="o">=</span><span class="n">cell_subtypes_mod</span><span class="p">,</span>
                                    <span class="n">file_name</span><span class="o">=</span><span class="s1">&#39;figures/inflam_sharing.csv&#39;</span><span class="p">,</span>
                                    <span class="n">first_index</span><span class="o">=</span><span class="s1">&#39;dominant_y&#39;</span><span class="p">,</span>
                                    <span class="n">second_index</span><span class="o">=</span><span class="s1">&#39;dominant_x&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">clone_irae_sharing</span> <span class="o">=</span> <span class="n">circos_edges</span><span class="p">(</span><span class="n">clone_merge_all_irae</span><span class="p">,</span>
                                  <span class="n">subtypes</span><span class="o">=</span><span class="n">cell_subtypes_mod</span><span class="p">,</span>
                                  <span class="n">file_name</span><span class="o">=</span><span class="s1">&#39;figures/irae_sharing.csv&#39;</span><span class="p">,</span>
                                  <span class="n">first_index</span><span class="o">=</span><span class="s1">&#39;dominant_y&#39;</span><span class="p">,</span>
                                  <span class="n">second_index</span><span class="o">=</span><span class="s1">&#39;dominant_x&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">clone_stumor_sharing</span> <span class="o">=</span> <span class="n">circos_edges</span><span class="p">(</span><span class="n">clone_merge_all_stumor</span><span class="p">,</span>
                                    <span class="n">subtypes</span><span class="o">=</span><span class="n">cell_subtypes_mod</span><span class="p">,</span>
                                    <span class="n">file_name</span><span class="o">=</span><span class="s1">&#39;figures/stumor_sharing.csv&#39;</span><span class="p">,</span>
                                    <span class="n">first_index</span><span class="o">=</span><span class="s1">&#39;dominant_y&#39;</span><span class="p">,</span>
                                    <span class="n">second_index</span><span class="o">=</span><span class="s1">&#39;dominant_x&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">clone_irae_sharing_mod</span> <span class="o">=</span> <span class="n">clone_irae_sharing</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;GZMK+ Tex&#39;</span><span class="p">,</span> <span class="s1">&#39;irae GZMK+ Tex&#39;</span><span class="p">)</span>
<span class="n">irae_stumor_sanke</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">clone_stumor_sharing</span><span class="p">,</span> <span class="n">clone_irae_sharing_mod</span><span class="p">])</span>

<span class="n">irae_stumor_sanke_mod</span><span class="p">,</span> <span class="n">irae_stumor_sanke_venn</span> <span class="o">=</span> <span class="n">sanke_plot</span><span class="p">(</span>
    <span class="n">irae_stumor_sanke</span><span class="p">,</span> 
    <span class="n">column1</span><span class="o">=</span><span class="s1">&#39;GZMK+ Tex&#39;</span><span class="p">,</span>
    <span class="n">column2</span><span class="o">=</span><span class="s1">&#39;irae GZMK+ Tex&#39;</span><span class="p">,</span> 
    <span class="n">file_name</span><span class="o">=</span><span class="s1">&#39;figures/irae_stumor_sanke.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="cxcl13expression">
<h2>CXCL13expression<a class="headerlink" href="#cxcl13expression" title="Permalink to this headline">Â¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">adata_hiit_cross_circ</span> <span class="o">=</span> <span class="n">adata_hiit_cross</span><span class="p">[(</span><span class="n">adata_hiit_cross</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;meta_tissue_type_aggr&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Circulating&#39;</span><span class="p">)]</span>
<span class="n">adata_hiit_cross_tissue</span> <span class="o">=</span> <span class="n">adata_hiit_cross</span><span class="p">[(</span><span class="n">adata_hiit_cross</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;meta_tissue_type_aggr&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Tissue&#39;</span><span class="p">)]</span>
<span class="n">adata_hiit_cross_til</span> <span class="o">=</span> <span class="n">adata_hiit_cross</span><span class="p">[(</span><span class="n">adata_hiit_cross</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;meta_tissue_type_aggr&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;TIL&#39;</span><span class="p">)]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">CXCL13high_index</span> <span class="o">=</span> <span class="n">adata_hiit_cross_til</span><span class="p">[</span><span class="n">adata_hiit_cross_til</span><span class="o">.</span><span class="n">raw</span><span class="p">[:,</span><span class="s1">&#39;CXCL13&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">todense</span><span class="p">()</span><span class="o">&gt;</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">index</span>
<span class="n">CXCL13no_index</span> <span class="o">=</span> <span class="n">adata_hiit_cross_til</span><span class="p">[</span><span class="n">adata_hiit_cross_til</span><span class="o">.</span><span class="n">raw</span><span class="p">[:,</span><span class="s1">&#39;CXCL13&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">todense</span><span class="p">()</span><span class="o">==</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">index</span>
<span class="n">adata_hiit_cross_til</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;CXCL13expression&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">adata_hiit_cross_til</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
    <span class="n">CXCL13high_index</span><span class="p">,</span><span class="s1">&#39;CXCL13expression&#39;</span>
<span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;CXCL13high&#39;</span>
<span class="n">adata_hiit_cross_til</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
    <span class="n">CXCL13no_index</span><span class="p">,</span><span class="s1">&#39;CXCL13expression&#39;</span>
<span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;noCXCL13&#39;</span>
<span class="n">adata_hiit_cross_til</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
    <span class="n">adata_hiit_cross_til</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;CXCL13expression&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">(),</span><span class="s1">&#39;CXCL13expression&#39;</span>
<span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;CXCL13low&#39;</span>
<span class="n">adata_hiit_cross_til</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;CXCL13expression&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">adata_hiit_cross_til</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;CXCL13expression&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;category&#39;</span><span class="p">)</span>
<span class="n">adata_hiit_cross_til</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;CXCL13expression&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">adata_hiit_cross_til</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span>
    <span class="s1">&#39;CXCL13expression&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">reorder_categories</span><span class="p">([</span><span class="s1">&#39;CXCL13high&#39;</span><span class="p">,</span> <span class="s1">&#39;CXCL13low&#39;</span><span class="p">,</span> <span class="s1">&#39;noCXCL13&#39;</span><span class="p">])</span>

<span class="n">ENTPD1high_index</span> <span class="o">=</span> <span class="n">adata_hiit_cross_til</span><span class="p">[</span><span class="n">adata_hiit_cross_til</span><span class="o">.</span><span class="n">raw</span><span class="p">[:,</span><span class="s1">&#39;ENTPD1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">todense</span><span class="p">()</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">index</span>
<span class="n">ENTPD1no_index</span> <span class="o">=</span> <span class="n">adata_hiit_cross_til</span><span class="p">[</span><span class="n">adata_hiit_cross_til</span><span class="o">.</span><span class="n">raw</span><span class="p">[:,</span><span class="s1">&#39;ENTPD1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">todense</span><span class="p">()</span><span class="o">==</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">index</span>
<span class="n">adata_hiit_cross_til</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;ENTPD1expression&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">adata_hiit_cross_til</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
    <span class="n">ENTPD1high_index</span><span class="p">,</span><span class="s1">&#39;ENTPD1expression&#39;</span>
<span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;ENTPD1high&#39;</span>
<span class="n">adata_hiit_cross_til</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
    <span class="n">ENTPD1no_index</span><span class="p">,</span><span class="s1">&#39;ENTPD1expression&#39;</span>
<span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;noENTPD1&#39;</span>
<span class="n">adata_hiit_cross_til</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
    <span class="n">adata_hiit_cross_til</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;ENTPD1expression&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">(),</span><span class="s1">&#39;ENTPD1expression&#39;</span>
<span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;ENTPD1low&#39;</span>
<span class="n">adata_hiit_cross_til</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;ENTPD1expression&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">adata_hiit_cross_til</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;ENTPD1expression&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;category&#39;</span><span class="p">)</span>
<span class="n">adata_hiit_cross_til</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;ENTPD1expression&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">adata_hiit_cross_til</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span>
    <span class="s1">&#39;ENTPD1expression&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">reorder_categories</span><span class="p">([</span><span class="s1">&#39;ENTPD1high&#39;</span><span class="p">,</span> <span class="s1">&#39;ENTPD1low&#39;</span><span class="p">,</span> <span class="s1">&#39;noENTPD1&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">clone_id_subset</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">clone_merge_all_stumor</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

<span class="n">adata_share_stumor</span> <span class="o">=</span> <span class="n">adata_hiit_cross_til</span><span class="p">[</span>
    <span class="n">adata_hiit_cross_til</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;cc_aa_identity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">clone_id_subset</span><span class="p">)]</span>

<span class="n">adata_share_stumor_reverse</span> <span class="o">=</span> <span class="n">adata_hiit_cross_til</span><span class="p">[</span>
    <span class="p">(</span><span class="o">~</span><span class="n">adata_hiit_cross_til</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">adata_share_stumor</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">index</span><span class="p">))</span>
<span class="p">]</span>

<span class="n">adata_hiit_cross_til</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;circulating&#39;</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span>
<span class="n">adata_hiit_cross_til</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">adata_share_stumor</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;circulating&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Sharing&#39;</span>
<span class="n">adata_hiit_cross_til</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">adata_hiit_cross_til</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;circulating&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">(),</span> <span class="s1">&#39;circulating&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;NoSharing&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">sc</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">umap</span><span class="p">(</span><span class="n">adata_share_stumor</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;CXCL13expression&#39;</span><span class="p">,</span>
           <span class="n">sort_order</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;#ff8fbd&#39;</span><span class="p">,</span><span class="s1">&#39;#2cbef7&#39;</span><span class="p">,</span><span class="s1">&#39;#d7d7d7&#39;</span><span class="p">])</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;figures/circCXCL13expression.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/GEXCD8_220_0.png" src="_images/GEXCD8_220_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">sc</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">umap</span><span class="p">(</span><span class="n">adata_share_stumor_reverse</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;CXCL13expression&#39;</span><span class="p">,</span><span class="c1">#ENTPD1expression</span>
           <span class="n">sort_order</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;#ff8fbd&#39;</span><span class="p">,</span><span class="s1">&#39;#2cbef7&#39;</span><span class="p">,</span><span class="s1">&#39;#d7d7d7&#39;</span><span class="p">])</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;figures/nocircCXCL13expression.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/GEXCD8_221_0.png" src="_images/GEXCD8_221_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sharing_status</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Sharing&#39;</span><span class="p">,</span> <span class="s1">&#39;NoSharing&#39;</span><span class="p">]</span>
<span class="n">CXCL13_items</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;noCXCL13&#39;</span><span class="p">,</span> <span class="s1">&#39;CXCL13low&#39;</span><span class="p">,</span> <span class="s1">&#39;CXCL13high&#39;</span><span class="p">]</span>
<span class="n">ENTPD1_items</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;noENTPD1&#39;</span><span class="p">,</span> <span class="s1">&#39;ENTPD1low&#39;</span><span class="p">,</span> <span class="s1">&#39;ENTPD1high&#39;</span><span class="p">]</span>

<span class="n">expression_colors</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span><span class="s1">&#39;#d7d7d7&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span><span class="s1">&#39;#2cbef7&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span><span class="s1">&#39;#ff8fbd&#39;</span><span class="p">}</span>
<span class="n">stacked_bar</span><span class="p">(</span><span class="n">adata</span><span class="o">=</span><span class="n">adata_hiit_cross_til</span><span class="p">,</span> <span class="n">percentage</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">xitems</span><span class="o">=</span><span class="n">sharing_status</span><span class="p">,</span> <span class="n">xitem_str</span><span class="o">=</span><span class="s2">&quot;circulating&quot;</span><span class="p">,</span> 
            <span class="n">yitems</span><span class="o">=</span><span class="n">CXCL13_items</span><span class="p">,</span> <span class="n">yitem_str</span><span class="o">=</span><span class="s2">&quot;CXCL13expression&quot;</span><span class="p">,</span> <span class="n">yitem_color</span><span class="o">=</span><span class="n">expression_colors</span><span class="p">,</span> 
            <span class="n">file_name</span><span class="o">=</span><span class="s2">&quot;./figures/CXCL13expression_bar.pdf&quot;</span><span class="p">)</span>
<span class="n">stacked_bar</span><span class="p">(</span><span class="n">adata</span><span class="o">=</span><span class="n">adata_hiit_cross_til</span><span class="p">,</span> <span class="n">percentage</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">xitems</span><span class="o">=</span><span class="n">sharing_status</span><span class="p">,</span> <span class="n">xitem_str</span><span class="o">=</span><span class="s2">&quot;circulating&quot;</span><span class="p">,</span> 
            <span class="n">yitems</span><span class="o">=</span><span class="n">ENTPD1_items</span><span class="p">,</span> <span class="n">yitem_str</span><span class="o">=</span><span class="s2">&quot;ENTPD1expression&quot;</span><span class="p">,</span> <span class="n">yitem_color</span><span class="o">=</span><span class="n">expression_colors</span><span class="p">,</span> 
            <span class="n">file_name</span><span class="o">=</span><span class="s2">&quot;./figures/ENTPD1expression_bar.pdf&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/GEXCD8_222_0.png" src="_images/GEXCD8_222_0.png" />
<img alt="_images/GEXCD8_222_1.png" src="_images/GEXCD8_222_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">sc</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">umap</span><span class="p">(</span><span class="n">adata_share_stumor</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;CXCL13&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Reds&#39;</span><span class="p">,</span> 
           <span class="n">vmax</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;figures/CXCL13irae.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span> <span class="c1"># ENTPD1</span>

<span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">sc</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">umap</span><span class="p">(</span><span class="n">adata_share_stumor_reverse</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;CXCL13&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Reds&#39;</span><span class="p">,</span>
           <span class="n">vmax</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;figures/CXCL13irae_reverse.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span> <span class="c1"># ENTPD1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/GEXCD8_223_0.png" src="_images/GEXCD8_223_0.png" />
<img alt="_images/GEXCD8_223_1.png" src="_images/GEXCD8_223_1.png" />
</div>
</div>
</div>
<div class="section" id="velo">
<h2>Velo<a class="headerlink" href="#velo" title="Permalink to this headline">Â¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span> <span class="c1"># same cell to adata_hiit_cross</span>
<span class="n">adata_velo</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">read_h5ad</span><span class="p">(</span><span class="s1">&#39;./source/20230319_velo_subset.h5ad&#39;</span><span class="p">)</span>
<span class="n">adata_velo</span><span class="o">.</span><span class="n">obs</span> <span class="o">=</span> <span class="n">adata_nogex</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="n">adata_nogex</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">adata_velo</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">index</span><span class="p">)]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">velopp</span><span class="p">(</span><span class="n">clone_index</span><span class="p">,</span> <span class="n">disease_type</span><span class="p">,</span> <span class="n">adata_velo</span><span class="o">=</span><span class="n">adata_velo</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;stochastic&#39;</span><span class="p">):</span>
    <span class="c1"># subset velo project by disease_type</span>
    <span class="n">clone_id_subset</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">clone_index</span><span class="p">)</span>
    <span class="n">adata_velo_subset</span> <span class="o">=</span> <span class="n">adata_velo</span><span class="p">[</span><span class="n">adata_velo</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;cc_aa_identity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">clone_id_subset</span><span class="p">)]</span>
    <span class="c1"># avoid public clonotype in other studies</span>
    <span class="n">adata_velo_subset</span> <span class="o">=</span> <span class="n">adata_velo_subset</span><span class="p">[</span><span class="n">adata_velo_subset</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;disease_type&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">disease_type</span><span class="p">]</span>
    <span class="c1"># transfer umap</span>
    <span class="n">adata_nogex_subset</span> <span class="o">=</span> <span class="n">adata_nogex</span><span class="p">[</span><span class="n">adata_nogex</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">adata_velo_subset</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">index</span><span class="p">)]</span>
    <span class="n">adata_velo_subset</span><span class="o">.</span><span class="n">obsm</span><span class="p">[</span><span class="s1">&#39;X_umap&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">adata_nogex_subset</span><span class="o">.</span><span class="n">obsm</span><span class="p">[</span><span class="s1">&#39;X_umap&#39;</span><span class="p">]</span>
    <span class="c1"># scvelo processing</span>
    <span class="n">scv</span><span class="o">.</span><span class="n">pp</span><span class="o">.</span><span class="n">filter_and_normalize</span><span class="p">(</span><span class="n">adata_velo_subset</span><span class="p">)</span>
    <span class="n">scv</span><span class="o">.</span><span class="n">pp</span><span class="o">.</span><span class="n">moments</span><span class="p">(</span><span class="n">adata_velo_subset</span><span class="p">)</span>
    <span class="n">scv</span><span class="o">.</span><span class="n">tl</span><span class="o">.</span><span class="n">velocity</span><span class="p">(</span><span class="n">adata_velo_subset</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;stochastic&#39;</span><span class="p">)</span>
    <span class="n">scv</span><span class="o">.</span><span class="n">tl</span><span class="o">.</span><span class="n">velocity_graph</span><span class="p">(</span><span class="n">adata_velo_subset</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">adata_velo_subset</span>

<span class="k">def</span> <span class="nf">velomode</span><span class="p">(</span><span class="n">adata_velo_subset</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;dynamical&#39;</span><span class="p">):</span>
    <span class="n">scv</span><span class="o">.</span><span class="n">tl</span><span class="o">.</span><span class="n">recover_dynamics</span><span class="p">(</span><span class="n">adata_velo_subset</span><span class="p">)</span>
    <span class="n">scv</span><span class="o">.</span><span class="n">tl</span><span class="o">.</span><span class="n">velocity</span><span class="p">(</span><span class="n">adata_velo_subset</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">)</span>
    <span class="n">scv</span><span class="o">.</span><span class="n">tl</span><span class="o">.</span><span class="n">velocity_graph</span><span class="p">(</span><span class="n">adata_velo_subset</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">adata_velo_subset</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">adata_velo_inflam</span> <span class="o">=</span> <span class="n">velopp</span><span class="p">(</span><span class="n">clone_index</span><span class="o">=</span><span class="n">clone_merge_all_inflam</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">disease_type</span><span class="o">=</span><span class="s2">&quot;Inflammation&quot;</span><span class="p">)</span>
<span class="n">adata_velo_irae</span> <span class="o">=</span> <span class="n">velopp</span><span class="p">(</span><span class="n">clone_index</span><span class="o">=</span><span class="n">clone_merge_all_irae</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">disease_type</span><span class="o">=</span><span class="s2">&quot;Inflammation-irAE&quot;</span><span class="p">)</span>
<span class="n">adata_velo_stumor</span> <span class="o">=</span> <span class="n">velopp</span><span class="p">(</span><span class="n">clone_index</span><span class="o">=</span><span class="n">clone_merge_all_stumor</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">disease_type</span><span class="o">=</span><span class="s2">&quot;Solid tumor&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Normalized count data: X, spliced, unspliced.
Logarithmized X.
computing neighbors
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>OMP: Info #276: omp_set_nested routine deprecated, please use omp_set_max_active_levels instead.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    finished (0:00:07) --&gt; added 
    &#39;distances&#39; and &#39;connectivities&#39;, weighted adjacency matrices (adata.obsp)
computing moments based on connectivities
    finished (0:00:01) --&gt; added 
    &#39;Ms&#39; and &#39;Mu&#39;, moments of un/spliced abundances (adata.layers)
computing velocities
    finished (0:00:08) --&gt; added 
    &#39;velocity&#39;, velocity vectors for each individual cell (adata.layers)
computing velocity graph (using 1/16 cores)
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "4561c20c3a1246d1aa9218ce86c0fdc1", "version_major": 2, "version_minor": 0}
</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    finished (0:00:09) --&gt; added 
    &#39;velocity_graph&#39;, sparse matrix with cosine correlations (adata.uns)
Normalized count data: X, spliced, unspliced.
Logarithmized X.
computing neighbors
    finished (0:00:26) --&gt; added 
    &#39;distances&#39; and &#39;connectivities&#39;, weighted adjacency matrices (adata.obsp)
computing moments based on connectivities
    finished (0:00:03) --&gt; added 
    &#39;Ms&#39; and &#39;Mu&#39;, moments of un/spliced abundances (adata.layers)
computing velocities
    finished (0:00:20) --&gt; added 
    &#39;velocity&#39;, velocity vectors for each individual cell (adata.layers)
computing velocity graph (using 1/16 cores)
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "0a6e67423b774f93bc920bf4c0a051e5", "version_major": 2, "version_minor": 0}
</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    finished (0:00:08) --&gt; added 
    &#39;velocity_graph&#39;, sparse matrix with cosine correlations (adata.uns)
Normalized count data: X, spliced, unspliced.
Logarithmized X.
computing neighbors
    finished (0:00:05) --&gt; added 
    &#39;distances&#39; and &#39;connectivities&#39;, weighted adjacency matrices (adata.obsp)
computing moments based on connectivities
    finished (0:00:06) --&gt; added 
    &#39;Ms&#39; and &#39;Mu&#39;, moments of un/spliced abundances (adata.layers)
computing velocities
    finished (0:00:39) --&gt; added 
    &#39;velocity&#39;, velocity vectors for each individual cell (adata.layers)
computing velocity graph (using 1/16 cores)
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "6347eb2e06e5454daf7e15f408436d18", "version_major": 2, "version_minor": 0}
</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    finished (0:00:49) --&gt; added 
    &#39;velocity_graph&#39;, sparse matrix with cosine correlations (adata.uns)
</pre></div>
</div>
</div>
</div>
<div class="section" id="inflammation">
<h3>Inflammation<a class="headerlink" href="#inflammation" title="Permalink to this headline">Â¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">adata_velo_inflam_dynamical</span> <span class="o">=</span> <span class="n">velomode</span><span class="p">(</span><span class="n">adata_velo_inflam</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;dynamical&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>recovering dynamics (using 1/16 cores)
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "24c42e6ce6024e5aac01d64d2fa10612", "version_major": 2, "version_minor": 0}
</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    finished (0:03:05) --&gt; added 
    &#39;fit_pars&#39;, fitted parameters for splicing dynamics (adata.var)
computing velocities
    finished (0:00:10) --&gt; added 
    &#39;velocity&#39;, velocity vectors for each individual cell (adata.layers)
computing velocity graph (using 1/16 cores)
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "8cbd76435e0e4dab95c37c2a4d4707e3", "version_major": 2, "version_minor": 0}
</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    finished (0:00:04) --&gt; added 
    &#39;velocity_graph&#39;, sparse matrix with cosine correlations (adata.uns)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">adata_velo_inflam_dynamical</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>AnnData object with n_obs Ã n_vars = 4161 Ã 19957
    obs: &#39;predictions&#39;, &#39;multi_chain&#39;, &#39;extra_chains&#39;, &#39;is_cell&#39;, &#39;high_confidence&#39;, &#39;IR_VJ_1_c_call&#39;, &#39;IR_VJ_2_c_call&#39;, &#39;IR_VDJ_1_c_call&#39;, &#39;IR_VDJ_2_c_call&#39;, &#39;IR_VJ_1_consensus_count&#39;, &#39;IR_VDJ_1_consensus_count&#39;, &#39;IR_VDJ_1_d_call&#39;, &#39;IR_VDJ_2_d_call&#39;, &#39;IR_VJ_1_duplicate_count&#39;, &#39;IR_VDJ_1_duplicate_count&#39;, &#39;IR_VJ_1_j_call&#39;, &#39;IR_VJ_2_j_call&#39;, &#39;IR_VDJ_1_j_call&#39;, &#39;IR_VDJ_2_j_call&#39;, &#39;IR_VJ_1_junction&#39;, &#39;IR_VJ_2_junction&#39;, &#39;IR_VDJ_1_junction&#39;, &#39;IR_VDJ_2_junction&#39;, &#39;IR_VJ_1_junction_aa&#39;, &#39;IR_VJ_2_junction_aa&#39;, &#39;IR_VDJ_1_junction_aa&#39;, &#39;IR_VDJ_2_junction_aa&#39;, &#39;IR_VJ_1_locus&#39;, &#39;IR_VJ_2_locus&#39;, &#39;IR_VDJ_1_locus&#39;, &#39;IR_VDJ_2_locus&#39;, &#39;IR_VJ_1_productive&#39;, &#39;IR_VJ_2_productive&#39;, &#39;IR_VDJ_1_productive&#39;, &#39;IR_VDJ_2_productive&#39;, &#39;IR_VJ_1_v_call&#39;, &#39;IR_VJ_2_v_call&#39;, &#39;IR_VDJ_1_v_call&#39;, &#39;IR_VDJ_2_v_call&#39;, &#39;has_ir&#39;, &#39;receptor_type&#39;, &#39;receptor_subtype&#39;, &#39;chain_pairing&#39;, &#39;sample_name&#39;, &#39;study_name&#39;, &#39;IR_VJ_2_consensus_count&#39;, &#39;IR_VJ_2_duplicate_count&#39;, &#39;leiden&#39;, &#39;leiden_1.0&#39;, &#39;leiden_0.6&#39;, &#39;individual_id&#39;, &#39;tissue_type&#39;, &#39;cell_type&#39;, &#39;disease&#39;, &#39;disease_type&#39;, &#39;treatment&#39;, &#39;treatment_type&#39;, &#39;response_type&#39;, &#39;meta_tissue_type&#39;, &#39;clone_id&#39;, &#39;clone_id_size&#39;, &#39;cc_aa_identity&#39;, &#39;cc_aa_identity_size&#39;, &#39;cell_subtype&#39;, &#39;normalized_shannon_entropy_cc_aa_identity&#39;, &#39;normalized_shannon_entropy_cc_aa_identity_float&#39;, &#39;Module 1&#39;, &#39;Module 2&#39;, &#39;Module 3&#39;, &#39;Module 4&#39;, &#39;Module 5&#39;, &#39;Module 6&#39;, &#39;Module 7&#39;, &#39;Module 8&#39;, &#39;Module 9&#39;, &#39;Module 10&#39;, &#39;treatment_type_rmpre&#39;, &#39;response_type_rmpre&#39;, &#39;response_type_rmpre_rmCR&#39;, &#39;cell_subtype_aggr&#39;, &#39;meta_tissue_type_aggr&#39;, &#39;main_origin&#39;, &#39;expansion_level&#39;, &#39;normalized_shannon_entropy_disease_type&#39;, &#39;D50_disease_type&#39;, &#39;COVID_state&#39;, &#39;tcr&#39;, &#39;expansion_size&#39;, &#39;D50_cc_aa_identity&#39;, &#39;Tex_umap&#39;, &#39;clone_umap&#39;, &#39;expanded_distribution&#39;, &#39;cell_distribution&#39;, &#39;specific_clone&#39;, &#39;specific_clone_subtype&#39;, &#39;initial_size_spliced&#39;, &#39;initial_size_unspliced&#39;, &#39;initial_size&#39;, &#39;n_counts&#39;, &#39;velocity_self_transition&#39;
    var: &#39;gene_count_corr&#39;, &#39;velocity_gamma&#39;, &#39;velocity_qreg_ratio&#39;, &#39;velocity_r2&#39;, &#39;velocity_genes&#39;, &#39;fit_alpha&#39;, &#39;fit_beta&#39;, &#39;fit_gamma&#39;, &#39;fit_t_&#39;, &#39;fit_scaling&#39;, &#39;fit_std_u&#39;, &#39;fit_std_s&#39;, &#39;fit_likelihood&#39;, &#39;fit_u0&#39;, &#39;fit_s0&#39;, &#39;fit_pval_steady&#39;, &#39;fit_steady_u&#39;, &#39;fit_steady_s&#39;, &#39;fit_variance&#39;, &#39;fit_alignment_scaling&#39;, &#39;fit_r2&#39;
    uns: &#39;pca&#39;, &#39;neighbors&#39;, &#39;velocity_params&#39;, &#39;velocity_graph&#39;, &#39;velocity_graph_neg&#39;, &#39;recover_dynamics&#39;
    obsm: &#39;X_umap&#39;, &#39;X_pca&#39;
    varm: &#39;PCs&#39;, &#39;loss&#39;
    layers: &#39;ambiguous&#39;, &#39;matrix&#39;, &#39;spliced&#39;, &#39;unspliced&#39;, &#39;Ms&#39;, &#39;Mu&#39;, &#39;velocity&#39;, &#39;variance_velocity&#39;, &#39;fit_t&#39;, &#39;fit_tau&#39;, &#39;fit_tau_&#39;, &#39;velocity_u&#39;
    obsp: &#39;distances&#39;, &#39;connectivities&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scv</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">velocity_embedding_grid</span><span class="p">(</span><span class="n">adata_velo_inflam_dynamical</span><span class="p">,</span> <span class="n">basis</span><span class="o">=</span><span class="s1">&#39;umap&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;cell_subtype&#39;</span><span class="p">,</span>
                               <span class="n">size</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">arrow_color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span>
                               <span class="n">arrow_size</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">arrow_length</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">min_mass</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">smooth</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                               <span class="n">save</span><span class="o">=</span><span class="s1">&#39;figures/inflam_grid.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="n">subtype_color</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>computing velocity embedding
    finished (0:00:01) --&gt; added
    &#39;velocity_umap&#39;, embedded velocity vectors (adata.obsm)
saving figure to file figures/inflam_grid.png
</pre></div>
</div>
<img alt="_images/GEXCD8_231_1.png" src="_images/GEXCD8_231_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scv</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">velocity_embedding_stream</span><span class="p">(</span><span class="n">adata_velo_inflam_dynamical</span><span class="p">,</span> <span class="n">basis</span><span class="o">=</span><span class="s1">&#39;umap&#39;</span><span class="p">,</span> 
                                 <span class="n">color</span><span class="o">=</span><span class="s1">&#39;meta_tissue_type&#39;</span><span class="p">,</span> <span class="n">smooth</span><span class="o">=</span><span class="mf">1.2</span><span class="p">,</span>
                                 <span class="n">save</span><span class="o">=</span><span class="s1">&#39;figures/inflam_stream.pdf&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="n">tissue_type_color</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>figure cannot be saved as pdf, using png instead.
saving figure to file figures/inflam_stream.png
</pre></div>
</div>
<img alt="_images/GEXCD8_232_1.png" src="_images/GEXCD8_232_1.png" />
</div>
</div>
</div>
<div class="section" id="irae">
<h3>irAE<a class="headerlink" href="#irae" title="Permalink to this headline">Â¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">adata_velo_irae_dynamical</span> <span class="o">=</span> <span class="n">velomode</span><span class="p">(</span><span class="n">adata_velo_subset</span><span class="o">=</span><span class="n">adata_velo_irae</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;dynamical&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>recovering dynamics (using 1/16 cores)
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "80000bdb33254b26a467c3589262f1d3", "version_major": 2, "version_minor": 0}
</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    finished (0:01:07) --&gt; added 
    &#39;fit_pars&#39;, fitted parameters for splicing dynamics (adata.var)
computing velocities
    finished (0:00:24) --&gt; added 
    &#39;velocity&#39;, velocity vectors for each individual cell (adata.layers)
computing velocity graph (using 1/16 cores)
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "2470af84e25c4d629435c1d972ee94cd", "version_major": 2, "version_minor": 0}
</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    finished (0:00:06) --&gt; added 
    &#39;velocity_graph&#39;, sparse matrix with cosine correlations (adata.uns)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">adata_velo_irae_dynamical</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>AnnData object with n_obs Ã n_vars = 9607 Ã 19957
    obs: &#39;predictions&#39;, &#39;multi_chain&#39;, &#39;extra_chains&#39;, &#39;is_cell&#39;, &#39;high_confidence&#39;, &#39;IR_VJ_1_c_call&#39;, &#39;IR_VJ_2_c_call&#39;, &#39;IR_VDJ_1_c_call&#39;, &#39;IR_VDJ_2_c_call&#39;, &#39;IR_VJ_1_consensus_count&#39;, &#39;IR_VDJ_1_consensus_count&#39;, &#39;IR_VDJ_1_d_call&#39;, &#39;IR_VDJ_2_d_call&#39;, &#39;IR_VJ_1_duplicate_count&#39;, &#39;IR_VDJ_1_duplicate_count&#39;, &#39;IR_VJ_1_j_call&#39;, &#39;IR_VJ_2_j_call&#39;, &#39;IR_VDJ_1_j_call&#39;, &#39;IR_VDJ_2_j_call&#39;, &#39;IR_VJ_1_junction&#39;, &#39;IR_VJ_2_junction&#39;, &#39;IR_VDJ_1_junction&#39;, &#39;IR_VDJ_2_junction&#39;, &#39;IR_VJ_1_junction_aa&#39;, &#39;IR_VJ_2_junction_aa&#39;, &#39;IR_VDJ_1_junction_aa&#39;, &#39;IR_VDJ_2_junction_aa&#39;, &#39;IR_VJ_1_locus&#39;, &#39;IR_VJ_2_locus&#39;, &#39;IR_VDJ_1_locus&#39;, &#39;IR_VDJ_2_locus&#39;, &#39;IR_VJ_1_productive&#39;, &#39;IR_VJ_2_productive&#39;, &#39;IR_VDJ_1_productive&#39;, &#39;IR_VDJ_2_productive&#39;, &#39;IR_VJ_1_v_call&#39;, &#39;IR_VJ_2_v_call&#39;, &#39;IR_VDJ_1_v_call&#39;, &#39;IR_VDJ_2_v_call&#39;, &#39;has_ir&#39;, &#39;receptor_type&#39;, &#39;receptor_subtype&#39;, &#39;chain_pairing&#39;, &#39;sample_name&#39;, &#39;study_name&#39;, &#39;IR_VJ_2_consensus_count&#39;, &#39;IR_VJ_2_duplicate_count&#39;, &#39;leiden&#39;, &#39;leiden_1.0&#39;, &#39;leiden_0.6&#39;, &#39;individual_id&#39;, &#39;tissue_type&#39;, &#39;cell_type&#39;, &#39;disease&#39;, &#39;disease_type&#39;, &#39;treatment&#39;, &#39;treatment_type&#39;, &#39;response_type&#39;, &#39;meta_tissue_type&#39;, &#39;clone_id&#39;, &#39;clone_id_size&#39;, &#39;cc_aa_identity&#39;, &#39;cc_aa_identity_size&#39;, &#39;cell_subtype&#39;, &#39;normalized_shannon_entropy_cc_aa_identity&#39;, &#39;normalized_shannon_entropy_cc_aa_identity_float&#39;, &#39;Module 1&#39;, &#39;Module 2&#39;, &#39;Module 3&#39;, &#39;Module 4&#39;, &#39;Module 5&#39;, &#39;Module 6&#39;, &#39;Module 7&#39;, &#39;Module 8&#39;, &#39;Module 9&#39;, &#39;Module 10&#39;, &#39;treatment_type_rmpre&#39;, &#39;response_type_rmpre&#39;, &#39;response_type_rmpre_rmCR&#39;, &#39;cell_subtype_aggr&#39;, &#39;meta_tissue_type_aggr&#39;, &#39;main_origin&#39;, &#39;expansion_level&#39;, &#39;normalized_shannon_entropy_disease_type&#39;, &#39;D50_disease_type&#39;, &#39;COVID_state&#39;, &#39;tcr&#39;, &#39;expansion_size&#39;, &#39;D50_cc_aa_identity&#39;, &#39;Tex_umap&#39;, &#39;clone_umap&#39;, &#39;expanded_distribution&#39;, &#39;cell_distribution&#39;, &#39;specific_clone&#39;, &#39;specific_clone_subtype&#39;, &#39;initial_size_spliced&#39;, &#39;initial_size_unspliced&#39;, &#39;initial_size&#39;, &#39;n_counts&#39;, &#39;velocity_self_transition&#39;
    var: &#39;gene_count_corr&#39;, &#39;velocity_gamma&#39;, &#39;velocity_qreg_ratio&#39;, &#39;velocity_r2&#39;, &#39;velocity_genes&#39;, &#39;fit_alpha&#39;, &#39;fit_beta&#39;, &#39;fit_gamma&#39;, &#39;fit_t_&#39;, &#39;fit_scaling&#39;, &#39;fit_std_u&#39;, &#39;fit_std_s&#39;, &#39;fit_likelihood&#39;, &#39;fit_u0&#39;, &#39;fit_s0&#39;, &#39;fit_pval_steady&#39;, &#39;fit_steady_u&#39;, &#39;fit_steady_s&#39;, &#39;fit_variance&#39;, &#39;fit_alignment_scaling&#39;, &#39;fit_r2&#39;
    uns: &#39;pca&#39;, &#39;neighbors&#39;, &#39;velocity_params&#39;, &#39;velocity_graph&#39;, &#39;velocity_graph_neg&#39;, &#39;recover_dynamics&#39;
    obsm: &#39;X_umap&#39;, &#39;X_pca&#39;
    varm: &#39;PCs&#39;, &#39;loss&#39;
    layers: &#39;ambiguous&#39;, &#39;matrix&#39;, &#39;spliced&#39;, &#39;unspliced&#39;, &#39;Ms&#39;, &#39;Mu&#39;, &#39;velocity&#39;, &#39;variance_velocity&#39;, &#39;fit_t&#39;, &#39;fit_tau&#39;, &#39;fit_tau_&#39;, &#39;velocity_u&#39;
    obsp: &#39;distances&#39;, &#39;connectivities&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scv</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">velocity_embedding_grid</span><span class="p">(</span><span class="n">adata_velo_irae_dynamical</span><span class="p">,</span> <span class="n">basis</span><span class="o">=</span><span class="s1">&#39;umap&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;cell_subtype&#39;</span><span class="p">,</span>
                               <span class="n">size</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">arrow_color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span>
                               <span class="n">arrow_size</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">arrow_length</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">min_mass</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">smooth</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                               <span class="n">save</span><span class="o">=</span><span class="s1">&#39;figures/irae_grid.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="n">subtype_color</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>computing velocity embedding
    finished (0:00:03) --&gt; added
    &#39;velocity_umap&#39;, embedded velocity vectors (adata.obsm)
saving figure to file figures/irae_grid.png
</pre></div>
</div>
<img alt="_images/GEXCD8_236_1.png" src="_images/GEXCD8_236_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scv</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">velocity_embedding_stream</span><span class="p">(</span><span class="n">adata_velo_irae_dynamical</span><span class="p">,</span> <span class="n">basis</span><span class="o">=</span><span class="s1">&#39;umap&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;meta_tissue_type&#39;</span><span class="p">,</span>
                                 <span class="n">size</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">arrow_color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span>
                                 <span class="n">smooth</span><span class="o">=</span><span class="mf">1.2</span><span class="p">,</span>
                                 <span class="n">save</span><span class="o">=</span><span class="s1">&#39;figures/irae_stream.pdf&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="n">tissue_type_color</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>figure cannot be saved as pdf, using png instead.
saving figure to file figures/irae_stream.png
</pre></div>
</div>
<img alt="_images/GEXCD8_237_1.png" src="_images/GEXCD8_237_1.png" />
</div>
</div>
</div>
<div class="section" id="stumor">
<h3>Stumor<a class="headerlink" href="#stumor" title="Permalink to this headline">Â¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">adata_velo_stumor_dynamical</span> <span class="o">=</span> <span class="n">velomode</span><span class="p">(</span><span class="n">adata_velo_subset</span><span class="o">=</span><span class="n">adata_velo_stumor</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;dynamical&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>recovering dynamics (using 1/16 cores)
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "24d74046055a4a25818e31c2e32b3885", "version_major": 2, "version_minor": 0}
</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    finished (0:08:54) --&gt; added 
    &#39;fit_pars&#39;, fitted parameters for splicing dynamics (adata.var)
computing velocities
    finished (0:00:42) --&gt; added 
    &#39;velocity&#39;, velocity vectors for each individual cell (adata.layers)
computing velocity graph (using 1/16 cores)
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "92691091984a46c9b8f5f33ce94ddc4d", "version_major": 2, "version_minor": 0}
</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    finished (0:00:16) --&gt; added 
    &#39;velocity_graph&#39;, sparse matrix with cosine correlations (adata.uns)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">adata_velo_stumor_dynamical</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>AnnData object with n_obs Ã n_vars = 17193 Ã 19957
    obs: &#39;predictions&#39;, &#39;multi_chain&#39;, &#39;extra_chains&#39;, &#39;is_cell&#39;, &#39;high_confidence&#39;, &#39;IR_VJ_1_c_call&#39;, &#39;IR_VJ_2_c_call&#39;, &#39;IR_VDJ_1_c_call&#39;, &#39;IR_VDJ_2_c_call&#39;, &#39;IR_VJ_1_consensus_count&#39;, &#39;IR_VDJ_1_consensus_count&#39;, &#39;IR_VDJ_1_d_call&#39;, &#39;IR_VDJ_2_d_call&#39;, &#39;IR_VJ_1_duplicate_count&#39;, &#39;IR_VDJ_1_duplicate_count&#39;, &#39;IR_VJ_1_j_call&#39;, &#39;IR_VJ_2_j_call&#39;, &#39;IR_VDJ_1_j_call&#39;, &#39;IR_VDJ_2_j_call&#39;, &#39;IR_VJ_1_junction&#39;, &#39;IR_VJ_2_junction&#39;, &#39;IR_VDJ_1_junction&#39;, &#39;IR_VDJ_2_junction&#39;, &#39;IR_VJ_1_junction_aa&#39;, &#39;IR_VJ_2_junction_aa&#39;, &#39;IR_VDJ_1_junction_aa&#39;, &#39;IR_VDJ_2_junction_aa&#39;, &#39;IR_VJ_1_locus&#39;, &#39;IR_VJ_2_locus&#39;, &#39;IR_VDJ_1_locus&#39;, &#39;IR_VDJ_2_locus&#39;, &#39;IR_VJ_1_productive&#39;, &#39;IR_VJ_2_productive&#39;, &#39;IR_VDJ_1_productive&#39;, &#39;IR_VDJ_2_productive&#39;, &#39;IR_VJ_1_v_call&#39;, &#39;IR_VJ_2_v_call&#39;, &#39;IR_VDJ_1_v_call&#39;, &#39;IR_VDJ_2_v_call&#39;, &#39;has_ir&#39;, &#39;receptor_type&#39;, &#39;receptor_subtype&#39;, &#39;chain_pairing&#39;, &#39;sample_name&#39;, &#39;study_name&#39;, &#39;IR_VJ_2_consensus_count&#39;, &#39;IR_VJ_2_duplicate_count&#39;, &#39;leiden&#39;, &#39;leiden_1.0&#39;, &#39;leiden_0.6&#39;, &#39;individual_id&#39;, &#39;tissue_type&#39;, &#39;cell_type&#39;, &#39;disease&#39;, &#39;disease_type&#39;, &#39;treatment&#39;, &#39;treatment_type&#39;, &#39;response_type&#39;, &#39;meta_tissue_type&#39;, &#39;clone_id&#39;, &#39;clone_id_size&#39;, &#39;cc_aa_identity&#39;, &#39;cc_aa_identity_size&#39;, &#39;cell_subtype&#39;, &#39;normalized_shannon_entropy_cc_aa_identity&#39;, &#39;normalized_shannon_entropy_cc_aa_identity_float&#39;, &#39;Module 1&#39;, &#39;Module 2&#39;, &#39;Module 3&#39;, &#39;Module 4&#39;, &#39;Module 5&#39;, &#39;Module 6&#39;, &#39;Module 7&#39;, &#39;Module 8&#39;, &#39;Module 9&#39;, &#39;Module 10&#39;, &#39;treatment_type_rmpre&#39;, &#39;response_type_rmpre&#39;, &#39;response_type_rmpre_rmCR&#39;, &#39;cell_subtype_aggr&#39;, &#39;meta_tissue_type_aggr&#39;, &#39;main_origin&#39;, &#39;expansion_level&#39;, &#39;normalized_shannon_entropy_disease_type&#39;, &#39;D50_disease_type&#39;, &#39;COVID_state&#39;, &#39;tcr&#39;, &#39;expansion_size&#39;, &#39;D50_cc_aa_identity&#39;, &#39;Tex_umap&#39;, &#39;clone_umap&#39;, &#39;expanded_distribution&#39;, &#39;cell_distribution&#39;, &#39;specific_clone&#39;, &#39;specific_clone_subtype&#39;, &#39;initial_size_spliced&#39;, &#39;initial_size_unspliced&#39;, &#39;initial_size&#39;, &#39;n_counts&#39;, &#39;velocity_self_transition&#39;
    var: &#39;gene_count_corr&#39;, &#39;velocity_gamma&#39;, &#39;velocity_qreg_ratio&#39;, &#39;velocity_r2&#39;, &#39;velocity_genes&#39;, &#39;fit_alpha&#39;, &#39;fit_beta&#39;, &#39;fit_gamma&#39;, &#39;fit_t_&#39;, &#39;fit_scaling&#39;, &#39;fit_std_u&#39;, &#39;fit_std_s&#39;, &#39;fit_likelihood&#39;, &#39;fit_u0&#39;, &#39;fit_s0&#39;, &#39;fit_pval_steady&#39;, &#39;fit_steady_u&#39;, &#39;fit_steady_s&#39;, &#39;fit_variance&#39;, &#39;fit_alignment_scaling&#39;, &#39;fit_r2&#39;
    uns: &#39;pca&#39;, &#39;neighbors&#39;, &#39;velocity_params&#39;, &#39;velocity_graph&#39;, &#39;velocity_graph_neg&#39;, &#39;recover_dynamics&#39;
    obsm: &#39;X_umap&#39;, &#39;X_pca&#39;
    varm: &#39;PCs&#39;, &#39;loss&#39;
    layers: &#39;ambiguous&#39;, &#39;matrix&#39;, &#39;spliced&#39;, &#39;unspliced&#39;, &#39;Ms&#39;, &#39;Mu&#39;, &#39;velocity&#39;, &#39;variance_velocity&#39;, &#39;fit_t&#39;, &#39;fit_tau&#39;, &#39;fit_tau_&#39;, &#39;velocity_u&#39;
    obsp: &#39;distances&#39;, &#39;connectivities&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scv</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">velocity_embedding_grid</span><span class="p">(</span><span class="n">adata_velo_stumor_dynamical</span><span class="p">,</span> <span class="n">basis</span><span class="o">=</span><span class="s1">&#39;umap&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;cell_subtype&#39;</span><span class="p">,</span>
                               <span class="n">size</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">arrow_color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span>
                               <span class="n">arrow_size</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">arrow_length</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">min_mass</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">smooth</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                               <span class="n">save</span><span class="o">=</span><span class="s1">&#39;figures/stumor_grid.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="n">subtype_color</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>computing velocity embedding
    finished (0:00:05) --&gt; added
    &#39;velocity_umap&#39;, embedded velocity vectors (adata.obsm)
saving figure to file figures/stumor_grid.png
</pre></div>
</div>
<img alt="_images/GEXCD8_241_1.png" src="_images/GEXCD8_241_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scv</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">velocity_embedding_stream</span><span class="p">(</span><span class="n">adata_velo_stumor_dynamical</span><span class="p">,</span> <span class="n">basis</span><span class="o">=</span><span class="s1">&#39;umap&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;meta_tissue_type&#39;</span><span class="p">,</span>
                                 <span class="n">size</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">arrow_color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span>
                                 <span class="n">smooth</span><span class="o">=</span><span class="mf">1.2</span><span class="p">,</span>
                                 <span class="n">save</span><span class="o">=</span><span class="s1">&#39;figures/stumor_stream.pdf&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="n">tissue_type_color</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>saving figure to file figures/stumor_stream.pdf
</pre></div>
</div>
<img alt="_images/GEXCD8_242_1.png" src="_images/GEXCD8_242_1.png" />
</div>
</div>
</div>
</div>
</div>
<div class="tex2jax_ignore mathjax_ignore section" id="transfervae">
<h1>TransferVAE<a class="headerlink" href="#transfervae" title="Permalink to this headline">Â¶</a></h1>
<div class="section" id="mainfigures">
<h2>MainFigures<a class="headerlink" href="#mainfigures" title="Permalink to this headline">Â¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## Processing query adata pipeline</span>
<span class="c1"># adata_1 = sc.read_h5ad(&quot;./20221102_Huardb_All.cd8.remove_hsp_mt_rpl_dnaj.h5ad&quot;)</span>
<span class="c1"># adata_2 = sc.concat([sc.read_h5ad(&quot;./GSE200996_Figure_CD8.h5ad&quot;), </span>
<span class="c1">#                      sc.read_h5ad (&quot;./GSE200996_Figure1.h5ad&quot;), sc.read_h5ad(&quot;./Watson_2021.h5ad&quot;)])</span>
<span class="c1"># adata = sc.concat([adata_1, adata_2])</span>
<span class="c1"># sc.pp.highly_variable_genes(adata, n_top_genes=5000, flavor=&#39;seurat_v3&#39;)</span>
<span class="c1"># adata_1 = adata_1[:, adata.var[adata.var[&#39;highly_variable&#39;]].index]</span>
<span class="c1"># adata_2 = adata_2[:, adata.var[adata.var[&#39;highly_variable&#39;]].index]</span>

<span class="c1"># from sctorch.model._vae import *</span>
<span class="c1"># model = VAE(adata=adata_1, batch_key=&quot;sample_name&quot;, device=&#39;cuda:2&#39;, constrain_latent_embedding=True)</span>
<span class="c1"># model.fit(max_epoch=32, lr=5e-5)</span>
<span class="c1"># model.transfer(adata_2, &#39;sample_name&#39;)</span>
<span class="c1"># model.adata = sc.concat([adata_1, adata_2], join=&#39;outer&#39;)[:,adata_1.var.index]</span>
<span class="c1"># model.initialize_dataset()</span>
<span class="c1"># Z = model.get_latent_embedding()</span>
<span class="c1"># z = umap.UMAP(n_jobs=32).fit_transform(Z)</span>
<span class="c1"># model.adata.obsm[&quot;X_umap&quot;] = z</span>
<span class="c1"># model.adata.obsm[&quot;X_pca&quot;] = Z</span>
<span class="c1"># model.adata.write_h5ad(&quot;vae_transfer_watson_luoma.h5ad&quot;)</span>

<span class="c1">## annotate cell subtype </span>
<span class="c1"># from sklearn.neighbors import KNeighborsClassifier</span>
<span class="c1"># obs = pd.read_csv(&quot;./20221101_adata_nogex_obs.csv&quot;, index_col=0)</span>
<span class="c1"># adata = sc.read_h5ad(&#39;vae_transfer_watson_luoma.h5ad&#39;)</span>
<span class="c1"># adata.obs[&#39;type&#39;]=&#39;query&#39;</span>
<span class="c1"># adata.obs.loc[obs.index,&#39;type&#39;] = &#39;reference&#39;</span>
<span class="c1"># adata.obs.loc[obs.index,&#39;cell_subtype&#39;] = list(obs[&#39;cell_subtype&#39;])</span>

<span class="c1"># knnc = KNeighborsClassifier(n_neighbors=23, n_jobs=16)</span>
<span class="c1"># knnc.fit(adata[adata.obs[&#39;type&#39;] == &#39;reference&#39;].obsm[&quot;X_pca&quot;], adata.obs.loc[adata.obs[&#39;type&#39;] == &#39;reference&#39;, &#39;cell_subtype&#39;])</span>
<span class="c1"># adata.obs.loc[adata.obs[&#39;type&#39;] != &#39;reference&#39;, &#39;cell_subtype&#39;] =  knnc.predict(adata[adata.obs[&#39;type&#39;] != &#39;reference&#39;].obsm[&quot;X_pca&quot;])</span>
<span class="c1"># adata.write_h5ad(&quot;annotated_vae_transfer_watson_luoma.h5ad&quot;)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># /Volumes/qwet/wlz_tmp/VAEdata/20221209_vae_comparison/.</span>
<span class="c1"># ./zuozhu_vae_study_study_5000/annotated_vae_transfer_watson_luoma_oldgene.h5ad</span>
<span class="n">adata</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">read_h5ad</span><span class="p">(</span><span class="s1">&#39;./source/CD8Mapper_data/waston_luoma_annotation.h5ad&#39;</span><span class="p">)</span>
<span class="n">adata</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="s1">&#39;raw&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">adata</span><span class="o">.</span><span class="n">X</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sample_information</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;./source/CD8Mapper_data/VAEsampleINFO.csv&quot;</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">meta_alteration</span><span class="p">(</span><span class="n">k</span><span class="p">):</span>
    <span class="n">obs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">sample_information</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
        <span class="n">obs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;sample_name&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">i</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">sample_information</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>
    <span class="n">obs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">obs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;category&#39;</span><span class="p">)</span>
    
<span class="n">adata</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;sample_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">adata</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;sample_name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;str&#39;</span><span class="p">)</span>
<span class="n">adata</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
    <span class="n">adata</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;study_name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Watson_2021&#39;</span><span class="p">,</span> <span class="s1">&#39;sample_name&#39;</span>
<span class="p">]</span> <span class="o">=</span> <span class="p">[</span> <span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">adata</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">adata</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;study_name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Watson_2021&#39;</span><span class="p">,</span> <span class="s1">&#39;sample_name&#39;</span><span class="p">]</span> <span class="p">]</span>
<span class="n">adata</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
    <span class="n">adata</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;study_name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Watson_2021&#39;</span><span class="p">,</span> <span class="s1">&#39;sample_name&#39;</span>
<span class="p">]</span> <span class="o">=</span> <span class="p">[</span> <span class="n">x</span><span class="o">+</span><span class="s2">&quot;_Watson&quot;</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">adata</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">adata</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;study_name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Watson_2021&#39;</span><span class="p">,</span> <span class="s1">&#39;sample_name&#39;</span><span class="p">]</span> <span class="p">]</span>
<span class="n">adata</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;sample_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">adata</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;sample_name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;category&#39;</span><span class="p">)</span>
<span class="n">obs</span> <span class="o">=</span> <span class="n">adata</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">meta_alteration</span><span class="p">(</span><span class="s1">&#39;disease&#39;</span><span class="p">)</span>
<span class="n">meta_alteration</span><span class="p">(</span><span class="s1">&#39;meta_tissue_type&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">adata</span><span class="o">.</span><span class="n">obs</span> <span class="o">=</span> <span class="n">obs</span><span class="p">[</span><span class="n">obs</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">adata</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">index</span><span class="p">)]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">luoma_raw_TIL</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">read_h5ad</span><span class="p">(</span><span class="s2">&quot;./source/CD8Mapper_data/luoma_raw_TIL.h5ad&quot;</span><span class="p">)</span>
<span class="n">luoma_raw_TIL</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="s1">&#39;raw&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">luoma_raw_TIL</span><span class="o">.</span><span class="n">X</span>
<span class="n">luoma_raw_PBMC</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">read_h5ad</span><span class="p">(</span><span class="s2">&quot;./source/CD8Mapper_data/luoma_raw_PBMC.h5ad&quot;</span><span class="p">)</span>
<span class="n">luoma_raw_PBMC</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="s1">&#39;raw&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">luoma_raw_PBMC</span><span class="o">.</span><span class="n">X</span>
<span class="n">luoma_origin</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">luoma_raw_PBMC</span><span class="p">,</span><span class="n">luoma_raw_TIL</span><span class="p">])</span>
<span class="n">watson_origin</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">read_h5ad</span><span class="p">(</span><span class="s2">&quot;./source/CD8Mapper_data/waston_origin.h5ad&quot;</span><span class="p">)</span>
<span class="n">watson_origin</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="s1">&#39;raw&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">watson_origin</span><span class="o">.</span><span class="n">X</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">adata</span><span class="o">.</span><span class="n">obs_names_make_unique</span><span class="p">()</span>
<span class="n">sc</span><span class="o">.</span><span class="n">pp</span><span class="o">.</span><span class="n">normalize_total</span><span class="p">(</span><span class="n">adata</span><span class="p">)</span>
<span class="n">sc</span><span class="o">.</span><span class="n">pp</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="n">adata</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">adata</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;orginal_annoatations&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">luoma_origin</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;CellType_ID&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">luoma_origin</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;CellType_ID&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;str&#39;</span><span class="p">)</span>
<span class="n">watson_origin</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;assignment_final&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">watson_origin</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;assignment_final&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;str&#39;</span><span class="p">)</span>
<span class="n">watson_origin</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="p">[</span> <span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;-Watson_2021-&#39;</span><span class="o">+</span><span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">watson_origin</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">index</span> <span class="p">]</span>

<span class="n">adata</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;orginal_annoatations&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">luoma_origin</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;CellType_ID&#39;</span><span class="p">]</span>
<span class="n">adata</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">adata</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;study_name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Watson_2021&#39;</span><span class="p">,</span> 
              <span class="s1">&#39;orginal_annoatations&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">watson_origin</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;assignment_final&#39;</span><span class="p">])</span>
<span class="n">adata</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;orginal_annoatations&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">adata</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;orginal_annoatations&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;category&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">adata</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;disease&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="n">adata</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;disease&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;str&#39;</span><span class="p">)</span>
<span class="n">adata</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">adata</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;disease&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;nan&#39;</span><span class="p">,</span> <span class="s1">&#39;disease&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">adata_nogex</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;disease&#39;</span><span class="p">]</span>
<span class="n">adata</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;disease&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="n">adata</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;disease&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;category&#39;</span><span class="p">)</span>

<span class="n">adata</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;meta_tissue_type&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="n">adata</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;meta_tissue_type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;str&#39;</span><span class="p">)</span>
<span class="n">adata</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">adata</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;meta_tissue_type&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;nan&#39;</span><span class="p">,</span> <span class="s1">&#39;meta_tissue_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">adata_nogex</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;meta_tissue_type&#39;</span><span class="p">]</span>
<span class="n">adata</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">adata</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;meta_tissue_type&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Tumor_infiltrating_lymphocyte&#39;</span><span class="p">,</span> 
                     <span class="s1">&#39;meta_tissue_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;TIL&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">adata_query</span> <span class="o">=</span> <span class="n">adata</span><span class="p">[</span><span class="n">adata</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;query&#39;</span><span class="p">]</span>
<span class="c1"># subset Luoma</span>
<span class="n">adata_luoma</span> <span class="o">=</span> <span class="n">adata</span><span class="p">[</span><span class="n">adata</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;study_name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Luoma_2022&#39;</span><span class="p">]</span>
<span class="n">adata_luoma_TIL</span> <span class="o">=</span> <span class="n">adata_luoma</span><span class="p">[</span><span class="n">adata_luoma</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;meta_tissue_type&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;TIL&#39;</span><span class="p">]</span>
<span class="n">adata_luoma_PBMC</span> <span class="o">=</span> <span class="n">adata_luoma</span><span class="p">[</span><span class="n">adata_luoma</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;meta_tissue_type&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;PBMC&#39;</span><span class="p">]</span>
<span class="c1"># subset Watson</span>
<span class="n">adata_watson</span> <span class="o">=</span> <span class="n">adata</span><span class="p">[</span><span class="n">adata</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;study_name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Watson_2021&#39;</span><span class="p">]</span>
<span class="c1"># subset heatmap</span>
<span class="n">disease_subtypes_plot</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;Melanoma(pre)&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Melanoma(post)&#39;</span><span class="p">,</span>
    <span class="s1">&#39;HNSCC(pre)&#39;</span><span class="p">,</span>
    <span class="s1">&#39;HNSCC(post)&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Melanoma&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Squamous cell carcinoma tumor&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Basal cell carinoma tumor&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Esophagus squamous cell carcinoma&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Nasopharyngeal carcinoma&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Breast cancer&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Clear cell renal cell carcinoma&#39;</span><span class="p">,</span>
<span class="p">]</span>
<span class="n">adata_filter_disease</span> <span class="o">=</span> <span class="n">adata</span><span class="p">[</span><span class="n">adata</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;disease&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">disease_subtypes_plot</span><span class="p">)]</span>
<span class="n">adata_filter_disease_tissue</span> <span class="o">=</span> <span class="n">adata_filter_disease</span><span class="p">[</span>
    <span class="p">(</span><span class="n">adata_filter_disease</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;meta_tissue_type&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;TIL&#39;</span><span class="p">)</span> <span class="o">|</span>
    <span class="p">(</span><span class="n">adata_filter_disease</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;meta_tissue_type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;Tissue&#39;</span><span class="p">))]</span>
<span class="n">adata_filter_disease_PBMC</span> <span class="o">=</span> <span class="n">adata_filter_disease</span><span class="p">[</span><span class="n">adata_filter_disease</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;meta_tissue_type&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;PBMC&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">adata</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;query_subtype&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">adata_query</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;cell_subtype&#39;</span><span class="p">]</span>
<span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span>
<span class="n">sc</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">umap</span><span class="p">(</span><span class="n">adata</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;query_subtype&#39;</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> 
           <span class="n">palette</span><span class="o">=</span><span class="n">subtype_color</span><span class="p">,</span>
           <span class="n">na_color</span><span class="o">=</span><span class="s1">&#39;#F3F3F3&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;./figures/query_subtype.png&quot;</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/GEXCD8_254_0.png" src="_images/GEXCD8_254_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tissue_subtype_aggr_hm</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([])</span>
<span class="n">tissue_subtype_aggr_hm</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">cell_subtypes</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">disease_subtypes_plot</span><span class="p">:</span>
    <span class="n">condition_subtypes</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">Counter</span><span class="p">(</span>
        <span class="n">adata_filter_disease_PBMC</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="n">adata_filter_disease_PBMC</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;disease&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">cell_subtype</span><span class="p">))</span>
    <span class="n">tissue_subtype_aggr_hm</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
        <span class="p">[</span><span class="n">tissue_subtype_aggr_hm</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">condition_subtypes</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">tissue_subtype_aggr_hm</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">tissue_subtype_aggr_hm</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

<span class="n">tissue_subtype_aggr_hm</span> <span class="o">=</span> <span class="n">tissue_subtype_aggr_hm</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">tissue_subtype_aggr_hm</span> <span class="o">=</span> <span class="n">tissue_subtype_aggr_hm</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,(</span><span class="n">tissue_subtype_aggr_hm</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)]</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tissue_subtype_aggr_hm</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
    <span class="n">tissue_subtype_aggr_hm</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span> <span class="n">x</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="n">tissue_subtype_aggr_hm</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">tissue_subtype_aggr_hm</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">]</span>

<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>    
<span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span>
<span class="n">cmaps</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">color_palette</span><span class="p">(</span><span class="s2">&quot;ch:start=.2,rot=-.3&quot;</span><span class="p">,</span> <span class="n">as_cmap</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">tissue_subtype_aggr_hm</span><span class="p">,</span> <span class="n">square</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;OrRd&#39;</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span><span class="c1">#, linewidth=1)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">(),</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_yticklabels</span><span class="p">(),</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;./figures/disease_subtype_PBMC.pdf&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/GEXCD8_255_0.png" src="_images/GEXCD8_255_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tissue_subtype_aggr_hm</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([])</span>
<span class="n">tissue_subtype_aggr_hm</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">cell_subtypes</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">disease_subtypes_plot</span><span class="p">:</span>
    <span class="n">condition_subtypes</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">Counter</span><span class="p">(</span>
        <span class="n">adata_filter_disease_tissue</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="n">adata_filter_disease_tissue</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;disease&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">cell_subtype</span><span class="p">))</span>
    <span class="n">tissue_subtype_aggr_hm</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
        <span class="p">[</span><span class="n">tissue_subtype_aggr_hm</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">condition_subtypes</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">tissue_subtype_aggr_hm</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">tissue_subtype_aggr_hm</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

<span class="n">tissue_subtype_aggr_hm</span> <span class="o">=</span> <span class="n">tissue_subtype_aggr_hm</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">tissue_subtype_aggr_hm</span> <span class="o">=</span> <span class="n">tissue_subtype_aggr_hm</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,(</span><span class="n">tissue_subtype_aggr_hm</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)]</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tissue_subtype_aggr_hm</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
    <span class="n">tissue_subtype_aggr_hm</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span> <span class="n">x</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="n">tissue_subtype_aggr_hm</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">tissue_subtype_aggr_hm</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">]</span>

<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>    
<span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span>
<span class="n">cmaps</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">color_palette</span><span class="p">(</span><span class="s2">&quot;ch:start=.2,rot=-.3&quot;</span><span class="p">,</span> <span class="n">as_cmap</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">tissue_subtype_aggr_hm</span><span class="p">,</span> <span class="n">square</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span><span class="c1">#, linewidth=1)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">(),</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_yticklabels</span><span class="p">(),</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;./figures/disease_subtype_PBMC.pdf&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/GEXCD8_256_0.png" src="_images/GEXCD8_256_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span>
<span class="n">sc</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">umap</span><span class="p">(</span><span class="n">adata_watson</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;orginal_annoatations&#39;</span><span class="p">,</span> <span class="n">na_color</span><span class="o">=</span><span class="s1">&#39;#F3F3F3&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
           <span class="n">palette</span><span class="o">=</span><span class="n">sc</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">palettes</span><span class="o">.</span><span class="n">default_20</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;./figures/watson_original.png&quot;</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span>
<span class="n">sc</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">umap</span><span class="p">(</span><span class="n">adata_watson</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;cell_subtype&#39;</span><span class="p">,</span> <span class="n">na_color</span><span class="o">=</span><span class="s1">&#39;#F3F3F3&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
           <span class="n">palette</span><span class="o">=</span><span class="n">subtype_color</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;./figures/watson_subtype.png&quot;</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/GEXCD8_257_0.png" src="_images/GEXCD8_257_0.png" />
<img alt="_images/GEXCD8_257_1.png" src="_images/GEXCD8_257_1.png" />
</div>
</div>
</div>
<div class="section" id="id9">
<h2>SupFigures<a class="headerlink" href="#id9" title="Permalink to this headline">Â¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">adata_query</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;disease_tissue&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">adata_query</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
    <span class="n">adata_query</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;meta_tissue_type&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;PBMC&#39;</span><span class="p">,</span> <span class="s1">&#39;disease_tissue&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">x</span><span class="o">+</span><span class="s1">&#39;_PBMC&#39;</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">adata_query</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">adata_query</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;meta_tissue_type&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;PBMC&#39;</span><span class="p">,</span> <span class="s1">&#39;disease&#39;</span><span class="p">]</span> <span class="p">]</span>
<span class="n">adata_query</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
    <span class="n">adata_query</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;meta_tissue_type&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;TIL&#39;</span><span class="p">,</span> <span class="s1">&#39;disease_tissue&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">x</span><span class="o">+</span><span class="s1">&#39;_TIL&#39;</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">adata_query</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">adata_query</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;meta_tissue_type&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;TIL&#39;</span><span class="p">,</span> <span class="s1">&#39;disease&#39;</span><span class="p">]</span> <span class="p">]</span>

<span class="n">adata</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;disease_tissue&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">adata_query</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;disease_tissue&#39;</span><span class="p">]</span>

<span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span>
<span class="n">sc</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">umap</span><span class="p">(</span><span class="n">adata</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;disease_tissue&#39;</span><span class="p">,</span> <span class="n">na_color</span><span class="o">=</span><span class="s1">&#39;#F3F3F3&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
           <span class="n">palette</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;#5E81C1&#39;</span><span class="p">,</span><span class="s1">&#39;#b8d391&#39;</span><span class="p">,</span><span class="s1">&#39;#d33f6a&#39;</span><span class="p">,</span><span class="s1">&#39;#F6B25F&#39;</span><span class="p">,</span><span class="s1">&#39;#4d97ac&#39;</span><span class="p">])</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;./figures/disease_tissue.png&quot;</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/GEXCD8_259_0.png" src="_images/GEXCD8_259_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">adata_query</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;cell_subtype&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">adata_query</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;cell_subtype&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">reorder_categories</span><span class="p">(</span><span class="n">cell_subtypes</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span>
<span class="n">sc</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">dotplot</span><span class="p">(</span><span class="n">adata_query</span><span class="p">,</span> <span class="n">var_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;S1PR1&quot;</span><span class="p">,</span> 
                                      <span class="s2">&quot;SELL&quot;</span><span class="p">,</span> <span class="s2">&quot;IL7R&quot;</span><span class="p">,</span><span class="s2">&quot;KLRG1&quot;</span><span class="p">,</span>
                                      <span class="s2">&quot;GZMK&quot;</span><span class="p">,</span> <span class="s2">&quot;CREM&quot;</span><span class="p">,</span><span class="s2">&quot;CX3CR1&quot;</span><span class="p">,</span><span class="s2">&quot;IFITM3&quot;</span><span class="p">,</span>
                                      <span class="s2">&quot;KLRB1&quot;</span><span class="p">,</span> <span class="s2">&quot;ZBTB16&quot;</span><span class="p">,</span> 
                                      <span class="s2">&quot;FCER1G&quot;</span><span class="p">,</span> <span class="s2">&quot;TYROBP&quot;</span><span class="p">,</span>
                                      <span class="s2">&quot;ITGAE&quot;</span><span class="p">,</span> <span class="s2">&quot;ITGA1&quot;</span><span class="p">,</span><span class="s2">&quot;ITGB2&quot;</span><span class="p">,</span>
                                      <span class="s2">&quot;TCF7&quot;</span><span class="p">,</span> <span class="s2">&quot;PDCD1&quot;</span><span class="p">,</span> <span class="s2">&quot;HAVCR2&quot;</span><span class="p">,</span>
                                      <span class="s2">&quot;TIGIT&quot;</span><span class="p">,</span> <span class="s2">&quot;CXCR6&quot;</span><span class="p">,</span>
                                      <span class="s2">&quot;MKI67&quot;</span><span class="p">,</span> <span class="s2">&quot;CDC20&quot;</span><span class="p">],</span> <span class="n">groupby</span><span class="o">=</span><span class="s1">&#39;cell_subtype&#39;</span><span class="p">,</span> <span class="n">dot_max</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> 
              <span class="n">standard_scale</span><span class="o">=</span><span class="s1">&#39;var&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;./figures/dotplot.pdf&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/GEXCD8_260_0.png" src="_images/GEXCD8_260_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">luoma_pbmc_palettes</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;#3876bb&#39;</span><span class="p">,</span>
    <span class="s1">&#39;#e64440&#39;</span><span class="p">,</span>
    <span class="s1">&#39;#009378&#39;</span><span class="p">,</span>
    <span class="s1">&#39;#cb62a0&#39;</span><span class="p">,</span>
    <span class="s1">&#39;#b8d391&#39;</span><span class="p">,</span>
    <span class="s1">&#39;#ef9c00&#39;</span><span class="p">,</span>
    <span class="s1">&#39;#69c5d9&#39;</span><span class="p">,</span>
    <span class="s1">&#39;#f6cf16&#39;</span><span class="p">,</span>
    <span class="s1">&#39;#d2d2cd&#39;</span>
<span class="p">]</span>
<span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span>
<span class="n">PBMC_subtypes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">luoma_raw_PBMC</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;CellType_ID&#39;</span><span class="p">])</span>
<span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">PBMC_subtypes</span><span class="p">):</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">luoma_raw_PBMC</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">luoma_raw_PBMC</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;CellType_ID&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">i</span><span class="p">,</span> <span class="s1">&#39;UMAP_1&#39;</span><span class="p">],</span> 
               <span class="n">luoma_raw_PBMC</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">luoma_raw_PBMC</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;CellType_ID&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">i</span><span class="p">,</span> <span class="s1">&#39;UMAP_2&#39;</span><span class="p">],</span> 
               <span class="n">c</span><span class="o">=</span><span class="n">luoma_pbmc_palettes</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">s</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;./figures/luoma_TIL_paper.png&quot;</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span>
<span class="n">sc</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">umap</span><span class="p">(</span><span class="n">adata_luoma_PBMC</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;orginal_annoatations&#39;</span><span class="p">,</span> <span class="n">na_color</span><span class="o">=</span><span class="s1">&#39;#F3F3F3&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
           <span class="n">palette</span><span class="o">=</span><span class="n">luoma_pbmc_palettes</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;./figures/luoma_pbmc_original.png&quot;</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span>
<span class="n">sc</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">umap</span><span class="p">(</span><span class="n">adata_luoma_PBMC</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;cell_subtype&#39;</span><span class="p">,</span> <span class="n">na_color</span><span class="o">=</span><span class="s1">&#39;#F3F3F3&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
           <span class="n">palette</span><span class="o">=</span><span class="n">subtype_color</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;./figures/luoma_pbmc_subtype.png&quot;</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/GEXCD8_261_0.png" src="_images/GEXCD8_261_0.png" />
<img alt="_images/GEXCD8_261_1.png" src="_images/GEXCD8_261_1.png" />
<img alt="_images/GEXCD8_261_2.png" src="_images/GEXCD8_261_2.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span>
<span class="n">TIL_subtypes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">luoma_raw_TIL</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;CellType_ID&#39;</span><span class="p">])</span>
<span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">TIL_subtypes</span><span class="p">):</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">luoma_raw_TIL</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">luoma_raw_TIL</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;CellType_ID&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">i</span><span class="p">,</span> <span class="s1">&#39;UMAP_1&#39;</span><span class="p">],</span> 
               <span class="n">luoma_raw_TIL</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">luoma_raw_TIL</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;CellType_ID&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">i</span><span class="p">,</span> <span class="s1">&#39;UMAP_2&#39;</span><span class="p">],</span> 
               <span class="n">c</span><span class="o">=</span><span class="n">sc</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">palettes</span><span class="o">.</span><span class="n">default_20</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">s</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="c1"># fig.savefig(&quot;/Volumes/rsch/20221107_results/FigureVAE/luoma_TIL_paper.png&quot;,dpi=600)</span>

<span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span>
<span class="n">sc</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">umap</span><span class="p">(</span><span class="n">adata_luoma_TIL</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;orginal_annoatations&#39;</span><span class="p">,</span> <span class="n">na_color</span><span class="o">=</span><span class="s1">&#39;#F3F3F3&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
           <span class="n">palette</span><span class="o">=</span><span class="n">sc</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">palettes</span><span class="o">.</span><span class="n">default_20</span><span class="p">)</span>
<span class="c1"># fig.savefig(&quot;/Volumes/rsch/20221107_results/FigureVAE/luoma_TIL_original.png&quot;,dpi=600)</span>

<span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span>
<span class="n">sc</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">umap</span><span class="p">(</span><span class="n">adata_luoma_TIL</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;cell_subtype&#39;</span><span class="p">,</span> <span class="n">na_color</span><span class="o">=</span><span class="s1">&#39;#F3F3F3&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
           <span class="n">palette</span><span class="o">=</span><span class="n">subtype_color</span><span class="p">)</span>
<span class="c1"># fig.savefig(&quot;/Volumes/rsch/20221107_results/FigureVAE/luoma_TIL_subtype.png&quot;,dpi=600)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/GEXCD8_262_0.png" src="_images/GEXCD8_262_0.png" />
<img alt="_images/GEXCD8_262_1.png" src="_images/GEXCD8_262_1.png" />
<img alt="_images/GEXCD8_262_2.png" src="_images/GEXCD8_262_2.png" />
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            
                <!-- Previous / next buttons -->
<div class='prev-next-area'>
</div>
            
        </div>
    </div>
    <footer class="footer">
  <p>
    
      By Ziwei Xue<br/>
    
        &copy; Copyright 2023.<br/>
  </p>
</footer>
</main>


      </div>
    </div>
  
  <script src="_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>