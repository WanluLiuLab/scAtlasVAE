
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Import Basic Packages and Definitions &#8212; TCR paper notebook</title>
    
  <link href="_static/css/theme.css" rel="stylesheet">
  <link href="_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/sphinx-book-theme.d59cb220de22ca1c485ebbdc042f0030.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="TCR-DeepInsight Vignette" href="huARdb_TCR_DeepInsight_notebook.html" />
    <link rel="prev" title="Welcome to the huARdb TCR analysis notebook" href="intro.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">TCR paper notebook</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="intro.html">
   Welcome to the huARdb TCR analysis notebook
  </a>
 </li>
</ul>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Import Basic Packages and Definitions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="huARdb_TCR_DeepInsight_notebook.html">
   TCR-DeepInsight Vignette
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="_sources/huARdb_TCR_paper_notebook.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
                onclick="printPdf(this)" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/WanluLiuLab/TCR-DeepInsight"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/WanluLiuLab/TCR-DeepInsight/issues/new?title=Issue%20on%20page%20%2FhuARdb_TCR_paper_notebook.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/WanluLiuLab/TCR-DeepInsight/master?urlpath=tree/docs/huARdb_TCR_paper_notebook.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show noprint">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   Import Basic Packages and Definitions
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#reading-data">
   Reading Data
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#basic-statistics">
   Basic Statistics
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#dataset-statistics">
     Dataset statistics
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#figure-1b">
       [Figure 1B]
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#tcr-statistics">
     TCR Statistics
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#figure-s3e">
       [Figure S3E]
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#gex-statistics">
     GEX statistics
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#figure-1c">
       [Figure 1C]
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#figure-s2a">
       [Figure S2A]
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#figure-1d">
       [Figure 1D]
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#figure-s2c">
       [Figure S2C]
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#figure-s2b">
       Figure S2B
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#figure-1e">
       Figure 1E
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#vj-segment-joining-analysis">
   VJ-segment joining analysis
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#single-vj-segment-and-t-cell-type">
     Single VJ segment and T cell type
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#paired-vj-segment-and-t-cell-type">
     Paired VJ segment and T cell type
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#figure2a">
       [Figure2A]
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#figure-2b">
       [Figure 2B]
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#figure-2c">
       [Figure 2C]
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#cdr-region-and-t-cell-type">
   CDR region and T cell type
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#figure-2d">
     [Figure 2D]
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#figure-s3a-d-f">
     [Figure S3A-D, F]
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#recurrent-tcr-analysis">
   Recurrent TCR analysis
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#recurrent-tcr-alpha-beta">
     Recurrent TCR (alpha-beta)
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#recurrent-tcr-beta">
     Recurrent TCR (beta)
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#recurrent-tcr-alpha">
     Recurrent TCR (alpha)
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#summary-of-recurrent-tcr">
     Summary of recurrent TCR
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#pgen-of-recurrent-tcr">
     Pgen of recurrent TCR
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#figure-3c">
       [Figure 3C]
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#cdr3mr-length-of-recurrent-tcr">
     CDR3mr length of recurrent TCR
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#figure-4d">
       [Figure 4D]
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#disease-specificity-analysis-of-recurrent-tcr">
     Disease specificity analysis of recurrent TCR
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#figure-4e-g">
       [Figure 4E-G]
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#tcr-coherence-analysis">
   TCR Coherence analysis
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#matching-to-known-tcrpmhc-dataset">
   Matching to known TCRpMHC dataset
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#figure-s4b">
     [Figure S4B]
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#tcr-deepinsight-result-visualization">
   TCR-DeepInsight Result Visualization
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Import Basic Packages and Definitions</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   Import Basic Packages and Definitions
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#reading-data">
   Reading Data
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#basic-statistics">
   Basic Statistics
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#dataset-statistics">
     Dataset statistics
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#figure-1b">
       [Figure 1B]
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#tcr-statistics">
     TCR Statistics
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#figure-s3e">
       [Figure S3E]
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#gex-statistics">
     GEX statistics
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#figure-1c">
       [Figure 1C]
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#figure-s2a">
       [Figure S2A]
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#figure-1d">
       [Figure 1D]
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#figure-s2c">
       [Figure S2C]
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#figure-s2b">
       Figure S2B
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#figure-1e">
       Figure 1E
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#vj-segment-joining-analysis">
   VJ-segment joining analysis
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#single-vj-segment-and-t-cell-type">
     Single VJ segment and T cell type
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#paired-vj-segment-and-t-cell-type">
     Paired VJ segment and T cell type
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#figure2a">
       [Figure2A]
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#figure-2b">
       [Figure 2B]
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#figure-2c">
       [Figure 2C]
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#cdr-region-and-t-cell-type">
   CDR region and T cell type
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#figure-2d">
     [Figure 2D]
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#figure-s3a-d-f">
     [Figure S3A-D, F]
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#recurrent-tcr-analysis">
   Recurrent TCR analysis
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#recurrent-tcr-alpha-beta">
     Recurrent TCR (alpha-beta)
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#recurrent-tcr-beta">
     Recurrent TCR (beta)
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#recurrent-tcr-alpha">
     Recurrent TCR (alpha)
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#summary-of-recurrent-tcr">
     Summary of recurrent TCR
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#pgen-of-recurrent-tcr">
     Pgen of recurrent TCR
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#figure-3c">
       [Figure 3C]
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#cdr3mr-length-of-recurrent-tcr">
     CDR3mr length of recurrent TCR
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#figure-4d">
       [Figure 4D]
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#disease-specificity-analysis-of-recurrent-tcr">
     Disease specificity analysis of recurrent TCR
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#figure-4e-g">
       [Figure 4E-G]
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#tcr-coherence-analysis">
   TCR Coherence analysis
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#matching-to-known-tcrpmhc-dataset">
   Matching to known TCRpMHC dataset
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#figure-s4b">
     [Figure S4B]
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#tcr-deepinsight-result-visualization">
   TCR-DeepInsight Result Visualization
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="import-basic-packages-and-definitions">
<h1>Import Basic Packages and Definitions<a class="headerlink" href="#import-basic-packages-and-definitions" title="Permalink to this headline">¶</a></h1>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">scanpy</span><span class="o">==</span><span class="mf">1.8.2</span>
<span class="n">anndata</span><span class="o">=</span><span class="mf">0.8.0</span>
<span class="n">numpy</span><span class="o">==</span><span class="mf">1.20.3</span>
<span class="n">pandas</span><span class="o">==</span><span class="mf">1.5.3</span>
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">scanpy</span> <span class="k">as</span> <span class="nn">sc</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span> 
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">gc</span>

<span class="k">def</span> <span class="nf">setPltLinewidth</span><span class="p">(</span><span class="n">linewidth</span><span class="p">:</span><span class="nb">float</span><span class="p">):</span>
    <span class="n">matplotlib</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;axes.linewidth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">linewidth</span>
    
<span class="n">setPltLinewidth</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.dpi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">300</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;savefig.dpi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">300</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">8</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;axes.linewidth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.family&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Arial&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">colour</span> <span class="kn">import</span> <span class="n">Color</span>
<span class="kn">from</span> <span class="nn">matplotlib.colors</span> <span class="kn">import</span> <span class="n">LinearSegmentedColormap</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span> 
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">colors</span> <span class="kn">import</span> <span class="o">*</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Loading Definitions...&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">FLATTEN</span><span class="p">(</span><span class="n">x</span><span class="p">):</span> <span class="k">return</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">x</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">s</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">createFig</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">)):</span>
    <span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>           
    <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>     
    <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
    <span class="c1">#ax.spines[&#39;bottom&#39;].set_color(&#39;none&#39;)     </span>
    <span class="c1">#ax.spines[&#39;left&#39;].set_color(&#39;none&#39;)</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">get_ticklines</span><span class="p">():</span>
        <span class="n">line</span><span class="o">.</span><span class="n">set_markersize</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
        <span class="n">line</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="s2">&quot;#585958&quot;</span><span class="p">)</span>
        <span class="n">line</span><span class="o">.</span><span class="n">set_markeredgewidth</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">get_ticklines</span><span class="p">():</span>
        <span class="n">line</span><span class="o">.</span><span class="n">set_markersize</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
        <span class="n">line</span><span class="o">.</span><span class="n">set_markeredgewidth</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="n">line</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="s2">&quot;#585958&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xbound</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ybound</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="n">figsize</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">fig</span><span class="p">,</span><span class="n">ax</span>

<span class="k">def</span> <span class="nf">createSubplots</span><span class="p">(</span><span class="n">nrow</span><span class="p">,</span><span class="n">ncol</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">)):</span>
    <span class="n">fig</span><span class="p">,</span><span class="n">axes</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrow</span><span class="p">,</span> <span class="n">ncol</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axes</span><span class="o">.</span><span class="n">flatten</span><span class="p">():</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>     
        <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">get_ticklines</span><span class="p">():</span>
            <span class="n">line</span><span class="o">.</span><span class="n">set_markersize</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
            <span class="n">line</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="s2">&quot;#585958&quot;</span><span class="p">)</span>
            <span class="n">line</span><span class="o">.</span><span class="n">set_markeredgewidth</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">get_ticklines</span><span class="p">():</span>
            <span class="n">line</span><span class="o">.</span><span class="n">set_markersize</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
            <span class="n">line</span><span class="o">.</span><span class="n">set_markeredgewidth</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
            <span class="n">line</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="s2">&quot;#585958&quot;</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="n">figsize</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">fig</span><span class="p">,</span><span class="n">axes</span>

<span class="k">def</span> <span class="nf">loadHLAGenotype</span><span class="p">():</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;./data/genotype.json&#39;</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">genotype</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;./data/partial_genotype.json&#39;</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">partial_genotype</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">genotype</span><span class="p">,</span> <span class="n">partial_genotype</span>

<span class="n">MHCI_DEFINITION</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;A_1&#39;</span><span class="p">,</span> <span class="s1">&#39;A_2&#39;</span><span class="p">,</span> <span class="s1">&#39;B_1&#39;</span><span class="p">,</span> <span class="s1">&#39;B_2&#39;</span><span class="p">,</span> <span class="s1">&#39;C_1&#39;</span><span class="p">,</span> <span class="s1">&#39;C_2&#39;</span><span class="p">]</span>

<span class="n">genotype</span><span class="p">,</span> <span class="n">partial_genotype</span> <span class="o">=</span> <span class="n">loadHLAGenotypeAsPandas</span><span class="p">()</span>
<span class="n">partial_genotype_raw</span> <span class="o">=</span> <span class="n">partial_genotype</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">partial_genotype</span> <span class="o">=</span> <span class="n">partial_genotype</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">partial_genotype</span><span class="p">[</span><span class="s2">&quot;A_1&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;-&#39;</span><span class="p">)</span> <span class="o">&amp;</span>
    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">partial_genotype</span><span class="p">[</span><span class="s2">&quot;A_2&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;-&#39;</span><span class="p">)</span> <span class="o">&amp;</span>
    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">partial_genotype</span><span class="p">[</span><span class="s2">&quot;B_1&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;-&#39;</span><span class="p">)</span> <span class="o">&amp;</span>
    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">partial_genotype</span><span class="p">[</span><span class="s2">&quot;B_2&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;-&#39;</span><span class="p">)</span> <span class="o">&amp;</span>
    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">partial_genotype</span><span class="p">[</span><span class="s2">&quot;C_1&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;-&#39;</span><span class="p">)</span> <span class="o">&amp;</span>
    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">partial_genotype</span><span class="p">[</span><span class="s2">&quot;C_2&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;-&#39;</span><span class="p">)</span>
<span class="p">]</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">partial_genotype</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
    <span class="n">partial_genotype</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
        <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;:&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)[:</span><span class="mi">1</span><span class="p">]),</span> 
            <span class="n">partial_genotype</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="p">))</span>

<span class="n">individual2hla</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">sample2individual</span><span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">sample2individual</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="nb">zip</span><span class="p">(</span><span class="n">partial_genotype</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">partial_genotype</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">())))))</span>
    

<span class="k">def</span> <span class="nf">to_pairing_level</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">11</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">i</span>
    <span class="k">elif</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">25</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">25</span>
    <span class="k">elif</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">50</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">50</span>
    <span class="k">elif</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">100</span>
    <span class="k">elif</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">250</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">250</span>
    <span class="k">elif</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">750</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">750</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">751</span>
    


<span class="k">def</span> <span class="nf">rgb2hex</span><span class="p">(</span><span class="n">vals</span><span class="p">,</span> <span class="n">rgbtype</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converts RGB values in a variety of formats to Hex values.</span>

<span class="sd">    @param  vals (tuple)     An RGB/RGBA tuple</span>
<span class="sd">    @param  rgbtype (int)    Valid valus are:</span>
<span class="sd">                        1 - Inputs are in the range 0 to 1</span>
<span class="sd">                        256 - Inputs are in the range 0 to 255</span>

<span class="sd">    @return A hex string in the form &#39;#RRGGBB&#39; or &#39;#RRGGBBAA&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">3</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">4</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
            <span class="s2">&quot;RGB or RGBA inputs to rgb2hex must have three or four elements!&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">rgbtype</span> <span class="o">!=</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">rgbtype</span> <span class="o">!=</span> <span class="mi">256</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;rgbtype must be 1 or 256!&quot;</span><span class="p">)</span>

    <span class="c1"># Convert from 0-1 RGB/RGBA to 0-255 RGB/RGBA</span>
    <span class="k">if</span> <span class="n">rgbtype</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">vals</span> <span class="o">=</span> <span class="p">[</span><span class="mi">255</span><span class="o">*</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">vals</span><span class="p">]</span>

    <span class="c1"># Ensure values are rounded integers, convert to hex, and concatenate</span>
    <span class="k">return</span> <span class="s1">&#39;#&#39;</span> <span class="o">+</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;</span><span class="si">{:02X}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">vals</span><span class="p">])</span>
    
    
<span class="k">def</span> <span class="nf">onemer</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">&#39;&#39;</span>
    
<span class="k">def</span> <span class="nf">twomer</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">&#39;&#39;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">s</span><span class="p">]</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">ret</span>
    
<span class="k">def</span> <span class="nf">make_colormap</span><span class="p">(</span> <span class="n">colors</span><span class="p">,</span> <span class="n">show_palette</span> <span class="o">=</span> <span class="kc">False</span> <span class="p">):</span> 
    <span class="n">color_ramp</span> <span class="o">=</span> <span class="n">LinearSegmentedColormap</span><span class="o">.</span><span class="n">from_list</span><span class="p">(</span> <span class="s1">&#39;my_list&#39;</span><span class="p">,</span> <span class="p">[</span> <span class="n">Color</span><span class="p">(</span> <span class="n">c1</span> <span class="p">)</span><span class="o">.</span><span class="n">rgb</span> <span class="k">for</span> <span class="n">c1</span> <span class="ow">in</span> <span class="n">colors</span> <span class="p">]</span> <span class="p">)</span>
    <span class="k">if</span> <span class="n">show_palette</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span> <span class="n">colors</span> <span class="p">)</span> <span class="p">,</span> <span class="mf">0.1</span><span class="p">))</span> <span class="p">]</span> <span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span> <span class="n">color_ramp</span> <span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">([])</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">([])</span>
    <span class="k">return</span> <span class="n">color_ramp</span>

<span class="n">kw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">arrowprops</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">arrowstyle</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">),</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">custom_pie2</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="n">anno</span><span class="p">,</span><span class="n">cm_dict</span><span class="p">,</span><span class="n">radius</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">setp</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">show_anno</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="n">pie</span><span class="p">,</span><span class="n">_</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">pie</span><span class="p">(</span><span class="n">anno</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> 
                 <span class="n">radius</span><span class="o">=</span><span class="n">radius</span><span class="p">,</span>
                 <span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="n">cm_dict</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">anno</span><span class="o">.</span><span class="n">keys</span><span class="p">()],</span> 
                 <span class="c1"># wedgeprops=dict(width=width, edgecolor=&#39;w&#39;)</span>
                <span class="p">)</span>
    <span class="k">if</span> <span class="n">setp</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">pie</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="n">width</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">pie</span><span class="p">):</span>
        <span class="n">theta1</span><span class="p">,</span> <span class="n">theta2</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">theta1</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">theta2</span>
        <span class="n">center</span><span class="p">,</span> <span class="n">r</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">center</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">r</span>
        <span class="n">ang</span> <span class="o">=</span> <span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">theta2</span> <span class="o">-</span> <span class="n">p</span><span class="o">.</span><span class="n">theta1</span><span class="p">)</span><span class="o">/</span><span class="mf">2.</span> <span class="o">+</span> <span class="n">p</span><span class="o">.</span><span class="n">theta1</span> 
        <span class="n">x</span> <span class="o">=</span> <span class="n">r</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span> <span class="o">*</span> <span class="p">(</span><span class="n">theta1</span><span class="o">+</span><span class="n">theta2</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">center</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">r</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span> <span class="o">*</span> <span class="p">(</span><span class="n">theta1</span><span class="o">+</span><span class="n">theta2</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">center</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">horizontalalignment</span> <span class="o">=</span> <span class="p">{</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span> <span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="s2">&quot;left&quot;</span><span class="p">}[</span><span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">x</span><span class="p">))]</span> 
        <span class="n">connectionstyle</span> <span class="o">=</span> <span class="s2">&quot;arc3, rad=0&quot;</span>
        <span class="n">kw</span><span class="p">[</span><span class="s2">&quot;arrowprops&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;connectionstyle&quot;</span><span class="p">:</span> <span class="n">connectionstyle</span><span class="p">})</span> 
        <span class="n">percentage</span> <span class="o">=</span> <span class="n">anno</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">anno</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="n">i</span><span class="p">]]</span> <span class="o">/</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">anno</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
        <span class="k">if</span> <span class="n">show_anno</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">anno</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">anno</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="n">i</span><span class="p">]]</span> <span class="o">/</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">anno</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span> <span class="o">&gt;</span> <span class="mf">0.005</span><span class="p">:</span> 
                <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">anno</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">percentage</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;%&quot;</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">),</span> <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="mf">1.2</span><span class="p">,</span> <span class="n">y</span><span class="o">*</span><span class="mf">1.2</span><span class="p">),</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="n">horizontalalignment</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">cm_dict</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">anno</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="n">i</span><span class="p">]])</span> 
    <span class="c1"># ax.text(x=0,y=0,s=str(sum(anno.values())),size=6, fontweight=900,horizontalalignment=&quot;center&quot;) </span>
    <span class="k">return</span> <span class="n">pie</span>



<span class="n">CELL_TYPE_CMAP</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;CD8&quot;</span><span class="p">:</span> <span class="n">make_colormap</span><span class="p">([</span><span class="s1">&#39;#ffffff&#39;</span><span class="p">,</span><span class="s1">&#39;#ffca39&#39;</span><span class="p">]),</span>
    <span class="s1">&#39;CD4&#39;</span><span class="p">:</span> <span class="n">make_colormap</span><span class="p">([</span><span class="s1">&#39;#ffffff&#39;</span><span class="p">,</span><span class="s1">&#39;#1c83c5&#39;</span><span class="p">]),</span>
    <span class="s1">&#39;Treg&#39;</span><span class="p">:</span> <span class="n">make_colormap</span><span class="p">([</span><span class="s1">&#39;#ffffff&#39;</span><span class="p">,</span><span class="s1">&#39;#6a4d93&#39;</span><span class="p">]),</span>
    <span class="s1">&#39;MAIT&#39;</span><span class="p">:</span> <span class="n">make_colormap</span><span class="p">([</span><span class="s1">&#39;#ffffff&#39;</span><span class="p">,</span><span class="s2">&quot;#2a9d8f&quot;</span><span class="p">]),</span>
    <span class="s2">&quot;cd8&quot;</span><span class="p">:</span> <span class="n">make_colormap</span><span class="p">([</span><span class="s1">&#39;#ffffff&#39;</span><span class="p">,</span><span class="s1">&#39;#ffca39&#39;</span><span class="p">]),</span>
    <span class="s1">&#39;cd4&#39;</span><span class="p">:</span> <span class="n">make_colormap</span><span class="p">([</span><span class="s1">&#39;#ffffff&#39;</span><span class="p">,</span><span class="s1">&#39;#1c83c5&#39;</span><span class="p">]),</span>
    <span class="s1">&#39;treg&#39;</span><span class="p">:</span> <span class="n">make_colormap</span><span class="p">([</span><span class="s1">&#39;#ffffff&#39;</span><span class="p">,</span><span class="s1">&#39;#6a4d93&#39;</span><span class="p">]),</span>
    <span class="s1">&#39;mait&#39;</span><span class="p">:</span> <span class="n">make_colormap</span><span class="p">([</span><span class="s1">&#39;#ffffff&#39;</span><span class="p">,</span><span class="s2">&quot;#2a9d8f&quot;</span><span class="p">])</span>
<span class="p">}</span>

<span class="n">CELL_TYPE_C</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;CD8&quot;</span><span class="p">:</span> <span class="s1">&#39;#ffca39&#39;</span><span class="p">,</span>
    <span class="s1">&#39;CD4&#39;</span><span class="p">:</span> <span class="s1">&#39;#1c83c5&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Treg&#39;</span><span class="p">:</span> <span class="s1">&#39;#6a4d93&#39;</span><span class="p">,</span>
    <span class="s1">&#39;MAIT&#39;</span><span class="p">:</span> <span class="s2">&quot;#2a9d8f&quot;</span><span class="p">,</span>
    <span class="s2">&quot;cd8&quot;</span><span class="p">:</span> <span class="s1">&#39;#ffca39&#39;</span><span class="p">,</span>
    <span class="s1">&#39;cd4&#39;</span><span class="p">:</span> <span class="s1">&#39;#1c83c5&#39;</span><span class="p">,</span>
    <span class="s1">&#39;treg&#39;</span><span class="p">:</span> <span class="s1">&#39;#6a4d93&#39;</span><span class="p">,</span>
    <span class="s1">&#39;mait&#39;</span><span class="p">:</span> <span class="s2">&quot;#2a9d8f&quot;</span><span class="p">,</span>
    <span class="s1">&#39;DP/DN&#39;</span><span class="p">:</span> <span class="s2">&quot;#F7F7F7&quot;</span><span class="p">,</span>
    <span class="s1">&#39;Unknown&#39;</span><span class="p">:</span> <span class="s2">&quot;#F7F7F7&quot;</span><span class="p">,</span>
    <span class="s1">&#39;Undefined&#39;</span><span class="p">:</span> <span class="s2">&quot;#F7F7F7&quot;</span><span class="p">,</span>
    <span class="s1">&#39;Unpredictive&#39;</span><span class="p">:</span> <span class="s2">&quot;#F7F7F7&quot;</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">CELL_TYPE_SHIFT</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;CD8&quot;</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.5</span><span class="p">),</span>
    <span class="s1">&#39;CD4&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.5</span><span class="p">),</span>
    <span class="s1">&#39;Treg&#39;</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="o">-</span><span class="mf">0.5</span><span class="p">),</span>
    <span class="s1">&#39;MAIT&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span><span class="o">-</span><span class="mf">0.5</span><span class="p">),</span>
    <span class="s2">&quot;cd8&quot;</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.5</span><span class="p">),</span>
    <span class="s1">&#39;cd4&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.5</span><span class="p">),</span>
    <span class="s1">&#39;treg&#39;</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="o">-</span><span class="mf">0.5</span><span class="p">),</span>
    <span class="s1">&#39;mait&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span><span class="o">-</span><span class="mf">0.5</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">TRBV_SEQUENCE</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;TRBV1&#39;</span><span class="p">:</span> <span class="s1">&#39;CTSSQ&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRBV2&#39;</span><span class="p">:</span> <span class="s1">&#39;CASSE&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRBV3-1&#39;</span><span class="p">:</span> <span class="s1">&#39;CASSQ&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRBV3-2&#39;</span><span class="p">:</span> <span class="s1">&#39;CASSQ&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRBV4-1&#39;</span><span class="p">:</span> <span class="s1">&#39;CASSQ&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRBV4-2&#39;</span><span class="p">:</span> <span class="s1">&#39;CASSQ&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRBV4-3&#39;</span><span class="p">:</span> <span class="s1">&#39;CASSQ&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRBV5-1&#39;</span><span class="p">:</span> <span class="s1">&#39;CASSL&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRBV5-3&#39;</span><span class="p">:</span> <span class="s1">&#39;CARSL&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRBV5-4&#39;</span><span class="p">:</span> <span class="s1">&#39;CASSL&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRBV5-5&#39;</span><span class="p">:</span> <span class="s1">&#39;CASSL&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRBV5-6&#39;</span><span class="p">:</span> <span class="s1">&#39;CASSL&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRBV5-7&#39;</span><span class="p">:</span> <span class="s1">&#39;CASSL&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRBV5-8&#39;</span><span class="p">:</span> <span class="s1">&#39;CASSL&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRBV6-1&#39;</span><span class="p">:</span> <span class="s1">&#39;CASSE&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRBV6-2&#39;</span><span class="p">:</span> <span class="s1">&#39;CASSY&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRBV6-3&#39;</span><span class="p">:</span> <span class="s1">&#39;CASSY&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRBV6-4&#39;</span><span class="p">:</span> <span class="s1">&#39;CASSD&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRBV6-5&#39;</span><span class="p">:</span> <span class="s1">&#39;CASSY&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRBV6-6&#39;</span><span class="p">:</span> <span class="s1">&#39;CASSY&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRBV6-7&#39;</span><span class="p">:</span> <span class="s1">&#39;CASSY&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRBV6-8&#39;</span><span class="p">:</span> <span class="s1">&#39;CASSY&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRBV6-9&#39;</span><span class="p">:</span> <span class="s1">&#39;CASSY&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRBV7-1&#39;</span><span class="p">:</span> <span class="s1">&#39;CASSS&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRBV7-2&#39;</span><span class="p">:</span> <span class="s1">&#39;CASSL&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRBV7-3&#39;</span><span class="p">:</span> <span class="s1">&#39;CASSL&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRBV7-4&#39;</span><span class="p">:</span> <span class="s1">&#39;CASSL&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRBV7-6&#39;</span><span class="p">:</span> <span class="s1">&#39;CASSL&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRBV7-7&#39;</span><span class="p">:</span> <span class="s1">&#39;CASSL&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRBV7-8&#39;</span><span class="p">:</span> <span class="s1">&#39;CASSL&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRBV7-9&#39;</span><span class="p">:</span> <span class="s1">&#39;CASSL&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRBV9&#39;</span><span class="p">:</span> <span class="s1">&#39;CASSV&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRBV10-1&#39;</span><span class="p">:</span> <span class="s1">&#39;CASSE&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRBV10-2&#39;</span><span class="p">:</span> <span class="s1">&#39;CASSE&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRBV10-3&#39;</span><span class="p">:</span> <span class="s1">&#39;CAISE&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRBV11-1&#39;</span><span class="p">:</span> <span class="s1">&#39;CASSL&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRBV11-2&#39;</span><span class="p">:</span> <span class="s1">&#39;CASSL&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRBV11-3&#39;</span><span class="p">:</span> <span class="s1">&#39;CASSL&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRBV12-1&#39;</span><span class="p">:</span> <span class="s1">&#39;CASSF&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRBV12-2&#39;</span><span class="p">:</span> <span class="s1">&#39;CASRL&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRBV12-3&#39;</span><span class="p">:</span> <span class="s1">&#39;CASSL&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRBV12-4&#39;</span><span class="p">:</span> <span class="s1">&#39;CASSL&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRBV12-5&#39;</span><span class="p">:</span> <span class="s1">&#39;CASGL&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRBV13&#39;</span><span class="p">:</span> <span class="s1">&#39;CASSL&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRBV14&#39;</span><span class="p">:</span> <span class="s1">&#39;CASSQ&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRBV15&#39;</span><span class="p">:</span> <span class="s1">&#39;CATSR&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRBV16&#39;</span><span class="p">:</span> <span class="s1">&#39;CASSQ&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRBV17&#39;</span><span class="p">:</span> <span class="s1">&#39;YSSG&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRBV18&#39;</span><span class="p">:</span> <span class="s1">&#39;CASSP&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRBV19&#39;</span><span class="p">:</span> <span class="s1">&#39;CASSI&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRBV20&#39;</span><span class="p">:</span> <span class="s1">&#39;CSAR&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRBV20OR9-2&#39;</span><span class="p">:</span> <span class="s1">&#39;CSAR&#39;</span><span class="p">,</span> <span class="c1">#???</span>
    <span class="s1">&#39;TRBV20-1&#39;</span><span class="p">:</span> <span class="s1">&#39;CSAR&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRBV21-1&#39;</span><span class="p">:</span> <span class="s1">&#39;CASSK&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRBV23-1&#39;</span><span class="p">:</span> <span class="s1">&#39;CASSQ&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRBV24-1&#39;</span><span class="p">:</span> <span class="s1">&#39;CATSDL&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRBV25-1&#39;</span><span class="p">:</span> <span class="s1">&#39;CASSE&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRBV26&#39;</span><span class="p">:</span> <span class="s1">&#39;YASSS&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRBV27&#39;</span><span class="p">:</span> <span class="s1">&#39;CASSL&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRBV28&#39;</span><span class="p">:</span> <span class="s1">&#39;CASSL&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRBV29-1&#39;</span><span class="p">:</span> <span class="s1">&#39;CSVE&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRBV30&#39;</span><span class="p">:</span> <span class="s1">&#39;CAWS&#39;</span>
<span class="p">}</span>


<span class="n">TRBJ_SEQUENCE</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;TRBJ1-1&#39;</span><span class="p">:</span> <span class="s1">&#39;NTEAFFGQGTRLTVV&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRBJ1-2&#39;</span><span class="p">:</span> <span class="s1">&#39;NYGYTFGSGTRLTVV&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRBJ1-3&#39;</span><span class="p">:</span> <span class="s1">&#39;SGNTIYFGEGSWLTVV&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRBJ1-4&#39;</span><span class="p">:</span> <span class="s1">&#39;TNEKLFFGSGTQLSVL&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRBJ1-5&#39;</span><span class="p">:</span> <span class="s1">&#39;SNQPQHFGDGTRLSIL&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRBJ1-6&#39;</span><span class="p">:</span> <span class="s1">&#39;SYNSPLHFGNGTRLTVT&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRBJ2-1&#39;</span><span class="p">:</span> <span class="s1">&#39;SYNEQFFGPGTRLTVL&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRBJ2-2&#39;</span><span class="p">:</span> <span class="s1">&#39;NTGELFFGEGSRLTVL&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRBJ2-3&#39;</span><span class="p">:</span> <span class="s1">&#39;STDTQYFGPGTRLTVL&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRBJ2-4&#39;</span><span class="p">:</span> <span class="s1">&#39;AKNIQYFGAGTRLSVL&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRBJ2-5&#39;</span><span class="p">:</span> <span class="s1">&#39;QETQYFGPGTRLLVL&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRBJ2-6&#39;</span><span class="p">:</span> <span class="s1">&#39;SGANVLTFGAGSRLTVL&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRBJ2-7&#39;</span><span class="p">:</span> <span class="s1">&#39;SYEQYFGPGTRLTVT&#39;</span>
<span class="p">}</span>
<span class="n">TRAV_SEQUENCE</span> <span class="o">=</span> <span class="p">{</span>
<span class="s1">&#39;TRAV1-1&#39;</span><span class="p">:</span> <span class="s1">&#39;CAVR&#39;</span><span class="p">,</span>
<span class="s1">&#39;TRAV1-2&#39;</span><span class="p">:</span> <span class="s1">&#39;CAVR&#39;</span><span class="p">,</span>
<span class="s1">&#39;TRAV2&#39;</span><span class="p">:</span> <span class="s1">&#39;CAVE&#39;</span><span class="p">,</span>
<span class="s1">&#39;TRAV3&#39;</span><span class="p">:</span> <span class="s1">&#39;CAVRD&#39;</span><span class="p">,</span>
<span class="s1">&#39;TRAV4&#39;</span><span class="p">:</span> <span class="s1">&#39;CLVGD&#39;</span><span class="p">,</span>
<span class="s1">&#39;TRAV5&#39;</span><span class="p">:</span> <span class="s1">&#39;CAES&#39;</span><span class="p">,</span>
<span class="s1">&#39;TRAV6&#39;</span><span class="p">:</span> <span class="s1">&#39;CALD&#39;</span><span class="p">,</span>
<span class="s1">&#39;TRAV7&#39;</span><span class="p">:</span> <span class="s1">&#39;CAVD&#39;</span><span class="p">,</span>
<span class="s1">&#39;TRAV8-1&#39;</span><span class="p">:</span> <span class="s1">&#39;CAVN&#39;</span><span class="p">,</span>
<span class="s1">&#39;TRAV8-2&#39;</span><span class="p">:</span> <span class="s1">&#39;CVVS&#39;</span><span class="p">,</span>
<span class="s1">&#39;TRAV8-3&#39;</span><span class="p">:</span> <span class="s1">&#39;CAVG&#39;</span><span class="p">,</span>
<span class="s1">&#39;TRAV8-4&#39;</span><span class="p">:</span> <span class="s1">&#39;CAVS&#39;</span><span class="p">,</span>
<span class="s1">&#39;TRAV8-6&#39;</span><span class="p">:</span> <span class="s1">&#39;CAVS&#39;</span><span class="p">,</span>
<span class="s1">&#39;TRAV8-7&#39;</span><span class="p">:</span> <span class="s1">&#39;CAVG&#39;</span><span class="p">,</span>
<span class="s1">&#39;TRAV9-1&#39;</span><span class="p">:</span> <span class="s1">&#39;CALS&#39;</span><span class="p">,</span>
<span class="s1">&#39;TRAV9-2&#39;</span><span class="p">:</span> <span class="s1">&#39;CALS&#39;</span><span class="p">,</span>
<span class="s1">&#39;TRAV10&#39;</span><span class="p">:</span> <span class="s1">&#39;CVVS&#39;</span><span class="p">,</span>
<span class="s1">&#39;TRAV11&#39;</span><span class="p">:</span> <span class="s1">&#39;CAL&#39;</span><span class="p">,</span>
<span class="s1">&#39;TRAV12-1&#39;</span><span class="p">:</span> <span class="s1">&#39;CVVN&#39;</span><span class="p">,</span>
<span class="s1">&#39;TRAV12-2&#39;</span><span class="p">:</span> <span class="s1">&#39;CAVN&#39;</span><span class="p">,</span>
<span class="s1">&#39;TRAV12-3&#39;</span><span class="p">:</span> <span class="s1">&#39;CAMS&#39;</span><span class="p">,</span>
<span class="s1">&#39;TRAV13-1&#39;</span><span class="p">:</span> <span class="s1">&#39;CAAS&#39;</span><span class="p">,</span>
<span class="s1">&#39;TRAV13-2&#39;</span><span class="p">:</span> <span class="s1">&#39;CAEN&#39;</span><span class="p">,</span>
<span class="s1">&#39;TRAV14DV4&#39;</span><span class="p">:</span> <span class="s1">&#39;CAMRE&#39;</span><span class="p">,</span>
<span class="s1">&#39;TRAV16&#39;</span><span class="p">:</span> <span class="s1">&#39;CALS&#39;</span><span class="p">,</span>
<span class="s1">&#39;TRAV17&#39;</span><span class="p">:</span> <span class="s1">&#39;CATD&#39;</span><span class="p">,</span>
<span class="s1">&#39;TRAV18&#39;</span><span class="p">:</span> <span class="s1">&#39;CALR&#39;</span><span class="p">,</span>
<span class="s1">&#39;TRAV19&#39;</span><span class="p">:</span> <span class="s1">&#39;CALSE&#39;</span><span class="p">,</span>
<span class="s1">&#39;TRAV20&#39;</span><span class="p">:</span> <span class="s1">&#39;CAVQ&#39;</span><span class="p">,</span>
<span class="s1">&#39;TRAV21&#39;</span><span class="p">:</span> <span class="s1">&#39;CAVR&#39;</span><span class="p">,</span>
<span class="s1">&#39;TRAV22&#39;</span><span class="p">:</span> <span class="s1">&#39;CAVE&#39;</span><span class="p">,</span>
<span class="s1">&#39;TRAV23DV6&#39;</span><span class="p">:</span> <span class="s1">&#39;CAAS&#39;</span><span class="p">,</span>
<span class="s1">&#39;TRAV24&#39;</span><span class="p">:</span> <span class="s1">&#39;CAF&#39;</span><span class="p">,</span>
<span class="s1">&#39;TRAV25&#39;</span><span class="p">:</span> <span class="s1">&#39;CAG&#39;</span><span class="p">,</span>
<span class="s1">&#39;TRAV26-1&#39;</span><span class="p">:</span> <span class="s1">&#39;CIVRV&#39;</span><span class="p">,</span>
<span class="s1">&#39;TRAV26-2&#39;</span><span class="p">:</span> <span class="s1">&#39;CILRD&#39;</span><span class="p">,</span>
<span class="s1">&#39;TRAV27&#39;</span><span class="p">:</span> <span class="s1">&#39;CAG&#39;</span><span class="p">,</span>
<span class="s1">&#39;TRAV29DV5&#39;</span><span class="p">:</span> <span class="s1">&#39;CAAS&#39;</span><span class="p">,</span>
<span class="s1">&#39;TRAV30&#39;</span><span class="p">:</span> <span class="s1">&#39;CGTE&#39;</span><span class="p">,</span>
<span class="s1">&#39;TRAV34&#39;</span><span class="p">:</span> <span class="s1">&#39;CGAD&#39;</span><span class="p">,</span>
<span class="s1">&#39;TRAV35&#39;</span><span class="p">:</span> <span class="s1">&#39;CAGQ&#39;</span><span class="p">,</span>
<span class="s1">&#39;TRAV36DV7&#39;</span><span class="p">:</span> <span class="s1">&#39;CAVE&#39;</span><span class="p">,</span>
<span class="s1">&#39;TRAV38-1&#39;</span><span class="p">:</span> <span class="s1">&#39;CAFMK&#39;</span><span class="p">,</span>
<span class="s1">&#39;TRAV38-2DV8&#39;</span><span class="p">:</span> <span class="s1">&#39;CAYRS&#39;</span><span class="p">,</span>
<span class="s1">&#39;TRAV39&#39;</span><span class="p">:</span> <span class="s1">&#39;CAVD&#39;</span><span class="p">,</span>
<span class="s1">&#39;TRAV40&#39;</span><span class="p">:</span> <span class="s1">&#39;CLLG&#39;</span><span class="p">,</span>
<span class="s1">&#39;TRAV41&#39;</span><span class="p">:</span> <span class="s1">&#39;CAVR&#39;</span>
<span class="p">}</span>


<span class="n">TRAJ_SEQUENCE</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;TRAJ1&#39;</span><span class="p">:</span> <span class="s1">&#39;YESITSQLQFGKGTRVSTSP&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRAJ2&#39;</span><span class="p">:</span> <span class="s1">&#39;NTGGTIDKLTFGKGTHVFIIS&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRAJ3&#39;</span><span class="p">:</span> <span class="s1">&#39;GYSSASKIIFGSGTRLSIRP&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRAJ4&#39;</span><span class="p">:</span> <span class="s1">&#39;FSGGYNKLIFGAGTRLAVHP&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRAJ5&#39;</span><span class="p">:</span> <span class="s1">&#39;DTGRRALTFGSGTRLQVQP&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRAJ6&#39;</span><span class="p">:</span> <span class="s1">&#39;ASGGSYIPTFGRGTSLIVHP&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRAJ7&#39;</span><span class="p">:</span> <span class="s1">&#39;DYGNNRLAFGKGNQVVVIP&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRAJ8&#39;</span><span class="p">:</span> <span class="s1">&#39;NTGFQKLVFGTGTRLLVSP&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRAJ9&#39;</span><span class="p">:</span> <span class="s1">&#39;GNTGGFKTIFGAGTRLFVKA&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRAJ10&#39;</span><span class="p">:</span> <span class="s1">&#39;ILTGGGNKLTFGTGTQLKVEL&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRAJ11&#39;</span><span class="p">:</span> <span class="s1">&#39;NSGYSTLTFGKGTMLLVSP&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRAJ12&#39;</span><span class="p">:</span> <span class="s1">&#39;MDSSYKLIFGSGTRLLVRP&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRAJ13&#39;</span><span class="p">:</span> <span class="s1">&#39;NSGGYQKVTFGIGTKLQVIP&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRAJ14&#39;</span><span class="p">:</span> <span class="s1">&#39;IYSTFIFGSGTRLSVKP&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRAJ15&#39;</span><span class="p">:</span> <span class="s1">&#39;NQAGTALIFGKGTTLSVSS&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRAJ16&#39;</span><span class="p">:</span> <span class="s1">&#39;FSDGQKLLFARGTMLKVDL&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRAJ17&#39;</span><span class="p">:</span> <span class="s1">&#39;IKAAGNKLTFGGGTRVLVKP&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRAJ18&#39;</span><span class="p">:</span> <span class="s1">&#39;DRGSTLGRLYFGRGTQLTVWP&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRAJ19&#39;</span><span class="p">:</span> <span class="s1">&#39;YQRFYNFTFGKGSKHNVTP&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRAJ20&#39;</span><span class="p">:</span> <span class="s1">&#39;SNDYKLSFGAGTTVTVRA&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRAJ21&#39;</span><span class="p">:</span> <span class="s1">&#39;YNFNKFYFGSGTKLNVKP&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRAJ22&#39;</span><span class="p">:</span> <span class="s1">&#39;SSGSARQLTFGSGTQLTVLP&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRAJ23&#39;</span><span class="p">:</span> <span class="s1">&#39;IYNQGGKLIFGQGTELSVKP&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRAJ24&#39;</span><span class="p">:</span> <span class="s1">&#39;TTDSWGKFEFGAGTQVVVTP&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRAJ25&#39;</span><span class="p">:</span> <span class="s1">&#39;EGQGFSFIFGKGTRLLVKP&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRAJ26&#39;</span><span class="p">:</span> <span class="s1">&#39;DNYGQNFVFGPGTRLSVLP&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRAJ27&#39;</span><span class="p">:</span> <span class="s1">&#39;NTNAGKSTFGDGTTLTVKP&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRAJ28&#39;</span><span class="p">:</span> <span class="s1">&#39;YSGAGSYQLTFGKGTKLSVIP&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRAJ29&#39;</span><span class="p">:</span> <span class="s1">&#39;NSGNTPLVFGKGTRLSVIA&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRAJ30&#39;</span><span class="p">:</span> <span class="s1">&#39;NRDDKIIFGKGTRLHILP&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRAJ31&#39;</span><span class="p">:</span> <span class="s1">&#39;NNNARLMFGDGTQLVVKP&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRAJ32&#39;</span><span class="p">:</span> <span class="s1">&#39;NYGGATNKLIFGTGTLLAVQP&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRAJ33&#39;</span><span class="p">:</span> <span class="s1">&#39;DSNYQLIWGAGTKLIIKP&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRAJ34&#39;</span><span class="p">:</span> <span class="s1">&#39;SYNTDKLIFGTGTRLQVFP&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRAJ35&#39;</span><span class="p">:</span> <span class="s1">&#39;IGFGNVLHCGSGTQVIVLP&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRAJ36&#39;</span><span class="p">:</span> <span class="s1">&#39;QTGANNLFFGTGTRLTVIP&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRAJ37&#39;</span><span class="p">:</span> <span class="s1">&#39;GSGNTGKLIFGQGTTLQVKP&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRAJ38&#39;</span><span class="p">:</span> <span class="s1">&#39;NAGNNRKLIWGLGTSLAVNP&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRAJ39&#39;</span><span class="p">:</span> <span class="s1">&#39;NNNAGNMLTFGGGTRLMVKP&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRAJ40&#39;</span><span class="p">:</span> <span class="s1">&#39;TTSGTYKYIFGTGTRLKVLA&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRAJ41&#39;</span><span class="p">:</span> <span class="s1">&#39;NSNSGYALNFGKGTSLLVTP&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRAJ42&#39;</span><span class="p">:</span> <span class="s1">&#39;NYGGSQGNLIFGKGTKLSVKP&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRAJ43&#39;</span><span class="p">:</span> <span class="s1">&#39;NNNDMRFGAGTRLTVKP&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRAJ44&#39;</span><span class="p">:</span> <span class="s1">&#39;NTGTASKLTFGTGTRLQVTL&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRAJ45&#39;</span><span class="p">:</span> <span class="s1">&#39;YSGGGADGLTFGKGTHLIIQP&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRAJ46&#39;</span><span class="p">:</span> <span class="s1">&#39;KKSSGDKLTFGTGTRLAVRP&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRAJ47&#39;</span><span class="p">:</span> <span class="s1">&#39;EYGNKLVFGAGTILRVKS&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRAJ48&#39;</span><span class="p">:</span> <span class="s1">&#39;SNFGNEKLTFGTGTRLTIIP&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRAJ49&#39;</span><span class="p">:</span> <span class="s1">&#39;NTGNQFYFGTGTSLTVIP&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRAJ50&#39;</span><span class="p">:</span> <span class="s1">&#39;KTSYDKVIFGPGTSLSVIP&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRAJ51&#39;</span><span class="p">:</span> <span class="s1">&#39;MRDSYEKLIFGKET*LTVKP&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRAJ52&#39;</span><span class="p">:</span> <span class="s1">&#39;NAGGTSYGKLTFGQGTILTVHP&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRAJ53&#39;</span><span class="p">:</span> <span class="s1">&#39;NSGGSNYKLTFGKGTLLTVNP&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRAJ54&#39;</span><span class="p">:</span> <span class="s1">&#39;IQGAQKLVFGQGTRLTINP&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRAJ55&#39;</span><span class="p">:</span> <span class="s1">&#39;KCW*CSCWGKGMSTKINP&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRAJ56&#39;</span><span class="p">:</span> <span class="s1">&#39;YTGANSKLTFGKGITLSVRP&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRAJ57&#39;</span><span class="p">:</span> <span class="s1">&#39;TQGGSEKLVFGKGTKLTVNP&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRAJ58&#39;</span><span class="p">:</span> <span class="s1">&#39;*ETSGSRLTFGEGTQLTVNP&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRAJ59&#39;</span><span class="p">:</span> <span class="s1">&#39;KEGNRKFTFGMGTQVRVKL&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRAJ60&#39;</span><span class="p">:</span> <span class="s1">&#39;KIT*MLNFGKGTELIVSL&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRAJ61&#39;</span><span class="p">:</span> <span class="s1">&#39;YRVNRKLTFGANTRGIMKL&#39;</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">CELL_TYPE_DEFINITION</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Central memory CD8 T cells&#39;</span><span class="p">:</span> <span class="s2">&quot;CD8&quot;</span><span class="p">,</span>
<span class="s1">&#39;Effector memory CD8 T cells&#39;</span><span class="p">:</span> <span class="s2">&quot;CD8&quot;</span><span class="p">,</span>
<span class="s1">&#39;Follicular helper T cells&#39;</span><span class="p">:</span> <span class="s2">&quot;CD4&quot;</span><span class="p">,</span>
<span class="s1">&#39;MAIT cells&#39;</span><span class="p">:</span> <span class="s2">&quot;MAIT&quot;</span><span class="p">,</span>
<span class="s1">&#39;Naive CD4 T cells&#39;</span><span class="p">:</span> <span class="s2">&quot;CD4&quot;</span><span class="p">,</span>
<span class="s1">&#39;Naive CD8 T cells&#39;</span><span class="p">:</span> <span class="s2">&quot;CD8&quot;</span><span class="p">,</span>
<span class="s1">&#39;T regulatory cells&#39;</span><span class="p">:</span> <span class="s2">&quot;Treg&quot;</span><span class="p">,</span>
<span class="s1">&#39;Terminal effector CD4 T cells&#39;</span><span class="p">:</span> <span class="s2">&quot;CD4&quot;</span><span class="p">,</span>
<span class="s1">&#39;Terminal effector CD8 T cells&#39;</span><span class="p">:</span> <span class="s2">&quot;CD8&quot;</span><span class="p">,</span>
<span class="s1">&#39;Th1 cells&#39;</span><span class="p">:</span> <span class="s2">&quot;CD4&quot;</span><span class="p">,</span>
<span class="s1">&#39;Th1/Th17 cells&#39;</span><span class="p">:</span> <span class="s2">&quot;CD4&quot;</span><span class="p">,</span>
<span class="s1">&#39;Th17 cells&#39;</span><span class="p">:</span> <span class="s2">&quot;CD4&quot;</span><span class="p">,</span>
<span class="s1">&#39;Th2 cells&#39;</span><span class="p">:</span> <span class="s2">&quot;CD4&quot;</span><span class="p">,</span>
<span class="s1">&#39;Unpredictive&#39;</span><span class="p">:</span> <span class="s2">&quot;Undefined&quot;</span>
<span class="p">}</span>


<span class="n">AMINO_ACIDS</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">,</span>
 <span class="s1">&#39;H&#39;</span><span class="p">,</span>
 <span class="s1">&#39;K&#39;</span><span class="p">,</span>
 <span class="s1">&#39;D&#39;</span><span class="p">,</span>
 <span class="s1">&#39;E&#39;</span><span class="p">,</span>
 <span class="s1">&#39;S&#39;</span><span class="p">,</span>
 <span class="s1">&#39;T&#39;</span><span class="p">,</span>
 <span class="s1">&#39;N&#39;</span><span class="p">,</span>
 <span class="s1">&#39;Q&#39;</span><span class="p">,</span>
 <span class="s1">&#39;C&#39;</span><span class="p">,</span>
 <span class="s1">&#39;G&#39;</span><span class="p">,</span>
 <span class="s1">&#39;P&#39;</span><span class="p">,</span>
 <span class="s1">&#39;A&#39;</span><span class="p">,</span>
 <span class="s1">&#39;V&#39;</span><span class="p">,</span>
 <span class="s1">&#39;I&#39;</span><span class="p">,</span>
 <span class="s1">&#39;L&#39;</span><span class="p">,</span>
 <span class="s1">&#39;M&#39;</span><span class="p">,</span>
 <span class="s1">&#39;F&#39;</span><span class="p">,</span>
 <span class="s1">&#39;Y&#39;</span><span class="p">,</span>
 <span class="s1">&#39;W&#39;</span>
<span class="p">]</span>

<span class="n">AMINO_ACID_PROPERTIES</span> <span class="o">=</span> <span class="p">{</span>
 <span class="s1">&#39;R&#39;</span><span class="p">:</span> <span class="s2">&quot;Positive&quot;</span><span class="p">,</span>
 <span class="s1">&#39;H&#39;</span><span class="p">:</span> <span class="s2">&quot;Positive&quot;</span><span class="p">,</span>
 <span class="s1">&#39;K&#39;</span><span class="p">:</span> <span class="s2">&quot;Positive&quot;</span><span class="p">,</span>
 <span class="s1">&#39;D&#39;</span><span class="p">:</span> <span class="s2">&quot;Negative&quot;</span><span class="p">,</span>
 <span class="s1">&#39;E&#39;</span><span class="p">:</span> <span class="s2">&quot;Negative&quot;</span><span class="p">,</span>
 <span class="s1">&#39;S&#39;</span><span class="p">:</span> <span class="s2">&quot;Polar uncharged&quot;</span><span class="p">,</span>
 <span class="s1">&#39;T&#39;</span><span class="p">:</span> <span class="s2">&quot;Polar uncharged&quot;</span><span class="p">,</span>
 <span class="s1">&#39;N&#39;</span><span class="p">:</span> <span class="s2">&quot;Polar uncharged&quot;</span><span class="p">,</span>
 <span class="s1">&#39;Q&#39;</span><span class="p">:</span> <span class="s2">&quot;Polar uncharged&quot;</span><span class="p">,</span>
 <span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="s2">&quot;Special&quot;</span><span class="p">,</span>
 <span class="s1">&#39;U&#39;</span><span class="p">:</span> <span class="s2">&quot;Special&quot;</span><span class="p">,</span>
 <span class="s1">&#39;G&#39;</span><span class="p">:</span> <span class="s2">&quot;Special&quot;</span><span class="p">,</span>
 <span class="s1">&#39;P&#39;</span><span class="p">:</span> <span class="s2">&quot;Special&quot;</span><span class="p">,</span>
 <span class="s1">&#39;A&#39;</span><span class="p">:</span> <span class="s2">&quot;Hydrophobic&quot;</span><span class="p">,</span>
 <span class="s1">&#39;V&#39;</span><span class="p">:</span> <span class="s2">&quot;Hydrophobic&quot;</span><span class="p">,</span>
 <span class="s1">&#39;I&#39;</span><span class="p">:</span> <span class="s2">&quot;Hydrophobic&quot;</span><span class="p">,</span>
 <span class="s1">&#39;L&#39;</span><span class="p">:</span> <span class="s2">&quot;Hydrophobic&quot;</span><span class="p">,</span>
 <span class="s1">&#39;M&#39;</span><span class="p">:</span> <span class="s2">&quot;Hydrophobic&quot;</span><span class="p">,</span>
 <span class="s1">&#39;F&#39;</span><span class="p">:</span> <span class="s2">&quot;Hydrophobic&quot;</span><span class="p">,</span>
 <span class="s1">&#39;Y&#39;</span><span class="p">:</span> <span class="s2">&quot;Hydrophobic&quot;</span><span class="p">,</span>
 <span class="s1">&#39;W&#39;</span><span class="p">:</span> <span class="s2">&quot;Hydrophobic&quot;</span>
<span class="p">}</span>

<span class="n">AMINO_ACIDS_IDX</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">AMINO_ACIDS</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">AMINO_ACIDS</span><span class="p">))))</span>
<span class="n">TRAV2IDX</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">TRAV_SEQUENCE</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">TRAV_SEQUENCE</span><span class="p">))))</span>
<span class="n">TRAJ2IDX</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">TRAJ_SEQUENCE</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">TRAJ_SEQUENCE</span><span class="p">))))</span>
<span class="n">TRBV2IDX</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">TRBV_SEQUENCE</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">TRBV_SEQUENCE</span><span class="p">))))</span>
<span class="n">TRBJ2IDX</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">TRBJ_SEQUENCE</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">TRBJ_SEQUENCE</span><span class="p">))))</span>
<span class="n">VJINDEX</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">VJINDEX</span><span class="p">[</span><span class="s1">&#39;TRAV&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">TRAV2IDX</span>
<span class="n">VJINDEX</span><span class="p">[</span><span class="s1">&#39;TRAJ&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">TRAJ2IDX</span>
<span class="n">VJINDEX</span><span class="p">[</span><span class="s1">&#39;TRBV&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">TRBV2IDX</span>
<span class="n">VJINDEX</span><span class="p">[</span><span class="s1">&#39;TRBJ&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">TRBJ2IDX</span>

<span class="k">def</span> <span class="nf">imputeTRAVJsequence</span><span class="p">(</span><span class="n">cdr3a</span><span class="p">):</span>
    <span class="n">maximum_v</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="n">maximum_j</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="n">maximum_vgene</span><span class="p">,</span> <span class="n">maximum_vjgene</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
    
    <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">TRAV_SEQUENCE</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">vsequence</span> <span class="o">=</span> <span class="n">TRAV_SEQUENCE</span><span class="p">[</span><span class="n">v</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">vsequence</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">cdr3a</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">vsequence</span><span class="p">[:</span><span class="o">-</span><span class="p">(</span><span class="n">m</span><span class="o">+</span><span class="mi">1</span><span class="p">)]):</span>     
                <span class="n">vindex</span> <span class="o">=</span> <span class="n">cdr3a</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">vsequence</span><span class="p">[:</span><span class="o">-</span><span class="p">(</span><span class="n">m</span><span class="o">+</span><span class="mi">1</span><span class="p">)])</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">vsequence</span><span class="p">[:</span><span class="o">-</span><span class="p">(</span><span class="n">m</span><span class="o">+</span><span class="mi">1</span><span class="p">)])</span>
                <span class="k">break</span>
        <span class="n">vmotif</span> <span class="o">=</span> <span class="n">vsequence</span><span class="p">[:</span><span class="o">-</span><span class="p">(</span><span class="n">m</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">vmotif</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">maximum_v</span><span class="p">):</span>
            <span class="n">maximum_v</span> <span class="o">=</span> <span class="n">vmotif</span>
            <span class="n">maximum_vgene</span> <span class="o">=</span> <span class="n">v</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">TRAJ_SEQUENCE</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    
        <span class="n">jsequence</span> <span class="o">=</span> <span class="n">TRAJ_SEQUENCE</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
        
        <span class="k">if</span> <span class="s1">&#39;F&#39;</span> <span class="ow">in</span> <span class="n">jsequence</span><span class="p">:</span>
            <span class="n">jsequence</span> <span class="o">=</span> <span class="n">jsequence</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">jsequence</span><span class="p">)</span> <span class="o">-</span> <span class="n">jsequence</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;F&quot;</span><span class="p">)]</span> 
        <span class="k">elif</span> <span class="s1">&#39;W&#39;</span> <span class="ow">in</span> <span class="n">jsequence</span><span class="p">:</span>
            <span class="n">jsequence</span> <span class="o">=</span> <span class="n">jsequence</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">jsequence</span><span class="p">)</span> <span class="o">-</span> <span class="n">jsequence</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;W&quot;</span><span class="p">)]</span> 
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">jsequence</span><span class="p">)):</span>    
            <span class="k">if</span> <span class="n">cdr3a</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">jsequence</span><span class="p">[</span><span class="n">n</span><span class="p">:]):</span>
                <span class="n">jindex</span> <span class="o">=</span> <span class="n">cdr3a</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">jsequence</span><span class="p">[</span><span class="n">n</span><span class="p">:])</span>
                <span class="k">break</span> 
        <span class="n">jmotif</span> <span class="o">=</span> <span class="n">jsequence</span><span class="p">[</span><span class="n">n</span><span class="p">:]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">jmotif</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">maximum_j</span><span class="p">):</span>
            <span class="n">maximum_j</span> <span class="o">=</span> <span class="n">jmotif</span>
            <span class="n">maximum_jgene</span> <span class="o">=</span> <span class="n">j</span>
    <span class="k">return</span> <span class="n">maximum_v</span><span class="p">,</span> <span class="n">maximum_vgene</span><span class="p">,</span> <span class="n">maximum_j</span><span class="p">,</span> <span class="n">maximum_jgene</span>

<span class="k">def</span> <span class="nf">imputeTRBVJsequence</span><span class="p">(</span><span class="n">cdr3a</span><span class="p">):</span>
    <span class="n">maximum_v</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="n">maximum_j</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="n">maximum_vgene</span><span class="p">,</span> <span class="n">maximum_vjgene</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
    
    <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">TRBV_SEQUENCE</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">vsequence</span> <span class="o">=</span> <span class="n">TRBV_SEQUENCE</span><span class="p">[</span><span class="n">v</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">vsequence</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">cdr3a</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">vsequence</span><span class="p">[:</span><span class="o">-</span><span class="p">(</span><span class="n">m</span><span class="o">+</span><span class="mi">1</span><span class="p">)]):</span>     
                <span class="n">vindex</span> <span class="o">=</span> <span class="n">cdr3a</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">vsequence</span><span class="p">[:</span><span class="o">-</span><span class="p">(</span><span class="n">m</span><span class="o">+</span><span class="mi">1</span><span class="p">)])</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">vsequence</span><span class="p">[:</span><span class="o">-</span><span class="p">(</span><span class="n">m</span><span class="o">+</span><span class="mi">1</span><span class="p">)])</span>
                <span class="k">break</span>
        <span class="n">vmotif</span> <span class="o">=</span> <span class="n">vsequence</span><span class="p">[:</span><span class="o">-</span><span class="p">(</span><span class="n">m</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">vmotif</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">maximum_v</span><span class="p">):</span>
            <span class="n">maximum_v</span> <span class="o">=</span> <span class="n">vmotif</span>
            <span class="n">maximum_vgene</span> <span class="o">=</span> <span class="n">v</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">TRBJ_SEQUENCE</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    
        <span class="n">jsequence</span> <span class="o">=</span> <span class="n">TRBJ_SEQUENCE</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
        
        <span class="k">if</span> <span class="s1">&#39;F&#39;</span> <span class="ow">in</span> <span class="n">jsequence</span><span class="p">:</span>
            <span class="n">jsequence</span> <span class="o">=</span> <span class="n">jsequence</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">jsequence</span><span class="p">)</span> <span class="o">-</span> <span class="n">jsequence</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;F&quot;</span><span class="p">)]</span> 
        <span class="k">elif</span> <span class="s1">&#39;W&#39;</span> <span class="ow">in</span> <span class="n">jsequence</span><span class="p">:</span>
            <span class="n">jsequence</span> <span class="o">=</span> <span class="n">jsequence</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">jsequence</span><span class="p">)</span> <span class="o">-</span> <span class="n">jsequence</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;W&quot;</span><span class="p">)]</span> 
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">jsequence</span><span class="p">)):</span>    
            <span class="k">if</span> <span class="n">cdr3a</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">jsequence</span><span class="p">[</span><span class="n">n</span><span class="p">:]):</span>
                <span class="n">jindex</span> <span class="o">=</span> <span class="n">cdr3a</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">jsequence</span><span class="p">[</span><span class="n">n</span><span class="p">:])</span>
                <span class="k">break</span> 
        <span class="n">jmotif</span> <span class="o">=</span> <span class="n">jsequence</span><span class="p">[</span><span class="n">n</span><span class="p">:]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">jmotif</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">maximum_j</span><span class="p">):</span>
            <span class="n">maximum_j</span> <span class="o">=</span> <span class="n">jmotif</span>
            <span class="n">maximum_jgene</span> <span class="o">=</span> <span class="n">j</span>
    <span class="k">return</span> <span class="n">maximum_v</span><span class="p">,</span> <span class="n">maximum_vgene</span><span class="p">,</span> <span class="n">maximum_j</span><span class="p">,</span> <span class="n">maximum_jgene</span>

<span class="c1"># response = get_response(&quot;Load computing modules?&quot;)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">Colors</span><span class="o">.</span><span class="n">GREEN</span> <span class="o">+</span> <span class="s2">&quot;Success&quot;</span> <span class="o">+</span> <span class="n">Colors</span><span class="o">.</span><span class="n">NC</span><span class="p">)</span>

<span class="n">CDR1a</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;TSGFYG&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TSGFNG&#39;</span><span class="p">,</span>
    <span class="s1">&#39;VSNAYN&#39;</span><span class="p">,</span>
    <span class="s1">&#39;VSGNPY&#39;</span><span class="p">,</span>
    <span class="s1">&#39;NIATNDY&#39;</span><span class="p">,</span>
    <span class="s1">&#39;DSSSTY&#39;</span><span class="p">,</span>
    <span class="s1">&#39;NYSPAY&#39;</span><span class="p">,</span>
    <span class="s1">&#39;VSRFNN&#39;</span><span class="p">,</span>
    <span class="s1">&#39;YGGTVN&#39;</span><span class="p">,</span>
    <span class="s1">&#39;SSYSPS&#39;</span><span class="p">,</span>
    <span class="s1">&#39;YGATPY&#39;</span><span class="p">,</span>
    <span class="s1">&#39;SSVPPY&#39;</span><span class="p">,</span>
    <span class="s1">&#39;SSVSVY&#39;</span><span class="p">,</span>
    <span class="s1">&#39;YSGVPS&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TTQYPS&#39;</span><span class="p">,</span>
    <span class="s1">&#39;ATGYPS&#39;</span><span class="p">,</span>
    <span class="s1">&#39;VSPFSN&#39;</span><span class="p">,</span>
    <span class="s1">&#39;ERTLFN&#39;</span><span class="p">,</span>
    <span class="s1">&#39;NSASQS&#39;</span><span class="p">,</span>
    <span class="s1">&#39;DRGSQS&#39;</span><span class="p">,</span>
    <span class="s1">&#39;NSAFQY&#39;</span><span class="p">,</span>
    <span class="s1">&#39;DSASNY&#39;</span><span class="p">,</span>
    <span class="s1">&#39;NSASDY&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TSDPSYG&#39;</span><span class="p">,</span>
    <span class="s1">&#39;YSGSPE&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TSINN&#39;</span><span class="p">,</span>
    <span class="s1">&#39;SSYSTF&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TRDTTYY&#39;</span><span class="p">,</span>
    <span class="s1">&#39;VSGLRG&#39;</span><span class="p">,</span>
    <span class="s1">&#39;DSAIYN&#39;</span><span class="p">,</span>
    <span class="s1">&#39;DSVNN&#39;</span><span class="p">,</span>
    <span class="s1">&#39;NTAFDY&#39;</span><span class="p">,</span>
    <span class="s1">&#39;SSNFYA&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TTLSN&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TISGNEY&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TISGTDY&#39;</span><span class="p">,</span>
    <span class="s1">&#39;SVFSS&#39;</span><span class="p">,</span>
    <span class="s1">&#39;NSMFDY&#39;</span><span class="p">,</span>
    <span class="s1">&#39;KALYS&#39;</span><span class="p">,</span>
    <span class="s1">&#39;KTLYG&#39;</span><span class="p">,</span>
    <span class="s1">&#39;SIFNT&#39;</span><span class="p">,</span>
    <span class="s1">&#39;VTNFRS&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TSENNYY&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TSESDYY&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TTSDR&#39;</span><span class="p">,</span>
    <span class="s1">&#39;STGYPT&#39;</span><span class="p">,</span>
    <span class="s1">&#39;VGISA&#39;</span>
<span class="p">]</span>

<span class="n">CDR2a</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;NALDGL&#39;</span><span class="p">,</span>
<span class="s1">&#39;NVLDGL&#39;</span><span class="p">,</span>
<span class="s1">&#39;GSKP&#39;</span><span class="p">,</span>
<span class="s1">&#39;YITGDNLV&#39;</span><span class="p">,</span>
<span class="s1">&#39;GYKTK&#39;</span><span class="p">,</span>
<span class="s1">&#39;IFSNMDM&#39;</span><span class="p">,</span>
<span class="s1">&#39;IRENEKE&#39;</span><span class="p">,</span>
<span class="s1">&#39;MYSAGYE&#39;</span><span class="p">,</span>
<span class="s1">&#39;YFSGDPLV&#39;</span><span class="p">,</span>
<span class="s1">&#39;YTSAATLV&#39;</span><span class="p">,</span>
<span class="s1">&#39;YFSGDTLV&#39;</span><span class="p">,</span>
<span class="s1">&#39;YTSAATLV&#39;</span><span class="p">,</span>
<span class="s1">&#39;YLSGSTLV&#39;</span><span class="p">,</span>
<span class="s1">&#39;DLTEATQV&#39;</span><span class="p">,</span>
<span class="s1">&#39;AMKANDK&#39;</span><span class="p">,</span>
<span class="s1">&#39;ATKADDK&#39;</span><span class="p">,</span>
<span class="s1">&#39;MTFSENT&#39;</span><span class="p">,</span>
<span class="s1">&#39;IQSSQKE&#39;</span><span class="p">,</span>
<span class="s1">&#39;VYSSGN&#39;</span><span class="p">,</span>
<span class="s1">&#39;IYSNGD&#39;</span><span class="p">,</span>
<span class="s1">&#39;TYSSGN&#39;</span><span class="p">,</span>
<span class="s1">&#39;IRSNVGE&#39;</span><span class="p">,</span>
<span class="s1">&#39;IRSNMDK&#39;</span><span class="p">,</span>
<span class="s1">&#39;QGSYDQQN&#39;</span><span class="p">,</span>
<span class="s1">&#39;HISR&#39;</span><span class="p">,</span>
<span class="s1">&#39;IRSNERE&#39;</span><span class="p">,</span>
<span class="s1">&#39;SSENQE&#39;</span><span class="p">,</span>
<span class="s1">&#39;RNSFDEQN&#39;</span><span class="p">,</span>
<span class="s1">&#39;LYSAGEE&#39;</span><span class="p">,</span>
<span class="s1">&#39;IQSSQRE&#39;</span><span class="p">,</span>
<span class="s1">&#39;IPSGT&#39;</span><span class="p">,</span>
<span class="s1">&#39;IRPDVSE&#39;</span><span class="p">,</span>
<span class="s1">&#39;MTLNGDE&#39;</span><span class="p">,</span>
<span class="s1">&#39;LVKSGEV&#39;</span><span class="p">,</span>
<span class="s1">&#39;GLKNN&#39;</span><span class="p">,</span>
<span class="s1">&#39;GLTSN&#39;</span><span class="p">,</span>
<span class="s1">&#39;VVTGGEV&#39;</span><span class="p">,</span>
<span class="s1">&#39;ISSIKDK&#39;</span><span class="p">,</span>
<span class="s1">&#39;LLKGGEQ&#39;</span><span class="p">,</span>
<span class="s1">&#39;LQKGGEE&#39;</span><span class="p">,</span>
<span class="s1">&#39;LYKAGEL&#39;</span><span class="p">,</span>
<span class="s1">&#39;LTSSGIE&#39;</span><span class="p">,</span>
<span class="s1">&#39;QEAYKQQN&#39;</span><span class="p">,</span>
<span class="s1">&#39;QEAYKQQN&#39;</span><span class="p">,</span>
<span class="s1">&#39;LLSNGAV&#39;</span><span class="p">,</span>
<span class="s1">&#39;ETME&#39;</span><span class="p">,</span>
<span class="s1">&#39;LSSGK&#39;</span><span class="p">]</span>

<span class="n">CDR1b</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;GHDS&#39;</span><span class="p">,</span>
<span class="s1">&#39;SNHLY&#39;</span><span class="p">,</span>
<span class="s1">&#39;LGHDT&#39;</span><span class="p">,</span>
<span class="s1">&#39;LGHNA&#39;</span><span class="p">,</span>
<span class="s1">&#39;MGHRA&#39;</span><span class="p">,</span>
<span class="s1">&#39;LGHNA&#39;</span><span class="p">,</span>
<span class="s1">&#39;LGHNA&#39;</span><span class="p">,</span>
<span class="s1">&#39;SGHRS&#39;</span><span class="p">,</span>
<span class="s1">&#39;SGHSS&#39;</span><span class="p">,</span>
<span class="s1">&#39;SGHNT&#39;</span><span class="p">,</span>
<span class="s1">&#39;SGHKS&#39;</span><span class="p">,</span>
<span class="s1">&#39;SGHDT&#39;</span><span class="p">,</span>
<span class="s1">&#39;SGHTS&#39;</span><span class="p">,</span>
<span class="s1">&#39;SGHTS&#39;</span><span class="p">,</span>
<span class="s1">&#39;MNHNS&#39;</span><span class="p">,</span>
<span class="s1">&#39;MNHEY&#39;</span><span class="p">,</span>
<span class="s1">&#39;MNHEY&#39;</span><span class="p">,</span>
<span class="s1">&#39;MRHNA&#39;</span><span class="p">,</span>
<span class="s1">&#39;MNHEY&#39;</span><span class="p">,</span>
<span class="s1">&#39;MNHNY&#39;</span><span class="p">,</span>
<span class="s1">&#39;MNHEY&#39;</span><span class="p">,</span>
<span class="s1">&#39;MNHGY&#39;</span><span class="p">,</span>
<span class="s1">&#39;MNHGY&#39;</span><span class="p">,</span>
<span class="s1">&#39;SGHNA&#39;</span><span class="p">,</span>
<span class="s1">&#39;SGHTA&#39;</span><span class="p">,</span>
<span class="s1">&#39;SGHTA&#39;</span><span class="p">,</span>
<span class="s1">&#39;SGHVT&#39;</span><span class="p">,</span>
<span class="s1">&#39;SGHVS&#39;</span><span class="p">,</span>
<span class="s1">&#39;SSHAT&#39;</span><span class="p">,</span>
<span class="s1">&#39;SGHVS&#39;</span><span class="p">,</span>
<span class="s1">&#39;SEHNR&#39;</span><span class="p">,</span>
<span class="s1">&#39;SGDLS&#39;</span><span class="p">,</span>
<span class="s1">&#39;WNHNN&#39;</span><span class="p">,</span>
<span class="s1">&#39;WSHSY&#39;</span><span class="p">,</span>
<span class="s1">&#39;ENHRY&#39;</span><span class="p">,</span>
<span class="s1">&#39;SGHAT&#39;</span><span class="p">,</span>
<span class="s1">&#39;SGHAT&#39;</span><span class="p">,</span>
<span class="s1">&#39;SGHNT&#39;</span><span class="p">,</span>
<span class="s1">&#39;SGHND&#39;</span><span class="p">,</span>
<span class="s1">&#39;FGHNF&#39;</span><span class="p">,</span>
<span class="s1">&#39;SGHNS&#39;</span><span class="p">,</span>
<span class="s1">&#39;SGHDY&#39;</span><span class="p">,</span>
<span class="s1">&#39;LGHNT&#39;</span><span class="p">,</span>
<span class="s1">&#39;PRHDT&#39;</span><span class="p">,</span>
<span class="s1">&#39;SGHDN&#39;</span><span class="p">,</span>
<span class="s1">&#39;LNHNV&#39;</span><span class="p">,</span>
<span class="s1">&#39;KGHSY&#39;</span><span class="p">,</span>
<span class="s1">&#39;SGHMF&#39;</span><span class="p">,</span>
<span class="s1">&#39;KGHSH&#39;</span><span class="p">,</span>
<span class="s1">&#39;LNHDA&#39;</span><span class="p">,</span>
<span class="s1">&#39;DFQATT&#39;</span><span class="p">,</span>
<span class="s1">&#39;KAHSY&#39;</span><span class="p">,</span>
<span class="s1">&#39;KGHTF&#39;</span><span class="p">,</span>
<span class="s1">&#39;KGHDR&#39;</span><span class="p">,</span>
<span class="s1">&#39;MGHDK&#39;</span><span class="p">,</span>
<span class="s1">&#39;MNHVT&#39;</span><span class="p">,</span>
<span class="s1">&#39;MNHEY&#39;</span><span class="p">,</span>
<span class="s1">&#39;MDHEN&#39;</span><span class="p">,</span>
<span class="s1">&#39;SQVTM&#39;</span><span class="p">,</span>
<span class="s1">&#39;GTSNPN&#39;</span><span class="p">]</span>

<span class="n">CDR2b</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;YNCKEF&#39;</span><span class="p">,</span>
<span class="s1">&#39;FYNNEI&#39;</span><span class="p">,</span>
<span class="s1">&#39;YNNKEL&#39;</span><span class="p">,</span>
<span class="s1">&#39;YSNKEP&#39;</span><span class="p">,</span>
<span class="s1">&#39;YSYEKL&#39;</span><span class="p">,</span>
<span class="s1">&#39;YNFKEQ&#39;</span><span class="p">,</span>
<span class="s1">&#39;YSLEER&#39;</span><span class="p">,</span>
<span class="s1">&#39;YFSETQ&#39;</span><span class="p">,</span>
<span class="s1">&#39;YANELR&#39;</span><span class="p">,</span>
<span class="s1">&#39;YYREEE&#39;</span><span class="p">,</span>
<span class="s1">&#39;YYEKEE&#39;</span><span class="p">,</span>
<span class="s1">&#39;YYEEEE&#39;</span><span class="p">,</span>
<span class="s1">&#39;YYEKEE&#39;</span><span class="p">,</span>
<span class="s1">&#39;YDEGEE&#39;</span><span class="p">,</span>
<span class="s1">&#39;SASEGT&#39;</span><span class="p">,</span>
<span class="s1">&#39;SVGEGT&#39;</span><span class="p">,</span>
<span class="s1">&#39;SVGEGT&#39;</span><span class="p">,</span>
<span class="s1">&#39;SNTAGT&#39;</span><span class="p">,</span>
<span class="s1">&#39;SVGAGI&#39;</span><span class="p">,</span>
<span class="s1">&#39;SVGAGI&#39;</span><span class="p">,</span>
<span class="s1">&#39;SVAAAL&#39;</span><span class="p">,</span>
<span class="s1">&#39;SAAAGT&#39;</span><span class="p">,</span>
<span class="s1">&#39;SVAAGI&#39;</span><span class="p">,</span>
<span class="s1">&#39;FQGKDA&#39;</span><span class="p">,</span>
<span class="s1">&#39;FQGNSA&#39;</span><span class="p">,</span>
<span class="s1">&#39;FQGTGA&#39;</span><span class="p">,</span>
<span class="s1">&#39;SQSDAQ&#39;</span><span class="p">,</span>
<span class="s1">&#39;FNYEAQ&#39;</span><span class="p">,</span>
<span class="s1">&#39;FNYEAQ&#39;</span><span class="p">,</span>
<span class="s1">&#39;FQNEAQ&#39;</span><span class="p">,</span>
<span class="s1">&#39;FQNEAQ&#39;</span><span class="p">,</span>
<span class="s1">&#39;YYNGEE&#39;</span><span class="p">,</span>
<span class="s1">&#39;SYGVQD&#39;</span><span class="p">,</span>
<span class="s1">&#39;SAAADI&#39;</span><span class="p">,</span>
<span class="s1">&#39;SYGVKD&#39;</span><span class="p">,</span>
<span class="s1">&#39;FQDESV&#39;</span><span class="p">,</span>
<span class="s1">&#39;FQNNGV&#39;</span><span class="p">,</span>
<span class="s1">&#39;YENEEA&#39;</span><span class="p">,</span>
<span class="s1">&#39;FCSWTL&#39;</span><span class="p">,</span>
<span class="s1">&#39;FRS*SI&#39;</span><span class="p">,</span>
<span class="s1">&#39;FNNNVP&#39;</span><span class="p">,</span>
<span class="s1">&#39;FNNNVP&#39;</span><span class="p">,</span>
<span class="s1">&#39;FRNRAP&#39;</span><span class="p">,</span>
<span class="s1">&#39;FYEKMQ&#39;</span><span class="p">,</span>
<span class="s1">&#39;FVKESK&#39;</span><span class="p">,</span>
<span class="s1">&#39;YYDKDF&#39;</span><span class="p">,</span>
<span class="s1">&#39;FQNENV&#39;</span><span class="p">,</span>
<span class="s1">&#39;FQYQNI&#39;</span><span class="p">,</span>
<span class="s1">&#39;LQKENI&#39;</span><span class="p">,</span>
<span class="s1">&#39;SQIVND&#39;</span><span class="p">,</span>
<span class="s1">&#39;SNEGSKA&#39;</span><span class="p">,</span>
<span class="s1">&#39;FQNEEL&#39;</span><span class="p">,</span>
<span class="s1">&#39;FQNEQV&#39;</span><span class="p">,</span>
<span class="s1">&#39;SFDVKD&#39;</span><span class="p">,</span>
<span class="s1">&#39;SYGVNS&#39;</span><span class="p">,</span>
<span class="s1">&#39;SPGTGS&#39;</span><span class="p">,</span>
<span class="s1">&#39;SMNVEV&#39;</span><span class="p">,</span>
<span class="s1">&#39;SYDVKM&#39;</span><span class="p">,</span>
<span class="s1">&#39;ANQGSEA&#39;</span><span class="p">,</span>
<span class="s1">&#39;SVGIG&#39;</span><span class="p">]</span>

<span class="n">TRAV2CDR1a</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">TRAV_SEQUENCE</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">CDR1a</span><span class="p">))</span>
<span class="n">TRAV2CDR2a</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">TRAV_SEQUENCE</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">CDR2a</span><span class="p">))</span>
<span class="n">TRBV2CDR1b</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">TRBV_SEQUENCE</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">CDR1b</span><span class="p">))</span>
<span class="n">TRBV2CDR2b</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">TRBV_SEQUENCE</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">CDR2b</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Loading Definitions...<span class=" -Color -Color-Green">Success</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">study_name_palette</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Abbas_2021&#39;</span><span class="p">:</span> <span class="s1">&#39;#ffff00&#39;</span><span class="p">,</span>
 <span class="s1">&#39;Azizi_2018&#39;</span><span class="p">:</span> <span class="s1">&#39;#1ce6ff&#39;</span><span class="p">,</span>
 <span class="s1">&#39;Bacher_2020&#39;</span><span class="p">:</span> <span class="s1">&#39;#ff34ff&#39;</span><span class="p">,</span>
 <span class="s1">&#39;Boland_2020&#39;</span><span class="p">:</span> <span class="s1">&#39;#ff4a46&#39;</span><span class="p">,</span>
 <span class="s1">&#39;Borcherding_2021&#39;</span><span class="p">:</span> <span class="s1">&#39;#008941&#39;</span><span class="p">,</span>
 <span class="s1">&#39;Cheon_2021&#39;</span><span class="p">:</span> <span class="s1">&#39;#006fa6&#39;</span><span class="p">,</span>
 <span class="s1">&#39;Corridoni_2020&#39;</span><span class="p">:</span> <span class="s1">&#39;#a30059&#39;</span><span class="p">,</span>
 <span class="s1">&#39;Gao_2020&#39;</span><span class="p">:</span> <span class="s1">&#39;#ffdbe5&#39;</span><span class="p">,</span>
 <span class="s1">&#39;Gate_2020&#39;</span><span class="p">:</span> <span class="s1">&#39;#7a4900&#39;</span><span class="p">,</span>
 <span class="s1">&#39;He_2020&#39;</span><span class="p">:</span> <span class="s1">&#39;#0000a6&#39;</span><span class="p">,</span>
 <span class="s1">&#39;Kim_2022&#39;</span><span class="p">:</span> <span class="s1">&#39;#63ffac&#39;</span><span class="p">,</span>
 <span class="s1">&#39;Krishna_2021&#39;</span><span class="p">:</span> <span class="s1">&#39;#b79762&#39;</span><span class="p">,</span>
 <span class="s1">&#39;Liao_2020&#39;</span><span class="p">:</span> <span class="s1">&#39;#004d43&#39;</span><span class="p">,</span>
 <span class="s1">&#39;Liu_2021&#39;</span><span class="p">:</span> <span class="s1">&#39;#8fb0ff&#39;</span><span class="p">,</span>
 <span class="s1">&#39;Lu_2019&#39;</span><span class="p">:</span> <span class="s1">&#39;#997d87&#39;</span><span class="p">,</span>
 <span class="s1">&#39;Luoma_2020&#39;</span><span class="p">:</span> <span class="s1">&#39;#5a0007&#39;</span><span class="p">,</span>
 <span class="s1">&#39;Mahuron_2020&#39;</span><span class="p">:</span> <span class="s1">&#39;#809693&#39;</span><span class="p">,</span>
 <span class="s1">&#39;Neal_2018&#39;</span><span class="p">:</span> <span class="s1">&#39;#6a3a4c&#39;</span><span class="p">,</span>
 <span class="s1">&#39;Notarbartolo_2021&#39;</span><span class="p">:</span> <span class="s1">&#39;#1b4400&#39;</span><span class="p">,</span>
 <span class="s1">&#39;Penkava_2020&#39;</span><span class="p">:</span> <span class="s1">&#39;#4fc601&#39;</span><span class="p">,</span>
 <span class="s1">&#39;Ramaswamy_2021&#39;</span><span class="p">:</span> <span class="s1">&#39;#3b5dff&#39;</span><span class="p">,</span>
 <span class="s1">&#39;Simone_2021&#39;</span><span class="p">:</span> <span class="s1">&#39;#4a3b53&#39;</span><span class="p">,</span>
 <span class="s1">&#39;Suo_2022&#39;</span><span class="p">:</span> <span class="s1">&#39;#ff2f80&#39;</span><span class="p">,</span>
 <span class="s1">&#39;Wang_2021&#39;</span><span class="p">:</span> <span class="s1">&#39;#61615a&#39;</span><span class="p">,</span>
 <span class="s1">&#39;Wang_2022&#39;</span><span class="p">:</span> <span class="s1">&#39;#ba0900&#39;</span><span class="p">,</span>
 <span class="s1">&#39;Wen_2020&#39;</span><span class="p">:</span> <span class="s1">&#39;#6b7900&#39;</span><span class="p">,</span>
 <span class="s1">&#39;Yost_2019&#39;</span><span class="p">:</span> <span class="s1">&#39;#00c2a0&#39;</span><span class="p">,</span>
 <span class="s1">&#39;Zheng_2020&#39;</span><span class="p">:</span> <span class="s1">&#39;#ffaa92&#39;</span><span class="p">}</span>

<span class="n">reannotated_prediction_palette</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;CD4&#39;</span><span class="p">:</span> <span class="s1">&#39;#1c83c5ff&#39;</span><span class="p">,</span>
 <span class="s1">&#39;CD8&#39;</span><span class="p">:</span> <span class="s1">&#39;#ffca39ff&#39;</span><span class="p">,</span>
 <span class="s1">&#39;CD40LG&#39;</span><span class="p">:</span> <span class="s1">&#39;#5bc8d9ff&#39;</span><span class="p">,</span>
 <span class="s1">&#39;Cycling&#39;</span><span class="p">:</span> <span class="s1">&#39;#a7a7a7ff&#39;</span><span class="p">,</span>
 <span class="s1">&#39;MAIT&#39;</span><span class="p">:</span> <span class="s1">&#39;#2a9d8fff&#39;</span><span class="p">,</span>
 <span class="s1">&#39;Naive CD4&#39;</span><span class="p">:</span> <span class="s1">&#39;#3c3354ff&#39;</span><span class="p">,</span>
 <span class="s1">&#39;Naive CD8&#39;</span><span class="p">:</span> <span class="s1">&#39;#a9d55dff&#39;</span><span class="p">,</span>
 <span class="s1">&#39;Treg&#39;</span><span class="p">:</span> <span class="s1">&#39;#6a4d93ff&#39;</span><span class="p">,</span>
 <span class="s1">&#39;Undefined&#39;</span><span class="p">:</span> <span class="s1">&#39;#f7f7f7ff&#39;</span><span class="p">,</span>
 <span class="s1">&#39;Ambiguous&#39;</span><span class="p">:</span> <span class="s1">&#39;#f7f7f7ff&#39;</span><span class="p">,</span>
  <span class="s1">&#39;Unknown&#39;</span><span class="p">:</span> <span class="s1">&#39;#f7f7f7ff&#39;</span><span class="p">}</span>

<span class="n">reannotation_palette</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;CREM+ Tm&#39;</span><span class="p">:</span> <span class="s1">&#39;#1f77b4&#39;</span><span class="p">,</span>
 <span class="s1">&#39;CXCR6+ Tex&#39;</span><span class="p">:</span> <span class="s1">&#39;#ff7f0e&#39;</span><span class="p">,</span>
 <span class="s1">&#39;Cycling T&#39;</span><span class="p">:</span> <span class="s1">&#39;#279e68&#39;</span><span class="p">,</span>
 <span class="s1">&#39;Early Tcm/Tem&#39;</span><span class="p">:</span> <span class="s1">&#39;#d62728&#39;</span><span class="p">,</span>
 <span class="s1">&#39;GZMK+ Tem&#39;</span><span class="p">:</span> <span class="s1">&#39;#aa40fc&#39;</span><span class="p">,</span>
 <span class="s1">&#39;GZMK+ Tex&#39;</span><span class="p">:</span> <span class="s1">&#39;#8c564b&#39;</span><span class="p">,</span>
 <span class="s1">&#39;IFITM3+KLRG1+ Temra&#39;</span><span class="p">:</span> <span class="s1">&#39;#e377c2&#39;</span><span class="p">,</span>
 <span class="s1">&#39;ILTCK&#39;</span><span class="p">:</span> <span class="s1">&#39;#b5bd61&#39;</span><span class="p">,</span>
 <span class="s1">&#39;ITGAE+ Trm&#39;</span><span class="p">:</span> <span class="s1">&#39;#17becf&#39;</span><span class="p">,</span>
 <span class="s1">&#39;ITGB2+ Trm&#39;</span><span class="p">:</span> <span class="s1">&#39;#aec7e8&#39;</span><span class="p">,</span>
 <span class="s1">&#39;KLRG1+ Temra&#39;</span><span class="p">:</span> <span class="s1">&#39;#ffbb78&#39;</span><span class="p">,</span>
 <span class="s1">&#39;KLRG1- Temra&#39;</span><span class="p">:</span> <span class="s1">&#39;#98df8a&#39;</span><span class="p">,</span>
 <span class="s1">&#39;MAIT&#39;</span><span class="p">:</span> <span class="s1">&#39;#ff9896&#39;</span><span class="p">,</span>
 <span class="s1">&#39;SELL+ progenitor Tex&#39;</span><span class="p">:</span> <span class="s1">&#39;#c49c94&#39;</span><span class="p">,</span>
 <span class="s1">&#39;Tcm&#39;</span><span class="p">:</span> <span class="s1">&#39;#f7b6d2&#39;</span><span class="p">,</span>
 <span class="s1">&#39;Tn&#39;</span><span class="p">:</span> <span class="s1">&#39;#dbdb8d&#39;</span><span class="p">,</span>
    <span class="s1">&#39;None&#39;</span><span class="p">:</span> <span class="s1">&#39;#F7F7F7&#39;</span>
<span class="p">}</span>
<span class="n">disease_type_palette</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;AML&#39;</span><span class="p">:</span> <span class="s1">&#39;#E64B35&#39;</span><span class="p">,</span>
 <span class="s1">&#39;COVID-19&#39;</span><span class="p">:</span> <span class="s1">&#39;#4DBBD5&#39;</span><span class="p">,</span>
 <span class="s1">&#39;Healthy&#39;</span><span class="p">:</span> <span class="s1">&#39;#029F87&#39;</span><span class="p">,</span>
 <span class="s1">&#39;Inflammation&#39;</span><span class="p">:</span> <span class="s1">&#39;#3C5488&#39;</span><span class="p">,</span>
 <span class="s1">&#39;Inflammation-irAE&#39;</span><span class="p">:</span> <span class="s1">&#39;#F39B7F&#39;</span><span class="p">,</span>
  <span class="s1">&#39;CPI-irAE&#39;</span><span class="p">:</span> <span class="s1">&#39;#F39B7F&#39;</span><span class="p">,</span> 
 <span class="s1">&#39;Solid tumor&#39;</span><span class="p">:</span> <span class="s1">&#39;#8491B4&#39;</span><span class="p">,</span>
 <span class="s1">&#39;T-LGLL&#39;</span><span class="p">:</span> <span class="s1">&#39;#91D1C2&#39;</span><span class="p">}</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="tex2jax_ignore mathjax_ignore section" id="reading-data">
<h1>Reading Data<a class="headerlink" href="#reading-data" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tcr_adata</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">read_h5ad</span><span class="p">(</span><span class="s2">&quot;./data/TCR.h5ad&quot;</span><span class="p">)</span>
<span class="n">tcr_df</span> <span class="o">=</span> <span class="n">tcr_adata</span><span class="o">.</span><span class="n">obs</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># tcr_adata.write_h5ad(&quot;./data/TCR.h5ad&quot;)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gex_adata</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">read_h5ad</span><span class="p">(</span><span class="s2">&quot;./data/GEX.h5ad&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># gex_adata.write_h5ad(&quot;./data/GEX.h5ad&quot;)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">raw_gex_adata</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">read_h5ad</span><span class="p">(</span><span class="s2">&quot;./data/GEX.RAW.h5ad&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tcr_adata</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;tcr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s1">&#39;-&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> 
     <span class="n">tcr_adata</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="n">TRAB_DEFINITION</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;individual&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
<span class="p">))</span>
<span class="n">tcr_adata</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;tcr_no_individual&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s1">&#39;-&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> 
     <span class="n">tcr_adata</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="n">TRAB_DEFINITION</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
<span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gex_adata</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;tcr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s1">&#39;-&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> 
     <span class="n">gex_adata</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="n">TRAB_DEFINITION_ORIG</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;individual&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
<span class="p">))</span>
<span class="n">gex_adata</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;tcr_no_individual&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s1">&#39;-&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> 
     <span class="n">gex_adata</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="n">TRAB_DEFINITION_ORIG</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
<span class="p">))</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="tex2jax_ignore mathjax_ignore section" id="basic-statistics">
<h1>Basic Statistics<a class="headerlink" href="#basic-statistics" title="Permalink to this headline">¶</a></h1>
<div class="section" id="dataset-statistics">
<h2>Dataset statistics<a class="headerlink" href="#dataset-statistics" title="Permalink to this headline">¶</a></h2>
<div class="section" id="figure-1b">
<h3>[Figure 1B]<a class="headerlink" href="#figure-1b" title="Permalink to this headline">¶</a></h3>
<p>Pie chart illustrating the distribution of T cell lineages from different tissue origins and disease types in the collected data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">agg_gex</span> <span class="o">=</span> <span class="n">gex_adata</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span>
    <span class="s2">&quot;disease&quot;</span><span class="p">,</span><span class="s2">&quot;meta_tissue_type&quot;</span>
<span class="p">])</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s2">&quot;reannotated_prediction_2&quot;</span><span class="p">:</span><span class="n">Counter</span><span class="p">,</span><span class="s2">&quot;disease_type&quot;</span><span class="p">:</span><span class="nb">len</span><span class="p">})</span>


<span class="n">palette</span> <span class="o">=</span> <span class="n">CELL_TYPE_C</span>
<span class="n">palette</span><span class="p">[</span><span class="s2">&quot;CD40LG&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;#5BC8D9&#39;</span>
<span class="n">palette</span><span class="p">[</span><span class="s2">&quot;Naive CD8&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;#A9D55D&#39;</span>
<span class="n">palette</span><span class="p">[</span><span class="s2">&quot;Naive CD4&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;#3C3354&#39;</span>
<span class="n">palette</span><span class="p">[</span><span class="s2">&quot;Cycling&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;#A7A7A7&#39;</span>

<span class="n">fig</span><span class="p">,</span><span class="n">axes</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span>
<span class="n">axes</span><span class="o">=</span><span class="n">axes</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="n">cm_dict</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;CD4&quot;</span><span class="p">:</span> <span class="s1">&#39;#1982c4&#39;</span><span class="p">,</span>
    <span class="s2">&quot;Treg&quot;</span><span class="p">:</span> <span class="s1">&#39;#6a4c93&#39;</span><span class="p">,</span>
    <span class="s2">&quot;CD8&quot;</span><span class="p">:</span> <span class="s1">&#39;#ffca3a&#39;</span><span class="p">,</span>
    <span class="s2">&quot;MAIT&quot;</span><span class="p">:</span> <span class="s1">&#39;#2a9d8f&#39;</span><span class="p">,</span>
    <span class="s2">&quot;Unpredictive&quot;</span><span class="p">:</span> <span class="s2">&quot;#D7D7D7&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Undefined&quot;</span><span class="p">:</span> <span class="s2">&quot;#D7D7D7&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Unknown&quot;</span><span class="p">:</span> <span class="s2">&quot;#D7D7D7&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Others&quot;</span><span class="p">:</span> <span class="s1">&#39;#8ac926&#39;</span>
<span class="p">}</span>
<span class="n">a</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">),</span><span class="n">anno</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">agg_gex</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">agg_gex</span><span class="p">[</span><span class="s1">&#39;reannotated_prediction_2&#39;</span><span class="p">]):</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">anno</span><span class="p">)</span> <span class="o">==</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">continue</span>
    <span class="n">anno</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">anno</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    <span class="n">custom_pie2</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="n">a</span><span class="p">],</span> <span class="n">anno</span><span class="p">,</span> <span class="n">palette</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.65</span><span class="p">,</span><span class="n">setp</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="n">a</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">-</span><span class="si">{}</span><span class="s1">-</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="nb">sum</span><span class="p">(</span><span class="n">anno</span><span class="o">.</span><span class="n">values</span><span class="p">())))</span>
    <span class="n">a</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axes</span><span class="p">:</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>     
    <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;bottom&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>     
    <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;left&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">get_ticklines</span><span class="p">():</span>
        <span class="n">line</span><span class="o">.</span><span class="n">set_markersize</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
        <span class="n">line</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="s2">&quot;#585958&quot;</span><span class="p">)</span>
        <span class="n">line</span><span class="o">.</span><span class="n">set_markeredgewidth</span><span class="p">(</span><span class="mf">0.</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">get_ticklines</span><span class="p">():</span>
        <span class="n">line</span><span class="o">.</span><span class="n">set_markersize</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
        <span class="n">line</span><span class="o">.</span><span class="n">set_markeredgewidth</span><span class="p">(</span><span class="mf">0.</span><span class="p">)</span>
        <span class="n">line</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="s2">&quot;#585958&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/huARdb_TCR_paper_notebook_17_0.png" src="_images/huARdb_TCR_paper_notebook_17_0.png" />
</div>
</div>
</div>
</div>
<div class="section" id="tcr-statistics">
<h2>TCR Statistics<a class="headerlink" href="#tcr-statistics" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span>
    <span class="s2">&quot;Total number of TCRs&quot;</span><span class="p">,</span>
    <span class="nb">len</span><span class="p">(</span><span class="n">tcr_df</span><span class="p">)</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="s2">&quot;Number of unique alpha chains&quot;</span><span class="p">,</span> 
    <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span>
        <span class="nb">list</span><span class="p">(</span>
            <span class="nb">map</span><span class="p">(</span>
                <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s1">&#39;=&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> 
                <span class="n">tcr_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="n">TRA_DEFINITION</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">())</span>
            <span class="p">)</span>
        <span class="p">)</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="s2">&quot;Number of unique beta chains&quot;</span><span class="p">,</span> 
    <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span>
        <span class="nb">list</span><span class="p">(</span>
            <span class="nb">map</span><span class="p">(</span>
                <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s1">&#39;=&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> 
                <span class="n">tcr_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="n">TRB_DEFINITION</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">())</span>
            <span class="p">)</span>
        <span class="p">)</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="s2">&quot;Number of unique alpha-beta chains&quot;</span><span class="p">,</span> 
    <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span>
        <span class="nb">list</span><span class="p">(</span>
            <span class="nb">map</span><span class="p">(</span>
                <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s1">&#39;=&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> 
                <span class="n">tcr_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="n">TRAB_DEFINITION</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">())</span>
            <span class="p">)</span>
        <span class="p">)</span>
    <span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Total number of TCRs 635393
Number of unique alpha chains 459013
Number of unique beta chains 604728
Number of unique alpha-beta chains 634252
</pre></div>
</div>
</div>
</div>
<div class="section" id="figure-s3e">
<h3>[Figure S3E]<a class="headerlink" href="#figure-s3e" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">norm</span>
<span class="kn">import</span> <span class="nn">matplotlib.mlab</span> <span class="k">as</span> <span class="nn">mlab</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">norm</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">8</span>

<span class="n">fig</span><span class="p">,</span><span class="n">axes</span><span class="o">=</span><span class="n">createSubplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">axes</span><span class="o">=</span><span class="n">axes</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
<span class="n">axes</span><span class="o">=</span><span class="n">axes</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>

<span class="k">for</span> <span class="n">tx</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;CDR3a_length&#39;</span><span class="p">,</span> <span class="s1">&#39;CDR3b_length&#39;</span><span class="p">,</span> <span class="s1">&#39;CDR3a_mr_length&#39;</span><span class="p">,</span> <span class="s1">&#39;CDR3b_mr_length&#39;</span><span class="p">]:</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">ty</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;CD4&#39;</span><span class="p">,</span> <span class="s1">&#39;CD8&#39;</span><span class="p">,</span> <span class="s1">&#39;MAIT&#39;</span><span class="p">,</span> <span class="s1">&#39;Treg&#39;</span><span class="p">]:</span>
        <span class="n">_tmp</span> <span class="o">=</span> <span class="n">tcr_df</span><span class="p">[</span><span class="n">tcr_df</span><span class="p">[</span><span class="s1">&#39;reannotated_prediction_3&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">ty</span><span class="p">]</span>
    
        <span class="c1"># best fit of data</span>
        <span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="p">)</span> <span class="o">=</span> <span class="n">norm</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">_tmp</span><span class="p">[</span><span class="n">tx</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">tx</span><span class="p">,</span> <span class="n">ty</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{:1f}</span><span class="s1"> </span><span class="si">{:1f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="p">))</span>
        <span class="c1"># the histogram of the data</span>
        <span class="n">n</span><span class="p">,</span> <span class="n">bins</span><span class="p">,</span> <span class="n">patches</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span>
            <span class="n">_tmp</span><span class="p">[</span><span class="n">tx</span><span class="p">],</span> 
            <span class="mi">60</span><span class="p">,</span>  
            <span class="n">alpha</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">density</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="p">)</span>

        <span class="c1"># add a &#39;best fit&#39; line</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">norm</span><span class="o">.</span><span class="n">pdf</span> <span class="p">(</span> <span class="n">bins</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="p">)</span>
        <span class="n">l</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">bins</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">CELL_TYPE_C</span><span class="p">[</span><span class="n">ty</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">tx</span><span class="p">)</span>
    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axes</span><span class="p">:</span> <span class="n">ax</span><span class="o">.</span><span class="n">set_ybound</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.3</span><span class="p">)</span>
<span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axes</span><span class="p">[:</span><span class="mi">2</span><span class="p">]:</span> <span class="n">ax</span><span class="o">.</span><span class="n">set_xbound</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">30</span><span class="p">)</span>
<span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">:]:</span> <span class="n">ax</span><span class="o">.</span><span class="n">set_xbound</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CDR3a_length CD4 13.735635 1.715279
CDR3a_length CD8 13.654846 1.884011
CDR3a_length MAIT 12.850893 1.513819
CDR3a_length Treg 13.720390 1.713582
CDR3b_length CD4 14.533009 1.747905
CDR3b_length CD8 14.567092 1.818574
CDR3b_length MAIT 14.694237 1.519334
CDR3b_length Treg 14.463437 1.777609
CDR3a_mr_length CD4 2.883989 1.772217
CDR3a_mr_length CD8 2.940058 1.887283
CDR3a_mr_length MAIT 2.087256 1.582452
CDR3a_mr_length Treg 2.836182 1.772542
CDR3b_mr_length CD4 5.473898 1.690095
CDR3b_mr_length CD8 5.471974 1.736014
CDR3b_mr_length MAIT 5.430519 1.603429
CDR3b_mr_length Treg 5.414066 1.705451
</pre></div>
</div>
<img alt="_images/huARdb_TCR_paper_notebook_21_1.png" src="_images/huARdb_TCR_paper_notebook_21_1.png" />
</div>
</div>
</div>
</div>
<div class="section" id="gex-statistics">
<h2>GEX statistics<a class="headerlink" href="#gex-statistics" title="Permalink to this headline">¶</a></h2>
<div class="section" id="figure-1c">
<h3>[Figure 1C]<a class="headerlink" href="#figure-1c" title="Permalink to this headline">¶</a></h3>
<p>Uniform manifold approximation and projection (UMAP) representation and cell lineage annotation for variational autoencoder (VAE)-based data integration for million-level scRNA-seq data. The panel in the bottom right corner shows a zoomed-in UMAP for cycling CD4 Tconv, CD8 T, and CD4 Treg cells.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">createFig</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
<span class="n">sc</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">umap</span><span class="p">(</span><span class="n">gex_adata</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;cell_type_1&#39;</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="n">reannotated_prediction_palette</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/huARdb_TCR_paper_notebook_25_0.png" src="_images/huARdb_TCR_paper_notebook_25_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">createFig</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
<span class="n">sc</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">umap</span><span class="p">(</span><span class="n">gex_adata</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;cell_type_2&#39;</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="n">reannotated_prediction_palette</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/huARdb_TCR_paper_notebook_26_0.png" src="_images/huARdb_TCR_paper_notebook_26_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">createFig</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
<span class="n">sc</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">umap</span><span class="p">(</span><span class="n">gex_adata</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;cell_type_3&#39;</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="n">reannotated_prediction_palette</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/huARdb_TCR_paper_notebook_27_0.png" src="_images/huARdb_TCR_paper_notebook_27_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">createFig</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
<span class="n">sc</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">umap</span><span class="p">(</span><span class="n">gex_adata</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;cell_type_4&#39;</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="n">reannotation_palette</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/huARdb_TCR_paper_notebook_28_0.png" src="_images/huARdb_TCR_paper_notebook_28_0.png" />
</div>
</div>
</div>
<div class="section" id="figure-s2a">
<h3>[Figure S2A]<a class="headerlink" href="#figure-s2a" title="Permalink to this headline">¶</a></h3>
<p>The UMAP projection of the integrated million-level T cells colored by study names (left panel), and bar plot for the distribution of different studies correponding to major T cell types including CD4 Tconv, CD4 Treg, CD4 Tn, CD8 Tn, and MAIT cells (right panel)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">createFig</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
<span class="n">sc</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">umap</span><span class="p">(</span><span class="n">gex_adata</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;study_name&#39;</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="n">study_name_palette</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/huARdb_TCR_paper_notebook_31_0.png" src="_images/huARdb_TCR_paper_notebook_31_0.png" />
</div>
</div>
</div>
<div class="section" id="figure-1d">
<h3>[Figure 1D]<a class="headerlink" href="#figure-1d" title="Permalink to this headline">¶</a></h3>
<p>Feature plot for key marker genes, including CD8A, CD4, FOXP3, TCF7, HAVCR2, GZMB, MKI67, CD40LG, KLRB1, ZBTB16, PDCD1, and CX3CR1, used for cell lineage annotation.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Normalize raw data for plotting gene expression</span>
<span class="n">sc</span><span class="o">.</span><span class="n">pp</span><span class="o">.</span><span class="n">normalize_total</span><span class="p">(</span><span class="n">raw_gex_adata</span><span class="p">)</span>
<span class="n">sc</span><span class="o">.</span><span class="n">pp</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="n">raw_gex_adata</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">createFig</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">raw_gex_adata</span><span class="o">.</span><span class="n">obsm</span><span class="p">[</span><span class="s2">&quot;X_umap&quot;</span><span class="p">][:,</span><span class="mi">0</span><span class="p">],</span>
    <span class="n">raw_gex_adata</span><span class="o">.</span><span class="n">obsm</span><span class="p">[</span><span class="s2">&quot;X_umap&quot;</span><span class="p">][:,</span><span class="mi">1</span><span class="p">],</span>
    <span class="n">s</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
    <span class="n">linewidths</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#FDF6F3&#39;</span>
<span class="p">)</span>
<span class="n">gene_name</span> <span class="o">=</span> <span class="s1">&#39;HAVCR2&#39;</span>
<span class="n">sc</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">umap</span><span class="p">(</span>
    <span class="n">raw_gex_adata</span><span class="p">[</span><span class="n">raw_gex_adata</span><span class="o">.</span><span class="n">X</span><span class="p">[:,</span><span class="nb">list</span><span class="p">(</span><span class="n">raw_gex_adata</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">index</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">gene_name</span><span class="p">)]</span><span class="o">.</span><span class="n">toarray</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">],</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> 
    <span class="n">color</span><span class="o">=</span><span class="n">gene_name</span><span class="p">,</span> 
    <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Reds&#39;</span><span class="p">,</span>
    <span class="n">s</span><span class="o">=</span><span class="mf">0.5</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/huARdb_TCR_paper_notebook_34_0.png" src="_images/huARdb_TCR_paper_notebook_34_0.png" />
</div>
</div>
</div>
<div class="section" id="figure-s2c">
<h3>[Figure S2C]<a class="headerlink" href="#figure-s2c" title="Permalink to this headline">¶</a></h3>
<p>Cell type annotation by singleR as previously used in Wu et al., 2021.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">createFig</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
<span class="n">sc</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">umap</span><span class="p">(</span><span class="n">gex_adata</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;predictions&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/huARdb_TCR_paper_notebook_37_0.png" src="_images/huARdb_TCR_paper_notebook_37_0.png" />
</div>
</div>
</div>
<div class="section" id="figure-s2b">
<h3>Figure S2B<a class="headerlink" href="#figure-s2b" title="Permalink to this headline">¶</a></h3>
<p>Distribution of cells from different disease states including solid tumors, inflammation, CPI-irAE (checkpoint inhibitor associated immune-related adverse events), AML (Acute Myeloid Leukemia), COVID-19, Healthy, and T-LGLL (T cell large granular lymphocytic leukemia) in the integrated UMAP and pie chart for the composition of T cell states in each disease conditions.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">createFig</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">gex_adata</span><span class="o">.</span><span class="n">obsm</span><span class="p">[</span><span class="s2">&quot;X_umap&quot;</span><span class="p">][:,</span><span class="mi">0</span><span class="p">],</span>
    <span class="n">gex_adata</span><span class="o">.</span><span class="n">obsm</span><span class="p">[</span><span class="s2">&quot;X_umap&quot;</span><span class="p">][:,</span><span class="mi">1</span><span class="p">],</span>
    <span class="n">s</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
    <span class="n">linewidths</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#F7F7F7&#39;</span>
<span class="p">)</span>
<span class="n">sc</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">umap</span><span class="p">(</span>
    <span class="n">gex_adata</span><span class="p">[</span><span class="n">gex_adata</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;disease_type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Solid tumor&#39;</span><span class="p">],</span> 
    <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> 
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;disease_type&#39;</span><span class="p">,</span> 
    <span class="n">s</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
    <span class="n">palette</span><span class="o">=</span><span class="n">disease_type_palette</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/usr/local/lib/python3.9/site-packages/anndata/compat/_overloaded_dict.py:106: ImplicitModificationWarning: Trying to modify attribute `._uns` of view, initializing view as actual.
  self.data[key] = value
</pre></div>
</div>
<img alt="_images/huARdb_TCR_paper_notebook_40_1.png" src="_images/huARdb_TCR_paper_notebook_40_1.png" />
</div>
</div>
</div>
<div class="section" id="figure-1e">
<h3>Figure 1E<a class="headerlink" href="#figure-1e" title="Permalink to this headline">¶</a></h3>
<p>Pie chart depicting the composition of cell lineages for all TCRα/β pairs (upper panel) and unique TCRα/β pairs (lower panel).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">anno</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="n">gex_adata</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;cell_type_3&#39;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">anno</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span><span class="n">axes</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">custom_pie2</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">anno</span><span class="p">,</span><span class="n">reannotated_prediction_palette</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;GEX&quot;</span><span class="p">)</span>
<span class="n">anno</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="n">tcr_df</span><span class="p">[</span><span class="s1">&#39;cell_type_3&#39;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">anno</span><span class="p">)</span>
<span class="n">custom_pie2</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">anno</span><span class="p">,</span><span class="n">reannotated_prediction_palette</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;TCR&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;./figures/gex_tcr_df_cell_type_3_pie.pdf&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Counter({&#39;CD4&#39;: 488160, &#39;CD8&#39;: 435666, &#39;Treg&#39;: 71854, &#39;MAIT&#39;: 20040, &#39;Undefined&#39;: 2002, &#39;Unknown&#39;: 155})
Counter({&#39;CD4&#39;: 413927, &#39;CD8&#39;: 139584, &#39;Treg&#39;: 48328, &#39;Ambiguous&#39;: 21231, &#39;MAIT&#39;: 12320, &#39;Undefined&#39;: 3})
</pre></div>
</div>
<img alt="_images/huARdb_TCR_paper_notebook_43_1.png" src="_images/huARdb_TCR_paper_notebook_43_1.png" />
</div>
</div>
</div>
</div>
</div>
<div class="tex2jax_ignore mathjax_ignore section" id="vj-segment-joining-analysis">
<h1>VJ-segment joining analysis<a class="headerlink" href="#vj-segment-joining-analysis" title="Permalink to this headline">¶</a></h1>
<div class="section" id="single-vj-segment-and-t-cell-type">
<h2>Single VJ segment and T cell type<a class="headerlink" href="#single-vj-segment-and-t-cell-type" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.lines</span> <span class="k">as</span> <span class="nn">mlines</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">stats</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">8</span>

<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>


<span class="c1"># Func to draw line segment</span>
<span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">cell_type</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">tcr_df</span><span class="p">[</span><span class="s1">&#39;cell_type_3&#39;</span><span class="p">]):</span>
    <span class="k">for</span> <span class="n">gene</span> <span class="ow">in</span> <span class="p">[</span>
        <span class="s1">&#39;TRAV&#39;</span><span class="p">,</span><span class="s1">&#39;TRAJ&#39;</span><span class="p">,</span><span class="s1">&#39;TRBV&#39;</span><span class="p">,</span><span class="s2">&quot;TRBJ&quot;</span>
    <span class="p">]:</span>

        <span class="n">c</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">,</span> <span class="n">tcr_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
            <span class="n">tcr_df</span><span class="p">[</span><span class="s1">&#39;cell_type_3&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">cell_type</span><span class="p">,</span>
            <span class="n">gene</span>
        <span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">())))</span>
        <span class="n">c_non</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">,</span> <span class="n">tcr_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
            <span class="n">tcr_df</span><span class="p">[</span><span class="s1">&#39;cell_type_3&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">cell_type</span><span class="p">,</span>
            <span class="n">gene</span>
        <span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">())))</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">c</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">mat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
                <span class="p">[</span><span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="nb">sum</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">values</span><span class="p">())</span> <span class="o">-</span> <span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span>
                <span class="p">[</span><span class="n">c_non</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="nb">sum</span><span class="p">(</span><span class="n">c_non</span><span class="o">.</span><span class="n">values</span><span class="p">())</span> <span class="o">-</span> <span class="n">c_non</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
            <span class="p">])</span>
            <span class="n">odds_ratio</span><span class="p">,</span> <span class="n">pvalue</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">fisher_exact</span><span class="p">(</span><span class="n">mat</span><span class="p">)</span>
            <span class="n">chi</span><span class="p">,</span> <span class="n">chi_p</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span>  <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">chi2_contingency</span><span class="p">(</span><span class="n">mat</span><span class="p">)</span>
            <span class="n">lower95ci</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">odds_ratio</span><span class="p">)</span> <span class="o">-</span> <span class="mf">1.96</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mi">1</span><span class="o">/</span><span class="n">x</span><span class="p">,</span> <span class="n">mat</span><span class="o">.</span><span class="n">flatten</span><span class="p">())))))</span>
            <span class="n">upper95ci</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">odds_ratio</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1.96</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mi">1</span><span class="o">/</span><span class="n">x</span><span class="p">,</span> <span class="n">mat</span><span class="o">.</span><span class="n">flatten</span><span class="p">())))))</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">cell_type</span><span class="p">,</span>
                           <span class="n">i</span><span class="p">,</span> 
                           <span class="n">odds_ratio</span><span class="p">,</span> 
                           <span class="n">lower95ci</span><span class="p">,</span> 
                           <span class="n">upper95ci</span><span class="p">,</span> 
                           <span class="n">pvalue</span><span class="p">,</span>
                           <span class="n">chi_p</span><span class="p">,</span>
                           <span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> 
                           <span class="n">c_non</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> 
                           <span class="nb">sum</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span> 
                           <span class="nb">sum</span><span class="p">(</span><span class="n">c_non</span><span class="o">.</span><span class="n">values</span><span class="p">())</span> 
                          <span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">statsmodels.stats.multitest</span> <span class="kn">import</span> <span class="n">multipletests</span>
<span class="n">single_vj_cell_type</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;cell_type&#39;</span><span class="p">,</span><span class="s1">&#39;segment&#39;</span><span class="p">,</span><span class="s1">&#39;odds&#39;</span><span class="p">,</span><span class="s1">&#39;lower95ci&#39;</span><span class="p">,</span><span class="s1">&#39;upper95ci&#39;</span><span class="p">,</span><span class="s1">&#39;pvalue&#39;</span><span class="p">,</span><span class="s1">&#39;chi_pvalue&#39;</span><span class="p">,</span><span class="s1">&#39;count_pos&#39;</span><span class="p">,</span><span class="s1">&#39;count_neg&#39;</span><span class="p">,</span><span class="s1">&#39;sum_pos&#39;</span><span class="p">,</span><span class="s1">&#39;sum_neg&#39;</span><span class="p">])</span>
<span class="n">single_vj_cell_type</span> <span class="o">=</span> <span class="n">single_vj_cell_type</span><span class="p">[</span><span class="n">single_vj_cell_type</span><span class="p">[</span><span class="s1">&#39;cell_type&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;Ambiguous&#39;</span><span class="p">]</span>
<span class="n">single_vj_cell_type</span><span class="p">[</span><span class="s1">&#39;pvalue&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">single_vj_cell_type</span><span class="p">[</span><span class="s1">&#39;pvalue&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="mf">1e-320</span>
<span class="n">single_vj_cell_type</span><span class="p">[</span><span class="s1">&#39;chi_pvalue&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">single_vj_cell_type</span><span class="p">[</span><span class="s1">&#39;chi_pvalue&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="mf">1e-320</span>
<span class="n">single_vj_cell_type</span><span class="p">[</span><span class="s1">&#39;adj_pvalue&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">multipletests</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">single_vj_cell_type</span><span class="p">[</span><span class="s1">&#39;pvalue&#39;</span><span class="p">]))[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">single_vj_cell_type</span><span class="p">[</span><span class="s1">&#39;adj_chi_pvalue&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">multipletests</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">single_vj_cell_type</span><span class="p">[</span><span class="s1">&#39;chi_pvalue&#39;</span><span class="p">]))[</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">single_vj_cell_type</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;./data/single_vj_cell_type.csv&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span><span class="n">axes</span><span class="o">=</span><span class="n">createSubplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">axes</span><span class="o">=</span><span class="n">axes</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="k">for</span> <span class="n">ax</span><span class="p">,</span><span class="n">cell_type</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">axes</span><span class="p">,[</span><span class="s1">&#39;CD8&#39;</span><span class="p">,</span><span class="s1">&#39;CD4&#39;</span><span class="p">,</span><span class="s1">&#39;MAIT&#39;</span><span class="p">,</span><span class="s1">&#39;Treg&#39;</span><span class="p">]):</span>
    <span class="n">NormalizeData</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span><span class="p">:</span> <span class="p">(</span><span class="n">data</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">data</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="n">single_vj_cell_type</span><span class="p">[</span><span class="n">single_vj_cell_type</span><span class="p">[</span><span class="s1">&#39;cell_type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">cell_type</span><span class="p">][</span><span class="s1">&#39;odds&#39;</span><span class="p">]),</span> 
               <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">single_vj_cell_type</span><span class="p">[</span><span class="n">single_vj_cell_type</span><span class="p">[</span><span class="s1">&#39;cell_type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">cell_type</span><span class="p">][</span><span class="s1">&#39;adj_pvalue&#39;</span><span class="p">]),</span> 
               <span class="n">s</span><span class="o">=</span><span class="n">NormalizeData</span><span class="p">(</span><span class="n">single_vj_cell_type</span><span class="p">[</span><span class="n">single_vj_cell_type</span><span class="p">[</span><span class="s1">&#39;cell_type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">cell_type</span><span class="p">][</span><span class="s1">&#39;count_pos&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">10</span><span class="p">,</span> 
               <span class="n">c</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">CELL_TYPE_C</span><span class="p">[</span><span class="n">x</span><span class="p">],</span> <span class="n">single_vj_cell_type</span><span class="p">[</span><span class="n">single_vj_cell_type</span><span class="p">[</span><span class="s1">&#39;cell_type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">cell_type</span><span class="p">][</span><span class="s1">&#39;cell_type&#39;</span><span class="p">])))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">i</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="n">single_vj_cell_type</span><span class="p">[</span><span class="n">single_vj_cell_type</span><span class="p">[</span><span class="s1">&#39;cell_type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">cell_type</span><span class="p">][</span><span class="s1">&#39;odds&#39;</span><span class="p">]),</span> 
        <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">single_vj_cell_type</span><span class="p">[</span><span class="n">single_vj_cell_type</span><span class="p">[</span><span class="s1">&#39;cell_type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">cell_type</span><span class="p">][</span><span class="s1">&#39;adj_pvalue&#39;</span><span class="p">]),</span>
        <span class="nb">list</span><span class="p">(</span><span class="n">single_vj_cell_type</span><span class="p">[</span><span class="n">single_vj_cell_type</span><span class="p">[</span><span class="s1">&#39;cell_type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">cell_type</span><span class="p">][</span><span class="s1">&#39;segment&#39;</span><span class="p">]),</span>
        <span class="nb">list</span><span class="p">(</span><span class="n">single_vj_cell_type</span><span class="p">[</span><span class="n">single_vj_cell_type</span><span class="p">[</span><span class="s1">&#39;cell_type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">cell_type</span><span class="p">][</span><span class="s1">&#39;cell_type&#39;</span><span class="p">])</span>
    <span class="p">):</span>
        <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mf">0.5</span> <span class="ow">and</span> <span class="n">y</span> <span class="o">&gt;</span> <span class="mi">50</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="mf">0.1</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="n">CELL_TYPE_C</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">cell_type</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Log2(FoldChange)&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;-Log10(pVal)&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/huARdb_TCR_paper_notebook_49_0.png" src="_images/huARdb_TCR_paper_notebook_49_0.png" />
</div>
</div>
</div>
<div class="section" id="paired-vj-segment-and-t-cell-type">
<h2>Paired VJ segment and T cell type<a class="headerlink" href="#paired-vj-segment-and-t-cell-type" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.lines</span> <span class="k">as</span> <span class="nn">mlines</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">stats</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">combinations</span>

<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">8</span>
<span class="c1"># Func to draw line segment</span>
<span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span> <span class="ow">in</span> <span class="n">combinations</span><span class="p">([</span><span class="s1">&#39;TRAV&#39;</span><span class="p">,</span><span class="s1">&#39;TRAJ&#39;</span><span class="p">,</span><span class="s1">&#39;TRBV&#39;</span><span class="p">,</span><span class="s2">&quot;TRBJ&quot;</span><span class="p">],</span><span class="mi">2</span><span class="p">):</span>
    <span class="n">tcr_df</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s1">&#39;=&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="nb">zip</span><span class="p">(</span><span class="n">tcr_df</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">tcr_df</span><span class="p">[</span><span class="n">j</span><span class="p">])))</span>

<span class="k">for</span> <span class="n">cell_type</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">tcr_df</span><span class="p">[</span><span class="s1">&#39;cell_type_3&#39;</span><span class="p">]):</span>
    <span class="k">for</span> <span class="n">gene</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">,</span> <span class="n">combinations</span><span class="p">([</span><span class="s1">&#39;TRAV&#39;</span><span class="p">,</span><span class="s1">&#39;TRAJ&#39;</span><span class="p">,</span><span class="s1">&#39;TRBV&#39;</span><span class="p">,</span><span class="s2">&quot;TRBJ&quot;</span><span class="p">],</span><span class="mi">2</span><span class="p">))):</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">,</span> <span class="n">tcr_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
            <span class="n">tcr_df</span><span class="p">[</span><span class="s1">&#39;cell_type_3&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">cell_type</span><span class="p">,</span>
            <span class="n">gene</span>
        <span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">())))</span>
        <span class="n">c_non</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">,</span> <span class="n">tcr_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
            <span class="n">tcr_df</span><span class="p">[</span><span class="s1">&#39;cell_type_3&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">cell_type</span><span class="p">,</span>
            <span class="n">gene</span>
        <span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">())))</span>


        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">c</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">mat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
                <span class="p">[</span><span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="nb">sum</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">values</span><span class="p">())</span> <span class="o">-</span> <span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span>
                <span class="p">[</span><span class="n">c_non</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="nb">sum</span><span class="p">(</span><span class="n">c_non</span><span class="o">.</span><span class="n">values</span><span class="p">())</span> <span class="o">-</span> <span class="n">c_non</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
            <span class="p">])</span>
            <span class="n">odds_ratio</span><span class="p">,</span> <span class="n">pvalue</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">fisher_exact</span><span class="p">(</span><span class="n">mat</span><span class="p">)</span>
            <span class="n">chi</span><span class="p">,</span> <span class="n">chi_p</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span>  <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">chi2_contingency</span><span class="p">(</span><span class="n">mat</span><span class="p">)</span>
            <span class="n">lower95ci</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">odds_ratio</span><span class="p">)</span> <span class="o">-</span> <span class="mf">1.96</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mi">1</span><span class="o">/</span><span class="n">x</span><span class="p">,</span> <span class="n">mat</span><span class="o">.</span><span class="n">flatten</span><span class="p">())))))</span>
            <span class="n">upper95ci</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">odds_ratio</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1.96</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mi">1</span><span class="o">/</span><span class="n">x</span><span class="p">,</span> <span class="n">mat</span><span class="o">.</span><span class="n">flatten</span><span class="p">())))))</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">cell_type</span><span class="p">,</span>
                           <span class="n">i</span><span class="p">,</span> 
                           <span class="n">odds_ratio</span><span class="p">,</span> 
                           <span class="n">lower95ci</span><span class="p">,</span> 
                           <span class="n">upper95ci</span><span class="p">,</span> 
                           <span class="n">pvalue</span><span class="p">,</span> 
                           <span class="n">chi_p</span><span class="p">,</span>
                           <span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> 
                           <span class="n">c_non</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> 
                           <span class="nb">sum</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span> 
                           <span class="nb">sum</span><span class="p">(</span><span class="n">c_non</span><span class="o">.</span><span class="n">values</span><span class="p">())</span> 
                          <span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dual_vj_cell_type</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;cell_type&#39;</span><span class="p">,</span><span class="s1">&#39;segment&#39;</span><span class="p">,</span><span class="s1">&#39;odds&#39;</span><span class="p">,</span><span class="s1">&#39;lower95ci&#39;</span><span class="p">,</span><span class="s1">&#39;upper95ci&#39;</span><span class="p">,</span><span class="s1">&#39;pvalue&#39;</span><span class="p">,</span><span class="s1">&#39;chi_pvalue&#39;</span><span class="p">,</span><span class="s1">&#39;count_pos&#39;</span><span class="p">,</span><span class="s1">&#39;count_neg&#39;</span><span class="p">,</span><span class="s1">&#39;sum_pos&#39;</span><span class="p">,</span><span class="s1">&#39;sum_neg&#39;</span><span class="p">])</span>
<span class="n">dual_vj_cell_type</span> <span class="o">=</span> <span class="n">dual_vj_cell_type</span><span class="p">[</span><span class="n">dual_vj_cell_type</span><span class="p">[</span><span class="s1">&#39;cell_type&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;Ambiguous&#39;</span><span class="p">]</span>
<span class="n">dual_vj_cell_type</span><span class="p">[</span><span class="s1">&#39;pvalue&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dual_vj_cell_type</span><span class="p">[</span><span class="s1">&#39;pvalue&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="mf">1e-320</span>
<span class="n">dual_vj_cell_type</span><span class="p">[</span><span class="s1">&#39;adj_pvalue&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">multipletests</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">dual_vj_cell_type</span><span class="p">[</span><span class="s1">&#39;pvalue&#39;</span><span class="p">]))[</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span><span class="n">axes</span><span class="o">=</span><span class="n">createSubplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">axes</span><span class="o">=</span><span class="n">axes</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="k">for</span> <span class="n">ax</span><span class="p">,</span><span class="n">cell_type</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">axes</span><span class="p">,[</span><span class="s1">&#39;CD8&#39;</span><span class="p">,</span><span class="s1">&#39;CD4&#39;</span><span class="p">,</span><span class="s1">&#39;MAIT&#39;</span><span class="p">,</span><span class="s1">&#39;Treg&#39;</span><span class="p">]):</span>
    <span class="n">NormalizeData</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span><span class="p">:</span> <span class="p">(</span><span class="n">data</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">data</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="n">dual_vj_cell_type</span><span class="p">[</span><span class="n">dual_vj_cell_type</span><span class="p">[</span><span class="s1">&#39;cell_type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">cell_type</span><span class="p">][</span><span class="s1">&#39;odds&#39;</span><span class="p">]),</span> 
               <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">dual_vj_cell_type</span><span class="p">[</span><span class="n">dual_vj_cell_type</span><span class="p">[</span><span class="s1">&#39;cell_type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">cell_type</span><span class="p">][</span><span class="s1">&#39;adj_pvalue&#39;</span><span class="p">]),</span> 
               <span class="n">s</span><span class="o">=</span><span class="n">NormalizeData</span><span class="p">(</span><span class="n">dual_vj_cell_type</span><span class="p">[</span><span class="n">dual_vj_cell_type</span><span class="p">[</span><span class="s1">&#39;cell_type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">cell_type</span><span class="p">][</span><span class="s1">&#39;count_pos&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">10</span><span class="p">,</span> 
               <span class="n">c</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">CELL_TYPE_C</span><span class="p">[</span><span class="n">x</span><span class="p">],</span> <span class="n">dual_vj_cell_type</span><span class="p">[</span><span class="n">dual_vj_cell_type</span><span class="p">[</span><span class="s1">&#39;cell_type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">cell_type</span><span class="p">][</span><span class="s1">&#39;cell_type&#39;</span><span class="p">])))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">i</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="n">dual_vj_cell_type</span><span class="p">[</span><span class="n">dual_vj_cell_type</span><span class="p">[</span><span class="s1">&#39;cell_type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">cell_type</span><span class="p">][</span><span class="s1">&#39;odds&#39;</span><span class="p">]),</span> 
        <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">dual_vj_cell_type</span><span class="p">[</span><span class="n">dual_vj_cell_type</span><span class="p">[</span><span class="s1">&#39;cell_type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">cell_type</span><span class="p">][</span><span class="s1">&#39;adj_pvalue&#39;</span><span class="p">]),</span>
        <span class="nb">list</span><span class="p">(</span><span class="n">dual_vj_cell_type</span><span class="p">[</span><span class="n">dual_vj_cell_type</span><span class="p">[</span><span class="s1">&#39;cell_type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">cell_type</span><span class="p">][</span><span class="s1">&#39;segment&#39;</span><span class="p">]),</span>
        <span class="nb">list</span><span class="p">(</span><span class="n">dual_vj_cell_type</span><span class="p">[</span><span class="n">dual_vj_cell_type</span><span class="p">[</span><span class="s1">&#39;cell_type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">cell_type</span><span class="p">][</span><span class="s1">&#39;cell_type&#39;</span><span class="p">])</span>
    <span class="p">):</span>
        <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mf">0.5</span> <span class="ow">and</span> <span class="n">y</span> <span class="o">&gt;</span> <span class="mi">50</span><span class="p">:</span>
            <span class="k">continue</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="mf">0.1</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="n">CELL_TYPE_C</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">cell_type</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Log2(FoldChange)&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;-Log10(pVal)&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/huARdb_TCR_paper_notebook_53_0.png" src="_images/huARdb_TCR_paper_notebook_53_0.png" />
</div>
</div>
<div class="section" id="figure2a">
<h3>[Figure2A]<a class="headerlink" href="#figure2a" title="Permalink to this headline">¶</a></h3>
<p>Sankey plot illustrating the enriched TRAV/TRAJ, TRAV/TRBV, and TRBV/TRBJ pairing and joining preferences in CD8 T, MAIT, and CD4 Tconv cells. The figure is generated by D3Js.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">_df</span> <span class="o">=</span> <span class="n">dual_vj_cell_type</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">dual_vj_cell_type</span><span class="p">[</span><span class="s1">&#39;adj_pvalue&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.05</span><span class="p">)</span> <span class="o">&amp;</span> 
    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">dual_vj_cell_type</span><span class="p">[</span><span class="s1">&#39;odds&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&amp;</span> 
    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">dual_vj_cell_type</span><span class="p">[</span><span class="s1">&#39;count_pos&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">350</span><span class="p">)</span> <span class="o">&amp;</span> 
    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;TRAV&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;TRAJ&quot;</span><span class="p">))</span> <span class="ow">or</span> 
                                <span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;TRAV&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;TRBV&quot;</span><span class="p">))</span> <span class="ow">or</span> 
                                <span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;TRBV&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;TRBJ&quot;</span><span class="p">)),</span> 
    <span class="n">dual_vj_cell_type</span><span class="p">[</span><span class="s1">&#39;segment&#39;</span><span class="p">])))</span>
<span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,[</span><span class="s1">&#39;cell_type&#39;</span><span class="p">,</span><span class="s1">&#39;segment&#39;</span><span class="p">,</span><span class="s1">&#39;odds&#39;</span><span class="p">,</span><span class="s1">&#39;count_pos&#39;</span><span class="p">]]</span>



<span class="n">_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                        <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> 
                        <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span>
                        <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                        <span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">]]</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;TRAJ&#39;</span><span class="p">)</span> <span class="k">else</span> \
                       <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                        <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span> 
                        <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
                        <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                        <span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">]],</span> <span class="n">_df</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">())),</span>
    <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;preference&#39;</span><span class="p">,</span><span class="s1">&#39;source&#39;</span><span class="p">,</span><span class="s1">&#39;target&#39;</span><span class="p">,</span><span class="s1">&#39;odds&#39;</span><span class="p">,</span><span class="s1">&#39;value&#39;</span><span class="p">]</span>
<span class="p">)</span>
<span class="n">_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;./sankey/files/cell_type_specific_vj_pairing.csv&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">IPython.core.display</span> <span class="kn">import</span> <span class="n">HTML</span>
<span class="n">HTML</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s2">&quot;./sankey/saved.html&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">readlines</span><span class="p">()))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div class="observablehq"><svg width="1504" height="600" viewBox="0,0,1504,600" style="max-width: 100%; height: auto; height: intrinsic;"><g stroke="currentColor"><rect x="1" y="310.933462652652" height="5.678380265301371" width="15" fill="#4e79a7"><title>TRAJ34366 TWh</title></rect><rect x="1" y="326.61184291795337" height="6.097277170118673" width="15" fill="#4e79a7"><title>TRAJ45393 TWh</title></rect><rect x="1" y="443.24733720857915" height="11.217128228997012" width="15" fill="#4e79a7"><title>TRAJ54723 TWh</title></rect><rect x="1" y="415.09590096501177" height="17.2213171980452" width="15" fill="#4e79a7"><title>TRAJ221,110 TWh</title></rect><rect x="1" y="342.70912008807204" height="7.524629586533251" width="15" fill="#4e79a7"><title>TRAJ58485 TWh</title></rect><rect x="1" y="574.923681569193" height="6.500659374757561" width="15" fill="#4e79a7"><title>TRAJ39419 TWh</title></rect><rect x="1" y="464.46446543757617" height="14.149406562718127" width="15" fill="#4e79a7"><title>TRAJ53912 TWh</title></rect><rect x="1" y="488.6138720002943" height="16.352493988053652" width="15" fill="#4e79a7"><title>TRAJ371,054 TWh</title></rect><rect x="1" y="558.2523604924728" height="6.671321076720233" width="15" fill="#4e79a7"><title>TRAJ31430 TWh</title></rect><rect x="496.6666666666667" y="378.64760334743687" height="68.46637188736332" width="15" fill="#f28e2c"><title>TRAV23DV64,413 TWh</title></rect><rect x="496.6666666666667" y="457.1139752348002" height="18.819331316422335" width="15" fill="#f28e2c"><title>TRAV9-21,213 TWh</title></rect><rect x="496.6666666666667" y="261.84353424870073" height="9.06058490419673" width="15" fill="#f28e2c"><title>TRAV16584 TWh</title></rect><rect x="496.6666666666667" y="573.2794197502132" height="21.72058024978685" width="15" fill="#f28e2c"><title>TRAV8-41,400 TWh</title></rect><rect x="496.6666666666667" y="523.5088763535139" height="15.35955317663479" width="15" fill="#f28e2c"><title>TRAV2990 TWh</title></rect><rect x="496.6666666666667" y="548.8684295301487" height="6.841982778682791" width="15" fill="#f28e2c"><title>TRAV26-1441 TWh</title></rect><rect x="496.6666666666667" y="485.93330655122253" height="13.420215654332424" width="15" fill="#f28e2c"><title>TRAV13-2865 TWh</title></rect><rect x="992.3333333333334" y="444.85261034830546" height="11.04646652703434" width="15" fill="#e15759"><title>TRBV3-1712 TWh</title></rect><rect x="992.3333333333334" y="427.87099526801694" height="6.98161508028852" width="15" fill="#e15759"><title>TRBV5-4450 TWh</title></rect><rect x="496.6666666666667" y="87.91366069350715" height="26.716313707237617" width="15" fill="#f28e2c"><title>TRAV14DV41,722 TWh</title></rect><rect x="496.6666666666667" y="5" height="6.6247769761849895" width="15" fill="#f28e2c"><title>TRAV29DV5427 TWh</title></rect><rect x="496.6666666666667" y="60.56822589403464" height="17.345434799472514" width="15" fill="#f28e2c"><title>TRAV12-21,118 TWh</title></rect><rect x="496.6666666666667" y="21.62477697618499" height="6.205880071367691" width="15" fill="#f28e2c"><title>TRAV17400 TWh</title></rect><rect x="496.6666666666667" y="124.62997440074477" height="26.033666899387185" width="15" fill="#f28e2c"><title>TRAV191,678 TWh</title></rect><rect x="496.6666666666667" y="37.83065704755268" height="12.737568846481963" width="15" fill="#f28e2c"><title>TRAV21821 TWh</title></rect><rect x="496.6666666666667" y="160.66364130013196" height="91.17989294856875" width="15" fill="#f28e2c"><title>TRAV1-25,877 TWh</title></rect><rect x="992.3333333333334" y="54.58653324024512" height="72.45364983321699" width="15" fill="#e15759"><title>TRBV274,670 TWh</title></rect><rect x="992.3333333333334" y="137.04018307346212" height="25.987122798852027" width="15" fill="#e15759"><title>TRBV7-91,675 TWh</title></rect><rect x="992.3333333333334" y="21.469629974400732" height="23.116903265844385" width="15" fill="#e15759"><title>TRBV4-11,490 TWh</title></rect><rect x="992.3333333333334" y="5" height="6.469629974400732" width="15" fill="#e15759"><title>TRBV13417 TWh</title></rect><rect x="992.3333333333334" y="264.03110697385796" height="13.823597858971368" width="15" fill="#e15759"><title>TRBV7-6891 TWh</title></rect><rect x="992.3333333333334" y="173.02730587231414" height="25.304475991001567" width="15" fill="#e15759"><title>TRBV91,631 TWh</title></rect><rect x="1" y="222.59974145181417" height="78.33372120083783" width="15" fill="#4e79a7"><title>TRAJ335,049 TWh</title></rect><rect x="1" y="360.2337496746053" height="5.833527267085515" width="15" fill="#4e79a7"><title>TRAJ20376 TWh</title></rect><rect x="1" y="376.0672769416908" height="7.012644480645349" width="15" fill="#4e79a7"><title>TRAJ12452 TWh</title></rect><rect x="992.3333333333334" y="231.25552711193882" height="22.77557986191914" width="15" fill="#e15759"><title>TRBV6-41,468 TWh</title></rect><rect x="992.3333333333334" y="393.7921805911105" height="24.07881467690646" width="15" fill="#e15759"><title>TRBV5-11,552 TWh</title></rect><rect x="992.3333333333334" y="524.8650221084481" height="30.408812349701293" width="15" fill="#e15759"><title>TRBV12-31,960 TWh</title></rect><rect x="992.3333333333334" y="483.3926770615162" height="8.905437902412473" width="15" fill="#e15759"><title>TRBV30574 TWh</title></rect><rect x="992.3333333333334" y="502.2981149639287" height="12.566907144519405" width="15" fill="#e15759"><title>TRBV2810 TWh</title></rect><rect x="992.3333333333334" y="565.2738344581494" height="29.726165541850833" width="15" fill="#e15759"><title>TRBV7-21,916 TWh</title></rect><rect x="992.3333333333334" y="350.0011636025137" height="33.791016988596766" width="15" fill="#e15759"><title>TRBV20-12,178 TWh</title></rect><rect x="992.3333333333334" y="465.8990768753398" height="7.4936001861764225" width="15" fill="#e15759"><title>TRBV18483 TWh</title></rect><rect x="1488" y="429.88572718435995" height="17.857419905360302" width="15" fill="#76b7b2"><title>TRBJ1-61,151 TWh</title></rect><rect x="992.3333333333334" y="208.3317818633157" height="12.923745248623106" width="15" fill="#e15759"><title>TRBV19833 TWh</title></rect><rect x="1488" y="5" height="71.04181211698085" width="15" fill="#76b7b2"><title>TRBJ2-74,579 TWh</title></rect><rect x="1488" y="127.50678044703983" height="58.133581568536215" width="15" fill="#76b7b2"><title>TRBJ2-13,747 TWh</title></rect><rect x="1488" y="86.04181211698085" height="20.494918935691544" width="15" fill="#76b7b2"><title>TRBJ1-11,321 TWh</title></rect><rect x="1488" y="195.64036201557604" height="21.751609650143564" width="15" fill="#76b7b2"><title>TRBJ2-31,402 TWh</title></rect><rect x="992.3333333333334" y="287.8547048328293" height="8.889923202234172" width="15" fill="#e15759"><title>TRBV6-2573 TWh</title></rect><rect x="992.3333333333334" y="306.7446280350635" height="14.226980063610313" width="15" fill="#e15759"><title>TRBV6-1917 TWh</title></rect><rect x="992.3333333333334" y="330.9716080986738" height="9.029555503839902" width="15" fill="#e15759"><title>TRBV4-2582 TWh</title></rect></g><g fill="none" stroke-opacity="0.5"><g style="mix-blend-mode: multiply;"><path d="M16,313.7726527853027C256.33333333333337,313.7726527853027,256.33333333333337,381.48679348008756,496.6666666666667,381.48679348008756" stroke="#1c83c5" stroke-width="5.678380265301373"><title>TRAJ34 → TRAV23DV6366 TWh</title></path></g><g style="mix-blend-mode: multiply;"><path d="M16,329.6604815030127C256.33333333333337,329.6604815030127,256.33333333333337,387.3746221977976,496.6666666666667,387.3746221977976" stroke="#1c83c5" stroke-width="6.097277170118687"><title>TRAJ45 → TRAV23DV6393 TWh</title></path></g><g style="mix-blend-mode: multiply;"><path d="M16,446.07876999114063C256.33333333333337,446.07876999114063,256.33333333333337,408.1488057367007,496.6666666666667,408.1488057367007" stroke="#1c83c5" stroke-width="5.662865565122954"><title>TRAJ54 → TRAV23DV6365 TWh</title></path></g><g style="mix-blend-mode: multiply;"><path d="M16,418.78064225738626C256.33333333333337,418.78064225738626,256.33333333333337,401.63263166176466,496.6666666666667,401.63263166176466" stroke="#1c83c5" stroke-width="7.36948258474905"><title>TRAJ22 → TRAV23DV6475 TWh</title></path></g><g style="mix-blend-mode: multiply;"><path d="M16,451.68733410563914C256.33333333333337,451.68733410563914,256.33333333333337,488.71043788315956,496.6666666666667,488.71043788315956" stroke="#1c83c5" stroke-width="5.55426266387402"><title>TRAJ54 → TRAV13-2358 TWh</title></path></g><g style="mix-blend-mode: multiply;"><path d="M16,346.47143488133867C256.33333333333337,346.47143488133867,256.33333333333337,394.18557557612354,496.6666666666667,394.18557557612354" stroke="#1c83c5" stroke-width="7.52462958653324"><title>TRAJ58 → TRAV23DV6485 TWh</title></path></g><g style="mix-blend-mode: multiply;"><path d="M16,578.1740112565718C256.33333333333337,578.1740112565718,256.33333333333337,576.5297494375919,496.6666666666667,576.5297494375919" stroke="#1c83c5" stroke-width="6.500659374757583"><title>TRAJ39 → TRAV8-4419 TWh</title></path></g><g style="mix-blend-mode: multiply;"><path d="M16,467.60619222370605C256.33333333333337,467.60619222370605,256.33333333333337,414.12196530539205,496.6666666666667,414.12196530539205" stroke="#1c83c5" stroke-width="6.283453572259716"><title>TRAJ53 → TRAV23DV6405 TWh</title></path></g><g style="mix-blend-mode: multiply;"><path d="M16,427.39130085640886C256.33333333333337,427.39130085640886,256.33333333333337,462.03989254144824,496.6666666666667,462.03989254144824" stroke="#1c83c5" stroke-width="9.851834613296097"><title>TRAJ22 → TRAV9-2635 TWh</title></path></g><g style="mix-blend-mode: multiply;"><path d="M16,492.4460029443638C256.33333333333337,492.4460029443638,256.33333333333337,421.09582303559137,496.6666666666667,421.09582303559137" stroke="#1c83c5" stroke-width="7.664261888139011"><title>TRAJ37 → TRAV23DV6494 TWh</title></path></g><g style="mix-blend-mode: multiply;"><path d="M16,500.62224993839067C256.33333333333337,500.62224993839067,256.33333333333337,527.8529924034711,496.6666666666667,527.8529924034711" stroke="#1c83c5" stroke-width="8.68823209991467"><title>TRAJ37 → TRAV2560 TWh</title></path></g><g style="mix-blend-mode: multiply;"><path d="M16,474.6808955050651C256.33333333333337,474.6808955050651,256.33333333333337,495.42054571032577,496.6666666666667,495.42054571032577" stroke="#1c83c5" stroke-width="7.865952990458459"><title>TRAJ53 → TRAV13-2507 TWh</title></path></g><g style="mix-blend-mode: multiply;"><path d="M16,561.5880210308329C256.33333333333337,561.5880210308329,256.33333333333337,535.5327689917887,496.6666666666667,535.5327689917887" stroke="#1c83c5" stroke-width="6.671321076720192"><title>TRAJ31 → TRAV2430 TWh</title></path></g><g style="mix-blend-mode: multiply;"><path d="M511.6666666666667,403.28494723076636C752,403.28494723076636,752,410.36188038166205,992.3333333333334,410.36188038166205" stroke="#1c83c5" stroke-width="15.018229772709642"><title>TRAV23DV6 → TRBV5-1968 TWh</title></path></g><g style="mix-blend-mode: multiply;"><path d="M511.6666666666667,470.9763598442176C752,470.9763598442176,752,529.821968815453,992.3333333333334,529.821968815453" stroke="#1c83c5" stroke-width="9.913893414009774"><title>TRAV9-2 → TRBV12-3639 TWh</title></path></g><g style="mix-blend-mode: multiply;"><path d="M511.6666666666667,461.5666941860065C752,461.5666941860065,752,487.8453960127225,992.3333333333334,487.8453960127225" stroke="#1c83c5" stroke-width="8.905437902412535"><title>TRAV9-2 → TRBV30574 TWh</title></path></g><g style="mix-blend-mode: multiply;"><path d="M511.6666666666667,266.3738267007991C752,266.3738267007991,752,398.32247304320884,992.3333333333334,398.32247304320884" stroke="#1c83c5" stroke-width="9.060584904196727"><title>TRAV16 → TRBV5-1584 TWh</title></path></g><g style="mix-blend-mode: multiply;"><path d="M511.6666666666667,435.15214139723906C752,435.15214139723906,752,505.77340780389454,992.3333333333334,505.77340780389454" stroke="#1c83c5" stroke-width="6.950585679931735"><title>TRAV23DV6 → TRBV2448 TWh</title></path></g><g style="mix-blend-mode: multiply;"><path d="M511.6666666666667,587.9330540687299C752,587.9330540687299,752,587.9330540687304,992.3333333333334,587.9330540687304" stroke="#1c83c5" stroke-width="14.133891862539755"><title>TRAV8-4 → TRBV7-2911 TWh</title></path></g><g style="mix-blend-mode: multiply;"><path d="M511.6666666666667,414.2848696572654C752,414.2848696572654,752,431.3618028081612,992.3333333333334,431.3618028081612" stroke="#1c83c5" stroke-width="6.981615080288573"><title>TRAV23DV6 → TRBV5-4450 TWh</title></path></g><g style="mix-blend-mode: multiply;"><path d="M511.6666666666667,532.6780641589595C752,532.6780641589595,752,577.3132417966025,992.3333333333334,577.3132417966025" stroke="#1c83c5" stroke-width="7.105732681715925"><title>TRAV2 → TRBV7-2458 TWh</title></path></g><g style="mix-blend-mode: multiply;"><path d="M511.6666666666667,552.2894209194901C752,552.2894209194901,752,544.2661546815611,992.3333333333334,544.2661546815611" stroke="#1c83c5" stroke-width="6.841982778682802"><title>TRAV26-1 → TRBV12-3441 TWh</title></path></g><g style="mix-blend-mode: multiply;"><path d="M511.6666666666667,577.0727639438367C752,577.0727639438367,752,551.480490264526,992.3333333333334,551.480490264526" stroke="#1c83c5" stroke-width="7.586688387246916"><title>TRAV8-4 → TRBV12-3489 TWh</title></path></g><g style="mix-blend-mode: multiply;"><path d="M511.6666666666667,488.96643043610345C752,488.96643043610345,752,537.8120394073388,992.3333333333334,537.8120394073388" stroke="#1c83c5" stroke-width="6.0662477697618495"><title>TRAV13-2 → TRBV12-3391 TWh</title></path></g><g style="mix-blend-mode: multiply;"><path d="M511.6666666666667,387.21171784592417C752,387.21171784592417,752,375.22806609262307,992.3333333333334,375.22806609262307" stroke="#1c83c5" stroke-width="17.128228996974634"><title>TRAV23DV6 → TRBV20-11,104 TWh</title></path></g><g style="mix-blend-mode: multiply;"><path d="M511.6666666666667,442.87070473600255C752,442.87070473600255,752,569.517104956947,992.3333333333334,569.517104956947" stroke="#1c83c5" stroke-width="8.48654099759522"><title>TRAV23DV6 → TRBV7-2547 TWh</title></path></g><g style="mix-blend-mode: multiply;"><path d="M511.6666666666667,526.3170370858077C752,526.3170370858077,752,512.0568613761543,992.3333333333334,512.0568613761543" stroke="#1c83c5" stroke-width="5.616321464587696"><title>TRAV2 → TRBV2362 TWh</title></path></g><g style="mix-blend-mode: multiply;"><path d="M511.6666666666667,420.97946278425326C752,420.97946278425326,752,448.056395935149,992.3333333333334,448.056395935149" stroke="#1c83c5" stroke-width="6.407571173687068"><title>TRAV23DV6 → TRBV3-1413 TWh</title></path></g><g style="mix-blend-mode: multiply;"><path d="M511.6666666666667,427.930048464185C752,427.930048464185,752,469.645876968428,992.3333333333334,469.645876968428" stroke="#1c83c5" stroke-width="7.493600186176402"><title>TRAV23DV6 → TRBV18483 TWh</title></path></g><g style="mix-blend-mode: multiply;"><path d="M1007.3333333333334,450.37584361182263C1247.6666666666667,450.37584361182263,1247.6666666666667,442.2199138262031,1488,442.2199138262031" stroke="#1c83c5" stroke-width="11.046466527034365"><title>TRBV3-1 → TRBJ1-6712 TWh</title></path></g><g style="mix-blend-mode: multiply;"><path d="M1007.3333333333334,431.2764719571799C1247.6666666666667,431.2764719571799,1247.6666666666667,433.29120387352293,1488,433.29120387352293" stroke="#1c83c5" stroke-width="6.810953378325964"><title>TRBV5-4 → TRBJ1-6439 TWh</title></path></g><g style="mix-blend-mode: multiply;"><path d="M511.6666666666667,111.26328446202781C752,111.26328446202781,752,211.69847180203266,992.3333333333334,211.69847180203266" stroke="#ffca39" stroke-width="6.733379877433868"><title>TRAV14DV4 → TRBV19434 TWh</title></path></g><g style="mix-blend-mode: multiply;"><path d="M511.6666666666667,90.75285082615784C752,90.75285082615784,752,82.71468466371886,992.3333333333334,82.71468466371886" stroke="#ffca39" stroke-width="5.678380265301373"><title>TRAV14DV4 → TRBV27366 TWh</title></path></g><g style="mix-blend-mode: multiply;"><path d="M511.6666666666667,8.312388488092468C752,8.312388488092468,752,57.898921728337584,992.3333333333334,57.898921728337584" stroke="#ffca39" stroke-width="6.624776976184935"><title>TRAV29DV5 → TRBV27427 TWh</title></path></g><g style="mix-blend-mode: multiply;"><path d="M511.6666666666667,74.72538980684202C752,74.72538980684202,752,176.21557675897927,992.3333333333334,176.21557675897927" stroke="#ffca39" stroke-width="6.3765417733302305"><title>TRAV12-2 → TRBV9411 TWh</title></path></g><g style="mix-blend-mode: multiply;"><path d="M511.6666666666667,24.7277170118688C752,24.7277170118688,752,64.31425025211387,992.3333333333334,64.31425025211387" stroke="#ffca39" stroke-width="6.205880071367621"><title>TRAV17 → TRBV27400 TWh</title></path></g><g style="mix-blend-mode: multiply;"><path d="M511.6666666666667,141.37033589325893C752,141.37033589325893,752,189.51943216197358,992.3333333333334,189.51943216197358" stroke="#ffca39" stroke-width="6.205880071367621"><title>TRAV19 → TRBV9400 TWh</title></path></g><g style="mix-blend-mode: multiply;"><path d="M511.6666666666667,41.321464587696966C752,41.321464587696966,752,70.90799782794195,992.3333333333334,70.90799782794195" stroke="#ffca39" stroke-width="6.981615080288573"><title>TRAV21 → TRBV27450 TWh</title></path></g><g style="mix-blend-mode: multiply;"><path d="M511.6666666666667,63.306570475525604C752,63.306570475525604,752,77.1371499495772,992.3333333333334,77.1371499495772" stroke="#ffca39" stroke-width="5.476689162981925"><title>TRAV12-2 → TRBV27353 TWh</title></path></g><g style="mix-blend-mode: multiply;"><path d="M511.6666666666667,104.39027228298818C752,104.39027228298818,752,182.91016988596706,992.3333333333334,182.91016988596706" stroke="#ffca39" stroke-width="7.012644480645411"><title>TRAV14DV4 → TRBV9452 TWh</title></path></g><g style="mix-blend-mode: multiply;"><path d="M511.6666666666667,163.51834613296106C752,163.51834613296106,752,195.4770770304865,992.3333333333334,195.4770770304865" stroke="#ffca39" stroke-width="5.709409665658211"><title>TRAV1-2 → TRBV9368 TWh</title></path></g><g style="mix-blend-mode: multiply;"><path d="M511.6666666666667,68.79101698859674C752,68.79101698859674,752,145.54223877123576,992.3333333333334,145.54223877123576" stroke="#ffca39" stroke-width="5.492203863160344"><title>TRAV12-2 → TRBV7-9354 TWh</title></path></g><g style="mix-blend-mode: multiply;"><path d="M511.6666666666667,47.69024901093798C752,47.69024901093798,752,139.91815995655884,992.3333333333334,139.91815995655884" stroke="#ffca39" stroke-width="5.755953766193468"><title>TRAV21 → TRBV7-9371 TWh</title></path></g><g style="mix-blend-mode: multiply;"><path d="M511.6666666666667,134.54386781475452C752,134.54386781475452,752,159.30377782949344,992.3333333333334,159.30377782949344" stroke="#ffca39" stroke-width="7.447056085641145"><title>TRAV19 → TRBV7-9480 TWh</title></path></g><g style="mix-blend-mode: multiply;"><path d="M511.6666666666667,127.72515708633938C752,127.72515708633938,752,88.64905748196415,992.3333333333334,88.64905748196415" stroke="#ffca39" stroke-width="6.190365371189202"><title>TRAV19 → TRBV27399 TWh</title></path></g><g style="mix-blend-mode: multiply;"><path d="M511.6666666666667,97.237995500737C752,97.237995500737,752,151.93429524474442,992.3333333333334,151.93429524474442" stroke="#ffca39" stroke-width="7.291909083856954"><title>TRAV14DV4 → TRBV7-9470 TWh</title></path></g><g style="mix-blend-mode: multiply;"><path d="M511.6666666666667,147.56845861453735C752,147.56845861453735,752,218.16034442634418,992.3333333333334,218.16034442634418" stroke="#ffca39" stroke-width="6.190365371189202"><title>TRAV19 → TRBV19399 TWh</title></path></g><g style="mix-blend-mode: multiply;"><path d="M1007.3333333333334,67.65766814056317C1247.6666666666667,67.65766814056317,1247.6666666666667,39.434877046001084,1488,39.434877046001084" stroke="#ffca39" stroke-width="26.1422698006361"><title>TRBV27 → TRBJ2-71,685 TWh</title></path></g><g style="mix-blend-mode: multiply;"><path d="M1007.3333333333334,148.38142890388644C1247.6666666666667,148.38142890388644,1247.6666666666667,160.73926822921345,1488,160.73926822921345" stroke="#ffca39" stroke-width="22.682491660848655"><title>TRBV7-9 → TRBJ2-11,462 TWh</title></path></g><g style="mix-blend-mode: multiply;"><path d="M1007.3333333333334,28.916686060041876C1247.6666666666667,28.916686060041876,1247.6666666666667,18.91668606004189,1488,18.91668606004189" stroke="#ffca39" stroke-width="14.89411217128229"><title>TRBV4-1 → TRBJ2-7960 TWh</title></path></g><g style="mix-blend-mode: multiply;"><path d="M1007.3333333333334,86.86486696144595C1247.6666666666667,86.86486696144595,1247.6666666666667,100.40066713210769,1488,100.40066713210769" stroke="#ffca39" stroke-width="12.27212784112947"><title>TRBV27 → TRBJ1-1791 TWh</title></path></g><g style="mix-blend-mode: multiply;"><path d="M1007.3333333333334,120.96617795361104C1247.6666666666667,120.96617795361104,1247.6666666666667,201.7143671354271,1488,201.7143671354271" stroke="#ffca39" stroke-width="12.148010239702117"><title>TRBV27 → TRBJ2-3783 TWh</title></path></g><g style="mix-blend-mode: multiply;"><path d="M1007.3333333333334,8.234814987200373C1247.6666666666667,8.234814987200373,1247.6666666666667,8.234814987200373,1488,8.234814987200373" stroke="#ffca39" stroke-width="6.469629974400744"><title>TRBV13 → TRBJ2-7417 TWh</title></path></g><g style="mix-blend-mode: multiply;"><path d="M1007.3333333333334,267.69257621596483C1247.6666666666667,267.69257621596483,1247.6666666666667,72.38034287487393,1488,72.38034287487393" stroke="#ffca39" stroke-width="7.322938484213792"><title>TRBV7-6 → TRBJ2-7472 TWh</title></path></g><g style="mix-blend-mode: multiply;"><path d="M1007.3333333333334,103.94655185788534C1247.6666666666667,103.94655185788534,1247.6666666666667,138.45240142291448,1488,138.45240142291448" stroke="#ffca39" stroke-width="21.891241951749283"><title>TRBV27 → TRBJ2-11,411 TWh</title></path></g><g style="mix-blend-mode: multiply;"><path d="M1007.3333333333334,181.1337367155381C1247.6666666666667,181.1337367155381,1247.6666666666667,60.61244278954309,1488,60.61244278954309" stroke="#ffca39" stroke-width="16.21286168644791"><title>TRBV9 → TRBJ2-71,045 TWh</title></path></g><g style="mix-blend-mode: multiply;"><path d="M1007.3333333333334,40.47513769296407C1247.6666666666667,40.47513769296407,1247.6666666666667,90.1532076642619,1488,90.1532076642619" stroke="#ffca39" stroke-width="8.222791094562098"><title>TRBV4-1 → TRBJ1-1530 TWh</title></path></g><g style="mix-blend-mode: multiply;"><path d="M1007.3333333333334,274.60437514545055C1247.6666666666667,274.60437514545055,1247.6666666666667,182.39003232819724,1488,182.39003232819724" stroke="#ffca39" stroke-width="6.500659374757583"><title>TRBV7-6 → TRBJ2-1419 TWh</title></path></g><g style="mix-blend-mode: multiply;"><path d="M16,261.76660205223305C256.33333333333337,261.76660205223305,256.33333333333337,199.83050190055084,496.6666666666667,199.83050190055084" stroke="#2a9d8f" stroke-width="78.33372120083779"><title>TRAJ33 → TRAV1-25,049 TWh</title></path></g><g style="mix-blend-mode: multiply;"><path d="M16,363.15051330814805C256.33333333333337,363.15051330814805,256.33333333333337,241.91412613451254,496.6666666666667,241.91412613451254" stroke="#2a9d8f" stroke-width="5.833527267085564"><title>TRAJ20 → TRAV1-2376 TWh</title></path></g><g style="mix-blend-mode: multiply;"><path d="M16,379.57359918201354C256.33333333333337,379.57359918201354,256.33333333333337,248.33721200837803,496.6666666666667,248.33721200837803" stroke="#2a9d8f" stroke-width="7.012644480645411"><title>TRAJ12 → TRAV1-2452 TWh</title></path></g><g style="mix-blend-mode: multiply;"><path d="M511.6666666666667,177.76084089674973C752,177.76084089674973,752,242.6433170428984,992.3333333333334,242.6433170428984" stroke="#2a9d8f" stroke-width="22.775579861919166"><title>TRAV1-2 → TRBV6-41,468 TWh</title></path></g><g style="mix-blend-mode: multiply;"><path d="M511.6666666666667,193.59359242882638C752,193.59359242882638,752,292.2996664339464,992.3333333333334,292.2996664339464" stroke="#2a9d8f" stroke-width="8.889923202234117"><title>TRAV1-2 → TRBV6-2573 TWh</title></path></g><g style="mix-blend-mode: multiply;"><path d="M511.6666666666667,205.15204406174857C752,205.15204406174857,752,313.85811806686866,992.3333333333334,313.85811806686866" stroke="#2a9d8f" stroke-width="14.22698006361027"><title>TRAV1-2 → TRBV6-1917 TWh</title></path></g><g style="mix-blend-mode: multiply;"><path d="M511.6666666666667,229.62648359320463C752,229.62648359320463,752,358.33255759832474,992.3333333333334,358.33255759832474" stroke="#2a9d8f" stroke-width="16.66278799162206"><title>TRAV1-2 → TRBV20-11,074 TWh</title></path></g><g style="mix-blend-mode: multiply;"><path d="M511.6666666666667,216.78031184547365C752,216.78031184547365,752,335.48638585059376,992.3333333333334,335.48638585059376" stroke="#2a9d8f" stroke-width="9.029555503839887"><title>TRAV1-2 → TRBV4-2582 TWh</title></path></g><g style="mix-blend-mode: multiply;"><path d="M1007.3333333333334,243.1165153983402C1247.6666666666667,243.1165153983402,1247.6666666666667,212.59017196049885,1488,212.59017196049885" stroke="#2a9d8f" stroke-width="9.603599410441392"><title>TRBV6-4 → TRBJ2-3619 TWh</title></path></g><g style="mix-blend-mode: multiply;"><path d="M1007.3333333333334,234.78512140252914C1247.6666666666667,234.78512140252914,1247.6666666666667,175.6101083502281,1488,175.6101083502281" stroke="#2a9d8f" stroke-width="7.059188581180669"><title>TRBV6-4 → TRBJ2-1455 TWh</title></path></g></g><g font-family="sans-serif" font-size="10"><text x="22" y="313.7726527853027" dy="0.35em" text-anchor="start">TRAJ34</text><text x="22" y="329.6604815030127" dy="0.35em" text-anchor="start">TRAJ45</text><text x="22" y="448.85590132307766" dy="0.35em" text-anchor="start">TRAJ54</text><text x="22" y="423.70655956403436" dy="0.35em" text-anchor="start">TRAJ22</text><text x="22" y="346.47143488133867" dy="0.35em" text-anchor="start">TRAJ58</text><text x="22" y="578.1740112565718" dy="0.35em" text-anchor="start">TRAJ39</text><text x="22" y="471.53916871893523" dy="0.35em" text-anchor="start">TRAJ53</text><text x="22" y="496.7901189943211" dy="0.35em" text-anchor="start">TRAJ37</text><text x="22" y="561.5880210308329" dy="0.35em" text-anchor="start">TRAJ31</text><text x="517.6666666666667" y="412.8807892911185" dy="0.35em" text-anchor="start">TRAV23DV6</text><text x="517.6666666666667" y="466.52364089301136" dy="0.35em" text-anchor="start">TRAV9-2</text><text x="517.6666666666667" y="266.3738267007991" dy="0.35em" text-anchor="start">TRAV16</text><text x="517.6666666666667" y="584.1397098751065" dy="0.35em" text-anchor="start">TRAV8-4</text><text x="517.6666666666667" y="531.1886529418313" dy="0.35em" text-anchor="start">TRAV2</text><text x="517.6666666666667" y="552.2894209194901" dy="0.35em" text-anchor="start">TRAV26-1</text><text x="517.6666666666667" y="492.64341437838874" dy="0.35em" text-anchor="start">TRAV13-2</text><text x="986.3333333333334" y="450.37584361182263" dy="0.35em" text-anchor="end">TRBV3-1</text><text x="986.3333333333334" y="431.3618028081612" dy="0.35em" text-anchor="end">TRBV5-4</text><text x="517.6666666666667" y="101.27181754712596" dy="0.35em" text-anchor="start">TRAV14DV4</text><text x="517.6666666666667" y="8.312388488092495" dy="0.35em" text-anchor="start">TRAV29DV5</text><text x="517.6666666666667" y="69.2409432937709" dy="0.35em" text-anchor="start">TRAV12-2</text><text x="517.6666666666667" y="24.727717011868833" dy="0.35em" text-anchor="start">TRAV17</text><text x="517.6666666666667" y="137.64680785043836" dy="0.35em" text-anchor="start">TRAV19</text><text x="517.6666666666667" y="44.19944147079366" dy="0.35em" text-anchor="start">TRAV21</text><text x="517.6666666666667" y="206.25358777441633" dy="0.35em" text-anchor="start">TRAV1-2</text><text x="986.3333333333334" y="90.81335815685361" dy="0.35em" text-anchor="end">TRBV27</text><text x="986.3333333333334" y="150.03374447288815" dy="0.35em" text-anchor="end">TRBV7-9</text><text x="986.3333333333334" y="33.028081607322925" dy="0.35em" text-anchor="end">TRBV4-1</text><text x="986.3333333333334" y="8.234814987200366" dy="0.35em" text-anchor="end">TRBV13</text><text x="986.3333333333334" y="270.94290590334367" dy="0.35em" text-anchor="end">TRBV7-6</text><text x="986.3333333333334" y="185.6795438678149" dy="0.35em" text-anchor="end">TRBV9</text><text x="22" y="261.7666020522331" dy="0.35em" text-anchor="start">TRAJ33</text><text x="22" y="363.15051330814805" dy="0.35em" text-anchor="start">TRAJ20</text><text x="22" y="379.5735991820135" dy="0.35em" text-anchor="start">TRAJ12</text><text x="986.3333333333334" y="242.6433170428984" dy="0.35em" text-anchor="end">TRBV6-4</text><text x="986.3333333333334" y="405.83158792956374" dy="0.35em" text-anchor="end">TRBV5-1</text><text x="986.3333333333334" y="540.0694282832987" dy="0.35em" text-anchor="end">TRBV12-3</text><text x="986.3333333333334" y="487.84539601272246" dy="0.35em" text-anchor="end">TRBV30</text><text x="986.3333333333334" y="508.5815685361884" dy="0.35em" text-anchor="end">TRBV2</text><text x="986.3333333333334" y="580.1369172290748" dy="0.35em" text-anchor="end">TRBV7-2</text><text x="986.3333333333334" y="366.8966720968121" dy="0.35em" text-anchor="end">TRBV20-1</text><text x="986.3333333333334" y="469.645876968428" dy="0.35em" text-anchor="end">TRBV18</text><text x="1482" y="438.8144371370401" dy="0.35em" text-anchor="end">TRBJ1-6</text><text x="986.3333333333334" y="214.79365448762726" dy="0.35em" text-anchor="end">TRBV19</text><text x="1482" y="40.520906058490425" dy="0.35em" text-anchor="end">TRBJ2-7</text><text x="1482" y="156.57357123130794" dy="0.35em" text-anchor="end">TRBJ2-1</text><text x="1482" y="96.28927158482662" dy="0.35em" text-anchor="end">TRBJ1-1</text><text x="1482" y="206.51616684064783" dy="0.35em" text-anchor="end">TRBJ2-3</text><text x="986.3333333333334" y="292.2996664339464" dy="0.35em" text-anchor="end">TRBV6-2</text><text x="986.3333333333334" y="313.85811806686866" dy="0.35em" text-anchor="end">TRBV6-1</text><text x="986.3333333333334" y="335.48638585059376" dy="0.35em" text-anchor="end">TRBV4-2</text></g></svg></div>
</div></div>
</div>
</div>
<div class="section" id="figure-2b">
<h3>[Figure 2B]<a class="headerlink" href="#figure-2b" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">createFig</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;left&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>     
<span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;bottom&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>

<span class="n">_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;./sankey/files/cell_type_specific_vj_pairing.csv&quot;</span><span class="p">)</span>

<span class="n">gex_adata</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;VJ_usage_group&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="s1">&#39;NA&#39;</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">_df</span><span class="p">[</span><span class="n">_df</span><span class="p">[</span><span class="s1">&#39;preference&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;CD4&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,[</span><span class="s1">&#39;source&#39;</span><span class="p">,</span><span class="s1">&#39;target&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;TRAV&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;TRBV&quot;</span><span class="p">):</span>
        <span class="n">gex_adata</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">gex_adata</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;IR_VJ_1_v_call&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span>
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">gex_adata</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;IR_VDJ_1_v_call&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
            <span class="s1">&#39;VJ_usage_group&#39;</span>
        <span class="p">]</span> <span class="o">=</span> <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

<span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
<span class="n">obsm</span> <span class="o">=</span> <span class="n">gex_adata</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">==</span> <span class="s1">&#39;NA&#39;</span><span class="p">,</span> <span class="n">gex_adata</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;VJ_usage_group&#39;</span><span class="p">]))]</span><span class="o">.</span><span class="n">obsm</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">obsm</span><span class="p">[</span><span class="s2">&quot;X_umap&quot;</span><span class="p">][:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">obsm</span><span class="p">[</span><span class="s2">&quot;X_umap&quot;</span><span class="p">][:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">s</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;#F1F1F1&quot;</span><span class="p">)</span>
<span class="n">obsm</span> <span class="o">=</span> <span class="n">gex_adata</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">!=</span> <span class="s1">&#39;NA&#39;</span><span class="p">,</span> <span class="n">gex_adata</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;VJ_usage_group&#39;</span><span class="p">]))]</span><span class="o">.</span><span class="n">obsm</span><span class="p">[</span><span class="s1">&#39;X_umap&#39;</span><span class="p">]</span>
<span class="n">sns</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span> <span class="n">obsm</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span>
    <span class="n">y</span><span class="o">=</span> <span class="n">obsm</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span>
    <span class="n">cmap</span><span class="o">=</span><span class="n">make_colormap</span><span class="p">([</span><span class="s1">&#39;#F1F1F1&#39;</span><span class="p">,</span><span class="n">CELL_TYPE_C</span><span class="p">[</span><span class="s2">&quot;CD4&quot;</span><span class="p">]]),</span> <span class="n">shade</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">bw_adjust</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">ax</span>
<span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[]
</pre></div>
</div>
<img alt="_images/huARdb_TCR_paper_notebook_59_1.png" src="_images/huARdb_TCR_paper_notebook_59_1.png" />
</div>
</div>
</div>
<div class="section" id="figure-2c">
<h3>[Figure 2C]<a class="headerlink" href="#figure-2c" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">raw_gex_adata</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;VJPairing&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span>
<span class="n">vj_map</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">TRAB_DEFINITION</span><span class="p">,</span> <span class="n">TRAB_DEFINITION_ORIG</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span> <span class="ow">in</span> <span class="n">_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,[</span><span class="s1">&#39;source&#39;</span><span class="p">,</span><span class="s1">&#39;target&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;TRAV&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">j</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;TRBV&quot;</span><span class="p">):</span>
        <span class="n">raw_gex_adata</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">raw_gex_adata</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="n">vj_map</span><span class="p">[</span><span class="n">i</span><span class="p">[:</span><span class="mi">4</span><span class="p">]]]</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span> <span class="o">&amp;</span> 
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">raw_gex_adata</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="n">vj_map</span><span class="p">[</span><span class="n">j</span><span class="p">[:</span><span class="mi">4</span><span class="p">]]]</span> <span class="o">==</span> <span class="n">j</span><span class="p">),</span><span class="s1">&#39;VJPairing&#39;</span>
        <span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">-</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s1">&#39;</span>

<span class="n">sc</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">dotplot</span><span class="p">(</span>
    <span class="n">raw_gex_adata</span><span class="p">,</span> 
    <span class="p">[</span><span class="s1">&#39;CD4&#39;</span><span class="p">,</span><span class="s1">&#39;CD8A&#39;</span><span class="p">,</span><span class="s1">&#39;CD8B&#39;</span><span class="p">,</span><span class="s1">&#39;ZBTB16&#39;</span><span class="p">,</span><span class="s1">&#39;KLRB1&#39;</span><span class="p">,</span><span class="s1">&#39;SLC4A10&#39;</span><span class="p">],</span> 
    <span class="n">groupby</span><span class="o">=</span><span class="s1">&#39;VJPairing&#39;</span><span class="p">,</span> 
    <span class="n">standard_scale</span><span class="o">=</span><span class="s1">&#39;var&#39;</span><span class="p">,</span>
    <span class="n">swap_axes</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">save</span><span class="o">=</span><span class="s1">&#39;vj_pairing_cell_type_specific&#39;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>WARNING: saving figure to file figures/dotplot_vj_pairing_cell_type_specific.pdf
</pre></div>
</div>
<img alt="_images/huARdb_TCR_paper_notebook_61_1.png" src="_images/huARdb_TCR_paper_notebook_61_1.png" />
</div>
</div>
</div>
</div>
</div>
<div class="tex2jax_ignore mathjax_ignore section" id="cdr-region-and-t-cell-type">
<h1>CDR region and T cell type<a class="headerlink" href="#cdr-region-and-t-cell-type" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">CDR3mr</span> <span class="o">=</span> <span class="n">tcr_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span>
    <span class="p">[</span><span class="s1">&#39;CDR3a&#39;</span><span class="p">,</span><span class="s1">&#39;CDR3a_mr&#39;</span><span class="p">,</span><span class="s1">&#39;CDR3b_mr&#39;</span><span class="p">,</span><span class="s1">&#39;cell_type_3&#39;</span><span class="p">,</span><span class="s1">&#39;individual&#39;</span><span class="p">,</span><span class="s1">&#39;CDR3a_length&#39;</span><span class="p">,</span><span class="s1">&#39;CDR3b_length&#39;</span><span class="p">,</span><span class="s1">&#39;CDR1a&#39;</span><span class="p">,</span><span class="s1">&#39;CDR1b&#39;</span><span class="p">,</span><span class="s1">&#39;CDR2a&#39;</span><span class="p">,</span><span class="s1">&#39;CDR2b&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">TRAB_DEFINITION</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;TRAV&quot;</span><span class="p">,</span><span class="s1">&#39;TRAJ&#39;</span><span class="p">,</span><span class="s1">&#39;TRBV&#39;</span><span class="p">,</span><span class="s1">&#39;TRBJ&#39;</span><span class="p">]:</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">CDR3mr</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span><span class="o">.</span><span class="n">flatten</span><span class="p">()):</span>
        <span class="n">CDR3mr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">x</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">CDR3mr</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">))</span>
    <span class="n">CDR3mr</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">properties</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">AMINO_ACID_PROPERTIES</span><span class="o">.</span><span class="n">values</span><span class="p">())))</span>
<span class="n">mat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">CDR3mr</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">properties</span><span class="p">)))</span>
<span class="k">for</span> <span class="n">idx</span><span class="p">,</span><span class="n">i</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">CDR3mr</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">CDR3mr</span><span class="p">[</span><span class="s1">&#39;CDR3a_mr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()):</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">str</span> <span class="p">:</span>
        <span class="k">continue</span>
    <span class="n">i</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">AMINO_ACID_PROPERTIES</span><span class="o">.</span><span class="n">get</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">i</span><span class="p">)))</span>
    <span class="n">l</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="n">counter</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span><span class="n">v</span> <span class="o">/</span> <span class="n">l</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">Counter</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">counter</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">mat</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span><span class="n">properties</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">k</span><span class="p">)]</span> <span class="o">=</span> <span class="n">v</span> <span class="o">*</span> <span class="mi">100</span>
<span class="n">CDR3mr</span> <span class="o">=</span> <span class="n">CDR3mr</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
    <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">mat</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">CDR3mr</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="s1">&#39;CDR3a_mr_&#39;</span> <span class="o">+</span> <span class="n">x</span><span class="p">,</span> <span class="n">properties</span><span class="p">)))</span>
<span class="p">)</span>
<span class="n">mat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">CDR3mr</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">properties</span><span class="p">)))</span>
<span class="k">for</span> <span class="n">idx</span><span class="p">,</span><span class="n">i</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">CDR3mr</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">CDR3mr</span><span class="p">[</span><span class="s1">&#39;CDR3b_mr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()):</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">str</span> <span class="p">:</span>
        <span class="k">continue</span>
    <span class="n">l</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="n">i</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">AMINO_ACID_PROPERTIES</span><span class="o">.</span><span class="n">get</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">i</span><span class="p">)))</span>
    <span class="n">counter</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span><span class="n">v</span> <span class="o">/</span> <span class="n">l</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">Counter</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">counter</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">mat</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span><span class="n">properties</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">k</span><span class="p">)]</span> <span class="o">=</span> <span class="n">v</span> <span class="o">*</span> <span class="mi">100</span>
<span class="n">CDR3mr</span> <span class="o">=</span> <span class="n">CDR3mr</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
    <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">mat</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">CDR3mr</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="s1">&#39;CDR3b_mr_&#39;</span> <span class="o">+</span> <span class="n">x</span><span class="p">,</span> <span class="n">properties</span><span class="p">)))</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">CDR3mr</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">AMINO_ACIDS</span><span class="p">)))</span>
<span class="k">for</span> <span class="n">idx</span><span class="p">,</span><span class="n">i</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">CDR3mr</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">CDR3mr</span><span class="p">[</span><span class="s1">&#39;CDR3a_mr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()):</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">str</span> <span class="p">:</span>
        <span class="k">continue</span>
    <span class="n">l</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="n">counter</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span><span class="n">v</span> <span class="o">/</span> <span class="n">l</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">Counter</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">counter</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">mat</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span><span class="n">AMINO_ACIDS</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">k</span><span class="p">)]</span> <span class="o">=</span> <span class="n">v</span> <span class="o">*</span> <span class="mi">100</span>
<span class="n">CDR3mr</span> <span class="o">=</span> <span class="n">CDR3mr</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
    <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">mat</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">CDR3mr</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="s1">&#39;CDR3a_mr_&#39;</span> <span class="o">+</span> <span class="n">x</span><span class="p">,</span> <span class="n">AMINO_ACIDS</span><span class="p">)))</span>
<span class="p">)</span>
<span class="n">mat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">CDR3mr</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">AMINO_ACIDS</span><span class="p">)))</span>
<span class="k">for</span> <span class="n">idx</span><span class="p">,</span><span class="n">i</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">CDR3mr</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">CDR3mr</span><span class="p">[</span><span class="s1">&#39;CDR3b_mr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()):</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">str</span> <span class="p">:</span>
        <span class="k">continue</span>
    <span class="n">l</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="n">counter</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span><span class="n">v</span> <span class="o">/</span> <span class="n">l</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">Counter</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">counter</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">mat</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span><span class="n">AMINO_ACIDS</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">k</span><span class="p">)]</span> <span class="o">=</span> <span class="n">v</span> <span class="o">*</span> <span class="mi">100</span>
<span class="n">CDR3mr</span> <span class="o">=</span> <span class="n">CDR3mr</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
    <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">mat</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">CDR3mr</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="s1">&#39;CDR3b_mr_&#39;</span> <span class="o">+</span> <span class="n">x</span><span class="p">,</span> <span class="n">AMINO_ACIDS</span><span class="p">)))</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">properties</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">AMINO_ACID_PROPERTIES</span><span class="o">.</span><span class="n">values</span><span class="p">())))</span>
<span class="n">mat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">CDR3mr</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">properties</span><span class="p">)))</span>
<span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;CDR1a&#39;</span><span class="p">,</span><span class="s1">&#39;CDR1b&#39;</span><span class="p">,</span><span class="s1">&#39;CDR2a&#39;</span><span class="p">,</span><span class="s1">&#39;CDR2b&#39;</span><span class="p">]:</span>
    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span><span class="n">i</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">CDR3mr</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">CDR3mr</span><span class="p">[</span><span class="n">kk</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()):</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">str</span> <span class="p">:</span>
            <span class="k">continue</span>
        <span class="n">i</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">AMINO_ACID_PROPERTIES</span><span class="o">.</span><span class="n">get</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">i</span><span class="p">)))</span>
        <span class="n">l</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="n">counter</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span><span class="n">v</span> <span class="o">/</span> <span class="n">l</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">Counter</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">counter</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">mat</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span><span class="n">properties</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">k</span><span class="p">)]</span> <span class="o">=</span> <span class="n">v</span> <span class="o">*</span> <span class="mi">100</span>
    <span class="n">CDR3mr</span> <span class="o">=</span> <span class="n">CDR3mr</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
        <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">mat</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">CDR3mr</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">kk</span><span class="si">}</span><span class="s1">_&#39;</span> <span class="o">+</span> <span class="n">x</span><span class="p">,</span> <span class="n">properties</span><span class="p">)))</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">CDR3mr</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">AMINO_ACIDS</span><span class="p">)))</span>
<span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;CDR1a&#39;</span><span class="p">,</span><span class="s1">&#39;CDR1b&#39;</span><span class="p">,</span><span class="s1">&#39;CDR2a&#39;</span><span class="p">,</span><span class="s1">&#39;CDR2b&#39;</span><span class="p">]:</span>
    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span><span class="n">i</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">CDR3mr</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">CDR3mr</span><span class="p">[</span><span class="n">kk</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()):</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">str</span> <span class="p">:</span>
            <span class="k">continue</span>
        <span class="n">l</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="n">counter</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span><span class="n">v</span> <span class="o">/</span> <span class="n">l</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">Counter</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">counter</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">mat</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span><span class="n">AMINO_ACIDS</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">k</span><span class="p">)]</span> <span class="o">=</span> <span class="n">v</span> <span class="o">*</span> <span class="mi">100</span>
    <span class="n">CDR3mr</span> <span class="o">=</span> <span class="n">CDR3mr</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
        <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">mat</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">CDR3mr</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">kk</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">x</span><span class="p">,</span> <span class="n">AMINO_ACIDS</span><span class="p">)))</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">CDR3mr</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;./data/cdr3mr_analysis.csv&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">CDR3mr</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;./data/cdr3mr_analysis.csv&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">ttest_ind</span><span class="p">,</span> <span class="n">ttest_rel</span>
<span class="n">_agg</span> <span class="o">=</span> <span class="n">tcr_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;individual&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s2">&quot;cell_type_3&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="n">Counter</span><span class="p">(</span><span class="n">x</span><span class="p">))})</span>
<span class="n">celltype_by_individual</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">_agg</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">FLATTEN</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">_agg</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()))))</span>
<span class="n">_celltype_by_individual</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:{}</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">celltype_by_individual</span><span class="o">.</span><span class="n">keys</span><span class="p">()}</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span> <span class="ow">in</span> <span class="n">celltype_by_individual</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">j</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="s1">&#39;Treg&#39;</span><span class="p">:</span>
            <span class="n">_celltype_by_individual</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;1_Treg&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
        <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="s1">&#39;CD4&#39;</span><span class="p">:</span>
            <span class="n">_celltype_by_individual</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;2_CD4&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
        <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="s1">&#39;CD8&#39;</span><span class="p">:</span>
            <span class="n">_celltype_by_individual</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;3_CD8&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_celltype_by_individual</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="figure-2d">
<h2>[Figure 2D]<a class="headerlink" href="#figure-2d" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

<span class="n">cdr3_amino_acid_properties</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">properties</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">AMINO_ACID_PROPERTIES</span><span class="o">.</span><span class="n">values</span><span class="p">())))</span>
<span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;CDR1a&#39;</span><span class="p">,</span><span class="s1">&#39;CDR1b&#39;</span><span class="p">,</span><span class="s1">&#39;CDR2a&#39;</span><span class="p">,</span><span class="s1">&#39;CDR2b&#39;</span><span class="p">,</span><span class="s1">&#39;CDR3a_mr&#39;</span><span class="p">,</span><span class="s1">&#39;CDR3b_mr&#39;</span><span class="p">]:</span>
    <span class="n">fig</span><span class="p">,</span><span class="n">axes</span><span class="o">=</span><span class="n">createSubplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">ax</span><span class="p">,</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">c</span><span class="si">}</span><span class="s1">_&#39;</span> <span class="o">+</span> <span class="n">x</span><span class="p">,</span> <span class="n">properties</span><span class="p">))):</span>
        <span class="n">agg</span> <span class="o">=</span> <span class="n">CDR3mr</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;cell_type_3&quot;</span><span class="p">,</span><span class="s2">&quot;individual&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="n">k</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">})</span>
        <span class="n">agg</span> <span class="o">=</span> <span class="n">pandas_aggregation_to_wide</span><span class="p">(</span><span class="n">agg</span><span class="p">)</span>
        <span class="n">agg</span><span class="p">[</span><span class="s1">&#39;cell_type_3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">agg</span><span class="p">[</span><span class="s1">&#39;cell_type_3&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;Treg&quot;</span><span class="p">,</span><span class="s1">&#39;1_Treg&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;CD4&quot;</span><span class="p">,</span><span class="s1">&#39;2_CD4&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;CD8&quot;</span><span class="p">,</span><span class="s2">&quot;3_CD8&quot;</span><span class="p">)</span>
        <span class="n">agg</span> <span class="o">=</span> <span class="n">agg</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;cell_type_3&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        
        <span class="n">agg</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">_celltype_by_individual</span><span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="nb">zip</span><span class="p">(</span><span class="n">agg</span><span class="p">[</span><span class="s1">&#39;individual&#39;</span><span class="p">],</span><span class="n">agg</span><span class="p">[</span><span class="s1">&#39;cell_type_3&#39;</span><span class="p">])))</span>
        <span class="n">agg</span> <span class="o">=</span> <span class="n">agg</span><span class="p">[</span><span class="n">agg</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">]</span>
        <span class="n">agg</span> <span class="o">=</span> <span class="n">agg</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;1_Treg&#39;</span><span class="p">,</span><span class="s1">&#39;2_CD4&#39;</span><span class="p">,</span><span class="s1">&#39;3_CD8&#39;</span><span class="p">],</span> <span class="n">agg</span><span class="p">[</span><span class="s1">&#39;cell_type_3&#39;</span><span class="p">]))]</span>

        <span class="n">sns</span><span class="o">.</span><span class="n">violinplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">agg</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;cell_type_3&#39;</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">k</span><span class="p">,</span> <span class="n">showfliers</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">palette</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;1_Treg&#39;</span><span class="p">:</span><span class="s1">&#39;#6B4E94&#39;</span><span class="p">,</span><span class="s1">&#39;2_CD4&#39;</span><span class="p">:</span><span class="s1">&#39;#1E83C5&#39;</span><span class="p">,</span><span class="s1">&#39;3_CD8&#39;</span><span class="p">:</span><span class="s1">&#39;#FFCB39&#39;</span><span class="p">})</span>
        <span class="n">sns</span><span class="o">.</span><span class="n">stripplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">agg</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;cell_type_3&#39;</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">k</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">jitter</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">agg</span><span class="p">[</span><span class="n">agg</span><span class="p">[</span><span class="s1">&#39;cell_type_3&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;3_CD8&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;individual&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="n">k</span><span class="p">:</span><span class="nb">list</span><span class="p">})</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">agg</span><span class="p">[</span><span class="n">agg</span><span class="p">[</span><span class="s1">&#39;cell_type_3&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;1_Treg&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;individual&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="n">k</span><span class="p">:</span><span class="nb">list</span><span class="p">})</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>  
        <span class="n">treg</span><span class="p">,</span><span class="n">cd4</span><span class="p">,</span><span class="n">cd8</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">agg</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;cell_type_3&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="n">k</span><span class="p">:</span><span class="nb">list</span><span class="p">})</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()))</span>
        <span class="n">agg_celltype</span> <span class="o">=</span> <span class="n">agg</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;cell_type_3&quot;</span><span class="p">,</span><span class="s2">&quot;individual&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="n">k</span><span class="p">:</span><span class="nb">list</span><span class="p">})</span>
        <span class="n">common_indices</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">agg_celltype</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;1_Treg&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">agg_celltype</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;2_CD4&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">)))</span>
        <span class="n">treg</span><span class="p">,</span> <span class="n">cd4</span> <span class="o">=</span> <span class="p">(</span>
            <span class="nb">list</span><span class="p">(</span><span class="n">agg_celltype</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;1_Treg&#39;</span><span class="p">,</span><span class="n">x</span> <span class="p">),</span> <span class="n">common_indices</span><span class="p">))][</span><span class="n">k</span><span class="p">]),</span>
            <span class="nb">list</span><span class="p">(</span><span class="n">agg_celltype</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;2_CD4&#39;</span><span class="p">,</span><span class="n">x</span> <span class="p">),</span> <span class="n">common_indices</span><span class="p">))][</span><span class="n">k</span><span class="p">])</span>
        <span class="p">)</span>
        <span class="n">stat</span> <span class="o">=</span> <span class="n">ttest_rel</span><span class="p">(</span><span class="n">treg</span><span class="p">,</span><span class="n">cd4</span><span class="p">)</span>
        <span class="n">cdr3_amino_acid_properties</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">k</span><span class="p">,</span> <span class="s1">&#39;Treg vs CD4&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">treg</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">cd4</span><span class="p">),</span> <span class="n">stat</span><span class="o">.</span><span class="n">pvalue</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        
        <span class="n">common_indices</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">agg_celltype</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;3_CD8&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">agg_celltype</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;2_CD4&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">)))</span>
        <span class="n">cd4</span><span class="p">,</span><span class="n">cd8</span> <span class="o">=</span> <span class="p">(</span>
            <span class="nb">list</span><span class="p">(</span><span class="n">agg_celltype</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;2_CD4&#39;</span><span class="p">,</span><span class="n">x</span> <span class="p">),</span> <span class="n">common_indices</span><span class="p">))][</span><span class="n">k</span><span class="p">]),</span>
            <span class="nb">list</span><span class="p">(</span><span class="n">agg_celltype</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;3_CD8&#39;</span><span class="p">,</span><span class="n">x</span> <span class="p">),</span> <span class="n">common_indices</span><span class="p">))][</span><span class="n">k</span><span class="p">])</span>
        <span class="p">)</span>
        <span class="n">stat</span> <span class="o">=</span> <span class="n">ttest_rel</span><span class="p">(</span><span class="n">cd4</span><span class="p">,</span><span class="n">cd8</span><span class="p">)</span>
        <span class="n">cdr3_amino_acid_properties</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">k</span><span class="p">,</span> <span class="s1">&#39;CD4 vs CD8&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">cd4</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">cd8</span><span class="p">),</span> <span class="n">stat</span><span class="o">.</span><span class="n">pvalue</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        
        <span class="n">common_indices</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">agg_celltype</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;1_Treg&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">agg_celltype</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;3_CD8&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">)))</span>
        <span class="n">treg</span><span class="p">,</span><span class="n">cd8</span> <span class="o">=</span> <span class="p">(</span>
            <span class="nb">list</span><span class="p">(</span><span class="n">agg_celltype</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;1_Treg&#39;</span><span class="p">,</span><span class="n">x</span> <span class="p">),</span> <span class="n">common_indices</span><span class="p">))][</span><span class="n">k</span><span class="p">]),</span>
            <span class="nb">list</span><span class="p">(</span><span class="n">agg_celltype</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;3_CD8&#39;</span><span class="p">,</span><span class="n">x</span> <span class="p">),</span> <span class="n">common_indices</span><span class="p">))][</span><span class="n">k</span><span class="p">])</span>
        <span class="p">)</span>
        <span class="n">stat</span> <span class="o">=</span> <span class="n">ttest_rel</span><span class="p">(</span><span class="n">treg</span><span class="p">,</span><span class="n">cd8</span><span class="p">)</span>
        <span class="n">cdr3_amino_acid_properties</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">k</span><span class="p">,</span> <span class="s1">&#39;Treg vs CD8&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">treg</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">cd8</span><span class="p">),</span> <span class="n">stat</span><span class="o">.</span><span class="n">pvalue</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        
        
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">k</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;./figures//huardb_</span><span class="si">{</span><span class="n">c</span><span class="si">}</span><span class="s2">_CD4vsCD8vsTreg_grouped_properties.pdf&quot;</span><span class="p">)</span>
    
    
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Figure size 1800x1200 with 0 Axes&gt;
</pre></div>
</div>
<img alt="_images/huARdb_TCR_paper_notebook_73_1.png" src="_images/huARdb_TCR_paper_notebook_73_1.png" />
<img alt="_images/huARdb_TCR_paper_notebook_73_2.png" src="_images/huARdb_TCR_paper_notebook_73_2.png" />
<img alt="_images/huARdb_TCR_paper_notebook_73_3.png" src="_images/huARdb_TCR_paper_notebook_73_3.png" />
<img alt="_images/huARdb_TCR_paper_notebook_73_4.png" src="_images/huARdb_TCR_paper_notebook_73_4.png" />
<img alt="_images/huARdb_TCR_paper_notebook_73_5.png" src="_images/huARdb_TCR_paper_notebook_73_5.png" />
<img alt="_images/huARdb_TCR_paper_notebook_73_6.png" src="_images/huARdb_TCR_paper_notebook_73_6.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># pd.DataFrame(cdr3_amino_acid_properties).to_csv(&quot;./data/20230307_cdr_amino_acid_properties.csv&quot;,index=False,header=None)</span>
<span class="n">cdr3_amino_acid_properties</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">cdr3_amino_acid_properties</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="figure-s3a-d-f">
<h2>[Figure S3A-D, F]<a class="headerlink" href="#figure-s3a-d-f" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cdr_amino_acid_properties</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;CDR1a&#39;</span><span class="p">,</span><span class="s1">&#39;CDR1b&#39;</span><span class="p">,</span><span class="s1">&#39;CDR2a&#39;</span><span class="p">,</span><span class="s1">&#39;CDR2b&#39;</span><span class="p">,</span><span class="s1">&#39;CDR3a_mr&#39;</span><span class="p">,</span><span class="s1">&#39;CDR3b_mr&#39;</span><span class="p">]:</span>
    <span class="n">fig</span><span class="p">,</span><span class="n">axes</span><span class="o">=</span><span class="n">createSubplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">AMINO_ACIDS</span><span class="p">))</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mi">42</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">ax</span><span class="p">,</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">c</span><span class="si">}</span><span class="s1">_&#39;</span> <span class="o">+</span> <span class="n">x</span><span class="p">,</span> <span class="n">AMINO_ACIDS</span><span class="p">))):</span>
        <span class="n">agg</span> <span class="o">=</span> <span class="n">CDR3mr</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;cell_type_3&quot;</span><span class="p">,</span><span class="s2">&quot;individual&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="n">k</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">})</span>
        <span class="n">agg</span> <span class="o">=</span> <span class="n">pandas_aggregation_to_wide</span><span class="p">(</span><span class="n">agg</span><span class="p">)</span>
        <span class="n">agg</span><span class="p">[</span><span class="s1">&#39;cell_type_3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">agg</span><span class="p">[</span><span class="s1">&#39;cell_type_3&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;Treg&quot;</span><span class="p">,</span><span class="s1">&#39;1_Treg&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;CD4&quot;</span><span class="p">,</span><span class="s1">&#39;2_CD4&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;CD8&quot;</span><span class="p">,</span><span class="s2">&quot;3_CD8&quot;</span><span class="p">)</span>
        <span class="n">agg</span> <span class="o">=</span> <span class="n">agg</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;cell_type_3&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        
        <span class="n">agg</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">_celltype_by_individual</span><span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="nb">zip</span><span class="p">(</span><span class="n">agg</span><span class="p">[</span><span class="s1">&#39;individual&#39;</span><span class="p">],</span><span class="n">agg</span><span class="p">[</span><span class="s1">&#39;cell_type_3&#39;</span><span class="p">])))</span>
        <span class="n">agg</span> <span class="o">=</span> <span class="n">agg</span><span class="p">[</span><span class="n">agg</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">]</span>
        <span class="n">agg</span> <span class="o">=</span> <span class="n">agg</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;1_Treg&#39;</span><span class="p">,</span><span class="s1">&#39;2_CD4&#39;</span><span class="p">,</span><span class="s1">&#39;3_CD8&#39;</span><span class="p">],</span> <span class="n">agg</span><span class="p">[</span><span class="s1">&#39;cell_type_3&#39;</span><span class="p">]))]</span>

        <span class="n">sns</span><span class="o">.</span><span class="n">violinplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">agg</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;cell_type_3&#39;</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">k</span><span class="p">,</span> <span class="n">showfliers</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">palette</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;1_Treg&#39;</span><span class="p">:</span><span class="s1">&#39;#6B4E94&#39;</span><span class="p">,</span><span class="s1">&#39;2_CD4&#39;</span><span class="p">:</span><span class="s1">&#39;#1E83C5&#39;</span><span class="p">,</span><span class="s1">&#39;3_CD8&#39;</span><span class="p">:</span><span class="s1">&#39;#FFCB39&#39;</span><span class="p">})</span>
        <span class="n">sns</span><span class="o">.</span><span class="n">stripplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">agg</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;cell_type_3&#39;</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">k</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">jitter</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">agg</span><span class="p">[</span><span class="n">agg</span><span class="p">[</span><span class="s1">&#39;cell_type_3&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;3_CD8&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;individual&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="n">k</span><span class="p">:</span><span class="nb">list</span><span class="p">})</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">agg</span><span class="p">[</span><span class="n">agg</span><span class="p">[</span><span class="s1">&#39;cell_type_3&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;1_Treg&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;individual&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="n">k</span><span class="p">:</span><span class="nb">list</span><span class="p">})</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>  
        <span class="n">agg_celltype</span> <span class="o">=</span> <span class="n">agg</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;cell_type_3&quot;</span><span class="p">,</span><span class="s2">&quot;individual&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="n">k</span><span class="p">:</span><span class="nb">list</span><span class="p">})</span>
        <span class="n">common_indices</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">agg_celltype</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;1_Treg&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">agg_celltype</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;2_CD4&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">)))</span>
        <span class="n">treg</span><span class="p">,</span> <span class="n">cd4</span> <span class="o">=</span> <span class="p">(</span>
            <span class="nb">list</span><span class="p">(</span><span class="n">agg_celltype</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;1_Treg&#39;</span><span class="p">,</span><span class="n">x</span> <span class="p">),</span> <span class="n">common_indices</span><span class="p">))][</span><span class="n">k</span><span class="p">]),</span>
            <span class="nb">list</span><span class="p">(</span><span class="n">agg_celltype</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;2_CD4&#39;</span><span class="p">,</span><span class="n">x</span> <span class="p">),</span> <span class="n">common_indices</span><span class="p">))][</span><span class="n">k</span><span class="p">])</span>
        <span class="p">)</span>
        <span class="n">stat</span> <span class="o">=</span> <span class="n">ttest_rel</span><span class="p">(</span><span class="n">treg</span><span class="p">,</span><span class="n">cd4</span><span class="p">)</span>
        <span class="n">cdr_amino_acid_properties</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">k</span><span class="p">,</span> <span class="s1">&#39;Treg vs CD4&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">treg</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">cd4</span><span class="p">),</span> <span class="n">stat</span><span class="o">.</span><span class="n">pvalue</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        
        <span class="n">common_indices</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">agg_celltype</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;3_CD8&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">agg_celltype</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;2_CD4&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">)))</span>
        <span class="n">cd4</span><span class="p">,</span><span class="n">cd8</span> <span class="o">=</span> <span class="p">(</span>
            <span class="nb">list</span><span class="p">(</span><span class="n">agg_celltype</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;2_CD4&#39;</span><span class="p">,</span><span class="n">x</span> <span class="p">),</span> <span class="n">common_indices</span><span class="p">))][</span><span class="n">k</span><span class="p">]),</span>
            <span class="nb">list</span><span class="p">(</span><span class="n">agg_celltype</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;3_CD8&#39;</span><span class="p">,</span><span class="n">x</span> <span class="p">),</span> <span class="n">common_indices</span><span class="p">))][</span><span class="n">k</span><span class="p">])</span>
        <span class="p">)</span>
        <span class="n">stat</span> <span class="o">=</span> <span class="n">ttest_rel</span><span class="p">(</span><span class="n">cd4</span><span class="p">,</span><span class="n">cd8</span><span class="p">)</span>
        <span class="n">cdr_amino_acid_properties</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">k</span><span class="p">,</span> <span class="s1">&#39;CD4 vs CD8&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">cd4</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">cd8</span><span class="p">),</span> <span class="n">stat</span><span class="o">.</span><span class="n">pvalue</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        
        <span class="n">common_indices</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">agg_celltype</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;1_Treg&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">agg_celltype</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;3_CD8&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">)))</span>
        <span class="n">treg</span><span class="p">,</span><span class="n">cd8</span> <span class="o">=</span> <span class="p">(</span>
            <span class="nb">list</span><span class="p">(</span><span class="n">agg_celltype</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;1_Treg&#39;</span><span class="p">,</span><span class="n">x</span> <span class="p">),</span> <span class="n">common_indices</span><span class="p">))][</span><span class="n">k</span><span class="p">]),</span>
            <span class="nb">list</span><span class="p">(</span><span class="n">agg_celltype</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;3_CD8&#39;</span><span class="p">,</span><span class="n">x</span> <span class="p">),</span> <span class="n">common_indices</span><span class="p">))][</span><span class="n">k</span><span class="p">])</span>
        <span class="p">)</span>
        <span class="n">stat</span> <span class="o">=</span> <span class="n">ttest_rel</span><span class="p">(</span><span class="n">treg</span><span class="p">,</span><span class="n">cd8</span><span class="p">)</span>
        <span class="n">cdr_amino_acid_properties</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">k</span><span class="p">,</span> <span class="s1">&#39;Treg vs CD8&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">treg</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">cd8</span><span class="p">),</span> <span class="n">stat</span><span class="o">.</span><span class="n">pvalue</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">k</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;./figures/huardb_</span><span class="si">{</span><span class="n">c</span><span class="si">}</span><span class="s2">_CD4vsCD8vsTreg_AminoAcids.pdf&quot;</span><span class="p">)</span>
    
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/huARdb_TCR_paper_notebook_76_0.png" src="_images/huARdb_TCR_paper_notebook_76_0.png" />
<img alt="_images/huARdb_TCR_paper_notebook_76_1.png" src="_images/huARdb_TCR_paper_notebook_76_1.png" />
<img alt="_images/huARdb_TCR_paper_notebook_76_2.png" src="_images/huARdb_TCR_paper_notebook_76_2.png" />
<img alt="_images/huARdb_TCR_paper_notebook_76_3.png" src="_images/huARdb_TCR_paper_notebook_76_3.png" />
<img alt="_images/huARdb_TCR_paper_notebook_76_4.png" src="_images/huARdb_TCR_paper_notebook_76_4.png" />
<img alt="_images/huARdb_TCR_paper_notebook_76_5.png" src="_images/huARdb_TCR_paper_notebook_76_5.png" />
</div>
</div>
</div>
</div>
<div class="tex2jax_ignore mathjax_ignore section" id="recurrent-tcr-analysis">
<h1>Recurrent TCR analysis<a class="headerlink" href="#recurrent-tcr-analysis" title="Permalink to this headline">¶</a></h1>
<div class="section" id="recurrent-tcr-alpha-beta">
<h2>Recurrent TCR (alpha-beta)<a class="headerlink" href="#recurrent-tcr-alpha-beta" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">count</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">i</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">,</span> <span class="n">tcr_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,[</span>
    <span class="s1">&#39;CDR3a&#39;</span><span class="p">,</span><span class="s1">&#39;CDR3b&#39;</span><span class="p">,</span><span class="s1">&#39;TRAV&#39;</span><span class="p">,</span><span class="s1">&#39;TRAJ&#39;</span><span class="p">,</span><span class="s1">&#39;TRBV&#39;</span><span class="p">,</span><span class="s1">&#39;TRBJ&#39;</span>
<span class="p">]]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">())),</span> <span class="n">tcr_df</span><span class="p">[</span><span class="s1">&#39;individual&#39;</span><span class="p">]):</span>

    <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">count</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">count</span><span class="p">[</span><span class="n">k</span><span class="p">]:</span> <span class="n">count</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">count</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="p">]</span>

<span class="n">recurrent_tcrs_alpha_beta</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span>
        <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">),</span> 
        <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="n">count</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>
    <span class="p">)),</span>
    <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;CDR3a&quot;</span><span class="p">,</span><span class="s2">&quot;CDR3b&quot;</span><span class="p">,</span><span class="s2">&quot;TRAV&quot;</span><span class="p">,</span><span class="s2">&quot;TRAJ&quot;</span><span class="p">,</span><span class="s2">&quot;TRBV&quot;</span><span class="p">,</span><span class="s2">&quot;TRBJ&quot;</span><span class="p">]</span>
<span class="p">)</span>

<span class="n">recurrent_tcrs_alpha_beta</span><span class="p">[</span><span class="s1">&#39;individuals&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span>
        <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
        <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="n">count</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>
    <span class="p">))</span>
<span class="n">recurrent_tcrs_alpha_beta</span><span class="p">[</span><span class="s1">&#39;number_of_individuals&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span>
        <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
        <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="n">count</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>
    <span class="p">))</span>
<span class="n">recurrent_tcrs_alpha_beta</span><span class="p">[</span><span class="s1">&#39;disease&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> 
     <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
         <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">a</span><span class="p">:</span> <span class="n">a</span><span class="p">,</span> 
                             <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">z</span><span class="p">:</span><span class="n">individual2disease_type</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">z</span><span class="p">),</span> <span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)))</span>
     <span class="p">)))</span>
     <span class="p">),</span> <span class="n">recurrent_tcrs_alpha_beta</span><span class="p">[</span><span class="s1">&#39;individuals&#39;</span><span class="p">])</span>
<span class="p">)</span>
<span class="n">tcr_df</span><span class="p">[</span><span class="s1">&#39;recurrent_tcrs_alpha_beta&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span>
<span class="n">tcr_df</span><span class="p">[</span><span class="s1">&#39;recurrent_tcrs_alpha_beta_n_individuals&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">m</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span>
    <span class="s1">&#39;=&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">,</span> 
    <span class="n">recurrent_tcrs_alpha_beta</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,[</span><span class="s1">&#39;CDR3a&#39;</span><span class="p">,</span><span class="s1">&#39;CDR3b&#39;</span><span class="p">,</span><span class="s1">&#39;TRAV&#39;</span><span class="p">,</span><span class="s1">&#39;TRAJ&#39;</span><span class="p">,</span><span class="s1">&#39;TRBV&#39;</span><span class="p">,</span><span class="s1">&#39;TRBJ&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">())),</span>
    <span class="n">recurrent_tcrs_alpha_beta</span><span class="p">[</span><span class="s1">&#39;individuals&#39;</span><span class="p">]</span>
<span class="p">))</span>
<span class="n">n</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span>
    <span class="s1">&#39;=&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">,</span> 
    <span class="n">recurrent_tcrs_alpha_beta</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,[</span><span class="s1">&#39;CDR3a&#39;</span><span class="p">,</span><span class="s1">&#39;CDR3b&#39;</span><span class="p">,</span><span class="s1">&#39;TRAV&#39;</span><span class="p">,</span><span class="s1">&#39;TRAJ&#39;</span><span class="p">,</span><span class="s1">&#39;TRBV&#39;</span><span class="p">,</span><span class="s1">&#39;TRBJ&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">())),</span>
    <span class="n">recurrent_tcrs_alpha_beta</span><span class="p">[</span><span class="s1">&#39;number_of_individuals&#39;</span><span class="p">]</span>
<span class="p">))</span>
<span class="n">_tmp_1</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">_tmp_2</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">pbar</span> <span class="o">=</span> <span class="n">tqdm</span><span class="o">.</span><span class="n">tqdm</span><span class="p">(</span><span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">tcr_df</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">k</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span>
    <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">,</span> <span class="n">tcr_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,[</span>
    <span class="s1">&#39;CDR3a&#39;</span><span class="p">,</span><span class="s1">&#39;CDR3b&#39;</span><span class="p">,</span><span class="s1">&#39;TRAV&#39;</span><span class="p">,</span><span class="s1">&#39;TRAJ&#39;</span><span class="p">,</span><span class="s1">&#39;TRBV&#39;</span><span class="p">,</span><span class="s1">&#39;TRBJ&#39;</span>
    <span class="p">]]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()))</span>
<span class="p">):</span>
    <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">_tmp_1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
        <span class="n">_tmp_2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
        <span class="k">assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">))</span> <span class="o">==</span> <span class="n">n</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">_tmp_1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
        <span class="n">_tmp_2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">pbar</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">tcr_df</span><span class="p">[</span><span class="s1">&#39;recurrent_tcrs_alpha_beta&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_tmp_1</span>
<span class="n">tcr_df</span><span class="p">[</span><span class="s1">&#39;recurrent_tcrs_alpha_beta_n_individuals&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_tmp_2</span>
<span class="n">pbar</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|███████████████████████████████████████████████████████████████████████████████████████| 635393/635393 [00:01&lt;00:00, 506518.12it/s]
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="recurrent-tcr-beta">
<h2>Recurrent TCR (beta)<a class="headerlink" href="#recurrent-tcr-beta" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">count</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">i</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">,</span> <span class="n">tcr_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,[</span>
    <span class="s1">&#39;CDR3b&#39;</span><span class="p">,</span><span class="s1">&#39;TRBV&#39;</span><span class="p">,</span><span class="s1">&#39;TRBJ&#39;</span>
<span class="p">]]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">())),</span> <span class="n">tcr_df</span><span class="p">[</span><span class="s1">&#39;individual&#39;</span><span class="p">]):</span>
    <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">count</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">and</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">count</span><span class="p">[</span><span class="n">k</span><span class="p">]:</span>
        <span class="n">count</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">count</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="p">]</span>
<span class="n">recurrent_tcrs_beta</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span>
        <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">),</span> 
        <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="n">count</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>
    <span class="p">)),</span>
    <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;CDR3b&quot;</span><span class="p">,</span><span class="s2">&quot;TRBV&quot;</span><span class="p">,</span><span class="s2">&quot;TRBJ&quot;</span><span class="p">]</span>
<span class="p">)</span>

<span class="n">recurrent_tcrs_beta</span><span class="p">[</span><span class="s1">&#39;individuals&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span>
        <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
        <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="n">count</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>
    <span class="p">))</span>
<span class="n">recurrent_tcrs_beta</span><span class="p">[</span><span class="s1">&#39;number_of_individuals&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span>
        <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
        <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="n">count</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>
    <span class="p">))</span>
<span class="n">tcr_df</span><span class="p">[</span><span class="s1">&#39;recurrent_tcrs_beta&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span>
<span class="n">tcr_df</span><span class="p">[</span><span class="s1">&#39;recurrent_tcrs_beta_n_individuals&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">m</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span>
    <span class="s1">&#39;=&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">,</span> 
    <span class="n">recurrent_tcrs_beta</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,[</span><span class="s1">&#39;CDR3b&#39;</span><span class="p">,</span><span class="s1">&#39;TRBV&#39;</span><span class="p">,</span><span class="s2">&quot;TRBJ&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">())),</span>
    <span class="n">recurrent_tcrs_beta</span><span class="p">[</span><span class="s1">&#39;individuals&#39;</span><span class="p">]</span>
<span class="p">))</span>
<span class="n">n</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span>
    <span class="s1">&#39;=&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">,</span> 
    <span class="n">recurrent_tcrs_beta</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,[</span><span class="s1">&#39;CDR3b&#39;</span><span class="p">,</span><span class="s1">&#39;TRBV&#39;</span><span class="p">,</span><span class="s2">&quot;TRBJ&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">())),</span>
    <span class="n">recurrent_tcrs_beta</span><span class="p">[</span><span class="s1">&#39;number_of_individuals&#39;</span><span class="p">]</span>
<span class="p">))</span>

<span class="n">_tmp_1</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">_tmp_2</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">pbar</span> <span class="o">=</span> <span class="n">tqdm</span><span class="o">.</span><span class="n">tqdm</span><span class="p">(</span><span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">tcr_df</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">k</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span>
    <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">,</span> <span class="n">tcr_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,[</span>
    <span class="s1">&#39;CDR3b&#39;</span><span class="p">,</span><span class="s1">&#39;TRBV&#39;</span><span class="p">,</span><span class="s1">&#39;TRBJ&#39;</span><span class="p">,</span>
    <span class="p">]]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()))</span>
<span class="p">):</span>
    <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">_tmp_1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
        <span class="n">_tmp_2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">_tmp_1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
        <span class="n">_tmp_2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">pbar</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">tcr_df</span><span class="p">[</span><span class="s1">&#39;recurrent_tcrs_beta&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_tmp_1</span>
<span class="n">tcr_df</span><span class="p">[</span><span class="s1">&#39;recurrent_tcrs_beta_n_individuals&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_tmp_2</span>
<span class="n">pbar</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|███████████████████████████████████████████████████████████████████████████████████████| 635393/635393 [00:01&lt;00:00, 564356.39it/s]
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="recurrent-tcr-alpha">
<h2>Recurrent TCR (alpha)<a class="headerlink" href="#recurrent-tcr-alpha" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">count</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">i</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">,</span> <span class="n">tcr_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,[</span>
    <span class="s1">&#39;CDR3a&#39;</span><span class="p">,</span><span class="s1">&#39;TRAV&#39;</span><span class="p">,</span><span class="s1">&#39;TRAJ&#39;</span>
<span class="p">]]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">())),</span> <span class="n">tcr_df</span><span class="p">[</span><span class="s1">&#39;individual&#39;</span><span class="p">]):</span>
    <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">count</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">and</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">count</span><span class="p">[</span><span class="n">k</span><span class="p">]:</span>
        <span class="n">count</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">count</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="p">]</span>
<span class="n">recurrent_tcrs_alpha</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span>
        <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">),</span> 
        <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="n">count</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>
    <span class="p">)),</span>
    <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;CDR3a&quot;</span><span class="p">,</span><span class="s2">&quot;TRAV&quot;</span><span class="p">,</span><span class="s2">&quot;TRAJ&quot;</span><span class="p">]</span>
<span class="p">)</span>

<span class="n">recurrent_tcrs_alpha</span><span class="p">[</span><span class="s1">&#39;individuals&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span>
        <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
        <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="n">count</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>
    <span class="p">))</span>
<span class="n">recurrent_tcrs_alpha</span><span class="p">[</span><span class="s1">&#39;number_of_individuals&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span>
        <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
        <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="n">count</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>
    <span class="p">))</span>
<span class="n">tcr_df</span><span class="p">[</span><span class="s1">&#39;recurrent_tcrs_alpha&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span>
<span class="n">tcr_df</span><span class="p">[</span><span class="s1">&#39;recurrent_tcrs_alpha_n_individuals&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">m</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span>
    <span class="s1">&#39;=&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">,</span> 
    <span class="n">recurrent_tcrs_alpha</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,[</span><span class="s1">&#39;CDR3a&#39;</span><span class="p">,</span><span class="s1">&#39;TRAV&#39;</span><span class="p">,</span><span class="s2">&quot;TRAJ&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">())),</span>
    <span class="n">recurrent_tcrs_alpha</span><span class="p">[</span><span class="s1">&#39;individuals&#39;</span><span class="p">]</span>
<span class="p">))</span>
<span class="n">n</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span>
    <span class="s1">&#39;=&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">,</span> 
    <span class="n">recurrent_tcrs_alpha</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,[</span><span class="s1">&#39;CDR3a&#39;</span><span class="p">,</span><span class="s1">&#39;TRAV&#39;</span><span class="p">,</span><span class="s2">&quot;TRAJ&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">())),</span>
    <span class="n">recurrent_tcrs_alpha</span><span class="p">[</span><span class="s1">&#39;number_of_individuals&#39;</span><span class="p">]</span>
<span class="p">))</span>
<span class="n">_tmp_1</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">_tmp_2</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">pbar</span> <span class="o">=</span> <span class="n">tqdm</span><span class="o">.</span><span class="n">tqdm</span><span class="p">(</span><span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">tcr_df</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">k</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span>
    <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">,</span> <span class="n">tcr_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,[</span>
    <span class="s1">&#39;CDR3a&#39;</span><span class="p">,</span><span class="s1">&#39;TRAV&#39;</span><span class="p">,</span><span class="s1">&#39;TRAJ&#39;</span><span class="p">,</span>
    <span class="p">]]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()))</span>
<span class="p">):</span>
    <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">_tmp_1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
        <span class="n">_tmp_2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">_tmp_1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
        <span class="n">_tmp_2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">pbar</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">tcr_df</span><span class="p">[</span><span class="s1">&#39;recurrent_tcrs_alpha&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_tmp_1</span>
<span class="n">tcr_df</span><span class="p">[</span><span class="s1">&#39;recurrent_tcrs_alpha_n_individuals&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_tmp_2</span>
<span class="n">pbar</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|███████████████████████████████████████████████████████████████████████████████████████| 635393/635393 [00:01&lt;00:00, 630966.92it/s]
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="summary-of-recurrent-tcr">
<h2>Summary of recurrent TCR<a class="headerlink" href="#summary-of-recurrent-tcr" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tcr_df</span><span class="p">[</span><span class="s1">&#39;recurrent_tcrs_alpha_beta_disease&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
         <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">a</span><span class="p">:</span> <span class="n">a</span><span class="p">,</span> 
         <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">z</span><span class="p">:</span><span class="n">individual2disease_type</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">z</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span><span class="s1">&#39;Unknown&#39;</span><span class="p">),</span> <span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)))</span>
     <span class="p">))))</span> <span class="k">if</span> <span class="n">x</span> <span class="o">!=</span> <span class="s1">&#39;-&#39;</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span> <span class="k">else</span> <span class="n">x</span><span class="p">,</span> <span class="n">tcr_df</span><span class="p">[</span><span class="s1">&#39;recurrent_tcrs_alpha_beta&#39;</span><span class="p">]))</span>

<span class="n">tcr_df</span><span class="p">[</span><span class="s1">&#39;recurrent_tcrs_alpha_disease&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span>     <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
         <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">a</span><span class="p">:</span> <span class="n">a</span><span class="p">,</span> 
         <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">z</span><span class="p">:</span><span class="n">individual2disease_type</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">z</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span><span class="s1">&#39;Unknown&#39;</span><span class="p">),</span> <span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)))</span>
     <span class="p">))))</span> <span class="k">if</span> <span class="n">x</span> <span class="o">!=</span> <span class="s1">&#39;-&#39;</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span> <span class="k">else</span> <span class="n">x</span><span class="p">,</span> <span class="n">tcr_df</span><span class="p">[</span><span class="s1">&#39;recurrent_tcrs_alpha&#39;</span><span class="p">]))</span>

<span class="n">tcr_df</span><span class="p">[</span><span class="s1">&#39;recurrent_tcrs_beta_disease&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span>     <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
         <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">a</span><span class="p">:</span> <span class="n">a</span><span class="p">,</span> 
         <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">z</span><span class="p">:</span><span class="n">individual2disease_type</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">z</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span><span class="s1">&#39;Unknown&#39;</span><span class="p">),</span> <span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)))</span>
     <span class="p">))))</span> <span class="k">if</span> <span class="n">x</span> <span class="o">!=</span> <span class="s1">&#39;-&#39;</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span> <span class="k">else</span> <span class="n">x</span><span class="p">,</span> <span class="n">tcr_df</span><span class="p">[</span><span class="s1">&#39;recurrent_tcrs_beta&#39;</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of recurrent Alpha Beta TCR&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">,</span> <span class="n">tcr_df</span><span class="p">[</span>
    <span class="n">tcr_df</span><span class="p">[</span><span class="s1">&#39;recurrent_tcrs_alpha_beta_disease&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;-&#39;</span>
<span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="n">TRAB_DEFINITION</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">())))))</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of recurrent Beta TCR&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">,</span> <span class="n">tcr_df</span><span class="p">[</span>
    <span class="n">tcr_df</span><span class="p">[</span><span class="s1">&#39;recurrent_tcrs_beta_disease&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;-&#39;</span>
<span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="n">TRB_DEFINITION</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">())))))</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of recurrent Alpha TCR&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">,</span> <span class="n">tcr_df</span><span class="p">[</span>
    <span class="n">tcr_df</span><span class="p">[</span><span class="s1">&#39;recurrent_tcrs_alpha_disease&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;-&#39;</span>
<span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="n">TRA_DEFINITION</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">())))))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Number of recurrent Alpha Beta TCR 858
Number of recurrent Beta TCR 10816
Number of recurrent Alpha TCR 65812
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="pgen-of-recurrent-tcr">
<h2>Pgen of recurrent TCR<a class="headerlink" href="#pgen-of-recurrent-tcr" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">recurrent_tcrab</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">Counter</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">,</span> <span class="n">tcr_df</span><span class="p">[</span>
    <span class="n">tcr_df</span><span class="p">[</span><span class="s1">&#39;recurrent_tcrs_alpha_beta_disease&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;-&#39;</span>
<span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="n">TRAB_DEFINITION</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">())))</span><span class="o">.</span><span class="n">items</span><span class="p">())))</span>
<span class="n">recurrent_tcrab</span><span class="p">[</span><span class="s1">&#39;disease&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">tcr_df</span><span class="p">[</span>
    <span class="n">tcr_df</span><span class="p">[</span><span class="s1">&#39;recurrent_tcrs_alpha_beta_disease&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;-&#39;</span>
<span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">TRAB_DEFINITION</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s1">&#39;recurrent_tcrs_alpha_beta_disease&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">x</span><span class="p">)[</span><span class="mi">0</span><span class="p">]})[</span><span class="s1">&#39;recurrent_tcrs_alpha_beta_disease&#39;</span><span class="p">])</span>

<span class="n">recurrent_tcrab</span><span class="p">[</span><span class="s1">&#39;disease&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">tcr_df</span><span class="p">[</span>
    <span class="n">tcr_df</span><span class="p">[</span><span class="s1">&#39;recurrent_tcrs_alpha_beta_disease&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;-&#39;</span>
<span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">TRAB_DEFINITION</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s1">&#39;recurrent_tcrs_alpha_beta_disease&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">x</span><span class="p">)[</span><span class="mi">0</span><span class="p">]})[</span><span class="s1">&#39;recurrent_tcrs_alpha_beta_disease&#39;</span><span class="p">])</span>


<span class="n">recurrent_tcrab</span><span class="p">[</span><span class="s1">&#39;TRA_Pgen&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">tcr_df</span><span class="p">[</span>
    <span class="n">tcr_df</span><span class="p">[</span><span class="s1">&#39;recurrent_tcrs_alpha_beta_disease&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;-&#39;</span>
<span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">TRAB_DEFINITION</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s1">&#39;TRA_Pgen&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">x</span><span class="p">)[</span><span class="mi">0</span><span class="p">]})[</span><span class="s1">&#39;TRA_Pgen&#39;</span><span class="p">])</span>

<span class="n">recurrent_tcrab</span><span class="p">[</span><span class="s1">&#39;TRB_Pgen&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">tcr_df</span><span class="p">[</span>
    <span class="n">tcr_df</span><span class="p">[</span><span class="s1">&#39;recurrent_tcrs_alpha_beta_disease&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;-&#39;</span>
<span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">TRAB_DEFINITION</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s1">&#39;TRB_Pgen&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">x</span><span class="p">)[</span><span class="mi">0</span><span class="p">]})[</span><span class="s1">&#39;TRB_Pgen&#39;</span><span class="p">])</span>

<span class="n">recurrent_tcrab</span><span class="p">[</span><span class="s1">&#39;individual&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">tcr_df</span><span class="p">[</span>
    <span class="n">tcr_df</span><span class="p">[</span><span class="s1">&#39;recurrent_tcrs_alpha_beta_disease&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;-&#39;</span>
<span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">TRAB_DEFINITION</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s1">&#39;individual&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">x</span><span class="p">))})[</span><span class="s1">&#39;individual&#39;</span><span class="p">])</span>

<span class="n">recurrent_tcrb</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">Counter</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">,</span> <span class="n">tcr_df</span><span class="p">[</span>
    <span class="n">tcr_df</span><span class="p">[</span><span class="s1">&#39;recurrent_tcrs_beta_disease&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;-&#39;</span>
<span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="n">TRB_DEFINITION</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">())))</span><span class="o">.</span><span class="n">items</span><span class="p">())))</span>
<span class="n">recurrent_tcrb</span><span class="p">[</span><span class="s1">&#39;disease&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">tcr_df</span><span class="p">[</span>
    <span class="n">tcr_df</span><span class="p">[</span><span class="s1">&#39;recurrent_tcrs_beta_disease&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;-&#39;</span>
<span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">TRB_DEFINITION</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s1">&#39;recurrent_tcrs_beta_disease&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">x</span><span class="p">)[</span><span class="mi">0</span><span class="p">]})[</span><span class="s1">&#39;recurrent_tcrs_beta_disease&#39;</span><span class="p">])</span>

<span class="n">recurrent_tcrb</span><span class="p">[</span><span class="s1">&#39;TRA_Pgen&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">tcr_df</span><span class="p">[</span>
    <span class="n">tcr_df</span><span class="p">[</span><span class="s1">&#39;recurrent_tcrs_beta_disease&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;-&#39;</span>
<span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">TRB_DEFINITION</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s1">&#39;TRA_Pgen&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">x</span><span class="p">)[</span><span class="mi">0</span><span class="p">]})[</span><span class="s1">&#39;TRA_Pgen&#39;</span><span class="p">])</span>


<span class="n">recurrent_tcrb</span><span class="p">[</span><span class="s1">&#39;TRB_Pgen&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">tcr_df</span><span class="p">[</span>
    <span class="n">tcr_df</span><span class="p">[</span><span class="s1">&#39;recurrent_tcrs_beta_disease&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;-&#39;</span>
<span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">TRB_DEFINITION</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s1">&#39;TRB_Pgen&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">x</span><span class="p">)[</span><span class="mi">0</span><span class="p">]})[</span><span class="s1">&#39;TRB_Pgen&#39;</span><span class="p">])</span>

<span class="n">recurrent_tcrb</span><span class="p">[</span><span class="s1">&#39;individual&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">tcr_df</span><span class="p">[</span>
    <span class="n">tcr_df</span><span class="p">[</span><span class="s1">&#39;recurrent_tcrs_beta_disease&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;-&#39;</span>
<span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">TRB_DEFINITION</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s1">&#39;individual&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">x</span><span class="p">))})[</span><span class="s1">&#39;individual&#39;</span><span class="p">])</span>

<span class="n">recurrent_tcra</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">Counter</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">,</span> <span class="n">tcr_df</span><span class="p">[</span>
    <span class="n">tcr_df</span><span class="p">[</span><span class="s1">&#39;recurrent_tcrs_alpha_disease&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;-&#39;</span>
<span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="n">TRA_DEFINITION</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">())))</span><span class="o">.</span><span class="n">items</span><span class="p">())))</span>
<span class="n">recurrent_tcra</span><span class="p">[</span><span class="s1">&#39;disease&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">tcr_df</span><span class="p">[</span>
    <span class="n">tcr_df</span><span class="p">[</span><span class="s1">&#39;recurrent_tcrs_alpha_disease&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;-&#39;</span>
<span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">TRA_DEFINITION</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s1">&#39;recurrent_tcrs_alpha_disease&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">x</span><span class="p">)[</span><span class="mi">0</span><span class="p">]})[</span><span class="s1">&#39;recurrent_tcrs_alpha_disease&#39;</span><span class="p">])</span>

<span class="n">recurrent_tcra</span><span class="p">[</span><span class="s1">&#39;TRA_Pgen&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">tcr_df</span><span class="p">[</span>
    <span class="n">tcr_df</span><span class="p">[</span><span class="s1">&#39;recurrent_tcrs_alpha_disease&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;-&#39;</span>
<span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">TRA_DEFINITION</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s1">&#39;TRA_Pgen&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">x</span><span class="p">)[</span><span class="mi">0</span><span class="p">]})[</span><span class="s1">&#39;TRA_Pgen&#39;</span><span class="p">])</span>


<span class="n">recurrent_tcra</span><span class="p">[</span><span class="s1">&#39;TRB_Pgen&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">tcr_df</span><span class="p">[</span>
    <span class="n">tcr_df</span><span class="p">[</span><span class="s1">&#39;recurrent_tcrs_alpha_disease&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;-&#39;</span>
<span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">TRA_DEFINITION</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s1">&#39;TRB_Pgen&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">x</span><span class="p">)[</span><span class="mi">0</span><span class="p">]})[</span><span class="s1">&#39;TRB_Pgen&#39;</span><span class="p">])</span>


<span class="n">recurrent_tcra</span><span class="p">[</span><span class="s1">&#39;individual&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">tcr_df</span><span class="p">[</span>
    <span class="n">tcr_df</span><span class="p">[</span><span class="s1">&#39;recurrent_tcrs_alpha_disease&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;-&#39;</span>
<span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">TRA_DEFINITION</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s1">&#39;individual&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">x</span><span class="p">))})[</span><span class="s1">&#39;individual&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="figure-3c">
<h3>[Figure 3C]<a class="headerlink" href="#figure-3c" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">sem</span>

<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">createSubplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>

<span class="n">tcr_df_groupby_public_alpha</span> <span class="o">=</span> <span class="n">tcr_df</span>
<span class="n">tcr_df_groupby_public_alpha</span><span class="p">[</span><span class="s1">&#39;TRA_Pgen_log&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">tcr_df_groupby_public_alpha</span><span class="p">[</span><span class="s1">&#39;TRA_Pgen&#39;</span><span class="p">])</span>
<span class="n">tcr_df_groupby_public_alpha</span><span class="p">[</span><span class="s1">&#39;TRB_Pgen_log&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">tcr_df_groupby_public_alpha</span><span class="p">[</span><span class="s1">&#39;TRB_Pgen&#39;</span><span class="p">])</span>

<span class="n">tcr_df_groupby_public_beta</span> <span class="o">=</span> <span class="n">tcr_df</span>
<span class="n">tcr_df_groupby_public_beta</span><span class="p">[</span><span class="s1">&#39;TRA_Pgen_log&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">tcr_df_groupby_public_beta</span><span class="p">[</span><span class="s1">&#39;TRA_Pgen&#39;</span><span class="p">])</span>
<span class="n">tcr_df_groupby_public_beta</span><span class="p">[</span><span class="s1">&#39;TRB_Pgen_log&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">tcr_df_groupby_public_beta</span><span class="p">[</span><span class="s1">&#39;TRB_Pgen&#39;</span><span class="p">])</span>
<span class="n">recurrent_tra_pgen</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">x</span><span class="p">),</span>
    <span class="n">tcr_df_groupby_public_alpha</span><span class="p">[</span>
        <span class="n">tcr_df_groupby_public_alpha</span><span class="p">[</span><span class="s1">&#39;recurrent_tcrs_alpha_n_individuals&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span>
    <span class="p">][</span><span class="s1">&#39;TRA_Pgen_log&#39;</span><span class="p">]</span>
<span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Mean of recurrent TCRa generation probability: &quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span>
    <span class="n">recurrent_tra_pgen</span>
<span class="p">),</span> <span class="n">sem</span><span class="p">(</span><span class="n">recurrent_tra_pgen</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">distplot</span><span class="p">(</span>
    <span class="n">recurrent_tra_pgen</span><span class="p">,</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
    <span class="n">kde_kws</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
        <span class="n">bw_adjust</span><span class="o">=</span><span class="mi">4</span>
    <span class="p">),</span>
    <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;#1D7293&#39;</span>
<span class="p">)</span>
<span class="n">non_recurrent_tra_pgen</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">x</span><span class="p">),</span>
    <span class="n">tcr_df_groupby_public_alpha</span><span class="p">[</span>
        <span class="n">tcr_df_groupby_public_alpha</span><span class="p">[</span><span class="s1">&#39;recurrent_tcrs_alpha_n_individuals&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span>
    <span class="p">][</span><span class="s1">&#39;TRA_Pgen_log&#39;</span><span class="p">]</span>
<span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Mean of non-recurrent TCRa generation probability: &quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span>
    <span class="n">non_recurrent_tra_pgen</span>
<span class="p">),</span> <span class="n">sem</span><span class="p">(</span><span class="n">non_recurrent_tra_pgen</span><span class="p">))</span>

<span class="n">sns</span><span class="o">.</span><span class="n">distplot</span><span class="p">(</span>
    <span class="n">non_recurrent_tra_pgen</span><span class="p">,</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
    <span class="n">kde_kws</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
        <span class="n">bw_adjust</span><span class="o">=</span><span class="mi">4</span>
    <span class="p">),</span>
    <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;#1D2D44&#39;</span>
<span class="p">)</span>

<span class="n">recurrent_trb_pgen</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">x</span><span class="p">),</span>
    <span class="n">tcr_df_groupby_public_beta</span><span class="p">[</span>
        <span class="n">tcr_df_groupby_public_beta</span><span class="p">[</span><span class="s1">&#39;recurrent_tcrs_beta_n_individuals&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span>
    <span class="p">][</span><span class="s1">&#39;TRB_Pgen_log&#39;</span><span class="p">]</span>
<span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Mean of recurrent TCRb generation probability: &quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span>
    <span class="n">recurrent_trb_pgen</span>
<span class="p">),</span> <span class="n">sem</span><span class="p">(</span><span class="n">recurrent_trb_pgen</span><span class="p">))</span>


<span class="n">sns</span><span class="o">.</span><span class="n">distplot</span><span class="p">(</span>
    <span class="n">recurrent_trb_pgen</span><span class="p">,</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
    <span class="n">kde_kws</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
        <span class="n">bw_adjust</span><span class="o">=</span><span class="mi">4</span>
    <span class="p">),</span>
    <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;#1D7293&#39;</span>
<span class="p">)</span>

<span class="n">non_recurrent_trb_pgen</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">x</span><span class="p">),</span>
    <span class="n">tcr_df_groupby_public_beta</span><span class="p">[</span>
        <span class="n">tcr_df_groupby_public_beta</span><span class="p">[</span><span class="s1">&#39;recurrent_tcrs_beta_n_individuals&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span>
    <span class="p">][</span><span class="s1">&#39;TRB_Pgen_log&#39;</span><span class="p">]</span>
<span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Mean of non-recurrent TCRb generation probability: &quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span>
<span class="n">non_recurrent_trb_pgen</span>
<span class="p">),</span> <span class="n">sem</span><span class="p">(</span><span class="n">non_recurrent_trb_pgen</span><span class="p">))</span>



<span class="n">sns</span><span class="o">.</span><span class="n">distplot</span><span class="p">(</span>
    <span class="n">non_recurrent_trb_pgen</span> <span class="p">,</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
    <span class="n">kde_kws</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
        <span class="n">bw_adjust</span><span class="o">=</span><span class="mi">4</span>
    <span class="p">),</span>
    <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;#1D2D44&#39;</span>
<span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xbound</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">20</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xbound</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">20</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;TRA Pgen Recurrent vs. Non-Recurrent&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;TRB Pgen Recurrent vs. Non-Recurrent&quot;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;./figures/recurrent_tcr_pgen.pdf&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Mean of recurrent TCRa generation probability:  6.706333637298545 0.0019356917967653917
Mean of non-recurrent TCRa generation probability:  8.440120472258233 0.0026651994166437066
Mean of recurrent TCRb generation probability:  7.974180982311336 0.005120385687269299
Mean of non-recurrent TCRb generation probability:  10.39177493763354 0.002538581120780088
</pre></div>
</div>
<img alt="_images/huARdb_TCR_paper_notebook_89_1.png" src="_images/huARdb_TCR_paper_notebook_89_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>

<span class="n">annotation_expansion_info_groupby_public_ab</span> <span class="o">=</span> <span class="n">annotation_expansion_info</span>
<span class="n">annotation_expansion_info_groupby_public_ab</span><span class="p">[</span><span class="s1">&#39;TRA_Pgen_log&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">annotation_expansion_info_groupby_public_ab</span><span class="p">[</span><span class="s1">&#39;TRA_Pgen&#39;</span><span class="p">])</span>
<span class="n">annotation_expansion_info_groupby_public_ab</span><span class="p">[</span><span class="s1">&#39;TRB_Pgen_log&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">annotation_expansion_info_groupby_public_ab</span><span class="p">[</span><span class="s1">&#39;TRB_Pgen&#39;</span><span class="p">])</span>

<span class="n">data</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
        <span class="nb">zip</span><span class="p">(</span><span class="n">annotation_expansion_info_groupby_public_ab</span><span class="p">[</span>
            <span class="n">annotation_expansion_info_groupby_public_ab</span><span class="p">[</span><span class="s1">&#39;recurrent_tcrs_alpha_beta_n_individuals&#39;</span><span class="p">]</span> <span class="o">==</span>  <span class="mi">0</span>
        <span class="p">][</span><span class="s1">&#39;TRA_Pgen_log&#39;</span><span class="p">],</span>
            <span class="n">annotation_expansion_info_groupby_public_ab</span><span class="p">[</span>
            <span class="n">annotation_expansion_info_groupby_public_ab</span><span class="p">[</span><span class="s1">&#39;recurrent_tcrs_alpha_beta_n_individuals&#39;</span><span class="p">]</span> <span class="o">==</span>  <span class="mi">0</span>
        <span class="p">][</span><span class="s1">&#39;TRB_Pgen_log&#39;</span><span class="p">])</span>
<span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>


<span class="n">sns</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">data</span><span class="p">)),</span>
    <span class="n">y</span><span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">data</span><span class="p">)),</span>
    <span class="n">cmap</span><span class="o">=</span><span class="n">make_colormap</span><span class="p">([</span><span class="s1">&#39;#F7F7F7&#39;</span><span class="p">,</span><span class="s1">&#39;#1D7293&#39;</span><span class="p">]),</span> <span class="n">shade</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">bw_adjust</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="p">)</span>

<span class="n">data</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
        <span class="nb">zip</span><span class="p">(</span><span class="n">annotation_expansion_info_groupby_public_ab</span><span class="p">[</span>
            <span class="n">annotation_expansion_info_groupby_public_ab</span><span class="p">[</span><span class="s1">&#39;recurrent_tcrs_beta_n_individuals&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span>
        <span class="p">][</span><span class="s1">&#39;TRA_Pgen_log&#39;</span><span class="p">],</span>
            <span class="n">annotation_expansion_info_groupby_public_ab</span><span class="p">[</span>
            <span class="n">annotation_expansion_info_groupby_public_ab</span><span class="p">[</span><span class="s1">&#39;recurrent_tcrs_beta_n_individuals&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span>
        <span class="p">][</span><span class="s1">&#39;TRB_Pgen_log&#39;</span><span class="p">])</span>
<span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>

<span class="n">sns</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">data</span><span class="p">)),</span>
    <span class="n">y</span><span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">data</span><span class="p">)),</span>
    <span class="n">cmap</span><span class="o">=</span><span class="n">make_colormap</span><span class="p">([</span><span class="s1">&#39;#F7F7F7&#39;</span><span class="p">,</span><span class="s1">&#39;#1D2D44&#39;</span><span class="p">]),</span> <span class="n">shade</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">bw_adjust</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="p">)</span>


<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xbound</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">15</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xbound</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">15</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ybound</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">20</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ybound</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">20</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;./figures/20230206_recurrent_tcr_alpha_beta_pgen.pdf&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[ 7.83913149 10.29804321]
[7.73053873 7.97428803]
</pre></div>
</div>
<img alt="_images/huARdb_TCR_paper_notebook_90_1.png" src="_images/huARdb_TCR_paper_notebook_90_1.png" />
</div>
</div>
</div>
</div>
<div class="section" id="cdr3mr-length-of-recurrent-tcr">
<h2>CDR3mr length of recurrent TCR<a class="headerlink" href="#cdr3mr-length-of-recurrent-tcr" title="Permalink to this headline">¶</a></h2>
<div class="section" id="figure-4d">
<h3>[Figure 4D]<a class="headerlink" href="#figure-4d" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Length of CDR3a middle region for recurrent TCRa:&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">x</span><span class="p">),</span>
        <span class="n">tcr_df_groupby_public_alpha</span><span class="p">[</span>
            <span class="n">tcr_df_groupby_public_alpha</span><span class="p">[</span><span class="s1">&#39;recurrent_tcrs_alpha_n_individuals&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="p">][</span><span class="s1">&#39;CDR3a_mr_length&#39;</span><span class="p">]</span>
    <span class="p">))),</span><span class="n">sem</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">x</span><span class="p">),</span>
        <span class="n">tcr_df_groupby_public_alpha</span><span class="p">[</span>
            <span class="n">tcr_df_groupby_public_alpha</span><span class="p">[</span><span class="s1">&#39;recurrent_tcrs_alpha_n_individuals&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="p">][</span><span class="s1">&#39;CDR3a_mr_length&#39;</span><span class="p">]</span>
    <span class="p">))))</span>


<span class="n">sns</span><span class="o">.</span><span class="n">distplot</span><span class="p">(</span>
    <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">x</span><span class="p">),</span>
        <span class="n">tcr_df_groupby_public_alpha</span><span class="p">[</span>
            <span class="n">tcr_df_groupby_public_alpha</span><span class="p">[</span><span class="s1">&#39;recurrent_tcrs_alpha_n_individuals&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="p">][</span><span class="s1">&#39;CDR3a_mr_length&#39;</span><span class="p">]</span>
    <span class="p">)),</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
    <span class="n">kde_kws</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
        <span class="n">bw_adjust</span><span class="o">=</span><span class="mi">5</span>
    <span class="p">),</span>    
    <span class="n">bins</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> 
    <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;#1D7293&#39;</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Length of CDR3a middle region for recurrent TCRa:&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">x</span><span class="p">),</span>
        <span class="n">tcr_df_groupby_public_alpha</span><span class="p">[</span>
            <span class="n">tcr_df_groupby_public_alpha</span><span class="p">[</span><span class="s1">&#39;recurrent_tcrs_alpha_n_individuals&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span>
        <span class="p">][</span><span class="s1">&#39;CDR3a_mr_length&#39;</span><span class="p">]</span>
    <span class="p">))),</span><span class="n">sem</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">x</span><span class="p">),</span>
        <span class="n">tcr_df_groupby_public_alpha</span><span class="p">[</span>
            <span class="n">tcr_df_groupby_public_alpha</span><span class="p">[</span><span class="s1">&#39;recurrent_tcrs_alpha_n_individuals&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span>
        <span class="p">][</span><span class="s1">&#39;CDR3a_mr_length&#39;</span><span class="p">]</span>
    <span class="p">))))</span>


<span class="n">sns</span><span class="o">.</span><span class="n">distplot</span><span class="p">(</span>
    <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">x</span><span class="p">),</span>
        <span class="n">tcr_df_groupby_public_alpha</span><span class="p">[</span>
            <span class="n">tcr_df_groupby_public_alpha</span><span class="p">[</span><span class="s1">&#39;recurrent_tcrs_alpha_n_individuals&#39;</span><span class="p">]</span> <span class="o">==</span>  <span class="mi">0</span>
        <span class="p">][</span><span class="s1">&#39;CDR3a_mr_length&#39;</span><span class="p">]</span>
    <span class="p">)),</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
    <span class="n">kde_kws</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
        <span class="n">bw_adjust</span><span class="o">=</span><span class="mi">5</span>
    <span class="p">),</span>    
    <span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
    <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;#1D2D44&#39;</span>
<span class="p">)</span>



<span class="n">tcr_df_groupby_public_beta</span> <span class="o">=</span> <span class="n">tcr_df</span>
<span class="n">tcr_df_groupby_public_beta</span><span class="p">[</span><span class="s1">&#39;TRB_Pgen_log&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">tcr_df_groupby_public_beta</span><span class="p">[</span><span class="s1">&#39;TRB_Pgen&#39;</span><span class="p">])</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Length of CDR3a middle region for recurrent TCRb:&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">x</span><span class="p">),</span>
        <span class="n">tcr_df_groupby_public_beta</span><span class="p">[</span>
            <span class="n">tcr_df_groupby_public_beta</span><span class="p">[</span><span class="s1">&#39;recurrent_tcrs_beta_n_individuals&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="p">][</span><span class="s1">&#39;CDR3b_mr_length&#39;</span><span class="p">]</span>
    <span class="p">))),</span><span class="n">sem</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">x</span><span class="p">),</span>
        <span class="n">tcr_df_groupby_public_beta</span><span class="p">[</span>
            <span class="n">tcr_df_groupby_public_beta</span><span class="p">[</span><span class="s1">&#39;recurrent_tcrs_beta_n_individuals&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="p">][</span><span class="s1">&#39;CDR3b_mr_length&#39;</span><span class="p">]</span>
    <span class="p">))))</span>

<span class="n">sns</span><span class="o">.</span><span class="n">distplot</span><span class="p">(</span>
    <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">x</span><span class="p">),</span>
        <span class="n">tcr_df_groupby_public_beta</span><span class="p">[</span>
            <span class="n">tcr_df_groupby_public_beta</span><span class="p">[</span><span class="s1">&#39;recurrent_tcrs_beta_n_individuals&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="p">][</span><span class="s1">&#39;CDR3b_mr_length&#39;</span><span class="p">]</span>
    <span class="p">)),</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
    <span class="n">kde_kws</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
        <span class="n">bw_adjust</span><span class="o">=</span><span class="mi">5</span>
    <span class="p">),</span>
    <span class="n">bins</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;#1D7293&#39;</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Length of CDR3a middle region for recurrent TCRb:&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">x</span><span class="p">),</span>
        <span class="n">tcr_df_groupby_public_beta</span><span class="p">[</span>
            <span class="n">tcr_df_groupby_public_beta</span><span class="p">[</span><span class="s1">&#39;recurrent_tcrs_beta_n_individuals&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span>
        <span class="p">][</span><span class="s1">&#39;CDR3b_mr_length&#39;</span><span class="p">]</span>
    <span class="p">))),</span><span class="n">sem</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">x</span><span class="p">),</span>
        <span class="n">tcr_df_groupby_public_beta</span><span class="p">[</span>
            <span class="n">tcr_df_groupby_public_beta</span><span class="p">[</span><span class="s1">&#39;recurrent_tcrs_beta_n_individuals&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span>
        <span class="p">][</span><span class="s1">&#39;CDR3b_mr_length&#39;</span><span class="p">]</span>
    <span class="p">))))</span>

<span class="n">sns</span><span class="o">.</span><span class="n">distplot</span><span class="p">(</span>
    <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">x</span><span class="p">),</span>
        <span class="n">tcr_df_groupby_public_beta</span><span class="p">[</span>
            <span class="n">tcr_df_groupby_public_beta</span><span class="p">[</span><span class="s1">&#39;recurrent_tcrs_beta_n_individuals&#39;</span><span class="p">]</span> <span class="o">==</span>  <span class="mi">0</span>
        <span class="p">][</span><span class="s1">&#39;CDR3b_mr_length&#39;</span><span class="p">]</span>
    <span class="p">)),</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
    <span class="n">kde_kws</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
        <span class="n">bw_adjust</span><span class="o">=</span><span class="mi">5</span>
    <span class="p">),</span>
    <span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
    <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;#1D2D44&#39;</span>
<span class="p">)</span>


<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xbound</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xbound</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">14</span><span class="p">)</span>
<span class="c1"># ax[0].set_ybound(0,1)</span>
<span class="c1"># ax[1].set_ybound(0,1)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;./figures/recurrent_tcr_length.pdf&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Length of CDR3a middle region for recurrent TCRa: 2.1790108564535586 0.003444970368430246
Length of CDR3a middle region for recurrent TCRa: 3.2408637793836057 0.0027675702171859034
Length of CDR3a middle region for recurrent TCRb: 3.6766982622432858 0.00815894376225061
Length of CDR3a middle region for recurrent TCRb: 5.537238986154116 0.0021453443405695955
</pre></div>
</div>
<img alt="_images/huARdb_TCR_paper_notebook_93_1.png" src="_images/huARdb_TCR_paper_notebook_93_1.png" />
</div>
</div>
</div>
</div>
<div class="section" id="disease-specificity-analysis-of-recurrent-tcr">
<h2>Disease specificity analysis of recurrent TCR<a class="headerlink" href="#disease-specificity-analysis-of-recurrent-tcr" title="Permalink to this headline">¶</a></h2>
<div class="section" id="figure-4e-g">
<h3>[Figure 4E-G]<a class="headerlink" href="#figure-4e-g" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">m</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Basal cell carinoma tumor&#39;</span><span class="p">:</span> <span class="s1">&#39;Solid tumor&#39;</span><span class="p">,</span>
 <span class="s1">&#39;Large granular lymphocyte leukemia&#39;</span><span class="p">:</span> <span class="s1">&#39;T-LGLL&#39;</span><span class="p">,</span>
 <span class="s1">&#39;Nasopharyngeal carcinoma&#39;</span><span class="p">:</span> <span class="s1">&#39;Solid tumor&#39;</span><span class="p">,</span>
 <span class="s1">&#39;Healthy&#39;</span><span class="p">:</span> <span class="s1">&#39;Healthy&#39;</span><span class="p">,</span>
 <span class="s1">&#39;Clear cell renal cell carcinoma&#39;</span><span class="p">:</span> <span class="s1">&#39;Solid tumor&#39;</span><span class="p">,</span>
 <span class="s1">&#39;Esophagus squamous cell carcinoma&#39;</span><span class="p">:</span> <span class="s1">&#39;Solid tumor&#39;</span><span class="p">,</span>
 <span class="s1">&#39;CPI-colitis&#39;</span><span class="p">:</span> <span class="s1">&#39;CPI-irAE&#39;</span><span class="p">,</span>
 <span class="s1">&#39;COVID-19&#39;</span><span class="p">:</span> <span class="s1">&#39;COVID-19&#39;</span><span class="p">,</span>
 <span class="s1">&#39;AML&#39;</span><span class="p">:</span> <span class="s1">&#39;AML&#39;</span><span class="p">,</span>
 <span class="s1">&#39;Ulcerative colitis&#39;</span><span class="p">:</span> <span class="s1">&#39;Inflammation&#39;</span><span class="p">,</span>
 <span class="s1">&#39;Kawasaki disease&#39;</span><span class="p">:</span> <span class="s1">&#39;Inflammation&#39;</span><span class="p">,</span>
 <span class="s1">&#39;Melanoma&#39;</span><span class="p">:</span> <span class="s1">&#39;Solid tumor&#39;</span><span class="p">,</span>
 <span class="s1">&#39;Breast cancer&#39;</span><span class="p">:</span> <span class="s1">&#39;Solid tumor&#39;</span><span class="p">,</span>
 <span class="s1">&#39;Squamous cell carcinoma tumor&#39;</span><span class="p">:</span> <span class="s1">&#39;Solid tumor&#39;</span><span class="p">,</span>
 <span class="s1">&#39;Psoriatic arthritis&#39;</span><span class="p">:</span> <span class="s1">&#39;Inflammation&#39;</span><span class="p">,</span>
 <span class="s1">&#39;Arthritis&#39;</span><span class="p">:</span> <span class="s1">&#39;CPI-irAE&#39;</span><span class="p">,</span>
 <span class="s1">&#39;Ankylosing spondylitis&#39;</span><span class="p">:</span> <span class="s1">&#39;Inflammation&#39;</span><span class="p">,</span>
 <span class="s1">&#39;Metastatic colorectal cancer&#39;</span><span class="p">:</span> <span class="s1">&#39;Solid tumor&#39;</span><span class="p">,</span>
 <span class="s1">&#39;Chronic pancreatitis&#39;</span><span class="p">:</span> <span class="s1">&#39;Inflammation&#39;</span><span class="p">,</span>
 <span class="s1">&#39;MIS-C&#39;</span><span class="p">:</span> <span class="s1">&#39;COVID-19&#39;</span><span class="p">}</span>
<span class="n">tcr_df</span><span class="p">[</span><span class="s1">&#39;disease_type_1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">get</span><span class="p">,</span> <span class="n">tcr_df</span><span class="p">[</span><span class="s1">&#39;disease&#39;</span><span class="p">]))</span>
<span class="n">m</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Basal cell carinoma tumor&#39;</span><span class="p">:</span> <span class="s1">&#39;Solid tumor&#39;</span><span class="p">,</span>
 <span class="s1">&#39;Large granular lymphocyte leukemia&#39;</span><span class="p">:</span> <span class="s1">&#39;T-LGLL&#39;</span><span class="p">,</span>
 <span class="s1">&#39;Nasopharyngeal carcinoma&#39;</span><span class="p">:</span> <span class="s1">&#39;Solid tumor&#39;</span><span class="p">,</span>
 <span class="s1">&#39;Healthy&#39;</span><span class="p">:</span> <span class="s1">&#39;Healthy&#39;</span><span class="p">,</span>
 <span class="s1">&#39;Clear cell renal cell carcinoma&#39;</span><span class="p">:</span> <span class="s1">&#39;Solid tumor&#39;</span><span class="p">,</span>
 <span class="s1">&#39;Esophagus squamous cell carcinoma&#39;</span><span class="p">:</span> <span class="s1">&#39;Solid tumor&#39;</span><span class="p">,</span>
 <span class="s1">&#39;CPI-colitis&#39;</span><span class="p">:</span> <span class="s1">&#39;Colitis&#39;</span><span class="p">,</span>
 <span class="s1">&#39;COVID-19&#39;</span><span class="p">:</span> <span class="s1">&#39;COVID-19&#39;</span><span class="p">,</span>
 <span class="s1">&#39;AML&#39;</span><span class="p">:</span> <span class="s1">&#39;AML&#39;</span><span class="p">,</span>
 <span class="s1">&#39;Ulcerative colitis&#39;</span><span class="p">:</span> <span class="s1">&#39;Colitis&#39;</span><span class="p">,</span>
 <span class="s1">&#39;Kawasaki disease&#39;</span><span class="p">:</span> <span class="s1">&#39;Kawasaki disease&#39;</span><span class="p">,</span>
 <span class="s1">&#39;Melanoma&#39;</span><span class="p">:</span> <span class="s1">&#39;Solid tumor&#39;</span><span class="p">,</span>
 <span class="s1">&#39;Breast cancer&#39;</span><span class="p">:</span> <span class="s1">&#39;Solid tumor&#39;</span><span class="p">,</span>
 <span class="s1">&#39;Squamous cell carcinoma tumor&#39;</span><span class="p">:</span> <span class="s1">&#39;Solid tumor&#39;</span><span class="p">,</span>
 <span class="s1">&#39;Psoriatic arthritis&#39;</span><span class="p">:</span> <span class="s1">&#39;Arthritis&#39;</span><span class="p">,</span>
 <span class="s1">&#39;Arthritis&#39;</span><span class="p">:</span> <span class="s1">&#39;Arthritis&#39;</span><span class="p">,</span>
 <span class="s1">&#39;Ankylosing spondylitis&#39;</span><span class="p">:</span> <span class="s1">&#39;Ankylosing spondylitis&#39;</span><span class="p">,</span>
 <span class="s1">&#39;Metastatic colorectal cancer&#39;</span><span class="p">:</span> <span class="s1">&#39;Solid tumor&#39;</span><span class="p">,</span>
 <span class="s1">&#39;Chronic pancreatitis&#39;</span><span class="p">:</span> <span class="s1">&#39;Chronic pancreatitis&#39;</span><span class="p">,</span>
 <span class="s1">&#39;MIS-C&#39;</span><span class="p">:</span> <span class="s1">&#39;COVID-19&#39;</span><span class="p">}</span>
<span class="n">tcr_df</span><span class="p">[</span><span class="s1">&#39;disease_type_2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">get</span><span class="p">,</span> <span class="n">tcr_df</span><span class="p">[</span><span class="s1">&#39;disease&#39;</span><span class="p">]))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">disease_label</span> <span class="o">=</span> <span class="s1">&#39;disease_type_1&#39;</span>
<span class="kn">from</span> <span class="nn">upsetplot</span> <span class="kn">import</span> <span class="n">from_memberships</span>
<span class="kn">import</span> <span class="nn">upsetplot</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">combinations</span>
<span class="n">all_diseases</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">tcr_df</span><span class="p">[</span><span class="n">disease_label</span><span class="p">]))</span>
<span class="n">tcr_df</span><span class="p">[</span><span class="s1">&#39;tcr_no_individual&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s1">&#39;-&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> 
     <span class="n">tcr_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="n">TRAB_DEFINITION</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
<span class="p">))</span>
<span class="n">_tmp_df</span> <span class="o">=</span> <span class="n">tcr_df</span><span class="p">[</span>
    <span class="n">tcr_df</span><span class="p">[</span><span class="s1">&#39;recurrent_tcrs_alpha_beta_n_individuals&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span>
<span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;tcr_no_individual&#39;</span><span class="p">,</span><span class="s1">&#39;recurrent_tcrs_alpha_beta_n_individuals&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span>
    <span class="n">disease_label</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="s1">&#39;count&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">,</span> <span class="s1">&#39;individual&#39;</span><span class="p">:</span> <span class="nb">list</span>
<span class="p">})</span>
<span class="n">_tmp_df</span> <span class="o">=</span> <span class="n">_tmp_df</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">,</span> <span class="n">_tmp_df</span><span class="p">[</span><span class="n">disease_label</span><span class="p">]))]</span>
<span class="n">_agg</span> <span class="o">=</span> <span class="n">pandas_aggregation_to_wide</span><span class="p">(</span>
    <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span>
            <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">_tmp_df</span><span class="o">.</span><span class="n">index</span><span class="p">)),</span> 
            <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">x</span><span class="p">)),</span> 
            <span class="n">_tmp_df</span><span class="p">[</span><span class="n">disease_label</span><span class="p">])),</span> 
            <span class="n">_tmp_df</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]</span>
        <span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;recurrent_tcrs_alpha_beta_n_individuals&#39;</span><span class="p">,</span><span class="n">disease_label</span><span class="p">,</span><span class="s1">&#39;count&#39;</span><span class="p">]</span>
    <span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span>
    <span class="p">[</span><span class="n">disease_label</span><span class="p">]</span>
<span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span>
    <span class="s2">&quot;count&quot;</span><span class="p">:</span><span class="nb">sum</span>
<span class="p">}))</span>

<span class="c1"># _agg = _agg[_agg[&#39;recurrent_tcrs_alpha_beta_n_individuals&#39;] &gt; 1]</span>

<span class="n">upset_df</span> <span class="o">=</span> <span class="n">from_memberships</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">),</span> <span class="n">_agg</span><span class="p">[</span><span class="n">disease_label</span><span class="p">])),</span><span class="n">data</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">_agg</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]))</span>

<span class="n">upset</span> <span class="o">=</span> <span class="n">upsetplot</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">upset_df</span> 
<span class="p">)</span>
<span class="n">upset</span><span class="p">[</span><span class="s1">&#39;intersections&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
<span class="n">_tmp_df</span> <span class="o">=</span> <span class="n">pandas_aggregation_to_wide</span><span class="p">(</span><span class="n">_tmp_df</span><span class="p">)</span>
<span class="n">d</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span>
    <span class="n">_agg</span><span class="p">[</span><span class="n">disease_label</span><span class="p">],</span> 
    <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_diseases</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint32</span><span class="p">)),</span> <span class="n">_agg</span><span class="p">[</span><span class="n">disease_label</span><span class="p">]))</span>
<span class="p">))</span>
<span class="k">for</span> <span class="n">dt</span> <span class="ow">in</span> <span class="n">_tmp_df</span><span class="p">[</span><span class="n">_tmp_df</span><span class="p">[</span><span class="s1">&#39;recurrent_tcrs_alpha_beta_n_individuals&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">][</span><span class="n">disease_label</span><span class="p">]:</span>
    <span class="n">k</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">dt</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">dt</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">d</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">all_diseases</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">t</span><span class="p">)]</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="n">_tmp</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">upset_df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">names</span><span class="p">)):</span>
    <span class="n">_tmp</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">upset_df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">upset_df</span><span class="p">[</span>
        <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">,</span> <span class="n">upset_df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()))</span>
    <span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()))</span>
<span class="n">names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">z</span> <span class="p">:</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">,</span><span class="nb">sorted</span><span class="p">(</span><span class="n">_tmp</span><span class="p">,</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])))))</span>
<span class="n">_names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">,</span><span class="nb">sorted</span><span class="p">(</span><span class="n">_tmp</span><span class="p">,</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])))</span>
<span class="n">indices</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">names</span><span class="p">)</span>
<span class="n">indices</span> <span class="o">+=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">z</span><span class="p">:</span> <span class="n">z</span><span class="p">,</span> <span class="nb">map</span><span class="p">(</span>
    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">z</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">z</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">))))</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">z</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)),</span> <span class="n">d</span><span class="o">.</span><span class="n">keys</span><span class="p">()))[</span><span class="mi">0</span><span class="p">]</span> 
    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">z</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">z</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">))))</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">z</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)),</span> <span class="n">d</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
    <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">FLATTEN</span><span class="p">([</span>
        <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">combinations</span><span class="p">(</span><span class="n">_names</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">q</span><span class="p">)),</span>
           <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">[</span><span class="n">_names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">z</span><span class="p">)</span> <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">x</span><span class="p">]</span>
    <span class="p">)</span> <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">7</span><span class="p">)</span>
    <span class="p">])</span>
<span class="p">)))</span>
<span class="c1"># print(indices)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">all_diseases</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
   <span class="n">indices</span>
<span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">,</span><span class="n">stacked</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">disease_type_palette</span><span class="p">[</span><span class="n">x</span><span class="p">],</span><span class="n">all_diseases</span><span class="p">)),</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">upset</span><span class="p">[</span><span class="s1">&#39;intersections&#39;</span><span class="p">]</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;./figures/recurrent_tcr_alpha_beta_disease_type.pdf&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/var/folders/lw/6xch0fpj02j61gwkgwfbv2940000gn/T/ipykernel_79467/603918421.py:67: DeprecationWarning: `np.int` is a deprecated alias for the builtin `int`. To silence this warning, use `int` by itself. Doing this will not modify any behavior and is safe. When replacing `np.int`, you may wish to use e.g. `np.int64` or `np.int32` to specify the precision. If you wish to review your current use, check the release note link for additional information.
Deprecated in NumPy 1.20; for more details and guidance: https://numpy.org/devdocs/release/1.20.0-notes.html#deprecations
  ].astype(np.int).plot(
</pre></div>
</div>
<img alt="_images/huARdb_TCR_paper_notebook_97_1.png" src="_images/huARdb_TCR_paper_notebook_97_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">upsetplot</span> <span class="kn">import</span> <span class="n">from_memberships</span>
<span class="kn">import</span> <span class="nn">upsetplot</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">combinations</span>
<span class="n">disease_label</span> <span class="o">=</span> <span class="s1">&#39;disease_type_1&#39;</span>
<span class="n">all_diseases</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">tcr_df</span><span class="p">[</span><span class="n">disease_label</span><span class="p">]))</span>
<span class="n">tcr_df</span><span class="p">[</span><span class="s1">&#39;tcr_no_individual&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s1">&#39;-&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> 
     <span class="n">tcr_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="n">TRB_DEFINITION</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
<span class="p">))</span>
<span class="n">_tmp_df</span> <span class="o">=</span> <span class="n">tcr_df</span><span class="p">[</span>
    <span class="n">tcr_df</span><span class="p">[</span><span class="s1">&#39;recurrent_tcrs_beta_n_individuals&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span>
<span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;tcr_no_individual&#39;</span><span class="p">,</span><span class="s1">&#39;recurrent_tcrs_beta_n_individuals&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span>
    <span class="n">disease_label</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="s1">&#39;count&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">,</span> <span class="s1">&#39;individual&#39;</span><span class="p">:</span> <span class="nb">list</span>
<span class="p">})</span>
<span class="n">_tmp_df</span> <span class="o">=</span> <span class="n">_tmp_df</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">,</span> <span class="n">_tmp_df</span><span class="p">[</span><span class="n">disease_label</span><span class="p">]))]</span>
<span class="n">_agg</span> <span class="o">=</span> <span class="n">pandas_aggregation_to_wide</span><span class="p">(</span>
    <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span>
            <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">_tmp_df</span><span class="o">.</span><span class="n">index</span><span class="p">)),</span> 
            <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">x</span><span class="p">)),</span> 
            <span class="n">_tmp_df</span><span class="p">[</span><span class="n">disease_label</span><span class="p">])),</span> 
            <span class="n">_tmp_df</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]</span>
        <span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;recurrent_tcrs_beta_n_individuals&#39;</span><span class="p">,</span><span class="n">disease_label</span><span class="p">,</span><span class="s1">&#39;count&#39;</span><span class="p">]</span>
    <span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span>
    <span class="p">[</span><span class="n">disease_label</span><span class="p">]</span>
<span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span>
    <span class="s2">&quot;count&quot;</span><span class="p">:</span><span class="nb">sum</span>
<span class="p">}))</span>

<span class="c1"># _agg = _agg[_agg[&#39;recurrent_tcrs_beta_n_individuals&#39;] &gt; 1]</span>

<span class="n">upset_df</span> <span class="o">=</span> <span class="n">from_memberships</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">),</span> <span class="n">_agg</span><span class="p">[</span><span class="n">disease_label</span><span class="p">])),</span><span class="n">data</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">_agg</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]))</span>

<span class="n">upset</span> <span class="o">=</span> <span class="n">upsetplot</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">upset_df</span> 
<span class="p">)</span>
<span class="n">upset</span><span class="p">[</span><span class="s1">&#39;intersections&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
<span class="n">_tmp_df</span> <span class="o">=</span> <span class="n">pandas_aggregation_to_wide</span><span class="p">(</span><span class="n">_tmp_df</span><span class="p">)</span>
<span class="n">d</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span>
    <span class="n">_agg</span><span class="p">[</span><span class="n">disease_label</span><span class="p">],</span> 
    <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_diseases</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint32</span><span class="p">)),</span> <span class="n">_agg</span><span class="p">[</span><span class="s1">&#39;disease_type_1&#39;</span><span class="p">]))</span>
<span class="p">))</span>
<span class="k">for</span> <span class="n">dt</span> <span class="ow">in</span> <span class="n">_tmp_df</span><span class="p">[</span><span class="n">_tmp_df</span><span class="p">[</span><span class="s1">&#39;recurrent_tcrs_beta_n_individuals&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">][</span><span class="s1">&#39;disease_type_1&#39;</span><span class="p">]:</span>
    <span class="n">k</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">dt</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">dt</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">d</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">all_diseases</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">t</span><span class="p">)]</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="n">_tmp</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">upset_df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">names</span><span class="p">)):</span>
    <span class="n">_tmp</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">upset_df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">upset_df</span><span class="p">[</span>
        <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">,</span> <span class="n">upset_df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()))</span>
    <span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()))</span>
<span class="n">names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">z</span> <span class="p">:</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">,</span><span class="nb">sorted</span><span class="p">(</span><span class="n">_tmp</span><span class="p">,</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])))))</span>
<span class="n">_names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">,</span><span class="nb">sorted</span><span class="p">(</span><span class="n">_tmp</span><span class="p">,</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])))</span>
<span class="n">indices</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">names</span><span class="p">)</span>
<span class="n">indices</span> <span class="o">+=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">z</span><span class="p">:</span> <span class="n">z</span><span class="p">,</span> <span class="nb">map</span><span class="p">(</span>
    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">z</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">z</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">))))</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">z</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)),</span> <span class="n">d</span><span class="o">.</span><span class="n">keys</span><span class="p">()))[</span><span class="mi">0</span><span class="p">]</span> 
    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">z</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">z</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">))))</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">z</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)),</span> <span class="n">d</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
    <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">FLATTEN</span><span class="p">([</span>
        <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">combinations</span><span class="p">(</span><span class="n">_names</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">q</span><span class="p">)),</span>
           <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">[</span><span class="n">_names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">z</span><span class="p">)</span> <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">x</span><span class="p">]</span>
    <span class="p">)</span> <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">7</span><span class="p">)</span>
    <span class="p">])</span>
<span class="p">)))</span>
<span class="c1"># print(indices)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">all_diseases</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
   <span class="n">indices</span>
<span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">,</span><span class="n">stacked</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">disease_type_palette</span><span class="p">[</span><span class="n">x</span><span class="p">],</span><span class="n">all_diseases</span><span class="p">)),</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">upset</span><span class="p">[</span><span class="s1">&#39;intersections&#39;</span><span class="p">]</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;./figures/recurrent_tcr_beta_disease.pdf&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/var/folders/lw/6xch0fpj02j61gwkgwfbv2940000gn/T/ipykernel_79467/3432817495.py:67: DeprecationWarning: `np.int` is a deprecated alias for the builtin `int`. To silence this warning, use `int` by itself. Doing this will not modify any behavior and is safe. When replacing `np.int`, you may wish to use e.g. `np.int64` or `np.int32` to specify the precision. If you wish to review your current use, check the release note link for additional information.
Deprecated in NumPy 1.20; for more details and guidance: https://numpy.org/devdocs/release/1.20.0-notes.html#deprecations
  ].astype(np.int).plot(
</pre></div>
</div>
<img alt="_images/huARdb_TCR_paper_notebook_98_1.png" src="_images/huARdb_TCR_paper_notebook_98_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">upsetplot</span> <span class="kn">import</span> <span class="n">from_memberships</span>
<span class="kn">import</span> <span class="nn">upsetplot</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">combinations</span>
<span class="n">all_diseases</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">tcr_df</span><span class="p">[</span><span class="s1">&#39;disease_type_1&#39;</span><span class="p">]))</span>
<span class="n">tcr_df</span><span class="p">[</span><span class="s1">&#39;tcr_no_individual&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s1">&#39;-&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> 
     <span class="n">tcr_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="n">TRA_DEFINITION</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
<span class="p">))</span>
<span class="n">_tmp_df</span> <span class="o">=</span> <span class="n">tcr_df</span><span class="p">[</span>
    <span class="n">tcr_df</span><span class="p">[</span><span class="s1">&#39;recurrent_tcrs_alpha_n_individuals&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span>
<span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;tcr_no_individual&#39;</span><span class="p">,</span><span class="s1">&#39;recurrent_tcrs_alpha_n_individuals&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span>
    <span class="s2">&quot;disease_type_1&quot;</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="s1">&#39;count&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">,</span> <span class="s1">&#39;individual&#39;</span><span class="p">:</span> <span class="nb">list</span>
<span class="p">})</span>
<span class="n">_agg</span> <span class="o">=</span> <span class="n">pandas_aggregation_to_wide</span><span class="p">(</span>
    <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span>
            <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">_tmp_df</span><span class="o">.</span><span class="n">index</span><span class="p">)),</span> 
            <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">x</span><span class="p">)),</span> 
            <span class="n">_tmp_df</span><span class="p">[</span><span class="s1">&#39;disease_type_1&#39;</span><span class="p">])),</span> 
            <span class="n">_tmp_df</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]</span>
        <span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;recurrent_tcrs_alpha_n_individuals&#39;</span><span class="p">,</span><span class="s1">&#39;disease_type_1&#39;</span><span class="p">,</span><span class="s1">&#39;count&#39;</span><span class="p">]</span>
    <span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span>
    <span class="p">[</span><span class="s1">&#39;disease_type_1&#39;</span><span class="p">]</span>
<span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span>
    <span class="s2">&quot;count&quot;</span><span class="p">:</span><span class="nb">sum</span>
<span class="p">}))</span>

<span class="c1"># _agg = _agg[_agg[&#39;recurrent_tcrs_alpha_n_individuals&#39;] &gt; 1]</span>

<span class="n">upset_df</span> <span class="o">=</span> <span class="n">from_memberships</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">),</span> <span class="n">_agg</span><span class="p">[</span><span class="s1">&#39;disease_type_1&#39;</span><span class="p">])),</span><span class="n">data</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">_agg</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]))</span>

<span class="n">upset</span> <span class="o">=</span> <span class="n">upsetplot</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">upset_df</span> 
<span class="p">)</span>
<span class="n">upset</span><span class="p">[</span><span class="s1">&#39;intersections&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
<span class="n">_tmp_df</span> <span class="o">=</span> <span class="n">pandas_aggregation_to_wide</span><span class="p">(</span><span class="n">_tmp_df</span><span class="p">)</span>
<span class="n">d</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span>
    <span class="n">_agg</span><span class="p">[</span><span class="s1">&#39;disease_type_1&#39;</span><span class="p">],</span> 
    <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_diseases</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint32</span><span class="p">)),</span> <span class="n">_agg</span><span class="p">[</span><span class="s1">&#39;disease_type_1&#39;</span><span class="p">]))</span>
<span class="p">))</span>
<span class="k">for</span> <span class="n">dt</span> <span class="ow">in</span> <span class="n">_tmp_df</span><span class="p">[</span><span class="n">_tmp_df</span><span class="p">[</span><span class="s1">&#39;recurrent_tcrs_alpha_n_individuals&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">][</span><span class="s1">&#39;disease_type_1&#39;</span><span class="p">]:</span>
    <span class="n">k</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">dt</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">dt</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">d</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">all_diseases</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">t</span><span class="p">)]</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="n">_tmp</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">upset_df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">names</span><span class="p">)):</span>
    <span class="n">_tmp</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">upset_df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">upset_df</span><span class="p">[</span>
        <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">,</span> <span class="n">upset_df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()))</span>
    <span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()))</span>
<span class="n">names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">z</span> <span class="p">:</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">,</span><span class="nb">sorted</span><span class="p">(</span><span class="n">_tmp</span><span class="p">,</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])))))</span>
<span class="n">_names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">,</span><span class="nb">sorted</span><span class="p">(</span><span class="n">_tmp</span><span class="p">,</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])))</span>
<span class="n">indices</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">names</span><span class="p">)</span>
<span class="n">indices</span> <span class="o">+=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">z</span><span class="p">:</span> <span class="n">z</span><span class="p">,</span> <span class="nb">map</span><span class="p">(</span>
    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">z</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">z</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">))))</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">z</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)),</span> <span class="n">d</span><span class="o">.</span><span class="n">keys</span><span class="p">()))[</span><span class="mi">0</span><span class="p">]</span> 
    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">z</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">z</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">))))</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">z</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)),</span> <span class="n">d</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
    <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">FLATTEN</span><span class="p">([</span>
        <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">combinations</span><span class="p">(</span><span class="n">_names</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">q</span><span class="p">)),</span>
           <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">[</span><span class="n">_names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">z</span><span class="p">)</span> <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">x</span><span class="p">]</span>
    <span class="p">)</span> <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">7</span><span class="p">)</span>
    <span class="p">])</span>
<span class="p">)))</span>
<span class="c1"># print(indices)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">all_diseases</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
   <span class="n">indices</span>
<span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">,</span><span class="n">stacked</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">disease_type_palette</span><span class="p">[</span><span class="n">x</span><span class="p">],</span><span class="n">all_diseases</span><span class="p">)),</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">upset</span><span class="p">[</span><span class="s1">&#39;intersections&#39;</span><span class="p">]</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;./figures/recurrent_tcr_alpha_disease.pdf&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/var/folders/lw/6xch0fpj02j61gwkgwfbv2940000gn/T/ipykernel_79467/1957927074.py:65: DeprecationWarning: `np.int` is a deprecated alias for the builtin `int`. To silence this warning, use `int` by itself. Doing this will not modify any behavior and is safe. When replacing `np.int`, you may wish to use e.g. `np.int64` or `np.int32` to specify the precision. If you wish to review your current use, check the release note link for additional information.
Deprecated in NumPy 1.20; for more details and guidance: https://numpy.org/devdocs/release/1.20.0-notes.html#deprecations
  ].astype(np.int).plot(
</pre></div>
</div>
<img alt="_images/huARdb_TCR_paper_notebook_99_1.png" src="_images/huARdb_TCR_paper_notebook_99_1.png" />
</div>
</div>
</div>
</div>
</div>
<div class="tex2jax_ignore mathjax_ignore section" id="tcr-coherence-analysis">
<h1>TCR Coherence analysis<a class="headerlink" href="#tcr-coherence-analysis" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pickle</span>
<span class="n">mismatch_pairing</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;CD8&#39;</span><span class="p">,</span><span class="s1">&#39;CD4&#39;</span><span class="p">,</span><span class="s1">&#39;Treg&#39;</span><span class="p">,</span><span class="s1">&#39;Naive_CD8&#39;</span><span class="p">,</span><span class="s1">&#39;Naive_CD4&#39;</span><span class="p">]:</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;./data/20230201_mismatch_pairing_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">.pkl&quot;</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">mismatch_pairing</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/var/folders/lw/6xch0fpj02j61gwkgwfbv2940000gn/T/ipykernel_88454/3900167238.py:5: DeprecationWarning: Please use `csr_matrix` from the `scipy.sparse` namespace, the `scipy.sparse.csr` namespace is deprecated.
  mismatch_pairing[i] = pickle.load(f)
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;\nfor i in [\&#39;CD8\&#39;,\&#39;CD4\&#39;,\&#39;Treg\&#39;,\&#39;Naive_CD8\&#39;,\&#39;Naive_CD4\&#39;]:\n    with open(f&quot;./data/20230215_mismatch_pairing_{i}_statistics_3.pkl&quot;, &quot;rb&quot;) as f:\n        mismatch_pairing[i][\&#39;statistics\&#39;] = pickle.load(f)\n&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">entropy</span><span class="p">,</span> <span class="n">sem</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">cache</span>
<span class="n">palette</span> <span class="o">=</span> <span class="n">reannotated_prediction_palette</span>
<span class="k">for</span> <span class="n">n_pairing</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">6</span><span class="p">):</span>
    <span class="nd">@cache</span>
    <span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">m</span><span class="p">):</span>
        <span class="n">X</span> <span class="o">=</span> <span class="n">mismatch_pairing</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;beta_alpha_mismatched_pairing&#39;</span><span class="p">][</span><span class="n">m</span><span class="p">]</span>
        <span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">X</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">flatten</span><span class="p">()]</span>
        <span class="n">tmp_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">X</span><span class="p">)))</span>
        <span class="n">tmp_df</span><span class="p">[</span><span class="s1">&#39;index&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tmp_df</span><span class="p">))</span>
        <span class="n">tmp_agg</span> <span class="o">=</span> <span class="n">tmp_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">x</span><span class="p">)[</span><span class="mi">0</span><span class="p">]})</span>
        <span class="n">tmp_agg</span><span class="p">[</span><span class="s1">&#39;n_pairing&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">))</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">tmp_agg</span><span class="o">.</span><span class="n">index</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">tmp_agg</span><span class="p">[</span><span class="n">tmp_agg</span><span class="p">[</span><span class="s1">&#39;n_pairing&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">n_pairing</span><span class="p">][</span><span class="s1">&#39;index&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

    <span class="n">entropy_mean_arr</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([[</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mismatch_pairing</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;statistics&#39;</span><span class="p">][</span><span class="s1">&#39;beta_alpha_coherence&#39;</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="s1">&#39;entropys&#39;</span><span class="p">])[</span><span class="n">func</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">m</span><span class="p">)]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">mismatch_pairing</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">)],</span> <span class="n">columns</span><span class="o">=</span><span class="n">mismatch_pairing</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="n">entropy_err_arr</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([[</span><span class="n">sem</span><span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mismatch_pairing</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;statistics&#39;</span><span class="p">][</span><span class="s1">&#39;beta_alpha_coherence&#39;</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="s1">&#39;entropys&#39;</span><span class="p">])[</span><span class="n">func</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">m</span><span class="p">)]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">mismatch_pairing</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">)],</span> <span class="n">columns</span><span class="o">=</span><span class="n">mismatch_pairing</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>


    <span class="n">percentage_mean_arr</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([[</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mismatch_pairing</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;statistics&#39;</span><span class="p">][</span><span class="s1">&#39;beta_alpha_coherence&#39;</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="s1">&#39;max_count_percentages&#39;</span><span class="p">])[</span><span class="n">func</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">m</span><span class="p">)]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">mismatch_pairing</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">)],</span> <span class="n">columns</span><span class="o">=</span><span class="n">mismatch_pairing</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="n">percentage_err_arr</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([[</span><span class="n">sem</span><span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mismatch_pairing</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;statistics&#39;</span><span class="p">][</span><span class="s1">&#39;beta_alpha_coherence&#39;</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="s1">&#39;max_count_percentages&#39;</span><span class="p">])[</span><span class="n">func</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">m</span><span class="p">)]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">mismatch_pairing</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">)],</span> <span class="n">columns</span><span class="o">=</span><span class="n">mismatch_pairing</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

    <span class="n">percentage_mean_arr</span> <span class="o">=</span> <span class="n">percentage_mean_arr</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">percentage_err_arr</span> <span class="o">=</span> <span class="n">percentage_err_arr</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">entropy_mean_arr</span> <span class="o">=</span> <span class="n">entropy_mean_arr</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">entropy_err_arr</span> <span class="o">=</span> <span class="n">entropy_err_arr</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    
    <span class="n">fig</span><span class="p">,</span><span class="n">axes</span><span class="o">=</span><span class="n">createSubplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">palette</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span> 
        <span class="n">j</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">percentage_mean_arr</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span>
                <span class="n">x</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span>
                <span class="n">y</span><span class="o">=</span><span class="n">percentage_mean_arr</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> 
                <span class="n">yerr</span><span class="o">=</span><span class="n">percentage_err_arr</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> 
                <span class="n">color</span><span class="o">=</span><span class="n">palette</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
                <span class="n">x</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span>
                <span class="n">y</span><span class="o">=</span><span class="n">percentage_mean_arr</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span>
                <span class="n">c</span><span class="o">=</span><span class="n">palette</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="p">)</span>
    <span class="c1"># fig.savefig(&quot;/Users/snow/Desktop/20220214_beta_alpha_coherence.pdf&quot;)</span>
    <span class="c1"># mean_arr.to_csv(&quot;/Users/snow/Desktop/2023-TCR-huARdb-Analysis-Paper-Figures/Data/Notebook/data/20220214_beta_alpha_coherence_entropy_mean.csv&quot;)</span>


    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">palette</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span> 
        <span class="n">j</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">entropy_mean_arr</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span>
                <span class="n">x</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span>
                <span class="n">y</span><span class="o">=</span><span class="n">entropy_mean_arr</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> 
                <span class="n">yerr</span><span class="o">=</span><span class="n">entropy_err_arr</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> 
                <span class="n">color</span><span class="o">=</span><span class="n">palette</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
                <span class="n">x</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span>
                <span class="n">y</span><span class="o">=</span><span class="n">entropy_mean_arr</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span>
                <span class="n">c</span><span class="o">=</span><span class="n">palette</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;./data/20220214_mismatched_pairing/20220214_beta_alpha_coherence_n_pairing_</span><span class="si">{</span><span class="n">n_pairing</span><span class="si">}</span><span class="s2">.pdf&quot;</span><span class="p">)</span>
    <span class="n">percentage_mean_arr</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;./data/20220214_mismatched_pairing/20220214_beta_alpha_coherence_percentage_mean_n_pairing_</span><span class="si">{</span><span class="n">n_pairing</span><span class="si">}</span><span class="s2">.csv&quot;</span><span class="p">)</span>
    <span class="n">percentage_err_arr</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;./data/20220214_mismatched_pairing/20220214_beta_alpha_coherence_percentage_err_n_pairing_</span><span class="si">{</span><span class="n">n_pairing</span><span class="si">}</span><span class="s2">.csv&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/usr/local/lib/python3.9/site-packages/numpy/core/fromnumeric.py:3419: RuntimeWarning: Mean of empty slice.
  return _methods._mean(a, axis=axis, dtype=dtype,
/usr/local/lib/python3.9/site-packages/numpy/core/_methods.py:188: RuntimeWarning: invalid value encountered in double_scalars
  ret = ret.dtype.type(ret / rcount)
/usr/local/lib/python3.9/site-packages/numpy/core/_methods.py:261: RuntimeWarning: Degrees of freedom &lt;= 0 for slice
  ret = _var(a, axis=axis, dtype=dtype, out=out, ddof=ddof,
/usr/local/lib/python3.9/site-packages/numpy/core/_methods.py:253: RuntimeWarning: invalid value encountered in double_scalars
  ret = ret.dtype.type(ret / rcount)
/usr/local/lib/python3.9/site-packages/numpy/core/_methods.py:221: RuntimeWarning: invalid value encountered in true_divide
  arrmean = um.true_divide(arrmean, div, out=arrmean, casting=&#39;unsafe&#39;,
/usr/local/lib/python3.9/site-packages/numpy/core/fromnumeric.py:3419: RuntimeWarning: Mean of empty slice.
  return _methods._mean(a, axis=axis, dtype=dtype,
/usr/local/lib/python3.9/site-packages/numpy/core/_methods.py:188: RuntimeWarning: invalid value encountered in double_scalars
  ret = ret.dtype.type(ret / rcount)
/usr/local/lib/python3.9/site-packages/numpy/core/_methods.py:261: RuntimeWarning: Degrees of freedom &lt;= 0 for slice
  ret = _var(a, axis=axis, dtype=dtype, out=out, ddof=ddof,
/usr/local/lib/python3.9/site-packages/numpy/core/_methods.py:253: RuntimeWarning: invalid value encountered in double_scalars
  ret = ret.dtype.type(ret / rcount)
/usr/local/lib/python3.9/site-packages/numpy/core/_methods.py:221: RuntimeWarning: invalid value encountered in true_divide
  arrmean = um.true_divide(arrmean, div, out=arrmean, casting=&#39;unsafe&#39;,
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>    <span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">entropy</span><span class="p">,</span> <span class="n">sem</span>
    <span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">cache</span>
    <span class="n">n_pairing</span><span class="o">=</span><span class="s1">&#39;average&#39;</span>
    <span class="nd">@cache</span>
    <span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">m</span><span class="p">):</span>
        <span class="n">X</span> <span class="o">=</span> <span class="n">mismatch_pairing</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;alpha_beta_mismatched_pairing&#39;</span><span class="p">][</span><span class="n">m</span><span class="p">]</span>
        <span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">X</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">flatten</span><span class="p">()]</span>
        <span class="n">tmp_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">X</span><span class="p">)))</span>
        <span class="n">tmp_df</span><span class="p">[</span><span class="s1">&#39;index&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tmp_df</span><span class="p">))</span>
        <span class="n">tmp_agg</span> <span class="o">=</span> <span class="n">tmp_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">x</span><span class="p">)[</span><span class="mi">0</span><span class="p">]})</span>
        <span class="n">tmp_agg</span><span class="p">[</span><span class="s1">&#39;n_pairing&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">))</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">tmp_agg</span><span class="o">.</span><span class="n">index</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">tmp_agg</span><span class="p">[</span><span class="s1">&#39;index&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

    <span class="n">entropy_mean_arr</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([[</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mismatch_pairing</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;statistics&#39;</span><span class="p">][</span><span class="s1">&#39;alpha_beta_coherence&#39;</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="s1">&#39;entropys&#39;</span><span class="p">])[</span><span class="n">func</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">m</span><span class="p">)]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">mismatch_pairing</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">)],</span> <span class="n">columns</span><span class="o">=</span><span class="n">mismatch_pairing</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="n">entropy_err_arr</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([[</span><span class="n">sem</span><span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mismatch_pairing</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;statistics&#39;</span><span class="p">][</span><span class="s1">&#39;alpha_beta_coherence&#39;</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="s1">&#39;entropys&#39;</span><span class="p">])[</span><span class="n">func</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">m</span><span class="p">)]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">mismatch_pairing</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">)],</span> <span class="n">columns</span><span class="o">=</span><span class="n">mismatch_pairing</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>


    <span class="n">percentage_mean_arr</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([[</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mismatch_pairing</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;statistics&#39;</span><span class="p">][</span><span class="s1">&#39;alpha_beta_coherence&#39;</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="s1">&#39;max_count_percentages&#39;</span><span class="p">])[</span><span class="n">func</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">m</span><span class="p">)]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">mismatch_pairing</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">)],</span> <span class="n">columns</span><span class="o">=</span><span class="n">mismatch_pairing</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="n">percentage_err_arr</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([[</span><span class="n">sem</span><span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mismatch_pairing</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;statistics&#39;</span><span class="p">][</span><span class="s1">&#39;alpha_beta_coherence&#39;</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="s1">&#39;max_count_percentages&#39;</span><span class="p">])[</span><span class="n">func</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">m</span><span class="p">)]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">mismatch_pairing</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">)],</span> <span class="n">columns</span><span class="o">=</span><span class="n">mismatch_pairing</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

    <span class="n">percentage_mean_arr</span> <span class="o">=</span> <span class="n">percentage_mean_arr</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">percentage_err_arr</span> <span class="o">=</span> <span class="n">percentage_err_arr</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">entropy_mean_arr</span> <span class="o">=</span> <span class="n">entropy_mean_arr</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">entropy_err_arr</span> <span class="o">=</span> <span class="n">entropy_err_arr</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    
    <span class="n">fig</span><span class="p">,</span><span class="n">axes</span><span class="o">=</span><span class="n">createSubplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">palette</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span> 
        <span class="n">j</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">percentage_mean_arr</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span>
                <span class="n">x</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span>
                <span class="n">y</span><span class="o">=</span><span class="n">percentage_mean_arr</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> 
                <span class="n">yerr</span><span class="o">=</span><span class="n">percentage_err_arr</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> 
                <span class="n">color</span><span class="o">=</span><span class="n">palette</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
                <span class="n">x</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span>
                <span class="n">y</span><span class="o">=</span><span class="n">percentage_mean_arr</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span>
                <span class="n">c</span><span class="o">=</span><span class="n">palette</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="p">)</span>
            
            
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">palette</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span> 
        <span class="n">j</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">percentage_mean_arr</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span>
                <span class="n">x</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span>
                <span class="n">y</span><span class="o">=</span><span class="n">entropy_mean_arr</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> 
                <span class="n">yerr</span><span class="o">=</span><span class="n">entropy_err_arr</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> 
                <span class="n">color</span><span class="o">=</span><span class="n">palette</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
                <span class="n">x</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span>
                <span class="n">y</span><span class="o">=</span><span class="n">entropy_mean_arr</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span>
                <span class="n">c</span><span class="o">=</span><span class="n">palette</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="p">)</span>


    <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;./data//20220214_mismatched_pairing/20220214_alpha_beta_coherence_n_pairing_</span><span class="si">{</span><span class="n">n_pairing</span><span class="si">}</span><span class="s2">.pdf&quot;</span><span class="p">)</span>
    <span class="n">percentage_mean_arr</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;./data/20220214_mismatched_pairing/20220214_alpha_beta_coherence_percentage_mean_n_pairing_</span><span class="si">{</span><span class="n">n_pairing</span><span class="si">}</span><span class="s2">.csv&quot;</span><span class="p">)</span>
    <span class="n">percentage_err_arr</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;./data/20220214_mismatched_pairing/20220214_alpha_beta_coherence_percentage_err_n_pairing_</span><span class="si">{</span><span class="n">n_pairing</span><span class="si">}</span><span class="s2">.csv&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="tex2jax_ignore mathjax_ignore section" id="matching-to-known-tcrpmhc-dataset">
<h1>Matching to known TCRpMHC dataset<a class="headerlink" href="#matching-to-known-tcrpmhc-dataset" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">known_tcrpmhc</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;./data/sidhom_tcrbert_10x_covid10x_merged_dataset.csv&quot;</span><span class="p">)</span>
<span class="n">known_tcrpmhc</span>
<span class="n">peptide2epitope</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">unknownepitopename</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
<span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">known_tcrpmhc</span><span class="p">[</span><span class="s1">&#39;peptide&#39;</span><span class="p">],</span> <span class="n">known_tcrpmhc</span><span class="p">[</span><span class="s1">&#39;epitope&#39;</span><span class="p">]):</span>
    <span class="k">if</span> <span class="n">v</span> <span class="o">!=</span> <span class="s1">&#39;-&#39;</span><span class="p">:</span>
        <span class="n">peptide2epitope</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
<span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">known_tcrpmhc</span><span class="p">[</span><span class="s1">&#39;peptide&#39;</span><span class="p">],</span> <span class="n">known_tcrpmhc</span><span class="p">[</span><span class="s1">&#39;epitope&#39;</span><span class="p">]):</span>
    <span class="k">if</span> <span class="n">v</span> <span class="o">==</span> <span class="s1">&#39;-&#39;</span><span class="p">:</span>
        <span class="n">unknownepitopename</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">known_tcrpmhc</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>CDR3a</th>
      <th>CDR3b</th>
      <th>HLA</th>
      <th>peptide</th>
      <th>epitope</th>
      <th>MHC</th>
      <th>source</th>
      <th>comments</th>
      <th>pMHC</th>
      <th>TRAV</th>
      <th>...</th>
      <th>TRBJ</th>
      <th>TRAV_motif</th>
      <th>TRAV_imputed</th>
      <th>TRAJ_motif</th>
      <th>TRAJ_imputed</th>
      <th>TRBV_motif</th>
      <th>TRBV_imputed</th>
      <th>TRBJ_motif</th>
      <th>TRBJ_imputed</th>
      <th>tcr</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>CAAAAYNQGGKLIF</td>
      <td>CATSDPAGMTGGWHGYTF</td>
      <td>A03:01</td>
      <td>KLGGALQAK</td>
      <td>IE-1_CMV</td>
      <td>YFAMYQENVAQTDVDTLYIIYRDYTWAELAYTWY</td>
      <td>10x_donor</td>
      <td>-</td>
      <td>-</td>
      <td>TRAV1-1</td>
      <td>...</td>
      <td>TRBJ1-2</td>
      <td>CAA</td>
      <td>TRAV13-1</td>
      <td>YNQGGKLIF</td>
      <td>TRAJ23</td>
      <td>CATSD</td>
      <td>TRBV24-1</td>
      <td>GYTF</td>
      <td>TRBJ1-2</td>
      <td>CAAAAYNQGGKLIF=CATSDPAGMTGGWHGYTF</td>
    </tr>
    <tr>
      <th>1</th>
      <td>CAAADNYGQNFVF</td>
      <td>CAWSSGEGTDTQYF</td>
      <td>A11:01</td>
      <td>AVFDRKSDAK</td>
      <td>EBNA-3B_EBV</td>
      <td>YYAMYQENVAQTDVDTLYIIYRDYTWAAQAYRWY</td>
      <td>10x_donor</td>
      <td>-</td>
      <td>-</td>
      <td>TRAV25</td>
      <td>...</td>
      <td>TRBJ2-3</td>
      <td>CAA</td>
      <td>TRAV13-1</td>
      <td>DNYGQNFVF</td>
      <td>TRAJ26</td>
      <td>CAW</td>
      <td>TRBV30</td>
      <td>TDTQYF</td>
      <td>TRBJ2-3</td>
      <td>CAAADNYGQNFVF=CAWSSGEGTDTQYF</td>
    </tr>
    <tr>
      <th>2</th>
      <td>CAAAETSYDKVIF</td>
      <td>CASSFSGNTGELFF</td>
      <td>B08:01</td>
      <td>RAKFKQLL</td>
      <td>BZLF1_EBV</td>
      <td>YDSEYRNIFTNTDESNLYLSYNYYTWAVDAYTWY</td>
      <td>10x_donor</td>
      <td>-</td>
      <td>-</td>
      <td>TRAV13-1</td>
      <td>...</td>
      <td>TRBJ2-2</td>
      <td>CAA</td>
      <td>TRAV13-1</td>
      <td>TSYDKVIF</td>
      <td>TRAJ50</td>
      <td>CASS</td>
      <td>TRBV2</td>
      <td>NTGELFF</td>
      <td>TRBJ2-2</td>
      <td>CAAAETSYDKVIF=CASSFSGNTGELFF</td>
    </tr>
    <tr>
      <th>3</th>
      <td>CAAAETSYDKVIF</td>
      <td>CASSFVDRAETQYF</td>
      <td>A11:01</td>
      <td>IVTDFSVIK</td>
      <td>EBNA-3B_EBV</td>
      <td>YYAMYQENVAQTDVDTLYIIYRDYTWAAQAYRWY</td>
      <td>10x_donor</td>
      <td>-</td>
      <td>-</td>
      <td>TRAV13-1</td>
      <td>...</td>
      <td>TRBJ2-5</td>
      <td>CAA</td>
      <td>TRAV13-1</td>
      <td>TSYDKVIF</td>
      <td>TRAJ50</td>
      <td>CASS</td>
      <td>TRBV2</td>
      <td>ETQYF</td>
      <td>TRBJ2-5</td>
      <td>CAAAETSYDKVIF=CASSFVDRAETQYF</td>
    </tr>
    <tr>
      <th>4</th>
      <td>CAAAETSYDKVIF</td>
      <td>CASSFVDRAETQYF</td>
      <td>B08:01</td>
      <td>RAKFKQLL</td>
      <td>BZLF1_EBV</td>
      <td>YDSEYRNIFTNTDESNLYLSYNYYTWAVDAYTWY</td>
      <td>10x_donor</td>
      <td>-</td>
      <td>-</td>
      <td>TRAV13-1</td>
      <td>...</td>
      <td>TRBJ2-5</td>
      <td>CAA</td>
      <td>TRAV13-1</td>
      <td>TSYDKVIF</td>
      <td>TRAJ50</td>
      <td>CASS</td>
      <td>TRBV2</td>
      <td>ETQYF</td>
      <td>TRBJ2-5</td>
      <td>CAAAETSYDKVIF=CASSFVDRAETQYF</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>28636</th>
      <td>CAMMAGTASKLTF</td>
      <td>CASSDWTSGSAPTTDTQYF</td>
      <td>A01:01</td>
      <td>TTDPSFLGRY</td>
      <td>SARS2_NSP3</td>
      <td>-</td>
      <td>Minervina_vax2_inf</td>
      <td>-</td>
      <td>-</td>
      <td>TRAV12-3</td>
      <td>...</td>
      <td>TRBJ2-3</td>
      <td>CAM</td>
      <td>TRAV12-3</td>
      <td>GTASKLTF</td>
      <td>TRAJ44</td>
      <td>CASS</td>
      <td>TRBV2</td>
      <td>TDTQYF</td>
      <td>TRBJ2-3</td>
      <td>CAMMAGTASKLTF=CASSDWTSGSAPTTDTQYF=TRAV12-3=TRA...</td>
    </tr>
    <tr>
      <th>28637</th>
      <td>CAVQAGGANNLFF</td>
      <td>CSADDYSGSSDEQFF</td>
      <td>B15:01</td>
      <td>NQKLIANQF</td>
      <td>SARS2_SPIKE</td>
      <td>-</td>
      <td>Minervina_vax2</td>
      <td>-</td>
      <td>-</td>
      <td>TRAV20</td>
      <td>...</td>
      <td>TRBJ2-1</td>
      <td>CAV</td>
      <td>TRAV1-1</td>
      <td>GANNLFF</td>
      <td>TRAJ36</td>
      <td>CSA</td>
      <td>TRBV20</td>
      <td>EQFF</td>
      <td>TRBJ2-1</td>
      <td>CAVQAGGANNLFF=CSADDYSGSSDEQFF=TRAV20=TRAJ36=TR...</td>
    </tr>
    <tr>
      <th>28638</th>
      <td>CALAMNNYGQNFVF</td>
      <td>CASTPTDNQPQHF</td>
      <td>A01:01</td>
      <td>TTDPSFLGRY</td>
      <td>SARS2_NSP3</td>
      <td>-</td>
      <td>Minervina_inf</td>
      <td>-</td>
      <td>-</td>
      <td>TRAV9-2</td>
      <td>...</td>
      <td>TRBJ1-5</td>
      <td>CAL</td>
      <td>TRAV6</td>
      <td>NYGQNFVF</td>
      <td>TRAJ26</td>
      <td>CAS</td>
      <td>TRBV2</td>
      <td>NQPQHF</td>
      <td>TRBJ1-5</td>
      <td>CALAMNNYGQNFVF=CASTPTDNQPQHF=TRAV9-2=TRAJ26=TR...</td>
    </tr>
    <tr>
      <th>28639</th>
      <td>CAVRDPIGQNFVF</td>
      <td>CASSYRRGANEQFF</td>
      <td>B44:01</td>
      <td>AEVQIDRLI</td>
      <td>SARS2_SPIKE</td>
      <td>-</td>
      <td>Minervina_vax2</td>
      <td>-</td>
      <td>-</td>
      <td>TRAV3</td>
      <td>...</td>
      <td>TRBJ2-1</td>
      <td>CAVR</td>
      <td>TRAV3</td>
      <td>GQNFVF</td>
      <td>TRAJ26</td>
      <td>CASS</td>
      <td>TRBV2</td>
      <td>NEQFF</td>
      <td>TRBJ2-1</td>
      <td>CAVRDPIGQNFVF=CASSYRRGANEQFF=TRAV3=TRAJ26=TRBV...</td>
    </tr>
    <tr>
      <th>28640</th>
      <td>CAIFASYDKVIF</td>
      <td>CASRYVGRREKESNEQFF</td>
      <td>B15:01</td>
      <td>NQKLIANQF</td>
      <td>SARS2_SPIKE</td>
      <td>-</td>
      <td>Minervina_inf_vax2</td>
      <td>-</td>
      <td>-</td>
      <td>TRAV14/DV4</td>
      <td>...</td>
      <td>TRBJ2-1</td>
      <td>CA</td>
      <td>TRAV1-1</td>
      <td>SYDKVIF</td>
      <td>TRAJ50</td>
      <td>CASR</td>
      <td>TRBV12-2</td>
      <td>NEQFF</td>
      <td>TRBJ2-1</td>
      <td>CAIFASYDKVIF=CASRYVGRREKESNEQFF=TRAV14/DV4=TRA...</td>
    </tr>
  </tbody>
</table>
<p>28641 rows × 22 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">known_tcrpmhc</span><span class="p">[</span><span class="s1">&#39;peptide&#39;</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1037
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">peptide_mapping</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">p</span> <span class="ow">in</span> <span class="n">known_tcrpmhc</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,[</span><span class="s1">&#39;CDR3a&#39;</span><span class="p">,</span><span class="s1">&#39;CDR3b&#39;</span><span class="p">,</span><span class="s1">&#39;peptide&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">():</span>
    <span class="n">cdr3</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">-</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">cdr3</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">peptide_mapping</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">peptide_mapping</span><span class="p">[</span><span class="n">cdr3</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">p</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">peptide_mapping</span><span class="p">[</span><span class="n">cdr3</span><span class="p">]:</span>
            <span class="n">peptide_mapping</span><span class="p">[</span><span class="n">cdr3</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">peptide_mapping</span><span class="p">))</span>
<span class="n">_tmp</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">tcr_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,[</span><span class="s1">&#39;CDR3a&#39;</span><span class="p">,</span><span class="s1">&#39;CDR3b&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()):</span>
    <span class="n">cdr3</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">-</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">cdr3</span> <span class="ow">in</span> <span class="n">peptide_mapping</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">_tmp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">peptide_mapping</span><span class="p">[</span><span class="n">cdr3</span><span class="p">]))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">_tmp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
        
<span class="n">tcr_df</span><span class="p">[</span><span class="s1">&#39;alpha_beta_pmhc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_tmp</span>

<span class="n">peptide_mapping</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">p</span> <span class="ow">in</span> <span class="n">known_tcrpmhc</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,[</span><span class="s1">&#39;CDR3a&#39;</span><span class="p">,</span><span class="s1">&#39;CDR3b&#39;</span><span class="p">,</span><span class="s1">&#39;peptide&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">():</span>
    <span class="n">cdr3</span> <span class="o">=</span> <span class="n">a</span>
    <span class="k">if</span> <span class="n">cdr3</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">peptide_mapping</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">peptide_mapping</span><span class="p">[</span><span class="n">cdr3</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">p</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">peptide_mapping</span><span class="p">[</span><span class="n">cdr3</span><span class="p">]:</span>
            <span class="n">peptide_mapping</span><span class="p">[</span><span class="n">cdr3</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
            
            
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">peptide_mapping</span><span class="p">))</span>
<span class="n">_tmp</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">tcr_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,[</span><span class="s1">&#39;CDR3a&#39;</span><span class="p">,</span><span class="s1">&#39;CDR3b&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()):</span>
    <span class="n">cdr3</span> <span class="o">=</span> <span class="n">a</span>
    <span class="k">if</span> <span class="n">cdr3</span> <span class="ow">in</span> <span class="n">peptide_mapping</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">_tmp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">peptide_mapping</span><span class="p">[</span><span class="n">cdr3</span><span class="p">]))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">_tmp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
<span class="n">tcr_df</span><span class="p">[</span><span class="s1">&#39;alpha_pmhc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_tmp</span>

<span class="n">peptide_mapping</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">p</span> <span class="ow">in</span> <span class="n">known_tcrpmhc</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,[</span><span class="s1">&#39;CDR3a&#39;</span><span class="p">,</span><span class="s1">&#39;CDR3b&#39;</span><span class="p">,</span><span class="s1">&#39;peptide&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">():</span>
    <span class="n">cdr3</span> <span class="o">=</span> <span class="n">b</span>
    <span class="k">if</span> <span class="n">cdr3</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">peptide_mapping</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">peptide_mapping</span><span class="p">[</span><span class="n">cdr3</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">p</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">peptide_mapping</span><span class="p">[</span><span class="n">cdr3</span><span class="p">]:</span>
            <span class="n">peptide_mapping</span><span class="p">[</span><span class="n">cdr3</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">peptide_mapping</span><span class="p">))</span>
<span class="n">_tmp</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">tcr_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,[</span><span class="s1">&#39;CDR3a&#39;</span><span class="p">,</span><span class="s1">&#39;CDR3b&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()):</span>
    <span class="n">cdr3</span> <span class="o">=</span> <span class="n">b</span>
    <span class="k">if</span> <span class="n">cdr3</span> <span class="ow">in</span> <span class="n">peptide_mapping</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">_tmp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">peptide_mapping</span><span class="p">[</span><span class="n">cdr3</span><span class="p">]))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">_tmp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
<span class="n">tcr_df</span><span class="p">[</span><span class="s1">&#39;beta_pmhc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_tmp</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>26960
21156
23108
</pre></div>
</div>
</div>
</div>
<div class="section" id="figure-s4b">
<h2>[Figure S4B]<a class="headerlink" href="#figure-s4b" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">disease_types</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">tcr_df</span><span class="p">[</span><span class="s1">&#39;disease_type_1&#39;</span><span class="p">]))</span>
<span class="n">sumstat</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">tcr_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">tcr_df</span><span class="p">[</span><span class="s1">&#39;alpha_beta_pmhc&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;alpha_beta_pmhc&#39;</span><span class="p">]):</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="n">tcr_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">tcr_df</span><span class="p">[</span><span class="s1">&#39;alpha_beta_pmhc&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">,</span> <span class="s1">&#39;disease_type_1&#39;</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">i</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">sumstat</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">sumstat</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">c</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">disease_types</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sumstat</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">c</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">disease_types</span><span class="p">])</span>
<span class="n">sumstat</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">sumstat</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">disease_types</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
<span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
<span class="n">sumstat</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">sumstat</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">3</span><span class="p">,:]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="n">stacked</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;#E64B35&#39;</span><span class="p">,</span><span class="s1">&#39;#4DBBD5&#39;</span><span class="p">,</span><span class="s1">&#39;#029F87&#39;</span><span class="p">,</span><span class="s1">&#39;#3C5488&#39;</span><span class="p">,</span><span class="s1">&#39;#F39B7F&#39;</span><span class="p">,</span><span class="s1">&#39;#8491B4&#39;</span><span class="p">,</span><span class="s1">&#39;#91D1C2&#39;</span><span class="p">,</span><span class="s1">&#39;#7E6048&#39;</span><span class="p">,</span><span class="s1">&#39;#B09C85&#39;</span><span class="p">],</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">sumstat</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">sumstat</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="mi">20</span><span class="p">,:]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="n">stacked</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;#E64B35&#39;</span><span class="p">,</span><span class="s1">&#39;#4DBBD5&#39;</span><span class="p">,</span><span class="s1">&#39;#029F87&#39;</span><span class="p">,</span><span class="s1">&#39;#3C5488&#39;</span><span class="p">,</span><span class="s1">&#39;#F39B7F&#39;</span><span class="p">,</span><span class="s1">&#39;#8491B4&#39;</span><span class="p">,</span><span class="s1">&#39;#91D1C2&#39;</span><span class="p">,</span><span class="s1">&#39;#7E6048&#39;</span><span class="p">,</span><span class="s1">&#39;#B09C85&#39;</span><span class="p">],</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">sumstat</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">sumstat</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">20</span><span class="p">:,:]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="n">stacked</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;#E64B35&#39;</span><span class="p">,</span><span class="s1">&#39;#4DBBD5&#39;</span><span class="p">,</span><span class="s1">&#39;#029F87&#39;</span><span class="p">,</span><span class="s1">&#39;#3C5488&#39;</span><span class="p">,</span><span class="s1">&#39;#F39B7F&#39;</span><span class="p">,</span><span class="s1">&#39;#8491B4&#39;</span><span class="p">,</span><span class="s1">&#39;#91D1C2&#39;</span><span class="p">,</span><span class="s1">&#39;#7E6048&#39;</span><span class="p">,</span><span class="s1">&#39;#B09C85&#39;</span><span class="p">],</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>

<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;./figures/alpha_beta_mhc_disease_composition.pdf&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;AxesSubplot:&gt;
</pre></div>
</div>
<img alt="_images/huARdb_TCR_paper_notebook_110_1.png" src="_images/huARdb_TCR_paper_notebook_110_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">disease_types</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">tcr_df</span><span class="p">[</span><span class="s1">&#39;disease_type_1&#39;</span><span class="p">]))</span>
<span class="n">sumstat</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">tcr_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">tcr_df</span><span class="p">[</span><span class="s1">&#39;beta_pmhc&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;beta_pmhc&#39;</span><span class="p">]):</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="n">tcr_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">tcr_df</span><span class="p">[</span><span class="s1">&#39;beta_pmhc&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">,</span> <span class="s1">&#39;disease_type_1&#39;</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">i</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">sumstat</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">sumstat</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">c</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">disease_types</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sumstat</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">c</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">disease_types</span><span class="p">])</span>
<span class="n">sumstat</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">sumstat</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">disease_types</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

<span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
<span class="n">sumstat</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">sumstat</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">3</span><span class="p">,:]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="n">stacked</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;#E64B35&#39;</span><span class="p">,</span><span class="s1">&#39;#4DBBD5&#39;</span><span class="p">,</span><span class="s1">&#39;#029F87&#39;</span><span class="p">,</span><span class="s1">&#39;#3C5488&#39;</span><span class="p">,</span><span class="s1">&#39;#F39B7F&#39;</span><span class="p">,</span><span class="s1">&#39;#8491B4&#39;</span><span class="p">,</span><span class="s1">&#39;#91D1C2&#39;</span><span class="p">,</span><span class="s1">&#39;#7E6048&#39;</span><span class="p">,</span><span class="s1">&#39;#B09C85&#39;</span><span class="p">],</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">sumstat</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">sumstat</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="mi">11</span><span class="p">,:]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="n">stacked</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;#E64B35&#39;</span><span class="p">,</span><span class="s1">&#39;#4DBBD5&#39;</span><span class="p">,</span><span class="s1">&#39;#029F87&#39;</span><span class="p">,</span><span class="s1">&#39;#3C5488&#39;</span><span class="p">,</span><span class="s1">&#39;#F39B7F&#39;</span><span class="p">,</span><span class="s1">&#39;#8491B4&#39;</span><span class="p">,</span><span class="s1">&#39;#91D1C2&#39;</span><span class="p">,</span><span class="s1">&#39;#7E6048&#39;</span><span class="p">,</span><span class="s1">&#39;#B09C85&#39;</span><span class="p">],</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">sumstat</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">sumstat</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">11</span><span class="p">:</span><span class="mi">50</span><span class="p">,:]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="n">stacked</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;#E64B35&#39;</span><span class="p">,</span><span class="s1">&#39;#4DBBD5&#39;</span><span class="p">,</span><span class="s1">&#39;#029F87&#39;</span><span class="p">,</span><span class="s1">&#39;#3C5488&#39;</span><span class="p">,</span><span class="s1">&#39;#F39B7F&#39;</span><span class="p">,</span><span class="s1">&#39;#8491B4&#39;</span><span class="p">,</span><span class="s1">&#39;#91D1C2&#39;</span><span class="p">,</span><span class="s1">&#39;#7E6048&#39;</span><span class="p">,</span><span class="s1">&#39;#B09C85&#39;</span><span class="p">],</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;./figures/beta_mhc_disease_composition.pdf&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/huARdb_TCR_paper_notebook_111_0.png" src="_images/huARdb_TCR_paper_notebook_111_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">disease_types</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">tcr_df</span><span class="p">[</span><span class="s1">&#39;disease_type_1&#39;</span><span class="p">]))</span>
<span class="n">sumstat</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">tcr_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">tcr_df</span><span class="p">[</span><span class="s1">&#39;alpha_pmhc&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;alpha_pmhc&#39;</span><span class="p">]):</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="n">tcr_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">tcr_df</span><span class="p">[</span><span class="s1">&#39;alpha_pmhc&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">,</span> <span class="s1">&#39;disease_type_1&#39;</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">i</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">sumstat</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">sumstat</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">c</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">disease_types</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sumstat</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">c</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">disease_types</span><span class="p">])</span>
<span class="n">sumstat</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">sumstat</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">disease_types</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

<span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mi">24</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
<span class="n">sumstat</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">sumstat</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">1</span><span class="p">,:]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="n">stacked</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;#E64B35&#39;</span><span class="p">,</span><span class="s1">&#39;#4DBBD5&#39;</span><span class="p">,</span><span class="s1">&#39;#029F87&#39;</span><span class="p">,</span><span class="s1">&#39;#3C5488&#39;</span><span class="p">,</span><span class="s1">&#39;#F39B7F&#39;</span><span class="p">,</span><span class="s1">&#39;#8491B4&#39;</span><span class="p">,</span><span class="s1">&#39;#91D1C2&#39;</span><span class="p">,</span><span class="s1">&#39;#7E6048&#39;</span><span class="p">,</span><span class="s1">&#39;#B09C85&#39;</span><span class="p">],</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">sumstat</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">sumstat</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">6</span><span class="p">,:]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="n">stacked</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;#E64B35&#39;</span><span class="p">,</span><span class="s1">&#39;#4DBBD5&#39;</span><span class="p">,</span><span class="s1">&#39;#029F87&#39;</span><span class="p">,</span><span class="s1">&#39;#3C5488&#39;</span><span class="p">,</span><span class="s1">&#39;#F39B7F&#39;</span><span class="p">,</span><span class="s1">&#39;#8491B4&#39;</span><span class="p">,</span><span class="s1">&#39;#91D1C2&#39;</span><span class="p">,</span><span class="s1">&#39;#7E6048&#39;</span><span class="p">,</span><span class="s1">&#39;#B09C85&#39;</span><span class="p">],</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">sumstat</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">sumstat</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">6</span><span class="p">:</span><span class="mi">10</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="n">stacked</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;#E64B35&#39;</span><span class="p">,</span><span class="s1">&#39;#4DBBD5&#39;</span><span class="p">,</span><span class="s1">&#39;#029F87&#39;</span><span class="p">,</span><span class="s1">&#39;#3C5488&#39;</span><span class="p">,</span><span class="s1">&#39;#F39B7F&#39;</span><span class="p">,</span><span class="s1">&#39;#8491B4&#39;</span><span class="p">,</span><span class="s1">&#39;#91D1C2&#39;</span><span class="p">,</span><span class="s1">&#39;#7E6048&#39;</span><span class="p">,</span><span class="s1">&#39;#B09C85&#39;</span><span class="p">],</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<span class="n">sumstat</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">sumstat</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">10</span><span class="p">:</span><span class="mi">30</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="n">stacked</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;#E64B35&#39;</span><span class="p">,</span><span class="s1">&#39;#4DBBD5&#39;</span><span class="p">,</span><span class="s1">&#39;#029F87&#39;</span><span class="p">,</span><span class="s1">&#39;#3C5488&#39;</span><span class="p">,</span><span class="s1">&#39;#F39B7F&#39;</span><span class="p">,</span><span class="s1">&#39;#8491B4&#39;</span><span class="p">,</span><span class="s1">&#39;#91D1C2&#39;</span><span class="p">,</span><span class="s1">&#39;#7E6048&#39;</span><span class="p">,</span><span class="s1">&#39;#B09C85&#39;</span><span class="p">],</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;./figures/alpha_mhc_disease_composition.pdf&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/huARdb_TCR_paper_notebook_112_0.png" src="_images/huARdb_TCR_paper_notebook_112_0.png" />
</div>
</div>
</div>
</div>
<div class="tex2jax_ignore mathjax_ignore section" id="tcr-deepinsight-result-visualization">
<h1>TCR-DeepInsight Result Visualization<a class="headerlink" href="#tcr-deepinsight-result-visualization" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">result_tcr</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;./data//result_disease_specific_tcr.csv&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">result_tcr</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>disease_type</th>
      <th>tcr_count</th>
      <th>gex_count</th>
      <th>expanded</th>
      <th>tcr_similarity_score</th>
      <th>number_of_individuals</th>
      <th>disease_specificity_score</th>
      <th>cell_type</th>
      <th>common_hla_detailed</th>
      <th>common_hla</th>
      <th>...</th>
      <th>CDR3ab31</th>
      <th>CDR3ab32</th>
      <th>CDR3ab33</th>
      <th>CDR3ab34</th>
      <th>CDR3ab35</th>
      <th>CDR3ab36</th>
      <th>CDR3ab37</th>
      <th>CDR3ab38</th>
      <th>CDR3ab39</th>
      <th>CDR3ab40</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>COVID-19</td>
      <td>4</td>
      <td>35</td>
      <td>True</td>
      <td>273.191894</td>
      <td>3</td>
      <td>29.496277</td>
      <td>Ambiguous</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
    </tr>
    <tr>
      <th>1</th>
      <td>COVID-19</td>
      <td>4</td>
      <td>4</td>
      <td>False</td>
      <td>127.379761</td>
      <td>3</td>
      <td>43.410034</td>
      <td>CD8</td>
      <td>NaN</td>
      <td>DQA101</td>
      <td>...</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
    </tr>
    <tr>
      <th>2</th>
      <td>COVID-19</td>
      <td>5</td>
      <td>7</td>
      <td>True</td>
      <td>240.455994</td>
      <td>3</td>
      <td>154.892883</td>
      <td>CD4</td>
      <td>NaN</td>
      <td>DQA101</td>
      <td>...</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
    </tr>
    <tr>
      <th>3</th>
      <td>COVID-19</td>
      <td>4</td>
      <td>4</td>
      <td>False</td>
      <td>159.867035</td>
      <td>3</td>
      <td>108.853058</td>
      <td>CD4</td>
      <td>A*02:01:01</td>
      <td>A02;DQB103</td>
      <td>...</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
    </tr>
    <tr>
      <th>4</th>
      <td>COVID-19</td>
      <td>4</td>
      <td>4</td>
      <td>False</td>
      <td>112.635986</td>
      <td>3</td>
      <td>106.702087</td>
      <td>CD4</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>7004</th>
      <td>Solid tumor</td>
      <td>12</td>
      <td>28</td>
      <td>True</td>
      <td>181.347839</td>
      <td>11</td>
      <td>132.233948</td>
      <td>Treg</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
    </tr>
    <tr>
      <th>7005</th>
      <td>Solid tumor</td>
      <td>15</td>
      <td>33</td>
      <td>True</td>
      <td>16.236694</td>
      <td>11</td>
      <td>175.397156</td>
      <td>Treg</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
    </tr>
    <tr>
      <th>7006</th>
      <td>Solid tumor</td>
      <td>12</td>
      <td>16</td>
      <td>True</td>
      <td>81.461426</td>
      <td>11</td>
      <td>127.390198</td>
      <td>Treg</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
    </tr>
    <tr>
      <th>7007</th>
      <td>Solid tumor</td>
      <td>16</td>
      <td>22</td>
      <td>True</td>
      <td>77.871338</td>
      <td>12</td>
      <td>136.364624</td>
      <td>Treg</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
    </tr>
    <tr>
      <th>7008</th>
      <td>Solid tumor</td>
      <td>17</td>
      <td>56</td>
      <td>True</td>
      <td>110.237579</td>
      <td>13</td>
      <td>112.070526</td>
      <td>Treg</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
    </tr>
  </tbody>
</table>
<p>7009 rows × 50 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_covid19</span> <span class="o">=</span> <span class="n">result_tcr</span><span class="p">[</span>
    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">result_tcr</span><span class="p">[</span><span class="s2">&quot;disease_type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;COVID-19&#39;</span><span class="p">)</span> <span class="o">&amp;</span>
    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">result_tcr</span><span class="p">[</span><span class="s1">&#39;tcr_count&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">)</span> <span class="o">&amp;</span>
    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">result_tcr</span><span class="p">[</span><span class="s1">&#39;number_of_individuals&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&amp;</span>
    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">result_tcr</span><span class="p">[</span><span class="s1">&#39;tcr_similarity_score&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">600</span><span class="p">)</span> <span class="o">&amp;</span>
    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">result_tcr</span><span class="p">[</span><span class="s1">&#39;disease_specificity_score&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span>
    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">result_tcr</span><span class="p">[</span><span class="s1">&#39;cell_type&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;MAIT&#39;</span><span class="p">)</span>
<span class="p">]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;number_of_individuals&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ion</span><span class="p">()</span>
<span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">createFig</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">df_covid19</span><span class="p">[</span><span class="s1">&#39;tcr_similarity_score&#39;</span><span class="p">],</span> 
    <span class="n">df_covid19</span><span class="p">[</span><span class="s1">&#39;disease_specificity_score&#39;</span><span class="p">],</span>
    <span class="n">c</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">reannotated_prediction_palette</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="o">&gt;</span><span class="mi">300</span><span class="o">**</span><span class="mi">2</span> <span class="k">else</span> <span class="s1">&#39;#D7D7D7&#39;</span><span class="p">,</span> <span class="nb">zip</span><span class="p">(</span><span class="n">df_covid19</span><span class="p">[</span><span class="s1">&#39;cell_type&#39;</span><span class="p">],</span> <span class="n">df_covid19</span><span class="p">[</span><span class="s1">&#39;disease_specificity_score&#39;</span><span class="p">],</span> <span class="n">df_covid19</span><span class="p">[</span><span class="s1">&#39;tcr_similarity_score&#39;</span><span class="p">]))),</span> 
    <span class="n">s</span><span class="o">=</span><span class="n">df_covid19</span><span class="p">[</span><span class="s1">&#39;tcr_count&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">6</span><span class="p">,</span> 
    <span class="n">linewidths</span><span class="o">=</span><span class="mi">0</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.collections.PathCollection at 0x1405c45e0&gt;
</pre></div>
</div>
<img alt="_images/huARdb_TCR_paper_notebook_116_1.png" src="_images/huARdb_TCR_paper_notebook_116_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_solid_tumor</span> <span class="o">=</span> <span class="n">result_tcr</span><span class="p">[</span>
    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">result_tcr</span><span class="p">[</span><span class="s2">&quot;disease_type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Solid tumor&#39;</span><span class="p">)</span> <span class="o">&amp;</span>
    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">result_tcr</span><span class="p">[</span><span class="s1">&#39;tcr_count&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">)</span> <span class="o">&amp;</span>
    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">result_tcr</span><span class="p">[</span><span class="s1">&#39;number_of_individuals&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&amp;</span>
    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">result_tcr</span><span class="p">[</span><span class="s1">&#39;tcr_similarity_score&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">600</span><span class="p">)</span> <span class="o">&amp;</span>
    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">result_tcr</span><span class="p">[</span><span class="s1">&#39;disease_specificity_score&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span>
    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">result_tcr</span><span class="p">[</span><span class="s1">&#39;cell_type&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;MAIT&#39;</span><span class="p">)</span>
<span class="p">]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;number_of_individuals&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ion</span><span class="p">()</span>
<span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">createFig</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">df_solid_tumor</span><span class="p">[</span><span class="s1">&#39;tcr_similarity_score&#39;</span><span class="p">],</span> 
    <span class="n">df_solid_tumor</span><span class="p">[</span><span class="s1">&#39;disease_specificity_score&#39;</span><span class="p">],</span>
    <span class="n">c</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">reannotated_prediction_palette</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="o">&gt;</span><span class="mi">300</span><span class="o">**</span><span class="mi">2</span> <span class="k">else</span> <span class="s1">&#39;#D7D7D7&#39;</span><span class="p">,</span> <span class="nb">zip</span><span class="p">(</span><span class="n">df_solid_tumor</span><span class="p">[</span><span class="s1">&#39;cell_type&#39;</span><span class="p">],</span> <span class="n">df_solid_tumor</span><span class="p">[</span><span class="s1">&#39;disease_specificity_score&#39;</span><span class="p">],</span> <span class="n">df_solid_tumor</span><span class="p">[</span><span class="s1">&#39;tcr_similarity_score&#39;</span><span class="p">]))),</span> 
    <span class="n">s</span><span class="o">=</span><span class="n">df_solid_tumor</span><span class="p">[</span><span class="s1">&#39;tcr_count&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">6</span><span class="p">,</span> 
    <span class="n">linewidths</span><span class="o">=</span><span class="mi">0</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.collections.PathCollection at 0x1405f10d0&gt;
</pre></div>
</div>
<img alt="_images/huARdb_TCR_paper_notebook_117_1.png" src="_images/huARdb_TCR_paper_notebook_117_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_kd</span> <span class="o">=</span> <span class="n">result_tcr</span><span class="p">[</span>
    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">result_tcr</span><span class="p">[</span><span class="s2">&quot;disease_type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Kawasaki disease&#39;</span><span class="p">)</span> <span class="o">&amp;</span>
    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">result_tcr</span><span class="p">[</span><span class="s1">&#39;tcr_count&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">)</span> <span class="o">&amp;</span>
    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">result_tcr</span><span class="p">[</span><span class="s1">&#39;number_of_individuals&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&amp;</span>
    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">result_tcr</span><span class="p">[</span><span class="s1">&#39;tcr_similarity_score&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">600</span><span class="p">)</span> <span class="o">&amp;</span>
    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">result_tcr</span><span class="p">[</span><span class="s1">&#39;disease_specificity_score&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span>
    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">result_tcr</span><span class="p">[</span><span class="s1">&#39;cell_type&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;MAIT&#39;</span><span class="p">)</span>
<span class="p">]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;number_of_individuals&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ion</span><span class="p">()</span>
<span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">createFig</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">df_kd</span><span class="p">[</span><span class="s1">&#39;tcr_similarity_score&#39;</span><span class="p">],</span> 
    <span class="n">df_kd</span><span class="p">[</span><span class="s1">&#39;disease_specificity_score&#39;</span><span class="p">],</span>
    <span class="n">c</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">reannotated_prediction_palette</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="o">&gt;</span><span class="mi">300</span><span class="o">**</span><span class="mi">2</span> <span class="k">else</span> <span class="s1">&#39;#D7D7D7&#39;</span><span class="p">,</span> <span class="nb">zip</span><span class="p">(</span><span class="n">df_kd</span><span class="p">[</span><span class="s1">&#39;cell_type&#39;</span><span class="p">],</span> <span class="n">df_kd</span><span class="p">[</span><span class="s1">&#39;disease_specificity_score&#39;</span><span class="p">],</span> <span class="n">df_kd</span><span class="p">[</span><span class="s1">&#39;tcr_similarity_score&#39;</span><span class="p">]))),</span> 
    <span class="n">s</span><span class="o">=</span><span class="n">df_kd</span><span class="p">[</span><span class="s1">&#39;tcr_count&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">6</span><span class="p">,</span> 
    <span class="n">linewidths</span><span class="o">=</span><span class="mi">0</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.collections.PathCollection at 0x140636100&gt;
</pre></div>
</div>
<img alt="_images/huARdb_TCR_paper_notebook_118_1.png" src="_images/huARdb_TCR_paper_notebook_118_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_as</span> <span class="o">=</span> <span class="n">result_tcr</span><span class="p">[</span>
    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">result_tcr</span><span class="p">[</span><span class="s2">&quot;disease_type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Ankylosing spondylitis&#39;</span><span class="p">)</span> <span class="o">&amp;</span>
    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">result_tcr</span><span class="p">[</span><span class="s1">&#39;tcr_count&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&amp;</span>
    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">result_tcr</span><span class="p">[</span><span class="s1">&#39;number_of_individuals&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span>
    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">result_tcr</span><span class="p">[</span><span class="s1">&#39;tcr_similarity_score&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">600</span><span class="p">)</span> <span class="o">&amp;</span>
    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">result_tcr</span><span class="p">[</span><span class="s1">&#39;disease_specificity_score&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span>
    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">result_tcr</span><span class="p">[</span><span class="s1">&#39;cell_type&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;MAIT&#39;</span><span class="p">)</span>
<span class="p">]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;number_of_individuals&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ion</span><span class="p">()</span>
<span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">createFig</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">df_as</span><span class="p">[</span><span class="s1">&#39;tcr_similarity_score&#39;</span><span class="p">],</span> 
    <span class="n">df_as</span><span class="p">[</span><span class="s1">&#39;disease_specificity_score&#39;</span><span class="p">],</span>
    <span class="n">c</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">reannotated_prediction_palette</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="o">&gt;</span><span class="mi">300</span><span class="o">**</span><span class="mi">2</span> <span class="k">else</span> <span class="s1">&#39;#D7D7D7&#39;</span><span class="p">,</span> <span class="nb">zip</span><span class="p">(</span><span class="n">df_as</span><span class="p">[</span><span class="s1">&#39;cell_type&#39;</span><span class="p">],</span> <span class="n">df_as</span><span class="p">[</span><span class="s1">&#39;disease_specificity_score&#39;</span><span class="p">],</span> <span class="n">df_as</span><span class="p">[</span><span class="s1">&#39;tcr_similarity_score&#39;</span><span class="p">]))),</span> 
    <span class="n">s</span><span class="o">=</span><span class="n">df_as</span><span class="p">[</span><span class="s1">&#39;tcr_count&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">6</span><span class="p">,</span> 
    <span class="n">linewidths</span><span class="o">=</span><span class="mi">0</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.collections.PathCollection at 0x14077b580&gt;
</pre></div>
</div>
<img alt="_images/huARdb_TCR_paper_notebook_119_1.png" src="_images/huARdb_TCR_paper_notebook_119_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_colitis</span> <span class="o">=</span> <span class="n">result_tcr</span><span class="p">[</span>
    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">result_tcr</span><span class="p">[</span><span class="s2">&quot;disease_type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Colitis&#39;</span><span class="p">)</span> <span class="o">&amp;</span>
    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">result_tcr</span><span class="p">[</span><span class="s1">&#39;tcr_count&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&amp;</span>
    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">result_tcr</span><span class="p">[</span><span class="s1">&#39;number_of_individuals&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span>
    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">result_tcr</span><span class="p">[</span><span class="s1">&#39;tcr_similarity_score&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">600</span><span class="p">)</span> <span class="o">&amp;</span>
    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">result_tcr</span><span class="p">[</span><span class="s1">&#39;disease_specificity_score&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span>
    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">result_tcr</span><span class="p">[</span><span class="s1">&#39;cell_type&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;MAIT&#39;</span><span class="p">)</span>
<span class="p">]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;number_of_individuals&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ion</span><span class="p">()</span>
<span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">createFig</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">df_colitis</span><span class="p">[</span><span class="s1">&#39;tcr_similarity_score&#39;</span><span class="p">],</span> 
    <span class="n">df_colitis</span><span class="p">[</span><span class="s1">&#39;disease_specificity_score&#39;</span><span class="p">],</span>
    <span class="n">c</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">reannotated_prediction_palette</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="o">&gt;</span><span class="mi">300</span><span class="o">**</span><span class="mi">2</span> <span class="k">else</span> <span class="s1">&#39;#D7D7D7&#39;</span><span class="p">,</span> <span class="nb">zip</span><span class="p">(</span><span class="n">df_colitis</span><span class="p">[</span><span class="s1">&#39;cell_type&#39;</span><span class="p">],</span> <span class="n">df_colitis</span><span class="p">[</span><span class="s1">&#39;disease_specificity_score&#39;</span><span class="p">],</span> <span class="n">df_colitis</span><span class="p">[</span><span class="s1">&#39;tcr_similarity_score&#39;</span><span class="p">]))),</span> 
    <span class="n">s</span><span class="o">=</span><span class="n">df_colitis</span><span class="p">[</span><span class="s1">&#39;tcr_count&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">6</span><span class="p">,</span> 
    <span class="n">linewidths</span><span class="o">=</span><span class="mi">0</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.collections.PathCollection at 0x1407f6220&gt;
</pre></div>
</div>
<img alt="_images/huARdb_TCR_paper_notebook_120_1.png" src="_images/huARdb_TCR_paper_notebook_120_1.png" />
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            
                <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="intro.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Welcome to the huARdb TCR analysis notebook</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="huARdb_TCR_DeepInsight_notebook.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">TCR-DeepInsight Vignette</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            
        </div>
    </div>
    <footer class="footer">
  <p>
    
      By Ziwei Xue<br/>
    
        &copy; Copyright 2023.<br/>
  </p>
</footer>
</main>


      </div>
    </div>
  
  <script src="_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>